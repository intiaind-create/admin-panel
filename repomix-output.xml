This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.editorconfig
.gitignore
.postcssrc.json
.prettierignore
.prettierrc.json
angular.json
cypress.config.ts
cypress/cypress.config.ts
cypress/e2e/01-auth/login.cy.ts
cypress/e2e/02-dashboard/dashboard.cy.ts
cypress/support/commands.ts
cypress/support/e2e.ts
cypress/support/index.d.ts
cypress/tsconfig.json
eslint.config.js
LICENSE.md
package.json
public/demo/data/candidates.json
public/demo/data/chat.json
public/demo/data/file-management.json
public/demo/data/kanban.json
public/demo/data/mail.json
public/demo/data/members.json
public/demo/data/tasks.json
public/demo/images/avatar/amyelsner.png
public/demo/images/avatar/annafali.png
public/demo/images/avatar/asiyajavayant.png
public/demo/images/avatar/avatar.png
public/demo/images/avatar/bernardodominic.png
public/demo/images/avatar/circle-big/avatar-f-1.png
public/demo/images/avatar/circle-big/avatar-f-1@2x.png
public/demo/images/avatar/circle-big/avatar-f-2.png
public/demo/images/avatar/circle-big/avatar-f-2@2x.png
public/demo/images/avatar/circle-big/avatar-f-3.png
public/demo/images/avatar/circle-big/avatar-f-3@2x.png
public/demo/images/avatar/circle-big/avatar-m-1.png
public/demo/images/avatar/circle-big/avatar-m-1@2x.png
public/demo/images/avatar/circle-big/avatar-m-2.png
public/demo/images/avatar/circle-big/avatar-m-2@2x.png
public/demo/images/avatar/circle-big/avatar-m-3.png
public/demo/images/avatar/circle-big/avatar-m-3@2x.png
public/demo/images/avatar/circle/avatar-f-1.png
public/demo/images/avatar/circle/avatar-f-1@2x.png
public/demo/images/avatar/circle/avatar-f-10.png
public/demo/images/avatar/circle/avatar-f-10@2x.png
public/demo/images/avatar/circle/avatar-f-11.png
public/demo/images/avatar/circle/avatar-f-11@2x.png
public/demo/images/avatar/circle/avatar-f-12.png
public/demo/images/avatar/circle/avatar-f-12@2x.png
public/demo/images/avatar/circle/avatar-f-2.png
public/demo/images/avatar/circle/avatar-f-2@2x.png
public/demo/images/avatar/circle/avatar-f-3.png
public/demo/images/avatar/circle/avatar-f-3@2x.png
public/demo/images/avatar/circle/avatar-f-4.png
public/demo/images/avatar/circle/avatar-f-4@2x.png
public/demo/images/avatar/circle/avatar-f-5.png
public/demo/images/avatar/circle/avatar-f-5@2x.png
public/demo/images/avatar/circle/avatar-f-6.png
public/demo/images/avatar/circle/avatar-f-6@2x.png
public/demo/images/avatar/circle/avatar-f-7.png
public/demo/images/avatar/circle/avatar-f-7@2x.png
public/demo/images/avatar/circle/avatar-f-8.png
public/demo/images/avatar/circle/avatar-f-8@2x.png
public/demo/images/avatar/circle/avatar-f-9.png
public/demo/images/avatar/circle/avatar-f-9@2x.png
public/demo/images/avatar/circle/avatar-m-1.png
public/demo/images/avatar/circle/avatar-m-1@2x.png
public/demo/images/avatar/circle/avatar-m-10.png
public/demo/images/avatar/circle/avatar-m-10@2x.png
public/demo/images/avatar/circle/avatar-m-11.png
public/demo/images/avatar/circle/avatar-m-11@2x.png
public/demo/images/avatar/circle/avatar-m-12.png
public/demo/images/avatar/circle/avatar-m-12@2x.png
public/demo/images/avatar/circle/avatar-m-2.png
public/demo/images/avatar/circle/avatar-m-2@2x.png
public/demo/images/avatar/circle/avatar-m-3.png
public/demo/images/avatar/circle/avatar-m-3@2x.png
public/demo/images/avatar/circle/avatar-m-4.png
public/demo/images/avatar/circle/avatar-m-4@2x.png
public/demo/images/avatar/circle/avatar-m-5.png
public/demo/images/avatar/circle/avatar-m-5@2x.png
public/demo/images/avatar/circle/avatar-m-6.png
public/demo/images/avatar/circle/avatar-m-6@2x.png
public/demo/images/avatar/circle/avatar-m-7-1.png
public/demo/images/avatar/circle/avatar-m-7.png
public/demo/images/avatar/circle/avatar-m-7@2x-1.png
public/demo/images/avatar/circle/avatar-m-7@2x.png
public/demo/images/avatar/circle/avatar-m-8.png
public/demo/images/avatar/circle/avatar-m-8@2x.png
public/demo/images/avatar/circle/avatar-m-9.png
public/demo/images/avatar/circle/avatar-m-9@2x.png
public/demo/images/avatar/elwinsharvill.png
public/demo/images/avatar/ionibowcher.png
public/demo/images/avatar/ivanmagalhaes.png
public/demo/images/avatar/onyamalimba.png
public/demo/images/avatar/profile.jpg
public/demo/images/avatar/square/avatar-f-1.jpg
public/demo/images/avatar/square/avatar-f-1@2x.jpg
public/demo/images/avatar/square/avatar-f-2.jpg
public/demo/images/avatar/square/avatar-f-2@2x.jpg
public/demo/images/avatar/square/avatar-m-1.jpg
public/demo/images/avatar/square/avatar-m-1@2x.jpg
public/demo/images/avatar/stephenshaw.png
public/demo/images/avatar/xuxuefeng.png
public/demo/images/banking/airbnb.png
public/demo/images/banking/amazon.png
public/demo/images/banking/banking.png
public/demo/images/banking/nike.svg
public/demo/images/banking/starbucks.svg
public/demo/images/banking/visa.svg
public/demo/images/blocks/about/about-1.png
public/demo/images/blocks/ad/icon-blocks.svg
public/demo/images/blocks/hero/hero-1.png
public/demo/images/blocks/logos/hyper.svg
public/demo/images/blocks/logos/visa.png
public/demo/images/blocks/team/team-1.png
public/demo/images/blocks/team/team-2.png
public/demo/images/blocks/team/team-3.png
public/demo/images/blocks/team/team-4.png
public/demo/images/blog/blog-1.png
public/demo/images/blog/blog-2.png
public/demo/images/blog/blog-3.png
public/demo/images/blog/blog-4.png
public/demo/images/blog/blog-5.png
public/demo/images/blog/blog-6.png
public/demo/images/blog/blogdetail.png
public/demo/images/contact/map-dark.svg
public/demo/images/contact/map-light.svg
public/demo/images/ecommerce/order-history/orderhistory-1.png
public/demo/images/ecommerce/order-history/orderhistory-2.png
public/demo/images/ecommerce/order-history/orderhistory-3.png
public/demo/images/ecommerce/order-history/orderhistory-4.png
public/demo/images/ecommerce/order-history/orderhistory-5.png
public/demo/images/ecommerce/order-history/orderhistory-6.png
public/demo/images/ecommerce/ordersummary/order-summary-1-1.png
public/demo/images/ecommerce/ordersummary/order-summary-1-2.png
public/demo/images/ecommerce/ordersummary/order-summary-2-1.png
public/demo/images/ecommerce/ordersummary/visa.png
public/demo/images/ecommerce/product-list/product-list-2-1.png
public/demo/images/ecommerce/product-list/product-list-2-2.png
public/demo/images/ecommerce/product-list/product-list-2-3.png
public/demo/images/ecommerce/product-list/product-list-2-4.png
public/demo/images/ecommerce/product-list/product-list-4-1.png
public/demo/images/ecommerce/product-list/product-list-4-2.png
public/demo/images/ecommerce/product-list/product-list-4-3.png
public/demo/images/ecommerce/product-list/product-list-4-4.png
public/demo/images/ecommerce/product-list/product-list-4-5.png
public/demo/images/ecommerce/product-list/product-list-4-6.png
public/demo/images/ecommerce/productoverview/product-overview-1-1.png
public/demo/images/ecommerce/productoverview/product-overview-1-2.png
public/demo/images/ecommerce/productoverview/product-overview-1-3.png
public/demo/images/ecommerce/productoverview/product-overview-2-1.png
public/demo/images/ecommerce/productoverview/product-overview-2-2.png
public/demo/images/ecommerce/productoverview/product-overview-2-3.png
public/demo/images/ecommerce/productoverview/product-overview-2-4.png
public/demo/images/ecommerce/productoverview/product-overview-3-1.png
public/demo/images/ecommerce/productoverview/product-overview-3-2.png
public/demo/images/ecommerce/productoverview/product-overview-3-3.png
public/demo/images/ecommerce/productoverview/product-overview-3-4.png
public/demo/images/ecommerce/productoverview/product-overview-4-1.png
public/demo/images/ecommerce/productoverview/product-overview-4-2.png
public/demo/images/ecommerce/productoverview/product-overview-4-3.png
public/demo/images/ecommerce/productoverview/product-suggestion.png
public/demo/images/ecommerce/shop/flag.png
public/demo/images/ecommerce/shop/shop-1.png
public/demo/images/ecommerce/shop/shop-2.png
public/demo/images/ecommerce/shop/shop-3.png
public/demo/images/ecommerce/shop/shop-4.png
public/demo/images/ecommerce/shop/shop-5.png
public/demo/images/ecommerce/shop/shop-6.png
public/demo/images/ecommerce/shopping-cart/shopping-cart-2-1.png
public/demo/images/ecommerce/shopping-cart/shopping-cart-2-2.png
public/demo/images/landing/chat-dark.png
public/demo/images/landing/chat-light.png
public/demo/images/landing/dashboard-dark.png
public/demo/images/landing/dashboard-light.png
public/demo/images/landing/icon-accessibility.svg
public/demo/images/landing/icon-community.svg
public/demo/images/landing/icon-components.svg
public/demo/images/landing/icon-mobile.svg
public/demo/images/landing/icon-productivity.svg
public/demo/images/landing/icon-support.svg
public/demo/images/landing/icon-theme.svg
public/demo/images/landing/icon-ts.svg
public/demo/images/landing/mail-dark.png
public/demo/images/landing/mail-light.png
public/demo/images/logo-white.svg
public/demo/images/logo.svg
public/demo/images/nature/nature1.jpg
public/demo/images/nature/nature10.jpg
public/demo/images/nature/nature11.jpg
public/demo/images/nature/nature12.jpg
public/demo/images/nature/nature2.jpg
public/demo/images/nature/nature3.jpg
public/demo/images/nature/nature4.jpg
public/demo/images/nature/nature5.jpg
public/demo/images/nature/nature6.jpg
public/demo/images/nature/nature7.jpg
public/demo/images/nature/nature8.jpg
public/demo/images/nature/nature9.jpg
public/demo/images/product/bamboo-watch.jpg
public/demo/images/product/black-watch.jpg
public/demo/images/product/blue-band.jpg
public/demo/images/product/blue-t-shirt.jpg
public/demo/images/product/bracelet.jpg
public/demo/images/product/brown-purse.jpg
public/demo/images/product/chakra-bracelet.jpg
public/demo/images/product/galaxy-earrings.jpg
public/demo/images/product/game-controller.jpg
public/demo/images/product/gaming-set.jpg
public/demo/images/product/gold-phone-case.jpg
public/demo/images/product/green-earbuds.jpg
public/demo/images/product/green-t-shirt.jpg
public/demo/images/product/grey-t-shirt.jpg
public/demo/images/product/headphones.jpg
public/demo/images/product/light-green-t-shirt.jpg
public/demo/images/product/lime-band.jpg
public/demo/images/product/mini-speakers.jpg
public/demo/images/product/painted-phone-case.jpg
public/demo/images/product/pink-band.jpg
public/demo/images/product/pink-purse.jpg
public/demo/images/product/product-placeholder.svg
public/demo/images/product/purple-band.jpg
public/demo/images/product/purple-gemstone-necklace.jpg
public/demo/images/product/purple-t-shirt.jpg
public/demo/images/product/shoes.jpg
public/demo/images/product/sneakers.jpg
public/demo/images/product/teal-t-shirt.jpg
public/demo/images/product/yellow-earbuds.jpg
public/demo/images/product/yoga-mat.jpg
public/demo/images/product/yoga-set.jpg
public/favicon.ico
public/layout/images/avatar.png
public/layout/styles/preloading/preloading.css
public/layout/styles/preloading/preloading.scss
README.md
src/app.component.ts
src/app.config.ts
src/app.routes.ts
src/app/core/auth/auth.routes.ts
src/app/core/auth/login/app-login.html
src/app/core/auth/login/login.ts
src/app/core/auth/setup-password/setup-password.component.ts
src/app/core/guards/auth.guard.ts
src/app/core/services/auth.service.ts
src/app/core/services/convex.service.ts
src/app/features/dashboard/component/dashboard-component.html
src/app/features/dashboard/component/dashboard-component.ts
src/app/features/dashboard/dashboard.service.ts
src/app/features/dashboard/recent-status/recent-submissions-widget.component.html
src/app/features/dashboard/recent-status/recent-submissions-widget.component.ts.ts
src/app/features/dashboard/revenueoverviewwidget.ts
src/app/features/dashboard/salesbycategorywidget.ts
src/app/features/dashboard/status-widgets/statuswidget.component.html
src/app/features/dashboard/status-widgets/statuswidget.ts
src/app/features/dashboard/top-perfomers/top-executives-widget.component.html
src/app/features/dashboard/top-perfomers/top-executives-widget.ts.ts
src/app/features/hr-recruitment/candidate-pipeline/candidate-pipeline-components/candidate-card/candidate-card.component.html
src/app/features/hr-recruitment/candidate-pipeline/candidate-pipeline-components/candidate-card/candidate-card.component.scss
src/app/features/hr-recruitment/candidate-pipeline/candidate-pipeline-components/candidate-card/candidate-card.component.ts
src/app/features/hr-recruitment/candidate-pipeline/candidate-pipeline-components/candidate-detail/candidate-detail.component.html
src/app/features/hr-recruitment/candidate-pipeline/candidate-pipeline-components/candidate-detail/candidate-detail.component.scss
src/app/features/hr-recruitment/candidate-pipeline/candidate-pipeline-components/candidate-detail/candidate-detail.component.ts
src/app/features/hr-recruitment/candidate-pipeline/candidate-pipeline-components/pipeline-stage/pipeline-stage.component.html
src/app/features/hr-recruitment/candidate-pipeline/candidate-pipeline-components/pipeline-stage/pipeline-stage.component.scss
src/app/features/hr-recruitment/candidate-pipeline/candidate-pipeline-components/pipeline-stage/pipeline-stage.component.ts
src/app/features/hr-recruitment/candidate-pipeline/candidate-pipeline.component.html
src/app/features/hr-recruitment/candidate-pipeline/candidate-pipeline.component.scss
src/app/features/hr-recruitment/candidate-pipeline/candidate-pipeline.component.ts
src/app/features/hr-recruitment/candidate-pipeline/services/pipeline.service.ts
src/app/features/hr-recruitment/candidate-pipeline/types/pipeline.types.ts
src/app/features/hr-recruitment/hr-recruitment.routes.ts
src/app/features/hr-recruitment/interfaces/application.interface.ts
src/app/features/hr-recruitment/interfaces/google-sheet.interface.ts
src/app/features/hr-recruitment/interfaces/wards.interface.ts
src/app/features/hr-recruitment/manage-jobs/jobs-form/job-form.component.html
src/app/features/hr-recruitment/manage-jobs/jobs-form/job-form.component.scss
src/app/features/hr-recruitment/manage-jobs/jobs-form/job-form.component.ts
src/app/features/hr-recruitment/manage-jobs/jobs-list/manage-jobs.component.html
src/app/features/hr-recruitment/manage-jobs/jobs-list/manage-jobs.component.scss
src/app/features/hr-recruitment/manage-jobs/jobs-list/manage-jobs.component.ts
src/app/features/hr-recruitment/manage-jobs/services/jobs.service.ts
src/app/features/hr-recruitment/public/component/public-application-form.component.html
src/app/features/hr-recruitment/public/component/public-application-form.component.scss
src/app/features/hr-recruitment/public/component/public-application-form.component.ts
src/app/features/hr-recruitment/public/services/public-application.service.ts
src/app/features/hr-recruitment/services/applications-filter.service.ts
src/app/features/hr-recruitment/services/google-sheets-sync.service.ts
src/app/features/hr-recruitment/services/wards.service.ts
src/app/features/settings/certificate-template/certificate-template.component.html
src/app/features/settings/certificate-template/certificate-template.component.ts
src/app/features/settings/services/certificate.service.ts
src/app/features/settings/services/task-category.service.ts
src/app/features/settings/services/task.service.ts
src/app/features/settings/settings.routes.ts
src/app/features/settings/tasks-settings/task-settings.component.html
src/app/features/settings/tasks-settings/tasks-settings-component.ts
src/app/features/settings/types/certificate.types.ts
src/app/features/settings/types/task.types.ts
src/app/features/store/interfaces/order.interface.ts
src/app/features/store/interfaces/product.interface.ts
src/app/features/store/product-management/product-management.component.html
src/app/features/store/product-management/product-management.component.ts
src/app/features/store/services/orders.service.ts
src/app/features/store/services/product.service.ts
src/app/features/store/store.routes.ts
src/app/features/store/view-orders/view-orders.component.html
src/app/features/store/view-orders/view-orders.component.scss
src/app/features/store/view-orders/view-orders.component.ts
src/app/features/task-management/models/index.ts
src/app/features/task-management/models/task-stats.interface.ts
src/app/features/task-management/models/task.interface.ts
src/app/features/task-management/services/task.service.ts
src/app/features/task-management/task-management.route.ts
src/app/features/task-management/tasks/task-list/tasks-list.component.scss
src/app/features/task-management/tasks/task-list/tasks-list.component.ts
src/app/features/task-management/tasks/task-list/tasks.list.component.html
src/app/features/task-management/tasks/tasks-approve/task-approve.html
src/app/features/task-management/tasks/tasks-approve/task-approve.scss
src/app/features/task-management/tasks/tasks-approve/task-approve.ts
src/app/features/task-management/tasks/tasks-create/task-form.component.html
src/app/features/task-management/tasks/tasks-create/task-form.component.scss
src/app/features/task-management/tasks/tasks-create/task-form.component.ts
src/app/features/training/interfaces/training.interface.ts
src/app/features/training/manage-content/manage-content.component.html
src/app/features/training/manage-content/manage-content.component.scss
src/app/features/training/manage-content/manage-content.component.ts
src/app/features/training/quiz-manager/quiz-manager.component.html
src/app/features/training/quiz-manager/quiz-manager.component.scss
src/app/features/training/quiz-manager/quiz-manager.component.ts
src/app/features/training/saferesourcespipe/safe-resource.pipe.ts
src/app/features/training/services/progress.service.ts
src/app/features/training/services/quiz.service.ts
src/app/features/training/services/training.service.ts
src/app/features/training/training.routes.ts
src/app/features/training/view-progress/view-progress.component.html
src/app/features/training/view-progress/view-progress.component.scss
src/app/features/training/view-progress/view-progress.component.ts
src/app/features/user-management/components/admins/admin-form/admin-rbac-form.component.html
src/app/features/user-management/components/admins/admin-form/admin-rbac-form.component.scss
src/app/features/user-management/components/admins/admin-form/admin-rbac-form.component.ts
src/app/features/user-management/components/admins/admin-list/admin-list.component.html
src/app/features/user-management/components/admins/admin-list/admin-list.component.scss
src/app/features/user-management/components/admins/admin-list/admin-list.component.ts
src/app/features/user-management/components/executives/executive-form/executive-form.component.html
src/app/features/user-management/components/executives/executive-form/executive-form.component.scss
src/app/features/user-management/components/executives/executive-form/executive-form.component.ts
src/app/features/user-management/components/executives/executive-list/executive-list.component.html
src/app/features/user-management/components/executives/executive-list/executive-list.component.scss
src/app/features/user-management/components/executives/executive-list/executive-list.component.ts
src/app/features/user-management/components/interfaces/userinterface.ts
src/app/features/user-management/components/slideindrawer/view-user-drawer.component.html
src/app/features/user-management/components/slideindrawer/view-user-drawer.component.scss
src/app/features/user-management/components/slideindrawer/view-user-drawer.component.ts
src/app/features/user-management/user.management.route.ts
src/app/features/user-management/user.service.ts
src/app/layout/components/app-menu/app.menu.component.html
src/app/layout/components/app-menu/app.menu.ts
src/app/layout/components/app-profile-sidebar/app.profilesidebar.component.html
src/app/layout/components/app-profile-sidebar/app.profilesidebar.ts
src/app/layout/components/app-side-bar/app.sidebar.component.html
src/app/layout/components/app-side-bar/app.sidebar.ts
src/app/layout/components/app-topbar/app.topbar.component.html
src/app/layout/components/app-topbar/app.topbar.ts
src/app/layout/components/app.breadcrumb.ts
src/app/layout/components/app.menuitem.ts
src/app/layout/components/layout/layout.component.html
src/app/layout/components/layout/layout.component.ts
src/app/layout/service/layout.service.ts
src/app/shared/notfound/notfound.component.ts
src/assets/i18n/en.json
src/assets/layout/_breadcrumb.scss
src/assets/layout/_config.scss
src/assets/layout/_content.scss
src/assets/layout/_fonts.scss
src/assets/layout/_main.scss
src/assets/layout/_overrides.scss
src/assets/layout/_profile.scss
src/assets/layout/_responsive.scss
src/assets/layout/_sass_variables.scss
src/assets/layout/_sidebar_drawer.scss
src/assets/layout/_sidebar_horizontal.scss
src/assets/layout/_sidebar_reveal.scss
src/assets/layout/_sidebar_slim_plus.scss
src/assets/layout/_sidebar_slim.scss
src/assets/layout/_sidebar_vertical.scss
src/assets/layout/_topbar.scss
src/assets/layout/_utils.scss
src/assets/layout/fonts/poppins-v20-latin-500.woff
src/assets/layout/fonts/poppins-v20-latin-500.woff2
src/assets/layout/fonts/poppins-v20-latin-600.woff
src/assets/layout/fonts/poppins-v20-latin-600.woff2
src/assets/layout/fonts/poppins-v20-latin-700.woff
src/assets/layout/fonts/poppins-v20-latin-700.woff2
src/assets/layout/fonts/poppins-v20-latin-regular.woff
src/assets/layout/fonts/poppins-v20-latin-regular.woff2
src/assets/layout/images/avatar.png
src/assets/layout/layout.scss
src/assets/layout/menutheme/_colorscheme.scss
src/assets/layout/menutheme/_menutheme.scss
src/assets/layout/menutheme/_primarycolor.scss
src/assets/layout/menutheme/_transparent.scss
src/assets/layout/variables/_common.scss
src/assets/layout/variables/_dark.scss
src/assets/layout/variables/_light.scss
src/assets/styles.scss
src/assets/tailwind.css
src/environment/environment.development.ts
src/environment/prod.environment.ts
src/index.html
src/main.ts
tsconfig.app.json
tsconfig.json
tsconfig.spec.json
vercel.json
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".editorconfig">
# Editor configuration, see https://editorconfig.org
root = true

[*]
charset = utf-8
indent_style = space
indent_size = 4
insert_final_newline = true
trim_trailing_whitespace = true

[*.ts]
quote_type = single

[*.md]
max_line_length = off
trim_trailing_whitespace = false
</file>

<file path=".gitignore">
# Angular build output and cache
/dist
/tmp
/.angular/cache

# Dependencies
/node_modules

# IDE configuration
.idea/
.vscode/
</file>

<file path=".postcssrc.json">
{
    "plugins": {
      "@tailwindcss/postcss": {}
    }
}
</file>

<file path=".prettierignore">
# Ignore artifacts:
build
coverage
dist
out
public
styles
node_modules
.vscode
.angular
*.md
*.yml
/tsconfig.json
*.json
</file>

<file path=".prettierrc.json">
{
    "useTabs": false,
    "tabWidth": 4,
    "trailingComma": "none",
    "semi": true,
    "singleQuote": true,
    "printWidth": 80,
    "bracketSameLine": false,
    "overrides": [
        {
            "files": ["**/*.ts", "**/*.mts", "**/*.d.ts"],
            "options": {
                "parser": "typescript"
            }
        },
        {
            "files": ["**/*.html"],
            "options": {
                "parser": "html"
            }
        },
        {
            "files": ["**/*.component.html"],
            "options": {
                "parser": "angular"
            }
        }
    ]
}
</file>

<file path="angular.json">
{
    "$schema": "./node_modules/@angular/cli/lib/config/schema.json",
    "version": 1,
    "newProjectRoot": "projects",
    "projects": {
        "apollo-ng": {
            "projectType": "application",
            "schematics": {
                "@schematics/angular:component": {
                    "style": "scss"
                }
            },
            "root": "",
            "sourceRoot": "src",
            "prefix": "app",
            "architect": {
                "build": {
                    "builder": "@angular-devkit/build-angular:application",
                    "options": {
                        "outputPath": "dist/apollo-ng",
                        "index": "src/index.html",
                        "browser": "src/main.ts",
                        "polyfills": [
                          "zone.js",
                          "@angular/localize/init"
                        ],
                        "tsConfig": "tsconfig.app.json",
                        "inlineStyleLanguage": "scss",
                        "assets": [
                            {
                                "glob": "**/*",
                                "input": "public"
                            }
                        ],
                        "styles": [
                            "src/assets/styles.scss"
                        ],
                        "scripts": []
                    },
                    "configurations": {
                        "production": {
                            "budgets": [
                                {
                                    "type": "initial",
                                    "maximumWarning": "1mb",
                                    "maximumError": "5mb"
                                },
                                {
                                    "type": "anyComponentStyle",
                                    "maximumWarning": "2kb",
                                    "maximumError": "4kb"
                                }
                            ],
                            "outputHashing": "all"
                        },
                        "development": {
                            "optimization": false,
                            "extractLicenses": false,
                            "sourceMap": true
                        }
                    },
                    "defaultConfiguration": "production"
                },
                "serve": {
                    "builder": "@angular-devkit/build-angular:dev-server",
                    "configurations": {
                        "production": {
                            "buildTarget": "apollo-ng:build:production"
                        },
                        "development": {
                            "buildTarget": "apollo-ng:build:development"
                        }
                    },
                    "defaultConfiguration": "development"
                },
                "extract-i18n": {
                    "builder": "@angular-devkit/build-angular:extract-i18n"
                },
                "test": {
                    "builder": "@angular-devkit/build-angular:karma",
                    "options": {
                        "polyfills": [
                          "zone.js",
                          "zone.js/testing",
                          "@angular/localize/init"
                        ],
                        "tsConfig": "tsconfig.spec.json",
                        "inlineStyleLanguage": "scss",
                         "assets": [
                            "src/favicon.ico",
                            "src/assets"
                        ],
                        "styles": [
                            "node_modules/primeicons/primeicons.css",
                            "src/assets/styles.scss"
                        ],
                        "scripts": []
                    }
                }
            }
        }
    },
    "cli": {
      "analytics": false
    }
}
</file>

<file path="cypress.config.ts">
import { defineConfig } from 'cypress';

export default defineConfig({
  e2e: {
    baseUrl: 'http://localhost:4200',
    specPattern: 'cypress/e2e/**/*.cy.ts',
    supportFile: 'cypress/support/e2e.ts',
    videosFolder: 'cypress/videos',
    screenshotsFolder: 'cypress/screenshots',
    video: true,
    screenshotOnRunFailure: true,
    viewportWidth: 1280,
    viewportHeight: 720,
    defaultCommandTimeout: 10000,
    requestTimeout: 10000,
    responseTimeout: 30000,
    setupNodeEvents(on, config) {
      // You can add custom node event listeners here if needed
    },
  },
});
</file>

<file path="cypress/cypress.config.ts">
import { defineConfig } from 'cypress';

export default defineConfig({
  e2e: {
    baseUrl: 'http://localhost:4200',
    supportFile: 'cypress/support/e2e.ts',
    specPattern: 'cypress/e2e/**/*.cy.ts',
    viewportWidth: 1920,
    viewportHeight: 1080,
    video: true,
    screenshotOnRunFailure: true,
    setupNodeEvents(on, config) {
      return config;
    },
  },
});
</file>

<file path="cypress/e2e/01-auth/login.cy.ts">
// cypress/e2e/01-auth/login.cy.ts
describe('Login', () => {
    beforeEach(() => {
        cy.visit('/auth/login');
        // Intercept ALL possible login endpoints
        cy.intercept('POST', '**/**auth**/**login**').as('loginRequest');
        cy.intercept('POST', '**/**signin**').as('loginRequest');
    });

    it('should login with valid credentials â†’ dashboard', () => {
        cy.get('[data-cy=email-input]').type('superadmin@keralatech.in');
        cy.get('[data-cy=password-input]').type('Admin@123{enter}');

        // Wait for API OR timeout (one will happen)
        cy.wait('@loginRequest', { timeout: 5000 })
            .its('response.statusCode')
            .should('eq', 200);

        cy.url().should('include', '/dashboard');
        cy.get('[data-cy=dashboard-container]').should('be.visible');
    });

    it('should show client validation errors', () => {
        cy.get('[data-cy=email-input]').type('invalid-email');
        cy.get('[data-cy=login-button]').should('be.disabled');
        cy.get('[data-cy=email-error]').should('contain', 'valid email');
    });

    it('should show server validation errors', () => {
        cy.get('[data-cy=email-input]').type('superadmin@keralatech.in');
        cy.get('[data-cy=password-input]').type('wrong{enter}');

        // Mock failed login
        cy.intercept('POST', '**/**login**', { statusCode: 401 }).as(
            'loginFail'
        );
        cy.wait('@loginFail');

        cy.get('[data-cy=toast-container]').should('be.visible');
    });
});
</file>

<file path="cypress/e2e/02-dashboard/dashboard.cy.ts">
describe('Dashboard (After Login)', () => {
  
  beforeEach(() => {
    cy.login()
    cy.visit('/dashboard')
  })

  it('should load dashboard completely without errors', () => {
    cy.get('[data-cy=dashboard-container]').should('be.visible')
    cy.get('[data-cy=stats-loading]').should('not.exist')
    cy.get('[data-cy=dashboard-error]').should('not.exist')
  })

  it('should display task status widget (3 metrics)', () => {
    cy.get('[data-cy=task-status-widget]').should('be.visible')
    cy.get('[data-cy=task-status-widget] .card').should('have.length', 3)
    cy.contains('[data-cy=task-status-widget]', 'Completed Tasks').should('be.visible')
    cy.contains('[data-cy=task-status-widget]', 'Pending Tasks').should('be.visible')
    cy.contains('[data-cy=task-status-widget]', 'In Progress').should('be.visible')
  })

  it('should display navigation cards (4 cards)', () => {
    cy.get('[data-cy=pipeline-nav-card]').should('contain', 'Candidate Pipeline')
    cy.get('[data-cy=executives-nav-card]').should('contain', '75K+')
    cy.get('[data-cy=jobs-nav-card]').should('contain', '3 active')
    cy.get('[data-cy=tasks-nav-card]').should('contain', 'Task Management')
  })

  it('should navigate to pipeline on card click', () => {
    cy.get('[data-cy=pipeline-nav-card]').click()
    cy.url().should('include', '/candidate-pipeline')
    cy.go('back')
    cy.get('[data-cy=dashboard-container]').should('be.visible')
  })

  it('should handle dashboard service error gracefully', () => {
    // Mock API failure for dashboard service
    cy.intercept('GET', '**/api/users/admin/queries/getDashboardSummary**', {
      forceNetworkError: true
    }).as('dashboardError')
    
    cy.visit('/dashboard')
    cy.wait('@dashboardError')
    cy.get('[data-cy=dashboard-error]').should('be.visible')
    cy.get('[data-cy=stats-loading]').should('not.exist')
  })

  it('should show loading state initially', () => {
    cy.visit('/dashboard')
    cy.get('[data-cy=stats-loading]').should('be.visible')
    cy.wait(2000) // Wait for data load
    cy.get('[data-cy=stats-loading]').should('not.exist')
  })
})
</file>

<file path="cypress/support/commands.ts">
// cypress/support/commands.ts

Cypress.Commands.add('login', (email?: string, password?: string) => {
  const loginEmail = email || 'superadmin@keralatech.in'
  const loginPassword = password || 'Admin@123'
  
  cy.session([loginEmail, loginPassword], () => {
    cy.visit('/auth/login')
    cy.get('[data-cy=email-input]').clear().type(loginEmail)
    cy.get('[data-cy=password-input]').clear().type(loginPassword)
    cy.get('[data-cy=login-button]').click()
    cy.url().should('include', '/dashboard')
    cy.get('[data-cy=dashboard-container]').should('be.visible')
  })
})

// No export needed
</file>

<file path="cypress/support/e2e.ts">
// cypress/support/e2e.ts
import './commands'

Cypress.on('uncaught:exception', (err, runnable) => {
  return false
})
</file>

<file path="cypress/support/index.d.ts">
// cypress/support/index.d.ts
/// <reference types="cypress" />

declare namespace Cypress {
  interface Chainable {
    /**
     * Custom command to login with email and password
     * @example cy.login()
     * @example cy.login('user@example.com', 'password123')
     */
    login(email?: string, password?: string): Chainable<void>
  }
}
</file>

<file path="cypress/tsconfig.json">
{
  "compilerOptions": {
    "target": "ES2020",
    "lib": ["ES2020", "DOM"],
    "types": ["cypress", "node"],
    "module": "ESNext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "esModuleInterop": true,
    "allowSyntheticDefaultImports": true,
    "skipLibCheck": true,
    "strict": false,
    "noEmit": true
  },
  "include": [
    "**/*.ts",
    "**/*.cy.ts"
  ],
  "exclude": [
    "support/dist/**/*"
  ]
}
</file>

<file path="eslint.config.js">
export default {
    root: true,
    ignorePatterns: ['**/dist/**'],
    plugins: ['prettier'],
    extends: ['prettier'],
    rules: {
        'padding-line-between-statements': [
            'error',
            { blankLine: 'always', prev: ['const', 'let', 'var'], next: '*' },
            { blankLine: 'any', prev: ['const', 'let', 'var'], next: ['const', 'let', 'var'] },
            { blankLine: 'any', prev: ['case', 'default'], next: 'break' },
            { blankLine: 'any', prev: 'case', next: 'case' },
            { blankLine: 'always', prev: '*', next: 'return' },
            { blankLine: 'always', prev: 'block', next: '*' },
            { blankLine: 'always', prev: '*', next: 'block' },
            { blankLine: 'always', prev: 'block-like', next: '*' },
            { blankLine: 'always', prev: '*', next: 'block-like' },
            { blankLine: 'always', prev: ['import'], next: ['const', 'let', 'var'] }
        ]
    },
    overrides: [
        {
            files: ['*.ts'],
            parserOptions: {
                project: ['tsconfig.json', 'e2e/tsconfig.json'],
                createDefaultProgram: true
            },
            extends: ['eslint:recommended', 'plugin:@typescript-eslint/recommended', 'plugin:@angular-eslint/recommended', 'plugin:@angular-eslint/template/process-inline-templates', 'prettier'],
            rules: {
                '@angular-eslint/component-selector': [
                    'error',
                    {
                        type: 'element',
                        prefix: 'p',
                        style: 'kebab-case'
                    }
                ],
                '@angular-eslint/directive-selector': [
                    'error',
                    {
                        type: 'attribute',
                        prefix: 'p',
                        style: 'camelCase'
                    }
                ],
                '@angular-eslint/component-class-suffix': [
                    'error',
                    {
                        suffixes: ['']
                    }
                ],
                '@angular-eslint/template/eqeqeq': [
                    'error',
                    {
                        allowNullOrUndefined: true
                    }
                ],
                '@angular-eslint/no-host-metadata-property': 'off',
                '@angular-eslint/no-output-on-prefix': 'off',
                '@typescript-eslint/ban-types': 'off',
                '@typescript-eslint/no-explicit-any': 'off',
                '@typescript-eslint/no-inferrable-types': 'off',
                'arrow-body-style': ['error', 'as-needed'],
                curly: 0,
                '@typescript-eslint/member-ordering': [
                    'error',
                    {
                        default: ['public-static-field', 'static-field', 'instance-field', 'public-instance-method', 'public-static-field']
                    }
                ],
                'no-console': 0,
                'prefer-const': 0
            }
        },
        {
            files: ['*.html'],
            extends: ['plugin:@angular-eslint/template/recommended', 'prettier'],
            rules: {}
        },
        {
            files: ['*.js'],
            rules: {
                parserOptions: {
                    allowImportExportEverywhere: true
                }
            }
        }
    ]
};
</file>

<file path="LICENSE.md">
The MIT License (MIT)

Copyright (c) 2018-2022 PrimeTek

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
</file>

<file path="package.json">
{
    "name": "apollo-ng",
    "version": "20.0.0",
    "scripts": {
        "ng": "ng",
        "start": "ng serve",
        "build": "ng build",
        "watch": "ng build --watch --configuration development",
        "format": "prettier --write \"**/*.{js,mjs,ts,mts,d.ts,html}\" --cache",
        "test": "ng test",
        "e2e": "cypress open",
        "e2e:headless": "cypress run",
        "e2e:login": "cypress run --spec 'cypress/e2e/01-auth/login.cy.ts'",
        "e2e:dashboard": "cypress run --spec 'cypress/e2e/02-dashboard/dashboard.cy.ts'"
    },
    "private": true,
    "dependencies": {
        "@angular/animations": "^20",
        "@angular/cdk": "^20.2.7",
        "@angular/common": "^20",
        "@angular/compiler": "^20",
        "@angular/core": "^20",
        "@angular/forms": "^20",
        "@angular/platform-browser": "^20",
        "@angular/platform-browser-dynamic": "^20",
        "@angular/router": "^20",
        "@convex-dev/auth": "^0.0.90",
        "@ngx-translate/core": "^17.0.0",
        "@ngx-translate/http-loader": "^8.0.0",
        "@primeuix/themes": "^1.2.1",
        "@tailwindcss/postcss": "^4.1.11",
        "chart.js": "4.4.2",
        "convex": "^1.28.2",
        "exceljs": "^4.4.0",
        "file-saver": "^2.0.5",
        "jwt-decode": "^4.0.0",
        "primeclt": "^0.1.5",
        "primeicons": "^7.0.0",
        "primeng": "^20",
        "quill": "^2.0.3",
        "rxjs": "~7.8.0",
        "tailwindcss-primeui": "^0.6.1",
        "tslib": "^2.3.0",
        "zone.js": "~0.15.0"
    },
    "devDependencies": {
        "@angular-devkit/build-angular": "^20",
        "@angular/cli": "^20",
        "@angular/compiler-cli": "^20",
        "@angular/localize": "^20.3.3",
        "@cypress/angular": "^4.0.0",
        "@percy/cypress": "^3.1.7",
        "@testing-library/angular": "^18.1.1",
        "@testing-library/user-event": "^14.6.1",
        "@types/file-saver": "^2.0.7",
        "@types/jasmine": "~5.1.0",
        "@types/node": "^24.10.1",
        "autoprefixer": "^10.4.20",
        "cypress": "^15.7.0",
        "eslint": "^9.14.0",
        "eslint-config-prettier": "^9.1.0",
        "eslint-plugin-import": "^2.31.0",
        "eslint-plugin-prefer-arrow": "^1.2.3",
        "eslint-plugin-prettier": "^4.2.1",
        "jasmine-core": "~5.4.0",
        "karma": "~6.4.0",
        "karma-chrome-launcher": "~3.2.0",
        "karma-coverage": "~2.2.0",
        "karma-jasmine": "~5.1.0",
        "karma-jasmine-html-reporter": "~2.1.0",
        "mochawesome": "^7.1.4",
        "mochawesome-merge": "^5.1.0",
        "mochawesome-report-generator": "^6.3.2",
        "nyc": "^17.1.0",
        "postcss": "^8.5.6",
        "prettier": "^3.0.0",
        "tailwindcss": "^4.1.11",
        "typescript": "~5.8.3"
    }
}
</file>

<file path="public/demo/data/candidates.json">
{
    "data": [
        {
            "stageId": "applied",
            "title": "Applied",
            "candidates": [
                {
                    "id": "cand-01",
                    "candidateName": "Elena Rodriguez",
                    "jobTitle": "Senior Frontend Developer",
                    "rating": 4,
                    "appliedDate": "2025-10-01",
                    "source": "LinkedIn",
                    "interviewers": [{"name": "A", "image": "amyelsner.png"}]
                },
                {
                    "id": "cand-02",
                    "candidateName": "Ben Carter",
                    "jobTitle": "UX/UI Designer",
                    "rating": 5,
                    "appliedDate": "2025-10-02",
                    "source": "Referral"
                }
            ]
        },
        {
            "stageId": "screening",
            "title": "Screening",
            "candidates": [
                {
                    "id": "cand-03",
                    "candidateName": "Chen Li",
                    "jobTitle": "Senior Frontend Developer",
                    "rating": 5,
                    "appliedDate": "2025-09-28",
                    "source": "Website",
                    "interviewers": [{"name": "I", "image": "ionibowcher.png"}]
                }
            ]
        },
        {
            "stageId": "interview",
            "title": "Interview",
            "candidates": [
                {
                    "id": "cand-04",
                    "candidateName": "Aisha Khan",
                    "jobTitle": "UX/UI Designer",
                    "rating": 4,
                    "appliedDate": "2025-09-25",
                    "source": "LinkedIn",
                    "interviewers": [{"name": "A", "image": "amyelsner.png"}, {"name": "I", "image": "ionibowcher.png"}]
                }
            ]
        },
        {
            "stageId": "offer",
            "title": "Offer",
            "candidates": []
        }
    ]
}
</file>

<file path="public/demo/data/chat.json">
{
    "data": [
        {
            "id": 1,
            "name": "Ioni Bowcher",
            "image": "ionibowcher.png",
            "status": "active",
            "messages": [
                {
                    "text": "Lorem ipsum dolor sit amet, consectetur adipiscing elit",
                    "ownerId": 1,
                    "createdAt": 1652646338240
                },
                {
                    "text": "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua",
                    "ownerId": 1,
                    "createdAt": 1652646368718
                },
                {
                    "text": "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua",
                    "ownerId": 123,
                    "createdAt": 1652646368718
                }
            ],
            "lastSeen": "2d"
        },
        {
            "id": 2,
            "name": "Stephen Shaw",
            "image": "stephenshaw.png",
            "status": "away",
            "messages": [
                {
                    "text":  "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat",
                    "ownerId": 1,
                    "createdAt": 1652646338240
                },
                {
                    "text": "Consequat mauris nunc congue nisi vitae suscipit.",
                    "ownerId": 1,
                    "createdAt": 1652646368718
                },
                {
                    "text": "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua",
                    "ownerId": 123,
                    "createdAt": 1652646368718
                }
            ],
            "lastSeen": "2d"
        },
        {
            "id": 3,
            "name": "Xuxue Feng",
            "image": "xuxuefeng.png",
            "status": "busy",
            "messages": [
                {
                    "text":  "Duis aute irure dolor in reprehenderit",
                    "ownerId": 1,
                    "createdAt": 1652646338240
                },
                {
                    "text": "Adipiscing tristique risus nec feugiat in fermentum posuere urna nec.",
                    "ownerId": 1,
                    "createdAt": 1652646368718
                },
                {
                    "text": "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua",
                    "ownerId": 123,
                    "createdAt": 1652646368718
                }
            ],
            "lastSeen": "2d"
        },
        {
            "id": 4,
            "name": "Ivan Magalhaes",
            "image": "ivanmagalhaes.png",
            "status": "active",
            "messages": [
                {
                    "text":  "Ut enim ad minim veniam",
                    "ownerId": 1,
                    "createdAt": 1652646338240
                },
                {
                    "text": "Quis nostrud exercitation ullamco laboris nisi ut",
                    "ownerId": 1,
                    "createdAt": 1652646368718
                },
                {
                    "text": "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua",
                    "ownerId": 123,
                    "createdAt": 1652646368718
                }
            ],
            "lastSeen": "2d"
        },
        {
            "id": 4,
            "name": "Onyama Limba",
            "image": "onyamalimba.png",
            "status": "busy",
            "messages": [
                {
                    "text":  "Culpa qui officia deserunt mollit anim id est laborum",
                    "ownerId": 1,
                    "createdAt": 1652646338240
                },
                {
                    "text": "Excepteur sint occaecat cupidatat non proident",
                    "ownerId": 1,
                    "createdAt": 1652646368718
                },
                {
                    "text": "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua",
                    "ownerId": 123,
                    "createdAt": 1652646368718
                }
            ],
            "lastSeen": "2d"
        }
    ]
}
</file>

<file path="public/demo/data/file-management.json">
{
    "files": [
        {
            "name": "nature.jpeg",
            "icon": "pi pi-image",
            "date": "29 Jul 2021",
            "fileSize": "12 MB"
        },
        {
            "name": "report.pdf",
            "icon": "pi pi-image",
            "date": "29 Jul 2021",
            "fileSize": "6 MB"
        },
        {
            "name": "screenshot.jpeg",
            "icon": "pi pi-image",
            "date": "29 Jul 2021",
            "fileSize": "32 MB"
        },
        {
            "name": "sales.xls",
            "icon": "pi pi-file-excel",
            "date": "29 Jul 2021",
            "fileSize": "12 MB"
        },
        {
            "name": "cv.pdf",
            "icon": "pi pi-file-pdf",
            "date": "29 Jul 2021",
            "fileSize": "1.6 MB"
        },
        {
            "name": "product.png",
            "icon": "pi pi-image",
            "date": "29 Jul 2021",
            "fileSize": "1.8 MB"
        },
        {
            "name": "income.xls",
            "icon": "pi pi-file-excel",
            "date": "29 Jul 2021",
            "fileSize": "12 MB"
        },
        {
            "name": "art.png",
            "icon": "pi pi-image",
            "date": "29 Jul 2021",
            "fileSize": "6 MB"
        },
        {
            "name": "expenses.xls",
            "icon": "pi pi-file-excel",
            "date": "29 Jul 2021",
            "fileSize": "12 MB"
        },
        {
            "name": "cv-new.pdf",
            "icon": "pi pi-file-pdf",
            "date": "29 Jul 2021",
            "fileSize": "1.6 MB"
        },
        {
            "name": "revenue.xls",
            "icon": "pi pi-file-excel",
            "date": "29 Jul 2021",
            "fileSize": "12 MB"
        },
        {
            "name": "payment-1.pdf",
            "icon": "pi pi-file-pdf",
            "date": "29 Jul 2021",
            "fileSize": "6 MB"
        },
        {
            "name": "payment-2.pdf",
            "icon": "pi pi-file-pdf",
            "date": "29 Jul 2021",
            "fileSize": "32 MB"
        },
        {
            "name": "invoices.xls",
            "icon": "pi pi-file-excel",
            "date": "29 Jul 2021",
            "fileSize": "12 MB"
        },
        {
            "name": "ads.pdf",
            "icon": "pi pi-file-pdf",
            "date": "29 Jul 2021",
            "fileSize": "1.6 MB"
        }
    ],

    "metrics": [
        {
            "title": "Cloud Storage",
            "icon": "pi pi-ellipsis-v",
            "fieldColor": "bg-yellow-500",
            "color": "bg-yellow-100",
            "files": "412 Files",
            "fileSize": "1.5GB"
        },
        {
            "title": "Dropbox Storage",
            "icon": "pi pi-ellipsis-v",
            "fieldColor": "bg-pink-500",
            "color": "bg-pink-100",
            "files": "200 Files",
            "fileSize": "4.1GB"
        },
        {
            "title": "Google Drive Storage",
            "icon": "pi pi-ellipsis-v",
            "fieldColor": "bg-green-500",
            "color": "bg-green-100",
            "files": "24 Files",
            "fileSize": "1.3GB"
        },
        {
            "title": "Internal Storage",
            "icon": "pi pi-ellipsis-v",
            "fieldColor": "bg-indigo-500",
            "color": "bg-indigo-100",
            "files": "82 Files",
            "fileSize": "5.3GB"
        }
    ],

    "folders_small": [
        {
            "name": "Document Files",
            "icon": "pi pi-folder",
            "size": "1.8 GB"
        }, 
        {
            "name": "Document Files",
            "icon": "pi pi-images",
            "size": "23 GB"
        },
        {
            "name": "Other Files",
            "icon": "pi pi-folder-open",
            "size": "1.8 GB"
        },
        {
            "name": "Unknown Files",
            "icon": "pi pi-folder-open",
            "size": "16 GB"
        }
    ],

    "folders_large": [
        {
            "name": "Miami 2022",
            "icon": "pi pi-folder",
            "size": "12"
        }, 
        {
            "name": "Protoype",
            "icon": "pi pi-folder",
            "size": "1"
        },
        {
            "name": "Other Files",
            "icon": "pi pi-folder",
            "size": "53"
        },
        {
            "name": "Antalya Holiday",
            "icon": "pi pi-folder",
            "size": "1"
        },
        {
            "name": "Studio Photograpy",
            "icon": "pi pi-folder",
            "size": "3"
        },
        {
            "name": "Server Backup",
            "icon": "pi pi-folder-open",
            "size": "9"
        },
        {
            "name": "Document Files",
            "icon": "pi pi-folder",
            "size": "53"
        },
        {
            "name": "Vocals",
            "icon": "pi pi-image",
            "size": "0"
        },
        {
            "name": "Volces",
            "icon": "pi pi-folder-open",
            "size": "6"
        }
    ]
}
</file>

<file path="public/demo/data/kanban.json">
{
    "data": [
        {
            "listId": "1",
            "title": "Backlog",
            "cards" : [
                {
                    "id": "11",
                    "title": "Qualitative resarch planning",
                    "description": "Hey there, weâ€™re just writing to let you know",
                    "startDate":"2022-05-18",
                    "dueDate":"2022-05-18",
                    "completed": false,
                    "progress": 0,
                    "assignees": [
                        {"name": "Ioni Bowcher", "image": "ionibowcher.png"},
                        {"name": "Amy Elsner", "image": "amyelsner.png"}
                    ],
                    "comments": [
                        {"name": "Ioni Bowcher", "image": "ionibowcher.png", "text": "How likely are you to recommend our company"},
                        {"name": "Amy Elsner", "image": "amyelsner.png", "text": "Ok thanks!"}
                    ],
                    "priority": {"color": "#3b82f6", "title": "Medium"},
                    "attachments": 4,
                    "taskList" : {
                        "id" : "1234",
                        "title": "Tasklist",
                        "tasks" : []
                    }
                },
                {
                    "id": "12",
                    "title": "Create new components",
                    "description": "Lorem ipsum dolor sit amet, consectetur adipiscing elit.",
                    "startDate":"2022-05-20",
                    "dueDate":"2022-05-22",
                    "completed": false,
                    "progress": 0,
                    "assignees": [
                        {"name": "Asiya Javayant", "image": "asiyajavayant.png"},
                        {"name": "Xuxue Feng", "image": "amyelsner.png"}
                    ],
                    "comments": [
                        {"name": "Asiya Javayant", "image": "asiyajavayant.png", "text": "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua"},
                        {"name": "Xuxue Feng", "image": "xuxuefeng.png", "text": "Ut enim ad minim veniam"}
                    ],
                    "priority": {"color": "#3b82f6", "title": "Medium"},
                    "attachments": 3,
                    "taskList" : {
                        "id" : "12345",
                        "title": "Tasklist",
                        "tasks" : []
                    }
                },
                {
                    "id": "13",
                    "title": "Create new components",
                    "description": "Lorem ipsum dolor sit amet, consectetur adipiscing elit.",
                    "startDate":"2022-05-20",
                    "dueDate":"2022-05-25",
                    "completed": false,
                    "progress": 0,
                    "assignees": [
                        {"name": "Asiya Javayant", "image": "asiyajavayant.png"},
                        {"name": "Xuxue Feng", "image": "amyelsner.png"}
                    ],
                    "comments": [
                        {"name": "Asiya Javayant", "image": "asiyajavayant.png", "text": "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua"},
                        {"name": "Xuxue Feng", "image": "xuxuefeng.png", "text": "Ut enim ad minim veniam"}
                    ],
                    "priority": {"color": "#3b82f6", "title": "Medium"},
                    "attachments": 12,
                    "taskList" : {
                        "id" : "1245",
                        "title": "Tasklist",
                        "tasks" : []
                    }
                },
                {
                    "id": "14",
                    "title": "Ut enim ad minim veniam",
                    "startDate":"2022-05-24",
                    "dueDate":"2022-05-26",
                    "completed": false,
                    "progress": 0,
                    "assignees": [
                        {"name": "Xuxue Feng", "image": "xuxuefeng.png"}
                    ],
                    "comments": [
                        {"name": "Onyama Limba", "image": "onyamalimba.png", "text": "Adipiscing tristique risus nec"},
                        {"name": "Amy Elsner", "image": "amyelsner.png", "text": "Fermentum posuere urna nec"},
                        {"name": "Ivan Magalhaes", "image": "ivanmagalhaes.png", "text": "Sed do eiusmod tempor"}
                    ],
                    "priority": {"color": "#3b82f6", "title": "Medium"},
                    "attachments": 2,
                    "taskList" : {
                        "id" : "1345",
                        "title": "Tasklist",
                        "tasks" : []
                    }
                }
            ]
        },
        {
            "listId": "2",
            "title": "In Progress",
            "cards" : [
                {
                    "id": "21",
                    "title": "Qualitative resarch planning",
                    "description": "Hey there, weâ€™re just writing to let you know",
                    "startDate":"2022-05-18",
                    "dueDate":"2022-05-22",
                    "completed": false,
                    "progress": 50,
                    "assignees": [
                        {"name": "Ioni Bowcher", "image": "ionibowcher.png"}
                    ],
                    "comments": [
                        {"name": "Ioni Bowcher", "image": "ionibowcher.png", "text": "Ut enim ad minim veniam"},
                        {"name": "Amy Elsner", "image": "amyelsner.png", "text": "Quis nostrud exercitation ullamco laboris"}
                    ],
                    "priority": {"color": "#3b82f6", "title": "Medium"},
                    "attachments": 8,
                    "taskList" : {
                        "id" : "123",
                        "title": "Tasklist",
                        "tasks" : [
                            {
                                "text": "Lorem ipsum dolor sit amet",
                                "completed": false
                            },
                            {
                                "text": "Consectetur adipiscing elit",
                                "completed": true
                            },
                            {
                                "text": "Lorem ipsum dolor sit amet",
                                "completed": false
                            },
                            {
                                "text": "Consectetur adipiscing elit",
                                "completed": true
                            }
                        ]
                    }
                },
                {
                    "id": "22",
                    "title": "Culpa qui officia",
                    "description": "Culpa qui officia deserunt mollit anim id est laborum",
                    "startDate":"2022-05-20",
                    "dueDate":"2022-05-26",
                    "completed": false,
                    "progress": 25,
                    "assignees": [
                        {"name": "Onyama Limba", "image": "onyamalimba.png"},
                        {"name": "Ivan Magalhaes", "image": "ivanmagalhaes.png"},
                        {"name": "Amy Elsner", "image": "amyelsner.png"},
                        {"name": "Xuxue Feng", "image": "xuxuefeng.png"},
                        {"name": "Ioni Bowcher", "image": "ionibowcher.png"}
                    ],
                    "comments": [
                        {"name": "Ioni Bowcher", "image": "ionibowcher.png", "text": "Excepteur sint occaecat cupidatat non proident"},
                        {"name": "Amy Elsner", "image": "amyelsner.png", "text": "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua"}
                    ],
                    "priority": {"color": "#3b82f6", "title": "Medium"},
                    "attachments": 12,
                    "taskList" : {
                        "id" : "2341",
                        "title": "Tasklist",
                        "tasks" : [
                            {
                                "text": "Lorem ipsum dolor sit amet",
                                "completed": false
                            },
                            {
                                "text": "Consectetur adipiscing elit",
                                "completed": true
                            },
                            {
                                "text": "Lorem ipsum dolor sit amet",
                                "completed": false
                            },
                            {
                                "text": "Consectetur adipiscing elit",
                                "completed": false
                            }
                        ]
                    }
                }

            ]
        }
    ]
}
</file>

<file path="public/demo/data/mail.json">
{
    "data": [
        {
            "id": 1000,
            "from": "Ioni Bowcher",
            "email":"ionibowcher@gmail.com",
            "image": "ionibowcher.png",
            "title": "Apply These 7 Secret Techniques To Improve Event  Apply These",
            "message": "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
            "date": "May 30 2022",
            "important": true,
            "starred": false,
            "trash": false,
            "spam": false,
            "archived": false
        },
        {
            "id": 1001,
            "from": "Amy Elsner",
            "email":"amyelsner@gmail.com",
            "image": "amyelsner.png",
            "title": "Nullam purus metus, cras adipiscing magna et, aliquam gravida",
            "message": "Iaculis nunc sed augue lacus viverra vitae. Amet porttitor eget dolor morbi non arcu. Adipiscing commodo elit at imperdiet. Scelerisque viverra mauris in aliquam. Non diam phasellus vestibulum lorem sed risus. Malesuada bibendum arcu vitae elementum curabitur vitae nunc sed velit. Curabitur vitae nunc sed velit dignissim sodales ut eu. Posuere morbi leo urna molestie at elementum eu facilisis. Commodo odio aenean sed adipiscing diam. Arcu non odio euismod lacinia at quis. Viverra suspendisse potenti nullam ac tortor vitae purus. Viverra mauris in aliquam sem fringilla ut morbi. Sed viverra ipsum nunc aliquet bibendum enim facilisis gravida neque. Tristique senectus et netus et malesuada.",
            "date": "May 30 2022",
            "important": false,
            "starred": false,
            "trash": true,
            "spam": false,
            "archived": false
        },
        {
            "id": 1002,
            "from": "Asiya Javayant",
            "email":"asiyajavayant@gmail.com",
            "image": "asiyajavayant.png",
            "title": "Consectetur sed dis viverra lorem. Augue felis sed elit rhoncus non",
            "message": "In tellus integer feugiat scelerisque varius. Auctor neque vitae tempus quam pellentesque nec nam aliquam. Elit pellentesque habitant morbi tristique senectus et netus. Sodales ut etiam sit amet nisl purus in. Ullamcorper morbi tincidunt ornare massa eget egestas purus. Quam vulputate dignissim suspendisse in est ante in nibh. Turpis egestas sed tempus urna et pharetra. Non curabitur gravida arcu ac tortor. Integer malesuada nunc vel risus commodo viverra maecenas accumsan lacus. Massa placerat duis ultricies lacus sed turpis tincidunt id aliquet. Varius duis at consectetur lorem. Ultricies leo integer malesuada nunc vel. Blandit massa enim nec dui. Blandit massa enim nec dui nunc mattis enim. Arcu vitae elementum curabitur vitae nunc sed velit dignissim.",
            "date": "May 28 2022",
            "important": false,
            "starred": false,
            "trash": false,
            "spam": true,
            "archived": false
        },
        {
            "id": 1003,
            "from": "Xuxue Feng",
            "email":"xuexuefeng@gmail.com",
            "image": "xuxuefeng.png",
            "title": "Eget ipsum quam eu a, sit pellentesque molestie tristique.",
            "message": "Euismod lacinia at quis risus. Quis commodo odio aenean sed adipiscing diam donec adipiscing tristique. Risus commodo viverra maecenas accumsan. ",
            "date": "May 28 2022",
            "important": false,
            "starred": true,
            "trash": false,
            "spam": false,
            "archived": false
        },
        {
            "id": 1004,
            "from": "Ivan Magalhaes",
            "email":"ionibowcher@gmail.com",
            "image": "ivanmagalhaes.png",
            "title": "Tincidunt sed vel, ipsum in tincidunt. Scelerisque lectus dolor cras",
            "message": "Cursus mattis molestie a iaculis at erat. Nisi quis eleifend quam adipiscing vitae proin sagittis. Risus quis varius quam quisque id diam vel. Egestas sed sed risus pretium quam vulputate dignissim suspendisse. Dolor morbi non arcu risus quis varius quam quisque id. Eros donec ac odio tempor orci dapibus ultrices in.",
            "date": "May 27 2022",
            "important": false,
            "starred": false,
            "trash": true,
            "spam": false,
            "archived": false
        },
        {
            "id": 1005,
            "from": "Ivan Magalhaes",
            "email":"ivanmagalhaes@gmail.com",
            "image": "ivanmagalhaes.png",
            "title": "Consequat sed nibh laoreet ultrices at elit tellus, nunc. Neque,",
            "message": "Tellus integer feugiat scelerisque varius. Tincidunt vitae semper quis lectus nulla. Ipsum suspendisse ultrices gravida dictum fusce ut placerat orci. Donec massa sapien faucibus et molestie ac. Nibh sit amet commodo nulla. ",
            "date": "May 26 2022",
            "important": false,
            "starred": true,
            "trash": false,
            "spam": false,
            "archived": false
        },
        {
            "id": 1006,
            "from": "Onyama Limba",
            "email":"onyamalimba@gmail.com",
            "image": "onyamalimba.png",
            "title": "Hendrerit pharetra eu eget phasellus orci. Enim mi sed sem",
            "message": " Nullam non nisi est sit amet. Vivamus at augue eget arcu dictum varius duis at consectetur. Dignissim convallis aenean et tortor at risus viverra adipiscing at. A erat nam at lectus urna duis convallis. Cras ornare arcu dui vivamus arcu felis bibendum ut tristique.",
            "date": "May 26 2022",
            "important": false,
            "starred": false,
            "trash": false,
            "spam": false,
            "archived": true
        },
        {
            "id": 1007,
            "from": "Ivan Magalhaes",
            "email":"ivanmagalhes@gmail.com",
            "image": "ivanmagalhaes.png",
            "title": "Consectetur sed dis viverra lorem. Augue felis sed elit rhoncus non ",
            "message": "Dolor purus non enim praesent elementum facilisis leo. Euismod nisi porta lorem mollis aliquam ut. Nec ultrices dui sapien eget mi proin sed libero enim. Morbi tristique senectus et netus et.",
            "date": "May 24 2022",
            "important": false,
            "starred": false,
            "trash": false,
            "spam": false,
            "archived": true
        },
        {
            "id": 1008,
            "from": "Amy Elsner",
            "email":"amyelsner@gmail.com",
            "image": "amyelsner.png",
            "title": "Nullam purus metus, cras adipiscing magna et, aliquam gravida",
            "message": "Iaculis nunc sed augue lacus viverra vitae. Amet porttitor eget dolor morbi non arcu. Adipiscing commodo elit at imperdiet. Scelerisque viverra mauris in aliquam. Non diam phasellus vestibulum lorem sed risus. Malesuada bibendum arcu vitae elementum curabitur vitae nunc sed velit. Curabitur vitae nunc sed velit dignissim sodales ut eu. Posuere morbi leo urna molestie at elementum eu facilisis. Commodo odio aenean sed adipiscing diam. Arcu non odio euismod lacinia at quis. Viverra suspendisse potenti nullam ac tortor vitae purus. Viverra mauris in aliquam sem fringilla ut morbi. Sed viverra ipsum nunc aliquet bibendum enim facilisis gravida neque. Tristique senectus et netus et malesuada.",
            "date": "May 30 2022",
            "important": false,
            "starred": false,
            "trash": true,
            "spam": false,
            "archived": false
        },
        {
            "id": 1009,
            "from": "Asiya Javayant",
            "email":"asiyajavayant@gmail.com",
            "image": "asiyajavayant.png",
            "title": "Consectetur sed dis viverra lorem. Augue felis sed elit rhoncus non",
            "message": "In tellus integer feugiat scelerisque varius. Auctor neque vitae tempus quam pellentesque nec nam aliquam. Elit pellentesque habitant morbi tristique senectus et netus. Sodales ut etiam sit amet nisl purus in. Ullamcorper morbi tincidunt ornare massa eget egestas purus. Quam vulputate dignissim suspendisse in est ante in nibh. Turpis egestas sed tempus urna et pharetra. Non curabitur gravida arcu ac tortor. Integer malesuada nunc vel risus commodo viverra maecenas accumsan lacus. Massa placerat duis ultricies lacus sed turpis tincidunt id aliquet. Varius duis at consectetur lorem. Ultricies leo integer malesuada nunc vel. Blandit massa enim nec dui. Blandit massa enim nec dui nunc mattis enim. Arcu vitae elementum curabitur vitae nunc sed velit dignissim.",
            "date": "May 28 2022",
            "important": true,
            "starred": false,
            "trash": false,
            "spam": false,
            "archived": false
        },
        {
            "id": 1010,
            "from": "Xuxue Feng",
            "email":"xuexuefeng@gmail.com",
            "image": "xuxuefeng.png",
            "title": "Eget ipsum quam eu a, sit pellentesque molestie tristique.",
            "message": "Euismod lacinia at quis risus. Quis commodo odio aenean sed adipiscing diam donec adipiscing tristique. Risus commodo viverra maecenas accumsan. ",
            "date": "May 28 2022",
            "important": false,
            "starred": true,
            "trash": false,
            "spam": false,
            "archived": false
        },
        {
            "id": 1011,
            "from": "Ivan Magalhaes",
            "email":"ionibowcher@gmail.com",
            "image": "ivanmagalhaes.png",
            "title": "Tincidunt sed vel, ipsum in tincidunt. Scelerisque lectus dolor cras",
            "message": "Cursus mattis molestie a iaculis at erat. Nisi quis eleifend quam adipiscing vitae proin sagittis. Risus quis varius quam quisque id diam vel. Egestas sed sed risus pretium quam vulputate dignissim suspendisse. Dolor morbi non arcu risus quis varius quam quisque id. Eros donec ac odio tempor orci dapibus ultrices in.",
            "date": "May 27 2022",
            "important": false,
            "starred": false,
            "trash": false,
            "spam": false,
            "archived": true
        },
        {
            "id": 1012,
            "from": "Ivan Magalhaes",
            "email":"ivanmagalhaes@gmail.com",
            "image": "ivanmagalhaes.png",
            "title": "Consequat sed nibh laoreet ultrices at elit tellus, nunc. Neque,",
            "message": "Tellus integer feugiat scelerisque varius. Tincidunt vitae semper quis lectus nulla. Ipsum suspendisse ultrices gravida dictum fusce ut placerat orci. Donec massa sapien faucibus et molestie ac. Nibh sit amet commodo nulla. ",
            "date": "May 26 2022",
            "important": true,
            "starred": true,
            "trash": false,
            "spam": false,
            "archived": false
        },
        {
            "id": 1013,
            "from": "Onyama Limba",
            "email":"onyamalimba@gmail.com",
            "image": "onyamalimba.png",
            "title": "Hendrerit pharetra eu eget phasellus orci. Enim mi sed sem",
            "message": " Nullam non nisi est sit amet. Vivamus at augue eget arcu dictum varius duis at consectetur. Dignissim convallis aenean et tortor at risus viverra adipiscing at. A erat nam at lectus urna duis convallis. Cras ornare arcu dui vivamus arcu felis bibendum ut tristique.",
            "date": "May 26 2022",
            "important": false,
            "starred": false,
            "trash": false,
            "spam": false,
            "archived": true
        },
        {
            "id": 1014,
            "from": "Ivan Magalhaes",
            "email":"ivanmagalhes@gmail.com",
            "image": "ivanmagalhaes.png",
            "title": "Consectetur sed dis viverra lorem. Augue felis sed elit rhoncus non ",
            "message": "Dolor purus non enim praesent elementum facilisis leo. Euismod nisi porta lorem mollis aliquam ut. Nec ultrices dui sapien eget mi proin sed libero enim. Morbi tristique senectus et netus et.",
            "date": "May 24 2022",
            "important": false,
            "starred": true,
            "trash": false,
            "spam": false,
            "archived": false
        },
        {
            "id": 1015,
            "from": "Amy Elsner",
            "email":"amyelsner@gmail.com",
            "image": "amyelsner.png",
            "title": "Nullam purus metus, cras adipiscing magna et, aliquam gravida",
            "message": "Iaculis nunc sed augue lacus viverra vitae. Amet porttitor eget dolor morbi non arcu. Adipiscing commodo elit at imperdiet. Scelerisque viverra mauris in aliquam. Non diam phasellus vestibulum lorem sed risus. Malesuada bibendum arcu vitae elementum curabitur vitae nunc sed velit. Curabitur vitae nunc sed velit dignissim sodales ut eu. Posuere morbi leo urna molestie at elementum eu facilisis. Commodo odio aenean sed adipiscing diam. Arcu non odio euismod lacinia at quis. Viverra suspendisse potenti nullam ac tortor vitae purus. Viverra mauris in aliquam sem fringilla ut morbi. Sed viverra ipsum nunc aliquet bibendum enim facilisis gravida neque. Tristique senectus et netus et malesuada.",
            "date": "May 30 2022",
            "important": true,
            "starred": false,
            "trash": false,
            "spam": false,
            "archived": false
        },
        {
            "id": 1016,
            "from": "Asiya Javayant",
            "email":"asiyajavayant@gmail.com",
            "image": "asiyajavayant.png",
            "title": "Consectetur sed dis viverra lorem. Augue felis sed elit rhoncus non",
            "message": "In tellus integer feugiat scelerisque varius. Auctor neque vitae tempus quam pellentesque nec nam aliquam. Elit pellentesque habitant morbi tristique senectus et netus. Sodales ut etiam sit amet nisl purus in. Ullamcorper morbi tincidunt ornare massa eget egestas purus. Quam vulputate dignissim suspendisse in est ante in nibh. Turpis egestas sed tempus urna et pharetra. Non curabitur gravida arcu ac tortor. Integer malesuada nunc vel risus commodo viverra maecenas accumsan lacus. Massa placerat duis ultricies lacus sed turpis tincidunt id aliquet. Varius duis at consectetur lorem. Ultricies leo integer malesuada nunc vel. Blandit massa enim nec dui. Blandit massa enim nec dui nunc mattis enim. Arcu vitae elementum curabitur vitae nunc sed velit dignissim.",
            "date": "May 28 2022",
            "important": false,
            "starred": false,
            "trash": false,
            "spam": false,
            "archived": true
        },
        {
            "id": 1017,
            "from": "Xuxue Feng",
            "email":"xuexuefeng@gmail.com",
            "image": "xuxuefeng.png",
            "title": "Eget ipsum quam eu a, sit pellentesque molestie tristique.",
            "message": "Euismod lacinia at quis risus. Quis commodo odio aenean sed adipiscing diam donec adipiscing tristique. Risus commodo viverra maecenas accumsan. ",
            "date": "May 28 2022",
            "important": false,
            "starred": false,
            "trash": false,
            "spam": true,
            "archived": false
        },
        {
            "id": 1018,
            "from": "Ivan Magalhaes",
            "email":"ionibowcher@gmail.com",
            "image": "ivanmagalhaes.png",
            "title": "Tincidunt sed vel, ipsum in tincidunt. Scelerisque lectus dolor cras",
            "message": "Cursus mattis molestie a iaculis at erat. Nisi quis eleifend quam adipiscing vitae proin sagittis. Risus quis varius quam quisque id diam vel. Egestas sed sed risus pretium quam vulputate dignissim suspendisse. Dolor morbi non arcu risus quis varius quam quisque id. Eros donec ac odio tempor orci dapibus ultrices in.",
            "date": "May 27 2022",
            "important": false,
            "starred": false,
            "trash": true,
            "spam": false,
            "archived": false
        },
        {
            "id": 1019,
            "from": "Ivan Magalhaes",
            "email":"ivanmagalhaes@gmail.com",
            "image": "ivanmagalhaes.png",
            "title": "Consequat sed nibh laoreet ultrices at elit tellus, nunc. Neque,",
            "message": "Tellus integer feugiat scelerisque varius. Tincidunt vitae semper quis lectus nulla. Ipsum suspendisse ultrices gravida dictum fusce ut placerat orci. Donec massa sapien faucibus et molestie ac. Nibh sit amet commodo nulla. ",
            "date": "May 26 2022",
            "important": false,
            "starred": true,
            "trash": false,
            "spam": false,
            "archived": false
        },
        {
            "id": 1020,
            "from": "Onyama Limba",
            "email":"onyamalimba@gmail.com",
            "image": "onyamalimba.png",
            "title": "Hendrerit pharetra eu eget phasellus orci. Enim mi sed sem",
            "message": " Nullam non nisi est sit amet. Vivamus at augue eget arcu dictum varius duis at consectetur. Dignissim convallis aenean et tortor at risus viverra adipiscing at. A erat nam at lectus urna duis convallis. Cras ornare arcu dui vivamus arcu felis bibendum ut tristique.",
            "date": "May 26 2022",
            "important": false,
            "starred": false,
            "trash": false,
            "spam": true,
            "archived": false
        },
        {
            "id": 1021,
            "from": "Ivan Magalhaes",
            "email":"ivanmagalhes@gmail.com",
            "image": "ivanmagalhaes.png",
            "title": "Consectetur sed dis viverra lorem. Augue felis sed elit rhoncus non ",
            "message": "Dolor purus non enim praesent elementum facilisis leo. Euismod nisi porta lorem mollis aliquam ut. Nec ultrices dui sapien eget mi proin sed libero enim. Morbi tristique senectus et netus et.",
            "date": "May 24 2022",
            "important": true,
            "starred": true,
            "trash": false,
            "spam": false,
            "archived": false
        },
        {
            "id": 1022,
            "from": "Onyama Limba",
            "email":"ionibowcher@gmail.com",
            "image": "onyamalimba.png",
            "title": "Nullam purus metus, cras adipiscing magna et, aliquam gravida",
            "message": "Sed turpis tincidunt id aliquet risus feugiat in ante metus. Id semper risus in hendrerit. Placerat duis ultricies lacus sed. Non tellus orci ac auctor augue mauris augue.",
            "date": "May 15 2022",
            "important": false,
            "starred": false,
            "trash": false,
            "spam": false,
            "archived": true
        },
        {
            "id": 2000,
            "to": "Ioni Bowcher",
            "email":"ionibowcher@gmail.com",
            "image": "ionibowcher.png",
            "title": "Apply These 7 Secret Techniques To Improve Event  Apply These",
            "message": "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
            "date": "May 30 2022",
            "starred": false,
            "trash": false,
            "archived": false,
            "sent" : true
        },
        {
            "id": 2001,
            "to": "Amy Elsner",
            "email":"amyelsner@gmail.com",
            "image": "amyelsner.png",
            "title": "Nullam purus metus, cras adipiscing magna et, aliquam gravida",
            "message": "Iaculis nunc sed augue lacus viverra vitae. Amet porttitor eget dolor morbi non arcu. Adipiscing commodo elit at imperdiet. Scelerisque viverra mauris in aliquam. Non diam phasellus vestibulum lorem sed risus. Malesuada bibendum arcu vitae elementum curabitur vitae nunc sed velit. Curabitur vitae nunc sed velit dignissim sodales ut eu. Posuere morbi leo urna molestie at elementum eu facilisis. Commodo odio aenean sed adipiscing diam. Arcu non odio euismod lacinia at quis. Viverra suspendisse potenti nullam ac tortor vitae purus. Viverra mauris in aliquam sem fringilla ut morbi. Sed viverra ipsum nunc aliquet bibendum enim facilisis gravida neque. Tristique senectus et netus et malesuada.",
            "date": "May 30 2022",
            "starred": true,
            "trash": false,
            "archived": false,
            "sent" : true
        },
        {
            "id": 2002,
            "to": "Asiya Javayant",
            "email":"asiyajavayant@gmail.com",
            "image": "asiyajavayant.png",
            "title": "Consectetur sed dis viverra lorem. Augue felis sed elit rhoncus non",
            "message": "In tellus integer feugiat scelerisque varius. Auctor neque vitae tempus quam pellentesque nec nam aliquam. Elit pellentesque habitant morbi tristique senectus et netus. Sodales ut etiam sit amet nisl purus in. Ullamcorper morbi tincidunt ornare massa eget egestas purus. Quam vulputate dignissim suspendisse in est ante in nibh. Turpis egestas sed tempus urna et pharetra. Non curabitur gravida arcu ac tortor. Integer malesuada nunc vel risus commodo viverra maecenas accumsan lacus. Massa placerat duis ultricies lacus sed turpis tincidunt id aliquet. Varius duis at consectetur lorem. Ultricies leo integer malesuada nunc vel. Blandit massa enim nec dui. Blandit massa enim nec dui nunc mattis enim. Arcu vitae elementum curabitur vitae nunc sed velit dignissim.",
            "date": "May 28 2022",
            "starred": false,
            "trash": false,
            "archived": false,
            "sent" : true
        }
    ]
}
</file>

<file path="public/demo/data/members.json">
{
    "data": [
        {
            "id": 1000,
            "name": "Ioni Bowcher",
            "image": "ionibowcher.png"
        },
        {
            "id": 1001,
            "name": "Amy Elsner",
            "image": "amyelsner.png"
        },
        {
            "id": 1002,
            "name": "Asiya Javayant",
            "image": "asiyajavayant.png"
        },
        {
            "id": 1003,
            "name": "Xuxue Feng",
            "image": "xuxuefeng.png"
        },
        {
            "id": 1004,
            "name": "Ivan Magalhaes",
            "image": "ivanmagalhaes.png"
        },
        {
            "id": 1005,
            "name": "Ivan Magalhaes",
            "image": "ivanmagalhaes.png"
        },
        {
            "id": 1006,
            "name": "Onyama Limba",
            "image": "onyamalimba.png"
        },
        {
            "id": 1007,
            "name": "Ivan Magalhaes",
            "image": "ivanmagalhaes.png"
        },
        {
            "id": 1008,
            "name": "Onyama Limba",
            "image": "onyamalimba.png"
        }
    ]
}
</file>

<file path="public/demo/data/tasks.json">
{
    "data": [
        {
            "id": 1,
            "name": "Create a New Landing UI",
            "description": "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Enim eu turpis egestas pretium aenean pharetra magna.",
            "startDate": "2022-05-13",
            "endDate": "2022-05-15",
            "members":[
                {
                    "name": "Ioni Bowcher",
                    "image": "ionibowcher.png"
                },
                {
                    "name": "Amy Elsner",
                    "image": "amyelsner.png"
                },
                {
                    "name": "Asiya Javayant",
                    "image": "asiyajavayant.png"
                }
            ],
            "completed": false,
            "status": "Approved",
            "comments": 3,
            "attachments": 2
        },
        {
            "id": 2,
            "name": "Create Dashboard",
            "description": "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Enim eu turpis egestas pretium aenean pharetra magna.",
            "startDate": "2022-05-16",
            "endDate": "2022-05-20",
            "members":[
                {
                    "name": "Onyama Limba",
                    "image": "onyamalimba.png"
                },
                {
                    "name": "Ivan Magalhaes",
                    "image": "ivanmagalhaes.png"
                }
            ],
            "completed": false,
            "status": "Waiting",
            "comments": 2,
            "attachments": 4
        },
        {
            "id": 3,
            "name": "Brand logo design",
            "description": "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Enim eu turpis egestas pretium aenean pharetra magna.",
            "startDate": "2022-05-17",
            "endDate": "2022-05-18",
            "members":[
                {
                    "name": "Ioni Bowcher",
                    "image": "ionibowcher.png"
                },
                {
                    "name": "Amy Elsner",
                    "image": "amyelsner.png"
                },
                {
                    "name": "Asiya Javayant",
                    "image": "asiyajavayant.png"
                }
            ],
            "completed": null,
            "status": "Approved",
            "comments": 4,
            "attachments": 1
        },
        {
            "id": 4,
            "name": "Create Dashboard",
            "description": "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Enim eu turpis egestas pretium aenean pharetra magna.",
            "startDate": "2022-05-20",
            "endDate": "2022-05-22",
            "members":[
                {
                    "name": "Onyama Limba",
                    "image": "onyamalimba.png"
                },
                {
                    "name": "Ivan Magalhaes",
                    "image": "ivanmagalhaes.png"
                }
            ],
            "completed": null,
            "status": "Approved",
            "comments": 1,
            "attachments": 3
        },
        {
            "id": 5,
            "name": "Rebranding For Peak",
            "description": "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Enim eu turpis egestas pretium aenean pharetra magna.",
            "startDate": "2022-05-24",
            "endDate": "2022-05-26",
            "members":[
                {
                    "name": "Ioni Bowcher",
                    "image": "ionibowcher.png"
                },
                {
                    "name": "Amy Elsner",
                    "image": "amyelsner.png"
                }
            ],
            "completed": false,
            "status": "Waiting",
            "comments": 5,
            "attachments": 2
        },
        {
            "id": 6,
            "name": "Create Mobile UI",
            "description": "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Enim eu turpis egestas pretium aenean pharetra magna.",
            "startDate": "2022-05-13",
            "endDate": "2022-05-15",
            "members":[
                {
                    "name": "Onyama Limba",
                    "image": "onyamalimba.png"
                },
                {
                    "name": "Ivan Magalhaes",
                    "image": "ivanmagalhaes.png"
                }
            ],
            "completed": null,
            "status": "Approved",
            "comments": 1,
            "attachments": 2
        },
        {
            "id": 7,
            "name": "Create a New Marketing Project",
            "description": "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Enim eu turpis egestas pretium aenean pharetra magna.",
            "startDate": "2022-05-13",
            "endDate": "2022-05-15",
            "members":[
                {
                    "name": "Ioni Bowcher",
                    "image": "ionibowcher.png"
                },
                {
                    "name": "Asiya Javayant",
                    "image": "asiyajavayant.png"
                },
                {
                    "name": "Xuxue Feng",
                    "image": "xuxuefeng.png"
                }
            ],
            "completed": true,
            "status": "Complete",
            "comments": 7,
            "attachments": 4
        },
        {
            "id": 8,
            "name": "Analyze New Sprint",
            "description": "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Enim eu turpis egestas pretium aenean pharetra magna.",
            "startDate": "2022-05-10",
            "endDate": "2022-05-12",
            "members":[
                {
                    "name": "Ioni Bowcher",
                    "image": "ionibowcher.png"
                }
            ],
            "completed": true,
            "status": "Complete",
            "comments": 3,
            "attachments": 2
        },
        {
            "id": 9,
            "name": "Create New Icon Set",
            "description": "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Enim eu turpis egestas pretium aenean pharetra magna.",
            "startDate": "2022-05-13",
            "endDate": "2022-05-15",
            "members":[
                {
                    "name": "Onyama Limba",
                    "image": "onyamalimba.png"
                },
                {
                    "name": "Ivan Magalhaes",
                    "image": "ivanmagalhaes.png"
                },
                {
                    "name": "Asiya Javayant",
                    "image": "asiyajavayant.png"
                }
            ],
            "completed": true,
            "status": "Complete",
            "comments": 1,
            "attachments": 3
        }
    ]
}
</file>

<file path="public/demo/images/banking/nike.svg">
<svg width="192.756px" height="192.756px" viewBox="0 0 192.756 192.756" xmlns="http://www.w3.org/2000/svg"><g fill-rule="evenodd" clip-rule="evenodd"><path fill="#fff" d="M0 0h192.756v192.756H0V0z"/><path d="M42.741 71.477c-9.881 11.604-19.355 25.994-19.45 36.75-.037 4.047 1.255 7.58 4.354 10.256 4.46 3.854 9.374 5.213 14.264 5.221 7.146.01 14.242-2.873 19.798-5.096 9.357-3.742 112.79-48.659 112.79-48.659.998-.5.811-1.123-.438-.812-.504.126-112.603 30.505-112.603 30.505a24.771 24.771 0 0 1-6.524.934c-8.615.051-16.281-4.731-16.219-14.808.024-3.943 1.231-8.698 4.028-14.291z"/></g></svg>
</file>

<file path="public/demo/images/banking/starbucks.svg">
<?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 16.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1"
	 id="svg3003" sodipodi:docname="Starbucks_Corporation_Logo_2011.svg" inkscape:version="0.48.0 r9654" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
	 xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="297.474px" height="299px"
	 viewBox="1.263 0.5 297.474 299" enable-background="new 1.263 0.5 297.474 299" xml:space="preserve">
<title  id="title3036">Starbucks Corporation
 Logo</title>
<sodipodi:namedview  id="namedview3015" inkscape:current-layer="svg3003" inkscape:window-y="-8" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-height="750" inkscape:window-width="1280" inkscape:window-x="-8" inkscape:window-maximized="1" inkscape:cy="219.77498" inkscape:cx="108.82718" inkscape:zoom="2.3162919" showgrid="false" borderopacity="1" pagecolor="#ffffff" guidetolerance="10" bordercolor="#666666" gridtolerance="10" objecttolerance="10">
	</sodipodi:namedview>
<g id="text3021" transform="matrix(2.7809611,0,0,2.7809611,-616.7962,-1116.1732)">
</g>
<g id="g4387">
	<path id="path3040" fill="#FFFFFF" d="M298.736,150c0,82.567-66.592,149.5-148.736,149.5C67.855,299.5,1.263,232.568,1.263,150
		C1.263,67.434,67.855,0.5,150,0.5C232.145,0.5,298.736,67.434,298.736,150z"/>
	<g id="g4381">
		<path id="inner_artwork" inkscape:connector-curvature="0" fill="#007042" d="M148.758,53.65
			c5.236,3.018,10.79,6.902,15.018,11.018l-1.661,1.669c-8.343-0.887-17.13,0.22-25.039,0.342c-0.882-0.89-2.659-2.228-1.004-3.346
			L148.758,53.65L148.758,53.65z M296.279,157.287c0.111,3.766,0.465,7-1.004,10.854c-15.242,4.335-25.254-11.803-40.043-9.369
			l1.672,8.365c13.682,0.45,22.228,13.57,36.363,13.006c-2.008,4.011,0.896,14.578-8.001,10.354
			c-9.235-2.219-15.912-10.354-26.032-10.354c-1.221,2.242-0.448,5.346-0.662,7.998c10.676,1.675,18.354,10.698,29.027,12.364
			c-1.004,3.668-1.999,7.775-5.005,10.012c-8.683-2.113-15.465-9.911-24.709-9.688l-1.646,7.681
			c8.785,0.226,14.461,7.998,22.356,10.331c0.217,3.24-2.679,6.135-4.347,9.027c-7.009-2.105-12.354-8.126-20.362-7.682
			c-0.111-3.017,1.68-6.443,1.004-9.669c-8.994,2.675-15.025-5.682-21.691-10.695c-0.192-16.405-17.462-27.167-18.374-42.535
			c-0.175-3.064,0.292-6.335,1.688-9.85c5.676-13.124,3.893-30.163-2.331-42.399c-1.891-3.22-5.242-5.762-8.365-7.655
			c4.569,9.683,10.137,21.124,7.358,33.026c-0.322,9.191-5.745,18.018-5.807,26.878c-0.021,3.159,0.653,6.318,2.47,9.508
			c7.236,13.032,20.254,25.368,15.359,41.712c-1.346,5.02-5.354,8.902-6.354,14.011c8.465,7.011,16.469,14.911,27.701,15.356
			c4.002-2.556,1.779-13.891,10.012-8.663l12.021,6.013c-0.876,3.218-3.57,6.102-6.01,8.318c-4.561-2.22-9.01-4.881-14.697-4.664
			c-1.677,1.779-3.12,3.776-2.992,6.329c4.002,0.659,7.673,2.348,11.016,4.688c-1.552,3.343-4.577,5.438-7.358,7.998l-9.325-3.334
			c-1.557,2.228-4.791,4.569-3.656,7.014c2.104,0.901,4.438,2.119,5.987,3.68c-4.116,4.449-9.333,7.311-14.353,10.331
			c-4.324-14.133-18.571-24.042-17.348-40.386l-0.662-0.661c-3.349,3.765-2.23,9.786-2.014,14.672
			c4.008,10.237,13.568,18.144,15.018,29.37c-1.674,2.889-5.448,3.465-8.343,4.688c0.336-20.24-30.365-35.591-10.677-56.064
			c6.566-10.025,17.567-19.592,13.669-33.394c-4.002-13.326-18.157-21.583-18.032-36.522l0.022-1.165
			c3.224-15.579,13.018-32.156,5.006-48.729c-2.233-6.666-7.222-14.241-14.008-17.027c10.117,11.58,14.128,30.474,8.34,46.056
			c-2.917,6.198-6.933,13.582-7.336,20.868h-0.024c-0.215,3.805,0.562,7.589,3.017,11.177c7.682,12.464,21.024,26.155,13.349,42.398
			c-8.676,13.01-23.805,26.244-15.356,43.38c6.118,10.234,15.582,20.446,13.029,33.027l-10.012,3.334
			c6.675-23.466-26.035-37.254-12.342-60.728c8.454-12.57,23.574-24.364,15.015-41.047c-5.117-10.337-15.69-16.455-15.356-29.373
			l0.364-2.169c3.445-18.321,17.372-35.663,7.634-55.241c-2.559-5.781-7.673-11.675-13.349-15.015l-0.343,0.343
			c11.353,11.013,14.807,29.133,8.686,43.699c-2.856,8.546-9.124,17.059-10.398,26.217c-0.606,4.318-0.095,8.793,2.4,13.507
			c7.23,11.449,19.909,23.594,11.997,38.396c-8.332,12.226-22.242,24.122-16.686,40.021c6.12,13.91,18.899,27.161,11.999,44.409
			l-10.331,2.333c8.229-16.809-4.11-33.488-11.338-48.066c-8.793-20.915,18.892-30.93,19.336-50.052
			c-0.105-12.342-13.226-19.35-15.999-30.696c-5.679-4.791-11.565,1.905-18.354,0.662c-5.012,1.007-12.71-6.899-15.702,1.671
			c-3.563,12.564-19.795,21.801-12.661,36.703c6.788,13.243,23.124,22.927,17.667,40.065c-4.886,16.008-21.026,31.25-11.016,49.713
			c-4.112-1.332-11.791,1.218-11.68-5.351c-6.338-22.359,20.69-35.385,12.342-57.732c-3.885-13.688-21.586-21.25-17.689-37.713
			c2.881-13.552,18.088-23.026,15.955-37.871c-0.173-1.243-0.479-2.515-0.916-3.841c-5.676-16.019-17.256-32.042-10.354-50.738
			c1.895-5.34,5.68-9.9,9.006-14.673c-11.014,5.894-16.57,18.357-16.342,31.036c-0.48,13.788,9.705,25.599,11.154,38.216
			c0.57,5.092-0.264,10.306-3.818,15.837c-7.225,9.804-16.674,20.141-12.342,33.05c4.119,13.021,20.359,20.909,19.358,36.044
			c-0.11,17.903-20.913,29.05-15.017,49.072l-10.354-3.359c-4.111-17.792,14.797-26.895,15.014-43.357
			c2.676-18.931-21.469-25.955-20.02-44.409c-0.104-14.021,12.238-22.901,17.689-34.695c0.935-2.87,1.246-5.582,1.121-8.182
			c-0.668-13.04-12.418-23.235-10.468-37.896c0.656-10.79,4.327-20.248,11.338-28.363c-9.673,3.886-13.669,15.021-16.341,24.367
			c-4.637,14.986,6.432,28.466,7.542,41.893c0.492,5.929-0.957,11.824-6.536,17.851c-8.014,9.444-16.141,21.36-10.355,34.053
			c6.127,14.005,25.376,24.906,17.027,42.374c-4.555,11.015-15.462,19.353-15.014,32.364c-2.89-1.224-5.888-2.444-8.344-4.663
			c0-16.572,23.574-26.923,12.342-44.388c-0.995,3.446-1.209,8.129-1.988,12.022c-3.898,10.128-12.238,18.235-15.359,28.705
			c-5.219-2.014-10.676-6.246-15.017-10.695l6.013-3.68c-0.668-2.229-2.445-4.118-3.999-6.009c-3.905-0.549-6.469,2.013-9.688,3.017
			c-2.781-2.452-5.465-4.678-7.682-7.681c1.996-5.685,17.592-0.984,9.691-10.331c-5.334-3.335-10.688,1.429-15.359,3.653
			l-6.332-7.998c5.451-3.334,10.888-8.017,17.668-6.674c1.671,3.009,1.787,7.434,5.006,9.005c11.46-0.223,19.58-8.891,28.365-15.679
			c-6.123-9.111-11.107-21.689-5.668-32.707c4.358-11.041,15.713-20.34,16.228-32.546c0.116-2.778-0.317-5.701-1.532-8.847
			c-6.004-15.465-8.123-36.366,3.337-50.054c-6.231,1.674-9.905,9.44-12.022,15.337c-6.889,15.101,1.824,29.091,2.125,43.563
			c0.041,2.603-0.17,5.212-0.801,7.84c-5.898,11.902-15.454,22.345-17.006,36.041c-6.788,4.33-12.361,11.902-22.033,9.347
			c-0.34,2.556,0.439,6.452,1.326,9.347c-7.67-0.322-12.9,5.331-19.358,8.001c-3.44-1.104-4.335-5.551-5.667-8.663
			c7.559-2.553,13.012-10.131,21.691-10.011c1.006-2.795-0.564-5.356-1.007-8.023c-10.796-4.792-27.909,23.688-29.348-1.004
			c10.788-0.668,17.682-10.682,28.366-11.68l0.319-7.998c-12.125-1.225-19.925,11.24-32.045,10.011l-2.673-10.673
			c14.02,0.876,22.373-11.688,35.725-12.364c1.774-2.333,1.988-5.782,2.33-9.005c-14.574-1.899-24.575,14.252-40.043,9.347
			c0,0-0.533-6.722-0.822-10.512h0.021c-0.105-1.482-0.205-2.515-0.205-2.515c13.793,5.352,25.912-4.555,37.712-9.669
			c3.001-0.898,7.681,0.659,9.027-2.675c-0.117-2.559,4.55-5.551,0.665-7.337c-17.251-2.341-28.711,18.466-46.4,9.005l-1.327-2.675
			C6.262,91.145,34.616,42.539,81.667,18.62C100.723,7.73,124.397,2.179,148.272,1.982c28.813-0.239,57.927,7.319,79.585,22.65
			c21.032,12.901,41.15,34.162,52.068,55.745c10.442,18.91,15.248,40.129,16.683,62.719c-18.248,13.788-30.49-12.99-49.072-6.997
			c1.001,2.898,1.555,5.896,3.679,8.343c16.469-0.116,27.81,17.128,45.049,10.332L296.279,157.287L296.279,157.287z M86.667,95.369
			c-11.571-7.567-26.241-0.442-37.025,3.679c-1.001-10.128-5.114-19.355-13.69-26.029c-0.832-0.414-1.982-1.285-3.018-1.349
			c-0.62-0.039-1.21,0.211-1.668,1.004c3.887,23.913-11.658,40.599-22.674,58.739c3.668,2.998,9.561,2.55,14.01,1.669
			c11.678-4.67,22.802-12.798,36.707-10.012c4.112-7.008,11.021-13.796,16.686-19.358C79.456,100.717,84.211,98.815,86.667,95.369
			L86.667,95.369z M122.049,110.387c-0.222,1.44,0.111,4.007,2.331,3.015c3.454-4.783,9.569-0.999,13.349-0.662v-1.346
			c-2.074-3.257-6.341-4.893-10.674-4.73c-1,0.035-2.016,0.181-2.994,0.408C122.611,107.394,121.602,108.721,122.049,110.387
			L122.049,110.387z M176.445,96.056c-3.106-6.899-10.226-9.691-16.687-11.359c-3.167-0.39-6.454-0.654-9.714-0.685
			c-0.611-0.006-1.221-0.014-1.829,0c-9.119,0.184-17.832,2.525-23.155,10.031c-0.764,2.119-4.123,5.095-1.004,6.994
			c7.009-0.448,15.007-1.327,19.679,4.688c0,5.345,3.451,12.456-2.331,15.015c-4.791-4.436-10.465,1.888-15.678-1.672
			c-2.451-1.448-4.002,0.242-5.006,2.355c-1.449,13.791,5.772,29.011,18.674,36.684c5.229,1.886,12.258,3.68,17.715,1.004
			c13.126-6.112,18.563-20.12,21.007-33.026c-0.328-2.456-0.211-7.242-3.657-7.358c-3.891,2.461-9.566,1.007-13.69,0
			c-2.438,0.787-2.55,4.354-5.325,5.03l-1.691-1.349c-1.448-6.109-2.341-14.789,3.338-19.016c6.346-2.559,13.799-3.677,20.362-1.669
			C178.678,99.611,176.787,97.948,176.445,96.056L176.445,96.056z M169.748,107.025c-0.441,0.011-0.87,0.033-1.304,0.047
			c-2.331,1.555-9.124,0.437-6.672,5.668c4.23-3.346,10.126-1.001,14.353,0.662c1.563-0.776,1.224-2.334,1.327-3.677
			C176.095,107.2,172.852,106.963,169.748,107.025z M218.182,59.991c-8.234-0.437-15.129,4.237-22.695,6.352
			c-0.659-6.438,4.232-13.237,5.348-19.7c-12.233,0.787-21.922,8.15-32.042,14.032c-2.342-5.659-4.691-11.347-7.017-17.027
			l13.349-12.685l0.342-1.671l-18.031-1.004c-3.106-5.442-4.33-11.997-8.001-17.003c-3.004,5.673-5.022,11.677-8.023,17.345
			l-18.01,1.007v1.326l13.669,12.342c-1.671,6.344-3.224,13.237-7.336,18.032c-8.009-4.797-15.904-10.018-24.685-13.349
			c-2.113-0.682-5.125-1.791-7.016-0.342c2.777,6.12,6.666,12.703,6.012,19.383c-3.673-0.676-6.56-3.031-10.011-4.021
			c-4.127-1.126-9.024-3.326-13.028-1.988c6.676,9.339,12.125,19.113,14.01,30.352c22.147-10.689,47.975-16.568,74.785-12
			c12.567,2,24.123,7.119,35.36,11.336C205.601,78.923,213.054,69.453,218.182,59.991L218.182,59.991z M256.214,124.075
			c11.338,3.001,22.712,15.354,34.718,7.339c-10.456-17.351-26.019-33.374-21.691-56.064c0.453-1.549-0.548-3.117-1.988-3.337
			c-6.783,2.772-12.036,9.455-14.72,16.024c-1.104,3.885-1.758,8.015-3.313,11.677c-8.126-4.229-16.797-8.326-26.697-7.336
			c-3.57,0.445-8.688,0.679-9.347,4.344c11.235,6.004,20.474,16.024,27.359,26.694C245.329,122.634,251.208,123.302,256.214,124.075
			L256.214,124.075z M137.408,139.756l0.32,2.011c4.347,2.896,5.684,7.804,11.702,7.358c5.337,0.317,9.341-4.683,12-8.685
			C154.208,139.443,145.42,140.986,137.408,139.756L137.408,139.756z M143.418,130.751c0.217,0.891-0.551,2.226,0.662,2.676
			c3.56-0.773,10.009,1.894,11.997-2.333c-1.388-1.555-3.654-2.261-6.032-2.261C147.668,128.833,145.201,129.526,143.418,130.751z"
			/>
		<g id="g4377">
			<path id="rect3815" opacity="0.99" fill="#FFFFFF" enable-background="new    " d="M137.416,126.891h24.392v10.021h-24.392
				V126.891z"/>
			<path id="path3032-6" sodipodi:nodetypes="cccsccc" inkscape:connector-curvature="0" fill="#007042" d="M141.922,132.249
				c3.152,0.746,3.932,1.864,6.423,2.176c2.648-0.047,2.266-0.585,6.885-2.179c0.303-0.107,0.72-0.776,0.203-1.289
				c-2.868-2.847-4.85-0.813-6.648-0.759c-2.385,0.026-4.622-2.042-6.952,0.646C141.436,131.39,141.229,131.926,141.922,132.249
				L141.922,132.249z"/>
		</g>
	</g>
	<g id="text4354">
		<path id="path4430" fill="#007042" d="M257.158,296.672v-14.273h-5.098v-2.906h13.652v2.906h-5.086v14.273H257.158z"/>
		<path id="path4432" fill="#007042" d="M267.916,296.672v-17.18h5.191l3.117,11.719l3.082-11.719h5.203v17.18h-3.223v-13.523
			l-3.41,13.523h-3.34l-3.398-13.523v13.523H267.916z"/>
	</g>
</g>
</svg>
</file>

<file path="public/demo/images/banking/visa.svg">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
   xmlns:dc="http://purl.org/dc/elements/1.1/"
   xmlns:cc="http://creativecommons.org/ns#"
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   version="1.1"
   id="Layer_1"
   width="1000"
   height="324.6835"
   viewBox="0 0 1000 324.68351"
   overflow="visible"
   enable-background="new 0 0 659.055 202.068"
   xml:space="preserve"
   inkscape:version="1.0.2 (e86c870879, 2021-01-15)"
   sodipodi:docname="Visa_2021.svg"
   style="overflow:visible"><metadata
   id="metadata3739"><rdf:RDF><cc:Work
       rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type
         rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><defs
   id="defs3737"><linearGradient
     id="linearGradient3801"><stop
       style="stop-color:#20225f;stop-opacity:1"
       offset="0"
       id="stop3803" /><stop
       id="stop3815"
       offset="0.2"
       style="stop-color:#1a1f61;stop-opacity:1" /><stop
       id="stop3813"
       offset="0.41023257"
       style="stop-color:#172272;stop-opacity:1" /><stop
       id="stop3811"
       offset="0.59519672"
       style="stop-color:#152682;stop-opacity:1" /><stop
       id="stop3809"
       offset="0.80208331"
       style="stop-color:#12288e;stop-opacity:1" /><stop
       style="stop-color:#0e2c9a;stop-opacity:1"
       offset="1"
       id="stop3805" /></linearGradient></defs><sodipodi:namedview
   pagecolor="#ffffff"
   bordercolor="#666666"
   borderopacity="1"
   objecttolerance="10"
   gridtolerance="10"
   guidetolerance="10"
   inkscape:pageopacity="0"
   inkscape:pageshadow="2"
   inkscape:window-width="1366"
   inkscape:window-height="705"
   id="namedview3735"
   showgrid="false"
   fit-margin-left="0.5"
   fit-margin-bottom="0.5"
   fit-margin-top="0.5"
   fit-margin-right="0.5"
   inkscape:zoom="0.49497088"
   inkscape:cx="473.80866"
   inkscape:cy="-26.853447"
   inkscape:window-x="-8"
   inkscape:window-y="-8"
   inkscape:window-maximized="1"
   inkscape:current-layer="Layer_1"
   inkscape:document-rotation="0"><inkscape:grid
     type="xygrid"
     id="grid3787"
     empspacing="5"
     visible="true"
     enabled="true"
     snapvisiblegridlinesonly="true" /></sodipodi:namedview>

<path
   style="fill:#1434cb;fill-opacity:1;stroke:none"
   d="m 651.18503,0.50000002 c -70.93272,0 -134.32163,36.76584998 -134.32163,104.69357998 0,77.90028 112.42264,83.28082 112.42264,122.41576 0,16.47806 -18.88384,31.22851 -51.13668,31.22851 -45.77308,0 -79.98403,-20.61081 -79.98403,-20.61081 l -14.63836,68.54658 c 0,0 39.41037,17.40989 91.73375,17.40989 77.55217,0 138.57651,-38.57104 138.57651,-107.66029 0,-82.3157 -112.89106,-87.53633 -112.89106,-123.86008 0,-12.9082 15.50201,-27.05169 47.66251,-27.05169 36.28682,0 65.89216,14.98968 65.89216,14.98968 l 14.32608,-66.20444 c 0,0 -32.21317,-13.89668998 -77.64189,-13.89668998 z M 2.2175605,5.49657 0.49999253,15.48969 c 0,0 29.84159547,5.46149 56.71878047,16.35593 34.606624,12.4927 37.071853,19.7653 42.900167,42.35367 l 63.51098,244.83152 85.13673,0 131.15974,-313.53424 -84.94155,0 L 210.7069,218.67018 176.3165,37.97422 C 173.1626,17.29371 157.18709,5.49657 137.63219,5.49657 l -135.4146295,0 z m 411.8650095,0 -66.63383,313.53424 80.99895,0 66.39962,-313.53424 -80.76474,0 z m 451.75943,0 c -19.53181,0 -29.88045,10.45695 -37.47421,28.73022 l -118.66834,284.80402 84.94155,0 16.434,-47.46734 103.48348,0 9.99312,47.46734 74.94843,0 -65.3847,-313.53424 -68.27333,0 z m 11.04709,84.70733 25.17799,117.65341 -67.45359,0 42.2756,-117.65341 z"
   id="path3789"
   inkscape:connector-curvature="0" /></svg>
</file>

<file path="public/demo/images/blocks/ad/icon-blocks.svg">
<svg width="40" height="56" viewBox="0 0 40 56" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect width="13.19" height="32.9435" transform="matrix(0.866325 0.49948 3.18816e-05 1 28.5721 0)" fill="#6E6E6E"/>
<rect width="32.9796" height="32.9435" transform="matrix(0.866325 -0.49948 -3.18816e-05 1 0.00149536 16.4727)" fill="#5A5A5A"/>
<rect width="13.19" height="32.9796" transform="matrix(0.866357 0.499425 -0.866357 0.499425 28.5721 32.9417)" fill="#AAAAAA"/>
<rect width="13.19" height="32.9435" transform="matrix(0.866325 0.49948 3.18816e-05 1 0.000396729 16.4672)" fill="#78909C"/>
<rect width="32.9796" height="32.9435" transform="matrix(0.866325 -0.49948 -3.18816e-05 1 11.4283 23.0559)" fill="#607D8B"/>
<path d="M31.3703 26.6927L29.5816 27.2658L30.9728 28.7545L30.9725 35.8561L35.7427 28.5243L35.7429 20.7354L33.5567 22.9122L31.3703 26.6927Z" fill="white"/>
<path d="M20.2405 33.1096L22.0292 31.6202L20.6379 34.7131L20.6377 41.8147L15.8679 39.9832L15.8681 32.1943L18.0543 31.8502L20.2405 33.1096Z" fill="white"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M21.2342 34.8275L22.8242 31.1618L23.818 31.2761L27.793 28.9843L28.7867 27.7241L30.3766 29.5564L30.3763 39.8652L29.1837 42.6145L27.7924 45.0202L23.8175 47.312L22.4263 46.5106L21.2338 45.1363L21.2342 34.8275Z" fill="white"/>
<path d="M30.9725 40.2088L33.5563 35.741L33.5564 32.7629L30.9726 36.7725L30.9725 40.2088Z" fill="white"/>
<path d="M20.6375 46.1673L18.0539 44.6789L18.054 41.7008L20.6376 42.731L20.6375 46.1673Z" fill="white"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M23.2221 17.6457L21.632 22.915L24.2155 30.1306L25.408 29.443L25.4084 16.3852L26.2034 15.9269L26.203 28.9847L27.5942 28.1826L29.9795 18.1023L28.3896 14.6664L23.2221 17.6457Z" fill="white"/>
<path d="M24.2154 30.1306L15.6693 31.3926L14.477 26.353L21.8307 22.8005L24.4142 30.016L24.2154 30.1306Z" fill="white"/>
<path d="M27.5942 28.1826L36.1405 19.59L37.3332 13.1753L29.7807 18.217L27.3955 28.2972L27.5942 28.1826Z" fill="white"/>
<path d="M30.3771 17.1858L34.5508 14.3213L31.7684 12.7184L28.9859 14.3226L30.3771 17.1858Z" fill="white"/>
<path d="M21.2345 22.457L17.0608 24.4052L19.8434 19.5937L22.6259 17.9895L21.2345 22.457Z" fill="white"/>
<rect width="32.9796" height="13.19" transform="matrix(0.866357 -0.499425 0.866357 0.499425 0.000396729 16.4709)" fill="#90A4AE"/>
</svg>
</file>

<file path="public/demo/images/blocks/logos/hyper.svg">
<svg width="48" height="50" viewBox="0 0 48 50" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M33.1548 9.65956L23.9913 4.86169L5.54723 14.5106L0.924465 12.0851L23.9913 0L37.801 7.23403L33.1548 9.65956ZM23.9931 19.3085L42.4255 9.65955L47.0717 12.0851L23.9931 24.1595L10.1952 16.9361L14.8297 14.5106L23.9931 19.3085ZM4.6345 25.8937L0 23.4681V37.9149L23.0669 50V45.1489L4.6345 35.4894V25.8937ZM18.4324 28.2658L0 18.6169V13.7658L23.0669 25.8403V40.2977L18.4324 37.8615V28.2658ZM38.7301 23.468V18.6169L24.9205 25.8403V49.9999L29.555 47.5743V28.2659L38.7301 23.468ZM43.3546 35.4892V16.1914L48.0008 13.7659V37.9148L34.1912 45.1488V40.2977L43.3546 35.4892Z" fill="#616161"/>
</svg>
</file>

<file path="public/demo/images/contact/map-dark.svg">
<svg width="1056" height="238" viewBox="0 0 1056 238" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect width="1056" height="238" fill="url(#pattern0)"/>
<defs>
<pattern id="pattern0" patternContentUnits="objectBoundingBox" width="1" height="1">
<use xlink:href="#image0_2529_18116" transform="scale(0.000473485 0.00210084)"/>
</pattern>
<image id="image0_2529_18116" width="2112" height="476" xlink:href="data:image/png;base64,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"/>
</defs>
</svg>
</file>

<file path="public/demo/images/contact/map-light.svg">
<svg width="1056" height="238" viewBox="0 0 1056 238" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect width="1056" height="238" fill="url(#pattern0)"/>
<defs>
<pattern id="pattern0" patternContentUnits="objectBoundingBox" width="1" height="1">
<use xlink:href="#image0_974_37072" transform="scale(0.000473485 0.00210084)"/>
</pattern>
<image id="image0_974_37072" width="2112" height="476" xlink:href="data:image/png;base64,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"/>
</defs>
</svg>
</file>

<file path="public/demo/images/landing/icon-accessibility.svg">
<svg width="21" height="26" viewBox="0 0 21 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M7.63671 3.34105C7.63671 2.58749 7.93595 1.86496 8.46882 1.33211C9.00152 0.799417 9.724 0.5 10.4776 0.5C11.2311 0.5 11.9537 0.799436 12.4863 1.33211C13.0191 1.86496 13.3184 2.58749 13.3184 3.34105C13.3184 4.09442 13.0192 4.81715 12.4863 5.34979C11.9536 5.88264 11.2311 6.18191 10.4776 6.18191C9.724 6.18191 9.00147 5.88266 8.46882 5.34979C7.93598 4.8171 7.63671 4.09442 7.63671 3.34105ZM19.5686 7.31821H1.38635C0.980382 7.31821 0.605229 7.5349 0.402241 7.88646C0.199253 8.23803 0.199253 8.67119 0.402241 9.02277C0.605229 9.37434 0.980377 9.59102 1.38635 9.59102H7.06836V24.3636C7.06836 24.7696 7.28504 25.1448 7.63661 25.3478C7.98817 25.5507 8.42134 25.5507 8.77291 25.3478C9.12448 25.1448 9.34116 24.7696 9.34116 24.3636V16.4092H11.614V24.3636H11.6138C11.6138 24.7696 11.8305 25.1448 12.182 25.3478C12.5336 25.5507 12.9667 25.5507 13.3183 25.3478C13.6699 25.1448 13.8866 24.7696 13.8866 24.3636V9.59102H19.5686C19.9746 9.59102 20.3497 9.37433 20.5527 9.02277C20.7557 8.6712 20.7557 8.23804 20.5527 7.88646C20.3497 7.53489 19.9746 7.31821 19.5686 7.31821H19.5686Z" fill="#03C4E8"/>
</svg>
</file>

<file path="public/demo/images/landing/icon-community.svg">
<svg width="27" height="26" viewBox="0 0 27 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M22.9625 4.8449C21.2901 4.07754 19.4968 3.51218 17.6217 3.18837C17.5875 3.18212 17.5534 3.19774 17.5358 3.22897C17.3052 3.6392 17.0497 4.17436 16.8708 4.595C14.854 4.29307 12.8475 4.29307 10.8721 4.595C10.6932 4.16501 10.4284 3.6392 10.1967 3.22897C10.1791 3.19878 10.145 3.18316 10.1109 3.18837C8.2368 3.51114 6.44341 4.0765 4.76998 4.8449C4.7555 4.85115 4.74308 4.86157 4.73484 4.8751C1.33316 9.95714 0.401292 14.9143 0.858433 19.8099C0.860502 19.8339 0.873947 19.8568 0.892564 19.8714C3.1369 21.5195 5.31092 22.5201 7.44457 23.1834C7.47871 23.1938 7.51489 23.1813 7.53662 23.1532C8.04134 22.4639 8.49125 21.7372 8.877 20.9729C8.89977 20.9282 8.87804 20.8751 8.83151 20.8574C8.11788 20.5867 7.43836 20.2566 6.78471 19.8818C6.733 19.8516 6.72887 19.7776 6.77643 19.7422C6.91398 19.6392 7.05157 19.5319 7.18291 19.4236C7.20668 19.4039 7.23979 19.3997 7.26773 19.4122C11.5619 21.3728 16.2109 21.3728 20.4544 19.4122C20.4824 19.3986 20.5155 19.4028 20.5403 19.4226C20.6717 19.5309 20.8092 19.6392 20.9478 19.7422C20.9954 19.7776 20.9923 19.8516 20.9406 19.8818C20.2869 20.2639 19.6074 20.5867 18.8927 20.8563C18.8462 20.874 18.8255 20.9282 18.8483 20.9729C19.2423 21.7361 19.6922 22.4629 20.1876 23.1521C20.2083 23.1813 20.2455 23.1938 20.2797 23.1834C22.4237 22.5201 24.5977 21.5195 26.842 19.8714C26.8617 19.8568 26.8741 19.8349 26.8762 19.811C27.4233 14.151 25.9598 9.23456 22.9967 4.87613C22.9894 4.86157 22.977 4.85115 22.9625 4.8449ZM9.51827 16.829C8.22542 16.829 7.16015 15.6421 7.16015 14.1844C7.16015 12.7267 8.20476 11.5398 9.51827 11.5398C10.8421 11.5398 11.8971 12.7371 11.8764 14.1844C11.8764 15.6421 10.8317 16.829 9.51827 16.829ZM18.237 16.829C16.9442 16.829 15.8789 15.6421 15.8789 14.1844C15.8789 12.7267 16.9235 11.5398 18.237 11.5398C19.5609 11.5398 20.6158 12.7371 20.5951 14.1844C20.5951 15.6421 19.5609 16.829 18.237 16.829Z" fill="#406AFF"/>
</svg>
</file>

<file path="public/demo/images/landing/icon-components.svg">
<svg width="29" height="26" viewBox="0 0 29 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M13.7008 2.13655L0.40966 9.05525C-0.136553 9.35863 -0.136553 10.2084 0.40966 10.5118L13.7008 17.4305C14.065 17.6126 14.4899 17.6126 14.854 17.4305L28.1452 10.5118C28.6914 10.2084 28.6914 9.35863 28.1452 9.05525L14.7932 2.13655C14.429 1.95448 14.0649 1.95448 13.7007 2.13655H13.7008Z" fill="#916AFF"/>
<path d="M28.0841 15.4885L25.5959 14.214C25.4746 14.1533 25.2925 14.1533 25.1105 14.214L15.5819 19.1907C15.157 19.4335 14.6715 19.4941 14.2466 19.4941C13.7612 19.4941 13.3363 19.3728 12.9114 19.1907L3.38335 14.214C3.26204 14.1533 3.07997 14.1533 2.89789 14.214L0.40966 15.4885C-0.136553 15.7919 -0.136553 16.6417 0.40966 16.9451L13.7008 23.8638C14.065 24.0459 14.4899 24.0459 14.854 23.8638L28.1452 16.9451C28.6305 16.6417 28.6305 15.7921 28.0843 15.4885H28.0841Z" fill="#916AFF"/>
</svg>
</file>

<file path="public/demo/images/landing/icon-mobile.svg">
<svg width="15" height="26" viewBox="0 0 15 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M14.904 2.47354V23.6405L14.9037 23.6406C14.9124 23.6755 14.9182 23.7132 14.9211 23.751C14.9123 24.3904 14.5549 25.0182 13.9678 25.303C13.6975 25.4367 13.4127 25.4948 13.1133 25.4948H5.15601C4.86269 25.4948 4.56872 25.4961 4.27454 25.4974C3.68552 25.5 3.09563 25.5026 2.50834 25.4948C1.53761 25.4832 0.761625 24.6927 0.758719 23.7249C0.757744 23.6615 0.756441 23.5984 0.755141 23.5354C0.752566 23.4108 0.75 23.2866 0.75 23.161V2.34856C0.75 1.66555 1.07551 1.00292 1.71202 0.691942C2.10625 0.498957 2.50048 0.499495 2.91456 0.500061C2.93701 0.500092 2.95951 0.500122 2.98207 0.500122H12.9568H13.1718C13.7909 0.505968 14.3809 0.840194 14.686 1.38657C14.8779 1.72952 14.904 2.09571 14.904 2.47354ZM6.3013 21.8793C6.3013 22.7308 6.9901 23.4196 7.84164 23.4196C8.69317 23.4196 9.38198 22.7279 9.38198 21.8793C9.38198 21.0277 8.69317 20.3389 7.84164 20.3389C6.9901 20.3389 6.3013 21.0277 6.3013 21.8793ZM10.9496 2.37872C10.9407 2.40627 10.9456 2.36176 10.9501 2.32157C10.9524 2.30045 10.9546 2.28053 10.9546 2.27288C10.9546 2.25434 10.9539 2.2358 10.9532 2.21692C10.9525 2.19732 10.9517 2.17735 10.9517 2.15663V1.66255H4.72316V2.24092V2.2758C4.72316 2.30196 4.72316 2.32811 4.72607 2.35427C4.72785 2.35427 4.73292 2.37945 4.73724 2.40091C4.73996 2.41443 4.74238 2.42647 4.7435 2.42984C4.74786 2.44146 4.7515 2.45381 4.75513 2.46616C4.75876 2.47852 4.76239 2.49087 4.76675 2.5025C4.76675 2.50395 4.76748 2.50467 4.76821 2.5054C4.76893 2.50613 4.76966 2.50685 4.76966 2.50831C4.77257 2.51121 4.77547 2.51412 4.77547 2.51703L4.78129 2.52865C4.78681 2.53971 4.79234 2.55193 4.79639 2.56088C4.79872 2.56604 4.80057 2.57012 4.80163 2.57225C4.80336 2.57745 4.81543 2.59505 4.82797 2.61334C4.83646 2.62572 4.84517 2.63843 4.85104 2.64781C4.83941 2.63619 4.8336 2.63328 4.85104 2.65363C4.85611 2.65869 4.85841 2.661 4.85868 2.66079C4.85902 2.66051 4.85596 2.65601 4.85104 2.64781C4.86266 2.66525 4.88882 2.69431 4.88882 2.69431C4.89234 2.69959 4.90968 2.7155 4.9267 2.73111C4.93781 2.7413 4.94878 2.75136 4.95567 2.75825C4.95368 2.75706 4.9518 2.75592 4.9501 2.75489C4.93935 2.74838 4.93559 2.7461 4.95567 2.76116C4.96729 2.76988 4.96439 2.76697 4.95567 2.75825C4.9731 2.76988 5.00217 2.79022 5.00217 2.79022C5.01088 2.79313 5.06029 2.81929 5.08354 2.83382C5.0661 2.82801 5.05739 2.8251 5.08354 2.83672C5.09179 2.83947 5.09548 2.84092 5.09555 2.84076C5.09563 2.84059 5.0912 2.83841 5.08354 2.83382C5.10389 2.83963 5.13876 2.85416 5.13876 2.85416L5.1388 2.85417C5.15348 2.85711 5.25501 2.87742 5.2463 2.88032C5.26374 2.88323 5.27827 2.88323 5.2928 2.88323H5.3393C6.19174 2.89679 7.04545 2.89227 7.89959 2.88775C8.32682 2.88549 8.75416 2.88323 9.18149 2.88323H10.0534H10.2917H10.3411H10.3527H10.3527C10.3847 2.88323 10.4138 2.88323 10.4457 2.88032C10.437 2.88323 10.4312 2.88613 10.4312 2.88613C10.4336 2.88613 10.451 2.88235 10.4638 2.87937C10.4578 2.88032 10.4518 2.88032 10.4457 2.88032C10.4493 2.88032 10.4529 2.87921 10.4579 2.87768C10.461 2.87673 10.4646 2.87562 10.469 2.87451C10.4799 2.8714 10.4905 2.86851 10.501 2.86565C10.5283 2.85822 10.5546 2.85108 10.5809 2.84128C10.5838 2.83908 10.589 2.83665 10.6001 2.83279C10.6027 2.83138 10.6053 2.82994 10.6077 2.82866C10.6104 2.82719 10.6127 2.82591 10.6143 2.8251C10.6311 2.81335 10.6498 2.80257 10.6688 2.79165C10.6827 2.78365 10.6967 2.77557 10.7102 2.76697C10.7117 2.76552 10.7131 2.76479 10.7146 2.76406C10.716 2.76334 10.7175 2.76261 10.7189 2.76116L10.7248 2.75534C10.748 2.735 10.7683 2.71466 10.7916 2.69141C10.7954 2.68765 10.8045 2.67635 10.8139 2.6647C10.8264 2.64929 10.8393 2.63328 10.841 2.63328C10.8526 2.61584 10.8643 2.5984 10.873 2.58096C10.8773 2.5737 10.8817 2.5657 10.8861 2.55771C10.8904 2.54972 10.8948 2.54173 10.8991 2.53446C10.8991 2.53446 10.902 2.52865 10.9049 2.51993C10.9064 2.51848 10.9071 2.51702 10.9079 2.51557C10.9086 2.51412 10.9093 2.51266 10.9108 2.51121C10.9127 2.50636 10.915 2.50085 10.9172 2.49535C10.9217 2.48439 10.9263 2.47342 10.9282 2.46761C10.9329 2.45187 10.9368 2.43443 10.9407 2.41666C10.9435 2.40401 10.9464 2.3912 10.9496 2.37872ZM10.5852 2.83963C10.5879 2.83829 10.5912 2.83695 10.5946 2.83561C10.5912 2.83728 10.5879 2.83873 10.5852 2.83963ZM13.75 4H1.75V19H13.75V4Z" fill="#00A3FF"/>
</svg>
</file>

<file path="public/demo/images/landing/icon-productivity.svg">
<svg width="17" height="26" viewBox="0 0 17 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M11.8196 0.5H4.2712L0.5 13.579H6.73867C6.93482 13.579 7.11832 13.6676 7.23854 13.8194C7.35876 13.9713 7.40306 14.1738 7.35876 14.3573L4.67591 25.5L16.2681 10.5732H9.89641C9.70026 10.5732 9.51043 10.4783 9.39654 10.3265C9.27632 10.1683 9.23835 9.96579 9.28897 9.77597L11.8196 0.5Z" fill="#03E8BF"/>
</svg>
</file>

<file path="public/demo/images/landing/icon-support.svg">
<svg width="25" height="26" viewBox="0 0 25 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M21.9656 4.83481C23.9265 7.10809 25.0038 10.0115 25.0006 13.0136C24.9972 16.0157 23.9135 18.9168 21.9476 21.1852L16.8672 16.1048C17.5091 15.2018 17.8553 14.1217 17.8581 13.0138C17.8609 11.9059 17.5199 10.8243 16.8823 9.91801L21.9656 4.83481ZM20.7058 3.56963L15.6261 8.6493C14.7189 7.9974 13.6307 7.64519 12.5134 7.64244C11.3963 7.63945 10.3061 7.98604 9.39571 8.63318L4.31527 3.55274H4.31507C6.5911 1.58085 9.50245 0.496793 12.5138 0.500007C15.5251 0.502997 18.4343 1.5932 20.7058 3.56968L20.7058 3.56963ZM4.33548 22.465L9.41872 17.3818C10.325 18.0193 11.4066 18.3604 12.5145 18.3576C13.6225 18.3548 14.7025 18.0086 15.6055 17.3666L20.686 22.4471C18.4171 24.413 15.5164 25.4966 12.5143 25.5C9.51219 25.5032 6.60906 24.4259 4.33553 22.465H4.33548ZM3.07029 21.2052C1.09361 18.9334 0.00342547 16.0245 7.01672e-06 13.0132C-0.00318184 10.0019 1.08065 7.09059 3.05254 4.81451L8.13399 9.89495L8.13379 9.89514C7.48664 10.8056 7.14005 11.8958 7.14306 13.0128C7.14585 14.1301 7.49801 15.2183 8.14992 16.1256L3.07029 21.2052Z" fill="#FFBD80"/>
</svg>
</file>

<file path="public/demo/images/landing/icon-theme.svg">
<svg width="26" height="26" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M13.0017 0.500022C10.5292 0.499682 8.11241 1.23254 6.05657 2.60581C4.00068 3.97907 2.39821 5.93123 1.452 8.21526C0.505633 10.4993 0.257845 13.0126 0.740012 15.4374C1.22211 17.8623 2.41253 20.0898 4.16062 21.8382C5.90872 23.5865 8.13605 24.7772 10.5607 25.2597C12.9855 25.7422 15.4988 25.4947 17.7831 24.5486C20.0673 23.6026 22.0195 22.0005 23.3932 19.9449C24.7668 17.8893 25.4999 15.4725 25.4999 13C25.4964 9.68632 24.1784 6.50911 21.8355 4.16575C19.4923 1.82239 16.3156 0.504129 13.0019 0.5L13.0017 0.500022ZM1.35355 13C1.35711 9.91192 2.58549 6.95116 4.76916 4.76753C6.95279 2.5839 9.91356 1.35561 13.0017 1.35192V24.6464C9.91377 24.6433 6.95301 23.4153 4.76938 21.2319C2.58575 19.0485 1.35724 16.0879 1.35355 13V13Z" fill="#FFAA8F"/>
</svg>
</file>

<file path="public/demo/images/landing/icon-ts.svg">
<svg width="26" height="26" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_1676_2383)">
<path d="M25.25 13C25.25 6.09644 19.6536 0.5 12.75 0.5C5.84644 0.5 0.25 6.09644 0.25 13C0.25 19.9036 5.84644 25.5 12.75 25.5C19.6536 25.5 25.25 19.9036 25.25 13Z" fill="#3178C6"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M13.6949 15.6891V17.7512C14.0302 17.9231 14.4266 18.052 14.8844 18.1379C15.3421 18.2238 15.8245 18.2668 16.3317 18.2668C16.826 18.2668 17.2955 18.2195 17.7403 18.125C18.1852 18.0305 18.5753 17.8747 18.9105 17.6578C19.2457 17.4409 19.5111 17.1573 19.7067 16.8071C19.9022 16.457 20 16.0242 20 15.5086C20 15.1349 19.9441 14.8073 19.8324 14.5259C19.7206 14.2445 19.5595 13.9943 19.3489 13.7752C19.1383 13.5561 18.8858 13.3595 18.5914 13.1855C18.297 13.0115 17.9649 12.8472 17.5953 12.6925C17.3245 12.5808 17.0817 12.4723 16.8668 12.3671C16.6519 12.2618 16.4692 12.1544 16.3188 12.0449C16.1684 11.9353 16.0523 11.8193 15.9707 11.6969C15.889 11.5744 15.8482 11.4359 15.8482 11.2812C15.8482 11.1395 15.8847 11.0116 15.9578 10.8978C16.0309 10.7839 16.134 10.6862 16.2672 10.6046C16.4005 10.523 16.5638 10.4596 16.7572 10.4145C16.9506 10.3693 17.1655 10.3468 17.4019 10.3468C17.5738 10.3468 17.7554 10.3597 17.9466 10.3855C18.1379 10.4112 18.3302 10.451 18.5237 10.5047C18.7171 10.5584 18.9051 10.6261 19.0878 10.7077C19.2704 10.7893 19.4391 10.8838 19.5938 10.9912V9.06439C19.2801 8.9441 18.9373 8.85496 18.5656 8.79696C18.1938 8.73896 17.7672 8.70996 17.2859 8.70996C16.7959 8.70996 16.3317 8.76261 15.8933 8.86785C15.455 8.9731 15.0692 9.13742 14.7361 9.36081C14.403 9.58425 14.1398 9.86885 13.9464 10.2147C13.753 10.5605 13.6562 10.974 13.6562 11.4552C13.6562 12.0696 13.8335 12.5937 14.1881 13.0276C14.5427 13.4615 15.081 13.8288 15.8031 14.1296C16.0867 14.2456 16.3511 14.3594 16.596 14.4711C16.841 14.5828 17.0527 14.6988 17.231 14.8191C17.4094 14.9394 17.5502 15.0704 17.6533 15.2122C17.7565 15.354 17.8081 15.5151 17.8081 15.6955C17.8081 15.8287 17.7758 15.9522 17.7113 16.0661C17.6469 16.1799 17.5491 16.2787 17.418 16.3625C17.2869 16.4463 17.1236 16.5118 16.9281 16.559C16.7325 16.6063 16.5036 16.6299 16.2415 16.6299C15.7945 16.6299 15.3518 16.5515 14.9134 16.3947C14.475 16.2379 14.0688 16.0027 13.6949 15.6891ZM10.2282 10.6082H12.8736V8.91593H5.5V10.6082H8.13249V18.1432H10.2282V10.6082Z" fill="white"/>
</g>
<defs>
<clipPath id="clip0_1676_2383">
<rect width="25" height="25" fill="white" transform="translate(0.25 0.5)"/>
</clipPath>
</defs>
</svg>
</file>

<file path="public/demo/images/logo-white.svg">
<?xml version="1.0" encoding="UTF-8"?>
<svg width="139px" height="158px" viewBox="0 0 139 158" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!-- Generator: Sketch 59.1 (86144) - https://sketch.com -->
    <title>head</title>
    <desc>Created with Sketch.</desc>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="Artboard" transform="translate(-3.000000, -7.000000)">
            <g id="head" transform="translate(3.000000, 7.000000)">
                <polygon id="chick-right" fill="#ffffff" fill-rule="nonzero" points="102.295646 72.1832018 91.4643424 69.7770951 99.8886897 81.8076287 99.8886897 119.102283 128.772166 95.0412157 128.772166 54.1374014 115.533906 58.9496148"></polygon>
                <polygon id="chick-left" fill="#ffffff" fill-rule="nonzero" transform="translate(27.078259, 86.619842) scale(-1, 1) translate(-27.078259, -86.619842) " points="19.255651 72.1832018 8.42434732 69.7770951 16.8486946 81.8076287 16.8486946 119.102283 45.7321712 95.0412157 45.7321712 54.1374014 32.4939111 58.9496148"></polygon>
                <polygon id="mask" fill="#ffffff" points="40.9182584 84.2137354 50.5460839 69.7770951 56.5634749 73.3862552 80.6330387 73.3862552 86.6504296 69.7770951 96.2782551 84.2137354 96.2782551 138.351137 89.057386 149.178617 80.6330387 157.599991 56.5634749 157.599991 48.1391276 149.178617 40.9182584 138.351137"></polygon>
                <polygon id="bottom-chick-right" fill="#ffffff" fill-rule="nonzero" points="99.8886897 141.960297 115.533906 126.320603 115.533906 110.680909 99.8886897 123.914496"></polygon>
                <polygon id="bottom-chick-left" fill="#ffffff" fill-rule="nonzero" transform="translate(29.485216, 126.320603) scale(-1, 1) translate(-29.485216, -126.320603) " points="21.6626074 141.960297 37.3078239 126.320603 37.3078239 110.680909 21.6626074 123.914496"></polygon>
                <path d="M89.4422148,12.342 L93.8712988,22.8580139 L79.4295605,68.5740417 L71.0052132,68.5740417 L71.0042148,56.994 L89.4422148,12.342 Z M48.1982148,11.287 L66.1912148,57.769 L66.1913004,68.5740417 L58.9704313,68.5740417 L43.3252148,22.8580139 L48.1982148,11.287 Z M66.1913004,0 L66.1912148,46.688 L59.3732148,29.074 L61.3773876,30.0763341 L61.3773876,0 L66.1913004,0 Z M75.8191259,1.91846539e-13 L75.8191259,30.0763341 L78.3042148,28.833 L71.0042148,46.513 L71.0052132,0 L75.8191259,1.91846539e-13 Z M84.2434732,0 L87.2562148,7.154 L80.6322148,23.196 L80.6330387,1.91846539e-13 L84.2434732,0 Z M56.5634749,0 L56.5632148,21.816 L50.4332148,5.981 L52.9530403,0 L56.5634749,0 Z" fill="#455C71"></path>
                <path d="M138.399992,19.2488538 L131.179123,49.3251879 L79.4295605,68.5740417 L78.2260823,68.5740417 L92.6678206,22.8580139 L138.399992,19.2488538 Z M0,19.2488538 L44.528693,22.8580139 L60.1739095,68.5740417 L58.9704313,68.5740417 L7.22086913,49.3251879 L0,19.2488538 Z" id="head-right-2" fill="#ffffff" fill-rule="nonzero"></path>
                <polygon id="ear-right" fill="#455C71" fill-rule="nonzero" points="96.2782551 19.2488538 121.551297 16.8427471 104.702602 0 87.8539078 0"></polygon>
                <polygon id="ear-left" fill="#455C71" fill-rule="nonzero" transform="translate(32.493911, 9.624427) scale(-1, 1) translate(-32.493911, -9.624427) " points="24.0695638 19.2488538 49.3426058 16.8427471 32.4939111 0 15.6452165 0"></polygon>
                <polygon id="Path-2" fill="#455C71" fill-rule="nonzero" points="18.7999989 20.7999988 44.7999973 22.7999986 60.3999964 68.5999959 58.7999965 68.5999959 41.9999975 62.3999963"></polygon>
                <polygon id="Path-3" fill="#455C71" fill-rule="nonzero" points="119.199993 20.7999988 92.3999945 22.7999986 77.5999954 68.5999959 79.5999953 68.5599959 95.1999943 62.7999963"></polygon>
                <polygon id="Path-4" fill="#455C71" fill-rule="nonzero" points="48.3999971 72.7999957 50.399997 69.5999959 57.1999966 72.7999957 81.1999952 72.7999957 86.3999949 69.5999959 88.7999947 72.7999957 68.5999959 107.199994"></polygon>
                <path d="M90.2104053,-1.0658141e-14 L68.485709,52.6144989 L48.1188062,-1.0658141e-14 L90.2104053,-1.0658141e-14 Z" id="Path-6" fill="#ffffff" fill-rule="nonzero"></path>
            </g>
        </g>
    </g>
</svg>
</file>

<file path="public/demo/images/logo.svg">
<?xml version="1.0" encoding="UTF-8"?>
<svg width="139px" height="158px" viewBox="0 0 139 158" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!-- Generator: Sketch 59.1 (86144) - https://sketch.com -->
    <title>head</title>
    <desc>Created with Sketch.</desc>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="Artboard" transform="translate(-3.000000, -7.000000)">
            <g id="head" transform="translate(3.000000, 7.000000)">
                <polygon id="chick-right" fill="#41B883" fill-rule="nonzero" points="102.295646 72.1832018 91.4643424 69.7770951 99.8886897 81.8076287 99.8886897 119.102283 128.772166 95.0412157 128.772166 54.1374014 115.533906 58.9496148"></polygon>
                <polygon id="chick-left" fill="#41B883" fill-rule="nonzero" transform="translate(27.078259, 86.619842) scale(-1, 1) translate(-27.078259, -86.619842) " points="19.255651 72.1832018 8.42434732 69.7770951 16.8486946 81.8076287 16.8486946 119.102283 45.7321712 95.0412157 45.7321712 54.1374014 32.4939111 58.9496148"></polygon>
                <polygon id="mask" fill="#41B883" points="40.9182584 84.2137354 50.5460839 69.7770951 56.5634749 73.3862552 80.6330387 73.3862552 86.6504296 69.7770951 96.2782551 84.2137354 96.2782551 138.351137 89.057386 149.178617 80.6330387 157.599991 56.5634749 157.599991 48.1391276 149.178617 40.9182584 138.351137"></polygon>
                <polygon id="bottom-chick-right" fill="#41B883" fill-rule="nonzero" points="99.8886897 141.960297 115.533906 126.320603 115.533906 110.680909 99.8886897 123.914496"></polygon>
                <polygon id="bottom-chick-left" fill="#41B883" fill-rule="nonzero" transform="translate(29.485216, 126.320603) scale(-1, 1) translate(-29.485216, -126.320603) " points="21.6626074 141.960297 37.3078239 126.320603 37.3078239 110.680909 21.6626074 123.914496"></polygon>
                <path d="M89.4422148,12.342 L93.8712988,22.8580139 L79.4295605,68.5740417 L71.0052132,68.5740417 L71.0042148,56.994 L89.4422148,12.342 Z M48.1982148,11.287 L66.1912148,57.769 L66.1913004,68.5740417 L58.9704313,68.5740417 L43.3252148,22.8580139 L48.1982148,11.287 Z M66.1913004,0 L66.1912148,46.688 L59.3732148,29.074 L61.3773876,30.0763341 L61.3773876,0 L66.1913004,0 Z M75.8191259,1.91846539e-13 L75.8191259,30.0763341 L78.3042148,28.833 L71.0042148,46.513 L71.0052132,0 L75.8191259,1.91846539e-13 Z M84.2434732,0 L87.2562148,7.154 L80.6322148,23.196 L80.6330387,1.91846539e-13 L84.2434732,0 Z M56.5634749,0 L56.5632148,21.816 L50.4332148,5.981 L52.9530403,0 L56.5634749,0 Z" fill="#455C71"></path>
                <path d="M138.399992,19.2488538 L131.179123,49.3251879 L79.4295605,68.5740417 L78.2260823,68.5740417 L92.6678206,22.8580139 L138.399992,19.2488538 Z M0,19.2488538 L44.528693,22.8580139 L60.1739095,68.5740417 L58.9704313,68.5740417 L7.22086913,49.3251879 L0,19.2488538 Z" id="head-right-2" fill="#41B883" fill-rule="nonzero"></path>
                <polygon id="ear-right" fill="#455C71" fill-rule="nonzero" points="96.2782551 19.2488538 121.551297 16.8427471 104.702602 0 87.8539078 0"></polygon>
                <polygon id="ear-left" fill="#455C71" fill-rule="nonzero" transform="translate(32.493911, 9.624427) scale(-1, 1) translate(-32.493911, -9.624427) " points="24.0695638 19.2488538 49.3426058 16.8427471 32.4939111 0 15.6452165 0"></polygon>
                <polygon id="Path-2" fill="#455C71" fill-rule="nonzero" points="18.7999989 20.7999988 44.7999973 22.7999986 60.3999964 68.5999959 58.7999965 68.5999959 41.9999975 62.3999963"></polygon>
                <polygon id="Path-3" fill="#455C71" fill-rule="nonzero" points="119.199993 20.7999988 92.3999945 22.7999986 77.5999954 68.5999959 79.5999953 68.5599959 95.1999943 62.7999963"></polygon>
                <polygon id="Path-4" fill="#455C71" fill-rule="nonzero" points="48.3999971 72.7999957 50.399997 69.5999959 57.1999966 72.7999957 81.1999952 72.7999957 86.3999949 69.5999959 88.7999947 72.7999957 68.5999959 107.199994"></polygon>
                <path d="M90.2104053,-1.0658141e-14 L68.485709,52.6144989 L48.1188062,-1.0658141e-14 L90.2104053,-1.0658141e-14 Z" id="Path-6" fill="#41B883" fill-rule="nonzero"></path>
            </g>
        </g>
    </g>
</svg>
</file>

<file path="public/demo/images/product/product-placeholder.svg">
<?xml version="1.0" encoding="UTF-8"?>
<svg width="300px" height="200px" viewBox="0 0 300 200" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <title>Artboard</title>
    <g id="Artboard" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <rect id="Rectangle" fill="#F8F9FA" x="0" y="0" width="300" height="200"></rect>
        <g id="image" transform="translate(110.000000, 70.000000)" fill="#BABABC" fill-rule="nonzero">
            <path d="M75,0 L5,0 C2.23857625,0 0,2.23857625 0,5 L0,55 C0,57.7614237 2.23857625,60 5,60 L75,60 C77.7614237,60 80,57.7614237 80,55 L80,5 C80,2.23857625 77.7614237,0 75,0 Z M20,10 C25.5228475,10 30,14.4771525 30,20 C30,25.5228475 25.5228475,30 20,30 C14.4771525,30 10,25.5228475 10,20 C10,14.4771525 14.4771525,10 20,10 Z M70,40 L70,50 L10,50 L10,40 L18.55,35.7 C19.4648753,35.2524957 20.5351247,35.2524957 21.45,35.7 L30,40 L53.65,21.1 C54.4866298,20.4991452 55.6133702,20.4991452 56.45,21.1 L70,30 L70,40 Z" id="Shape"></path>
        </g>
    </g>
</svg>
</file>

<file path="public/layout/styles/preloading/preloading.css">
body {
  margin: 0;
}

.layout-preloader-container {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100vh;
  width: 100vw;
  background-color: #111417;
}
.layout-preloader-container .layout-preloader {
  position: relative;
  width: 75px;
  height: 75px;
  background: transparent;
  border: 3px solid #161a1f;
  border-radius: 50%;
  text-align: center;
  line-height: 150px;
  font-family: sans-serif;
  font-size: 20px;
  color: #6366F1;
  letter-spacing: 4px;
  text-transform: uppercase;
  text-shadow: 0 0 10px #6366F1;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
}
.layout-preloader-container .layout-preloader:before {
  content: "";
  position: absolute;
  top: -3px;
  left: -3px;
  width: 100%;
  height: 100%;
  border: 3px solid transparent;
  border-top: 3px solid #6366F1;
  border-right: 3px solid #6366F1;
  border-radius: 50%;
  animation: preloader-rotate-c 1s linear infinite;
}
.layout-preloader-container .layout-preloader span {
  display: block;
  position: absolute;
  top: calc(50% - 2px);
  left: 50%;
  width: 50%;
  height: 4px;
  background: transparent;
  transform-origin: left;
  animation: preloader-rotate 1s linear infinite;
}
.layout-preloader-container .layout-preloader span:before {
  content: "";
  position: absolute;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: #6366F1;
  top: -6px;
  right: -8px;
  box-shadow: 0 0 20px #6366F1;
}

@keyframes preloader-rotate-c {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
@keyframes preloader-rotate {
  0% {
    transform: rotate(45deg);
  }
  100% {
    transform: rotate(405deg);
  }
}
</file>

<file path="public/layout/styles/preloading/preloading.scss">
body {
    margin: 0;
}

.layout-preloader-container {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100vh;
    width: 100vw;
    background-color: #111417;

    .layout-preloader {
        position: relative;
        width: 75px;
        height: 75px;
        background: transparent;
        border: 3px solid #161a1f;
        border-radius: 50%;
        text-align: center;
        line-height: 150px;
        font-family: sans-serif;
        font-size: 20px;
        color: #6366F1;
        letter-spacing: 4px;
        text-transform: uppercase;
        text-shadow: 0 0 10px #6366F1;
        box-shadow: 0 0 20px rgba(0, 0, 0, .5);
    
        &:before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            width: 100%;
            height: 100%;
            border: 3px solid transparent;
            border-top: 3px solid #6366F1;
            border-right: 3px solid #6366F1;
            border-radius: 50%;
            animation: preloader-rotate-c 1s linear infinite;
        }
    
        span {
            display: block;
            position: absolute;
            top: calc(50% - 2px);
            left: 50%;
            width: 50%;
            height: 4px;
            background: transparent;
            transform-origin: left;
            animation: preloader-rotate 1s linear infinite;
        }
    
        span:before {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #6366F1;
            top: -6px;
            right: -8px;
            box-shadow: 0 0 20px #6366F1;
        }
    }
}

@keyframes preloader-rotate-c {
    0% {
        transform: rotate(0deg);
    }

    100% {
        transform: rotate(360deg);
    }
}

@keyframes preloader-rotate {
    0% {
        transform: rotate(45deg);
    }

    100% {
        transform: rotate(405deg);
    }
}
</file>

<file path="README.md">
# Apollo19

This project was generated using [Angular CLI](https://github.com/angular/angular-cli) version 20.0.5.

## Development server

To start a local development server, run:

```bash
ng serve
```

Once the server is running, open your browser and navigate to `http://localhost:4200/`. The application will automatically reload whenever you modify any of the source files.

## Code scaffolding

Angular CLI includes powerful code scaffolding tools. To generate a new component, run:

```bash
ng generate component component-name
```

For a complete list of available schematics (such as `components`, `directives`, or `pipes`), run:

```bash
ng generate --help
```

## Building

To build the project run:

```bash
ng build
```

This will compile your project and store the build artifacts in the `dist/` directory. By default, the production build optimizes your application for performance and speed.

## Running unit tests

To execute unit tests with the [Karma](https://karma-runner.github.io) test runner, use the following command:

```bash
ng test
```

## Running end-to-end tests

For end-to-end (e2e) testing, run:

```bash
ng e2e
```

Angular CLI does not come with an end-to-end testing framework by default. You can choose one that suits your needs.

## Additional Resources

For more information on using the Angular CLI, including detailed command references, visit the [Angular CLI Overview and Command Reference](https://angular.dev/tools/cli) page.
</file>

<file path="src/app.component.ts">
import { Component } from '@angular/core';
import { RouterModule } from '@angular/router';

@Component({
    selector: 'app-root',
    standalone: true,
    imports: [RouterModule],
    template: `<router-outlet></router-outlet>`
})
export class AppComponent {}
</file>

<file path="src/app.config.ts">
// src/app/app.config.ts

import { provideHttpClient, withFetch, HttpClient } from '@angular/common/http';
import { ApplicationConfig, importProvidersFrom } from '@angular/core';
import { provideAnimationsAsync } from '@angular/platform-browser/animations/async';
import { provideRouter, withEnabledBlockingInitialNavigation, withInMemoryScrolling } from '@angular/router';
import Aura from '@primeuix/themes/aura';
import { providePrimeNG } from 'primeng/config';
import { appRoutes } from './app.routes';
import { TranslateModule, TranslateLoader } from '@ngx-translate/core';
import { TranslateHttpLoader } from '@ngx-translate/http-loader';
import { ConvexService } from '@/core/services/convex.service';

// Factory function for v8.0.0
export function createTranslateLoader(http: HttpClient) {
  return new TranslateHttpLoader(http, './assets/i18n/', '.json');
}

export const appConfig: ApplicationConfig = {
  providers: [
    provideRouter(
      appRoutes,
      withInMemoryScrolling({
        anchorScrolling: 'enabled',
        scrollPositionRestoration: 'enabled'
      }),
      withEnabledBlockingInitialNavigation()
    ),
    provideHttpClient(withFetch()),
    provideAnimationsAsync(),
    providePrimeNG({
      theme: {
        preset: Aura,
        options: {
          darkModeSelector: '.app-dark'
        }
      }
    }),
    importProvidersFrom(
      TranslateModule.forRoot({
        defaultLanguage: 'en',
        loader: {
          provide: TranslateLoader,
          useFactory: createTranslateLoader,
          deps: [HttpClient]
        }
      })
    ),
    ConvexService  // âœ… ADDED - Explicit provider
  ]
};
</file>

<file path="src/app.routes.ts">
import { Routes } from '@angular/router';
import { AuthGuard } from '@/core/guards/auth.guard';
import { LayoutComponent } from '@/layout/components/layout/layout.component';
import { NotFoundComponent } from '@/shared/notfound/notfound.component';
export const appRoutes: Routes = [
    // 1. Auth routes are separate and unprotected
    {
        path: 'auth',
        loadChildren: () =>
            import('@/core/auth/auth.routes').then((m) => m.AUTH_ROUTES)
    },
    {
    path: 'apply',
    loadComponent: () =>
      import('@/features/hr-recruitment/public/component/public-application-form.component')
        .then(m => m.PublicApplicationFormComponent),
  },

    // 2. The main application layout, protected by the AuthGuard
    {
        path: '', // The root path is now the main app
        component: LayoutComponent,
        canActivate: [AuthGuard],
        children: [
            // Default child route is the dashboard
            {
                path: 'dashboard',
                loadComponent: () =>
                    import('@/features/dashboard/component/dashboard-component').then(
                        (c) => c.DashboardComponent
                    )
            },

            {
                path: 'user-management',
                loadChildren: () =>
                    import(
                        '@/features/user-management/user.management.route'
                    ).then((m) => m.USER_MANAGEMENT_ROUTES)
            },
            {
                path:'tasks',
                loadChildren: ()=>
                    import('@/features/task-management/task-management.route').
                    then((m)=>m.TASK_MANAGEMENT_ROUTE)
                
            },
            {
                path: 'recruitment',
                loadChildren: () =>
                    import(
                        '@/features/hr-recruitment/hr-recruitment.routes'
                    ).then((m) => m.RECRUITMENT_ROUTES)
            },
            {
                path: 'store',
                loadChildren: () =>
                    import('@/features/store/store.routes').then(
                        (m) => m.STORE_ROUTES
                    )
            },
            {
                path: 'training',
                loadChildren: () =>
                    import('@/features/training/training.routes').then(
                        (m) => m.TRAINING_ROUTES
                    )
            },
            {
                path: 'settings',
                loadChildren: () =>
                    import('@/features/settings/settings.routes').then(
                        (m) => m.SETTINGS_ROUTES
                    )
            },
            // { path: 'field-ops', loadChildren: () => import('@/features/field-operations/field-operations.routes').then(m => m.FIELD_OPERATIONS_ROUTES) },

            // Redirect from the empty path '' to the dashboard
            { path: '', redirectTo: '/dashboard', pathMatch: 'full' }
        ]
    },

    // 3. Not Found and wildcard routes
   { path: 'notfound', component: NotFoundComponent },
    { path: '**', component: NotFoundComponent }

    
];
</file>

<file path="src/app/core/auth/auth.routes.ts">
import { Routes } from '@angular/router';
import { LoginComponent } from './login/login';
import { SetupPasswordComponent } from './setup-password/setup-password.component';

export const AUTH_ROUTES: Routes = [
  { path: 'login', component: LoginComponent },
  // { path: 'forgotpassword', component: ForgotPasswordComponent },
{
    path: 'setup-password',  // âœ… ADD THIS
    component: SetupPasswordComponent
  }];
</file>

<file path="src/app/core/auth/login/app-login.html">
<svg
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 1600 800"
    class="fixed left-0 top-0 min-h-screen min-w-screen"
    preserveAspectRatio="none"
></svg>
<div class="px-8 min-h-screen flex justify-center items-center">
    <div
        data-cy="login-container"
        class="border border-surface-200 dark:border-surface-700 bg-surface-0 dark:bg-surface-900 rounded py-16 px-6 md:px-16 z-10 w-full md:w-112"
    >
        <div class="mb-6">
            <div
                data-cy="login-title"
                class="text-surface-900 dark:text-surface-0 text-xl font-bold mb-2"
            >
                Log in
            </div>
            <span data-cy="login-subtitle" class="text-surface-600 dark:text-surface-200 font-medium"
                >Please enter your details</span
            >
        </div>

        @if (loginForm) {
        <div class="flex flex-col" [formGroup]="loginForm">
            <p-iconfield class="w-full mb-1">
                <p-inputicon class="pi pi-envelope" />
                <input
                    data-cy="email-input"
                    type="text"
                    pInputText
                    placeholder="Email"
                    formControlName="email"
                />
                <small 
      *ngIf="loginForm.get('email')?.invalid && loginForm.get('email')?.touched"
      data-cy="email-error"
      class="p-error">
      Please enter a valid email address
    </small>
            </p-iconfield>
            @if (loginForm.get('email')?.touched &&
            loginForm.get('email')?.hasError('serverError')) {
            <div data-cy="email-error" class="p-error text-xs mb-5">
                {{ loginForm.get('email')?.getError('serverError') }}
            </div>
            }

            <p-iconfield class="w-full mb-1">
                <p-inputicon class="pi pi-lock" />
                <input
                    data-cy="password-input"
                    [type]="passwordVisible ? 'text' : 'password'"
                    pInputText
                    placeholder="Password"
                    formControlName="password"
                />
                <button
                    data-cy="password-toggle"
                    type="button"
                    pButton
                    [icon]="passwordVisible ? 'pi pi-eye-slash' : 'pi pi-eye'"
                    (click)="passwordVisible = !passwordVisible"
                    class="p-button-text"
                ></button>
                <small 
      *ngIf="loginForm.get('password')?.invalid && loginForm.get('password')?.touched"
      data-cy="password-error"
      class="p-error">
      Password is required
    </small>
            </p-iconfield>
            @if (loginForm.get('password')?.touched &&
            loginForm.get('password')?.hasError('serverError')) {
            <div data-cy="password-error" class="p-error text-xs mb-5">
                {{ loginForm.get('password')?.getError('serverError') }}
            </div>
            }

            <div class="mb-6 flex flex-wrap gap-4 mt-5">
                <div class="flex items-center">
                    <p-checkbox
                        data-cy="remember-me-checkbox"
                        name="checkbox"
                        formControlName="rememberMe"
                        [binary]="true"
                        styleClass="mr-2"
                        class="flex"
                    ></p-checkbox>
                    <label class="font-medium ml-2">Remember Me</label>
                </div>
                <a
                    data-cy="forgot-password-link"
                    (click)="navigateToResetPassword()"
                    class="cursor-pointer ml-auto"
                    >Reset password</a
                >
            </div>

            <button
                data-cy="login-button"
                pButton
                pRipple
                label="Log In"
                class="w-full"
                (click)="handleLogin()"
                [disabled]="isLoading || loginForm.invalid"
            ></button>
        </div>
        }
    </div>
</div>
<p-toast data-cy="toast-message"></p-toast>
</file>

<file path="src/app/core/auth/login/login.ts">
// src/app/core/auth/login/login.ts

import { Component, computed, effect, inject, Injector, OnInit, runInInjectionContext } from '@angular/core';
import { CheckboxModule } from 'primeng/checkbox';
import { InputTextModule } from 'primeng/inputtext';
import { FormBuilder, FormGroup, FormsModule, ReactiveFormsModule, Validators } from '@angular/forms';
import { Router, RouterModule } from '@angular/router';
import { LayoutService } from '@/layout/service/layout.service';
import { IconFieldModule } from 'primeng/iconfield';
import { InputIconModule } from 'primeng/inputicon';
import { ButtonModule } from 'primeng/button';
import { AuthService } from '@/core/services/auth.service';
import { CommonModule } from '@angular/common';
import { toSignal } from '@angular/core/rxjs-interop';
import { MessageService } from 'primeng/api';
import { ToastModule } from 'primeng/toast';

@Component({
    selector: 'app-login',
    standalone: true,
    imports: [
        CommonModule,
        ReactiveFormsModule,
        RouterModule,
        CheckboxModule,
        InputTextModule,
        IconFieldModule,
        InputIconModule,
        ButtonModule,
        ToastModule
    ],
    providers: [MessageService],
    templateUrl: './app-login.html'
})
export class LoginComponent implements OnInit {
    isLoading: boolean = false;
    loginForm!: FormGroup;

    layoutService = inject(LayoutService);
    authService = inject(AuthService);
    router = inject(Router);
    fb = inject(FormBuilder);
    injector = inject(Injector);
    messageService = inject(MessageService);

    passwordVisible = false;

    ngOnInit() {
        this.loginForm = this.fb.group({
            email: ['', [Validators.required, Validators.email]],
            password: ['', Validators.required],
            rememberMe: [false]
        });

        if (this.authService.isLoggedIn()) {
            this.router.navigate(['/']);
            return;
        }

        runInInjectionContext(this.injector, () => {
            const emailChanges = toSignal(this.loginForm.get('email')!.valueChanges);
            const passwordChanges = toSignal(this.loginForm.get('password')!.valueChanges);

            effect(() => {
                emailChanges();
                const emailControl = this.loginForm.get('email');
                if (emailControl?.hasError('serverError')) {
                    emailControl.setErrors(null);
                }
            });

            effect(() => {
                passwordChanges();
                const passwordControl = this.loginForm.get('password');
                if (passwordControl?.hasError('serverError')) {
                    passwordControl.setErrors(null);
                }
            });
        });
    }

   // src/app/core/auth/login/login.ts

async handleLogin() {
    console.log('ðŸ”µ Login button clicked');
    
    if (this.loginForm.invalid) {
        console.log('âŒ Form is invalid');
        this.loginForm.markAllAsTouched();
        return;
    }

    console.log('âœ… Form is valid, attempting login...');
    this.isLoading = true;

    try {
        console.log('ðŸš€ Calling authService.login()...');
        
        // This will now throw error if profile loading fails
        await this.authService.login(
            this.loginForm.value.email,
            this.loginForm.value.password
        );

        console.log('âœ… Login successful!');
        console.log('ðŸ‘¤ User:', this.authService.currentUser());
        
        this.messageService.add({
            severity: 'success',
            summary: 'Success',
            detail: 'Login successful! Redirecting...',
            life: 2000
        });

        // âœ… Navigate now that user is loaded
        console.log('ðŸŽ¯ Navigating to /dashboard...');
        setTimeout(() => {
            this.router.navigate(['/dashboard']);
        }, 500);

    } catch (error: any) {
        console.error('âŒ Login error:', error);
        
        if (error?.message?.includes('USER_NOT_FOUND') || error?.message?.includes('user not found')) {
            this.loginForm.get('email')?.setErrors({ 
                'serverError': 'No account found with that email.' 
            });
        } else if (error?.message?.includes('INCORRECT_PASSWORD') || error?.message?.includes('incorrect password')) {
            this.loginForm.get('password')?.setErrors({ 
                'serverError': 'The password you entered is incorrect.' 
            });
        } else {
            this.messageService.add({
                severity: 'error',
                summary: 'Login Failed',
                detail: error?.message || 'An unexpected error occurred.',
                life: 5000
            });
        }
    } finally {
        console.log('ðŸ Login attempt finished');
        this.isLoading = false;
    }
}


    navigateToResetPassword() {
        this.router.navigate(['/auth/forgotpassword']);
    }
}
</file>

<file path="src/app/core/auth/setup-password/setup-password.component.ts">
import { Component, OnInit } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { ActivatedRoute, Router } from '@angular/router';
import { api } from 'convex/_generated/api';
import { CardModule } from 'primeng/card';
import { InputTextModule } from 'primeng/inputtext';
import { ButtonModule } from 'primeng/button';
import { PasswordModule } from 'primeng/password';
import { MessageModule } from 'primeng/message';
import { ConvexService } from '../../services/convex.service';

@Component({
  selector: 'app-setup-password',
  standalone: true,
  imports: [
    CommonModule,
    FormsModule,
    CardModule,
    InputTextModule,
    ButtonModule,
    PasswordModule,
    MessageModule
  ],
  template: `
    <div class="flex align-items-center justify-content-center min-h-screen">
      <p-card styleClass="w-full max-w-30rem">
        <ng-template pTemplate="header">
          <div class="text-center p-4">
            <h2 class="m-0">Setup Your Password</h2>
          </div>
        </ng-template>

        <form (ngSubmit)="setupPassword()" *ngIf="!success">
          <div class="field mb-4">
            <label for="password" class="block mb-2">New Password</label>
            <p-password
              id="password"
              [(ngModel)]="password"
              name="password"
              [feedback]="true"
              [toggleMask]="true"
              styleClass="w-full"
              inputStyleClass="w-full"
              placeholder="Enter new password"
              required
            ></p-password>
          </div>

          <div class="field mb-4">
            <label for="confirmPassword" class="block mb-2">Confirm Password</label>
            <p-password
              id="confirmPassword"
              [(ngModel)]="confirmPassword"
              name="confirmPassword"
              [feedback]="false"
              [toggleMask]="true"
              styleClass="w-full"
              inputStyleClass="w-full"
              placeholder="Confirm password"
              required
            ></p-password>
          </div>

          <p-message
            *ngIf="error"
            severity="error"
            [text]="error"
            styleClass="w-full mb-3"
          ></p-message>

          <p-button
            type="submit"
            label="Setup Password"
            [loading]="loading"
            [disabled]="!password || !confirmPassword"
            styleClass="w-full"
          ></p-button>
        </form>

        <div *ngIf="success" class="text-center">
          <p-message
            severity="success"
            text="Password setup successful! Redirecting to login..."
            styleClass="w-full mb-3"
          ></p-message>
        </div>
      </p-card>
    </div>
  `
})
export class SetupPasswordComponent implements OnInit {
  token: string = '';
  password: string = '';
  confirmPassword: string = '';
  error: string = '';
  loading: boolean = false;
  success: boolean = false;

  constructor(
    private route: ActivatedRoute,
    private router: Router,
    private convex: ConvexService
  ) {}

  ngOnInit() {
    this.token = this.route.snapshot.queryParams['token'] || '';
    if (!this.token) {
      this.error = 'Invalid or missing token';
    }
  }

async setupPassword() {
   this.password = this.password.trim();
  this.confirmPassword = this.confirmPassword.trim();
  if (this.password !== this.confirmPassword) {
    this.error = 'Passwords do not match';
    return;
  }

  if (this.password.length < 8) {
    this.error = 'Password must be at least 8 characters';
    return;
  }

  this.loading = true;
  this.error = '';

  try {
    // âœ… Changed to action (not mutation)
    const result = await this.convex.client.action(
      api.auth.setupPasswordWithToken as any,
      {
        token: this.token,
        password: this.password
      }
    );

    console.log('âœ… Password setup successful:', result);
    this.success = true;
    
    // Redirect to login after 2 seconds
    setTimeout(() => {
      this.router.navigate(['/auth/login']);
    }, 2000);
  } catch (err: any) {
    console.error('âŒ Password setup failed:', err);
    this.error = err.message || 'Failed to setup password. Token may be invalid or expired.';
    this.loading = false;
  }
}


}
</file>

<file path="src/app/core/guards/auth.guard.ts">
// src/app/core/guards/auth.guard.ts

import { inject } from '@angular/core';
import { Router, CanActivateFn } from '@angular/router';
import { AuthService } from '../services/auth.service';

export const AuthGuard: CanActivateFn = async (route, state) => {
    const authService = inject(AuthService);
    const router = inject(Router);

    console.log('ðŸ›¡ï¸ AuthGuard checking...', state.url);

    // âœ… ADD THIS: Wait for profile loading to finish
    let waitCount = 0;
    while (authService.isLoadingProfile() && waitCount < 50) {
        // Max 2.5 seconds
        console.log('â³ Waiting for profile to load...');
        await new Promise((resolve) => setTimeout(resolve, 50));
        waitCount++;
    }

    console.log('ðŸ‘¤ Current user:', authService.currentUser());
    console.log('âœ… Is logged in?', authService.isLoggedIn());

    if (!authService.isLoggedIn()) {
        console.log('âŒ Not logged in, redirecting to /auth/login');
        router.navigate(['/auth/login']);
        return false;
    }

    console.log('âœ… Auth guard passed');
    return true;
};
</file>

<file path="src/app/core/services/auth.service.ts">
// src/app/core/services/auth.service.ts

import { Injectable, signal, inject } from '@angular/core';
import { Router } from '@angular/router';
import { api } from 'convex/_generated/api';
import { ConvexService } from './convex.service';
import { ConvexClient } from 'convex/browser';


export type UserProfile = {
    authUserId: string;
    authEmail: string | undefined;
    adminUserId: string;
    name: string;
    email: string;
    phone: string | undefined;
    roleLevel: number;
    roleName: string;
    rootId: string;
    hierarchyId?: string;
    hierarchyName: string;
    hierarchyPath: string;
    hierarchyLevel: number;
    managerId: string | undefined;
    managerName: string | null;
    isActive: boolean;
    lastLogin: number | undefined;
    createdAt: number;
};


@Injectable({ providedIn: 'root' })
export class AuthService {
    private convex: ConvexClient;
    private router = inject(Router);

    public currentUser = signal<UserProfile | null>(null);
    // âœ… ADD THIS LINE
    public isLoadingProfile = signal<boolean>(false);

    constructor(convexService: ConvexService) {
        this.convex = convexService.client;

        const token = localStorage.getItem('convex_session_token');
        if (token) {
            console.log('ðŸ”‘ Found existing token, restoring auth...');
            this.convex.setAuth(async () => token);

            // âœ… CHANGE THIS: Set loading state
            this.isLoadingProfile.set(true);
            this.loadProfile()
                .catch((err) => {
                    console.error('Failed to restore session:', err);
                    localStorage.removeItem('convex_session_token');
                    this.convex.setAuth(async () => null);
                })
                .finally(() => {
                    // âœ… ADD THIS: Clear loading state when done
                    this.isLoadingProfile.set(false);
                });
        }
    }
// Frontend: auth.service.ts

async login(email: string, password: string): Promise<void> {
    try {
        const ipAddress = undefined;
        const userAgent = navigator.userAgent;

        // STEP 1: Security pre-check (rate limiting, account status)
        console.log('ðŸ” Security check...');
        const preCheck: any = await this.convex.action(
            api.secureAuth.actions.preLoginCheck,
            { email, ipAddress, userAgent }
        );

        if (!preCheck.allowed) {
            throw new Error(preCheck.reason || 'Login not allowed');
        }

        console.log('âœ… Security passed');

        // STEP 2: Convex Auth password verification
        console.log('ðŸ”‘ Verifying credentials...');
        let result: any;
        try {
            result = await this.convex.action(api.auth.signIn, {
                provider: 'password',
                params: { flow: 'signIn', email, password },
            });
        } catch (error: any) {
            // Password wrong - record failed attempt
            await this.convex.action(api.secureAuth.actions.recordFailedLogin, {
                email,
                adminUserId: preCheck.adminUserId,
                reason: 'Invalid password',
                ipAddress,
                userAgent,
            });
            throw new Error('Invalid email or password');
        }

        // STEP 3: Password correct - record success
        console.log('âœ… Credentials valid');
        await this.convex.action(api.secureAuth.actions.recordSuccessfulLogin, {
            email,
            adminUserId: preCheck.adminUserId,
            ipAddress,
            userAgent,
        });

        // Save token and load profile
        if (result?.tokens) {
            const token = result.tokens.token;
            localStorage.setItem('convex_session_token', token);
            this.convex.setAuth(async () => token);
            await this.loadProfile();
            console.log('âœ… Login complete!');
        }
    } catch (error: any) {
        console.error('âŒ Login failed:', error);
        localStorage.removeItem('convex_session_token');
        this.convex.setAuth(async () => null);
        this.currentUser.set(null);
        throw error;
    }
}


    isLoggedIn(): boolean {
        return !!this.currentUser();
    }

    async loadProfile() {
        console.log('ðŸ”„ loadProfile called');
        try {
            const token = localStorage.getItem('convex_session_token');
            if (!token) {
                console.log('âŒ No token found');
                throw new Error('No token');
            }

            console.log('ðŸ“ž Fetching profile from Convex...');
            const profile = await this.convex.query(
                api.auth.getCurrentUserProfile,
                {}
            );

            console.log('âœ… Profile fetched:', profile);
            this.currentUser.set(profile);
        } catch (e: any) {
            console.error('âŒ loadProfile error:', e);
            this.currentUser.set(null);
            localStorage.removeItem('convex_session_token');
            throw e;
        }
    }

 async logout(): Promise<void> {
        try {
            const sessionToken = localStorage.getItem('convex_session_token');
            const ipAddress = undefined;
            const userAgent = navigator.userAgent;

            const currentUser = this.currentUser();

            // Call secure logout action - it handles:
            // - Audit logging
            // - Session termination
            if (currentUser) {
                await this.convex.action(api.secureAuth.actions.secureSignOut, {
                    userId: currentUser.authUserId,
                    sessionToken: sessionToken || undefined,
                    ipAddress,
                    userAgent,
                });
            }

            // Standard Convex Auth signOut
            await this.convex.action(api.auth.signOut, {});
        } catch (error) {
            console.error('Logout action failed:', error);
        }

        localStorage.removeItem('convex_session_token');
        this.convex.setAuth(async () => null);
        this.currentUser.set(null);
        this.router.navigate(['/auth/login']);
    }
    isSuperAdmin(): boolean {
        return this.currentUser()?.roleLevel === 12;
    }

    hasMinimumRole(minLevel: number): boolean {
        const roleLevel = this.currentUser()?.roleLevel;
        return roleLevel !== undefined && roleLevel >= minLevel;
    }

    static readonly ROLE_LEVELS = {
        FIELD_EXECUTIVE: 1,
        BLOCK_COORDINATOR: 4,
        WARD_COORDINATOR: 5,
        DISTRICT_MANAGER: 6,
        DISTRICT_HEAD: 7,
        ZONAL_MANAGER: 8,
        ZONAL_HEAD: 9,
        STATE_MANAGER: 10,
        STATE_HEAD: 11,
        SUPER_ADMIN: 12
    } as const;

    can(permission: string): boolean {
        const user = this.currentUser();
        if (!user) return false;

        const roleLevel = user.roleLevel;

        const permissions: Record<string, boolean> = {
            canManageUsers: roleLevel >= 12,
            canManageTasks: roleLevel >= 4,
            canApprove: roleLevel >= 6,
            canManageOrders: roleLevel >= 8,
            canManageTraining: roleLevel >= 6,
            canManageHR: roleLevel >= 10,
            canViewAnalytics: roleLevel >= 6,
            isSuperAdmin: roleLevel === 12
        };

        return permissions[permission] || false;
    }
}
</file>

<file path="src/app/core/services/convex.service.ts">
import { Injectable } from '@angular/core';
import { ConvexClient } from 'convex/browser';

@Injectable({ providedIn: 'root' })
export class ConvexService {
  private _client!: ConvexClient;

  // Lazy initialization - only create client when first accessed
  get client(): ConvexClient {
    if (!this._client) {
      this._client = new ConvexClient('https://adventurous-toad-869.convex.cloud');
    }
    return this._client;
  }

  // Query wrapper
  async query<T>(query: any, args?: any): Promise<T> {
    return await this.client.query(query, args);
  }

  // Mutation wrapper
  async mutation<T>(mutation: any, args?: any): Promise<T> {
    return await this.client.mutation(mutation, args);
  }

  // Action wrapper
  async action<T>(action: any, args?: any): Promise<T> {
    return await this.client.action(action, args);
  }

  // âœ… Set auth token (takes a function that returns string or undefined)
  setAuth(token: string | null) {
    if (token) {
      this.client.setAuth(async () => token);
    } else {
      // âœ… FIX: Return undefined instead of null
      this.client.setAuth(async () => undefined);
    }
  }

  // âœ… Clear auth (return undefined from the fetcher)
  clearAuth() {
    this.client.setAuth(async () => undefined);
  }
}
</file>

<file path="src/app/features/dashboard/component/dashboard-component.html">
<div data-cy="dashboard-container" class="grid grid-nogutter surface-section">
  
  <!-- Loading State -->
  <div data-cy="stats-loading" *ngIf="loading" class="col-12 flex justify-content-center align-items-center py-8">
    <p-progressSpinner styleClass="w-6rem h-6rem" strokeWidth="8"></p-progressSpinner>
    <span class="ml-3 text-xl">Loading dashboard stats...</span>
  </div>

  <!-- Error State -->
  <div data-cy="dashboard-error" *ngIf="error" class="col-12">
    <p-card>
      <ng-template pTemplate="header">
        <i class="pi pi-exclamation-triangle mr-2"></i>
        Dashboard Error
      </ng-template>
      <p class="m-0 text-red-500">{{ error }}</p>
    </p-card>
  </div>

  <!-- Task Status Widget (YOUR EXISTING WIDGET - 3 cards) -->
  <div *ngIf="!loading && !error" class="col-12 mb-6">
    <div data-cy="task-status-widget">
      <app-status-widget></app-status-widget>
    </div>
  </div>

  <!-- Navigation Cards -->
  <div class="grid">
    
    <!-- Candidate Pipeline -->
    <div class="col-12 md:col-6 lg:col-3 mb-4">
      <p-card 
        data-cy="pipeline-nav-card"
        class="cursor-pointer hover:shadow-4 transition-duration-200 h-full"
        routerLink="/candidate-pipeline">
        <div class="flex align-items-center h-full">
          <i class="pi pi-sitemap text-3xl text-primary mr-4"></i>
          <div class="flex-1">
            <h3 class="m-0 mb-1 text-xl">Candidate Pipeline</h3>
            <span class="text-600">1,100+ applications across 5 stages</span>
          </div>
        </div>
      </p-card>
    </div>
    
    <!-- Executives -->
    <div class="col-12 md:col-6 lg:col-3 mb-4">
      <p-card 
        data-cy="executives-nav-card"
        class="cursor-pointer hover:shadow-4 transition-duration-200 h-full"
        routerLink="/executives">
        <div class="flex align-items-center h-full">
          <i class="pi pi-users text-3xl text-green-500 mr-4"></i>
          <div class="flex-1">
            <h3 class="m-0 mb-1 text-xl">Executives</h3>
            <span class="text-600">75K+ field executives</span>
          </div>
        </div>
      </p-card>
    </div>
    
    <!-- Jobs -->
    <div class="col-12 md:col-6 lg:col-3 mb-4">
      <p-card 
        data-cy="jobs-nav-card"
        class="cursor-pointer hover:shadow-4 transition-duration-200 h-full"
        routerLink="/jobs">
        <div class="flex align-items-center h-full">
          <i class="pi pi-briefcase text-3xl text-orange-500 mr-4"></i>
          <div class="flex-1">
            <h3 class="m-0 mb-1 text-xl">Job Postings</h3>
            <span class="text-600">3 active job postings</span>
          </div>
        </div>
      </p-card>
    </div>
    
    <!-- Tasks -->
    <div class="col-12 md:col-6 lg:col-3 mb-4">
      <p-card 
        data-cy="tasks-nav-card"
        class="cursor-pointer hover:shadow-4 transition-duration-200 h-full"
        routerLink="/tasks">
        <div class="flex align-items-center h-full">
          <i class="pi pi-check-square text-3xl text-blue-500 mr-4"></i>
          <div class="flex-1">
            <h3 class="m-0 mb-1 text-xl">Task Management</h3>
            <span class="text-600">60+ active tasks</span>
          </div>
        </div>
      </p-card>
    </div>
  </div>

  <!-- Other Widgets (if they exist) -->
  <div *ngIf="!loading && !error" class="col-12 mt-6">
    <div class="grid">
      <div class="col-12 lg:col-8" data-cy="top-executives-section">
        <app-top-executives-widget></app-top-executives-widget>
      </div>
      <div class="col-12 lg:col-4" data-cy="recent-submissions-section">
        <app-recent-submissions-widget></app-recent-submissions-widget>
      </div>
    </div>
  </div>

</div>

<p-toast data-cy="toast-container"></p-toast>
</file>

<file path="src/app/features/dashboard/component/dashboard-component.ts">
import { Component, ElementRef, OnInit, ViewChild } from '@angular/core';
import { CommonModule } from '@angular/common';
import { RecentSubmissionsWidgetComponent } from '../recent-status/recent-submissions-widget.component.ts';
import { StatusWidgetComponent } from '../status-widgets/statuswidget';
import { TopExecutivesWidgetComponent } from '../top-perfomers/top-executives-widget.ts';
import { DashboardService } from '../dashboard.service';
import { CardModule } from 'primeng/card';
import { ProgressSpinnerModule } from 'primeng/progressspinner';
import { ChartModule } from "primeng/chart";
import { ToastModule } from "primeng/toast";
import { MessageService } from 'primeng/api';

@Component({
  selector: 'app-dashboard',
  standalone: true,
  imports: [
    CommonModule,
    RecentSubmissionsWidgetComponent,
    StatusWidgetComponent,
    TopExecutivesWidgetComponent,
    CardModule,
    ProgressSpinnerModule,
    ChartModule,
    ToastModule
],
providers: [MessageService],
  templateUrl: './dashboard-component.html'
})
export class DashboardComponent implements OnInit {
  // Stats from your seeded database
  dashboardStats: any = null;
  loading = true;
  error: string = '';
@ViewChild('dashboardContainer') dashboardContainer!: ElementRef;
  constructor(private dashboardService: DashboardService,messageService: MessageService) {}

  async ngOnInit() {
    await this.loadDashboardStats();
  }

  async loadDashboardStats() {
    try {
      console.log('ðŸ“Š Loading dashboard stats...');
      // this.dashboardStats = await this.dashboardService.getAdminDashboardSummary();
      console.log('âœ… Dashboard stats loaded:', this.dashboardStats);
      this.loading = false;
    } catch (error: any) {
      console.error('âŒ Failed to load dashboard stats:', error);
      this.error = error.message || 'Failed to load dashboard';
      this.loading = false;
    }
  }
}
</file>

<file path="src/app/features/dashboard/dashboard.service.ts">
import { Injectable } from '@angular/core';
import { ConvexService } from '../../core/services/convex.service';
import { api } from 'convex/_generated/api';
import { AuthService } from '../../core/services/auth.service';

@Injectable({ providedIn: 'root' })
export class DashboardService {
  constructor(
    private convexService: ConvexService,
    private authService: AuthService
  ) {}

  // âœ… FIXED: No rootCode argument - uses authenticated user's context
  // async getAdminDashboardSummary() {
  //   const currentUser = this.authService.currentUser();
  //   if (!currentUser) {
  //     throw new Error('User not authenticated');
  //   }

  //   // Call without rootCode - the query gets it from your auth token
  //   return await this.convexService.client.query(
  //     api.users.admin.queries.getDashboardSummary,
  //     {} // Empty args - query uses authenticated user's rootId
  //   );
  // }

  // Existing methods (keep these)
  getSummary() {
    return this.convexService.client.query(
      api.tasks.me.queries.getMyTaskStats,
      {}
    );
  }

  getRecentSubmissions() {
    return this.convexService.client.query(
      api.tasks.me.queries.getMyTasks,
      { status: 'pending' }
    );
  }
}
</file>

<file path="src/app/features/dashboard/recent-status/recent-submissions-widget.component.html">
<!-- src/app/features/dashboard/recent-status/recent-submissions-widget.component.html -->

<div class="card h-full">
  <div class="font-semibold text-xl mb-4" i18n>Recent Submissions</div>
  
  @if (isLoading) {
    <div class="flex justify-center items-center py-8">
      <i class="pi pi-spin pi-spinner" style="font-size: 2rem"></i>
      <span class="ml-3">Loading...</span>
    </div>
  }
  
  @else if (errorMessage) {
    <div class="p-message p-message-error">
      <div class="p-message-wrapper">
        <span class="p-message-icon pi pi-times-circle"></span>
        <div class="p-message-detail">{{ errorMessage }}</div>
      </div>
    </div>
  }
  
  @else if (submissions.length === 0) {
    <div class="text-center py-8">
      <i class="pi pi-inbox" style="font-size: 3rem; color: var(--text-color-secondary)"></i>
      <p class="mt-3 mb-0">No recent submissions</p>
    </div>
  }
  
  @else {
    <p-timeline [value]="submissions" align="left">
      <ng-template pTemplate="content" let-submission>
        <div class="ml-3">
          <span class="font-semibold">{{ submission.title }}</span>
          <div class="text-sm text-color-secondary mt-1">
            Status: {{ submission.status }}
          </div>
        </div>
      </ng-template>
      <ng-template pTemplate="opposite" let-submission>
        <small class="p-text-secondary">{{ formatTime(getTimestamp(submission)) }}</small>
      </ng-template>
    </p-timeline>
  }
</div>
</file>

<file path="src/app/features/dashboard/recent-status/recent-submissions-widget.component.ts.ts">
import { Component, OnInit } from '@angular/core';
import { DashboardService } from '../dashboard.service';
import { TimelineModule } from 'primeng/timeline'
import { CommonModule } from '@angular/common';
import { AuthService } from '@/core/services/auth.service';
import { EnrichedTask, TaskService } from '@/features/settings/services/task.service';

type RecentActivity = EnrichedTask | {
  _id: string;
  title: string;
  status: string;
  priority: string;
  dueDate: number;
  createdAt: number;
};


@Component({
  selector: 'app-recent-submissions-widget',
  standalone: true,
    imports: [
    CommonModule,
    TimelineModule ],
  templateUrl: './recent-submissions-widget.component.html'
})
export class RecentSubmissionsWidgetComponent implements OnInit {
  submissions: any[] = [];
  isLoading = true;
  errorMessage = '';

  constructor(
    private taskService: TaskService,
    private authService: AuthService
  ) {}

  async ngOnInit() {
    await this.loadRecentSubmissions();
  }

  async loadRecentSubmissions() {
    this.isLoading = true;
    this.errorMessage = '';

    try {
      const user = this.authService.currentUser();
      
      if (!user) {
        throw new Error('User not authenticated');
      }

      // âœ… Admins/Managers see recent activity
      if (user.roleLevel >= 4) {
        const result = await this.taskService.getRecentActivity(10);
        this.submissions = result || [];
      } else {
        // âœ… Executives see their own tasks
        const result = await this.taskService.getMyTasks({});
        this.submissions = result || [];
      }
    } catch (error: any) {
      console.error('Failed to load recent submissions:', error);
      this.errorMessage = error?.message || 'Failed to load data';
      this.submissions = [];
    } finally {
      this.isLoading = false;
    }
  }

  // âœ… Helper to get timestamp - works with both types
  getTimestamp(item: RecentActivity): number {
    return (item as any).createdAt || (item as any)._creationTime || Date.now();
  }

  formatTime(timestamp: number): string {
    return new Date(timestamp).toLocaleTimeString('en-IN', {
      hour: '2-digit',
      minute: '2-digit'
    });
  }
}
</file>

<file path="src/app/features/dashboard/revenueoverviewwidget.ts">
import { Component } from '@angular/core';
import { FormsModule } from '@angular/forms';
import { SelectModule } from 'primeng/select';
import { ChartModule } from 'primeng/chart';
import { debounceTime, Subscription } from 'rxjs';
import { LayoutService } from '@/layout/service/layout.service';

interface Week {
    label: string;
    value: number;
    data: number[][];
}

@Component({
    standalone: true,
    selector: 'app-revenue-overview-widget',
    imports: [SelectModule, ChartModule, FormsModule],
    template: ` <div class="card h-full">
        <div class="flex items-start justify-between mb-12">
            <span
                class="text-surface-900 dark:text-surface-0 text-xl font-semibold"
                >Revenue Overview</span
            >
            <p-select
                [options]="weeks"
                [(ngModel)]="selectedWeek"
                class="w-40"
                optionLabel="label"
                (onChange)="onWeekChange()"
            ></p-select>
        </div>
        <p-chart
            type="bar"
            height="300"
            [data]="barData"
            [options]="barOptions"
        ></p-chart>
    </div>`,
})
export class RevenueOverViewWidget {
    weeks: Week[] = [
        {
            label: 'Last Week',
            value: 0,
            data: [
                [65, 59, 80, 81, 56, 55, 40],
                [28, 48, 40, 19, 86, 27, 90],
            ],
        },
        {
            label: 'This Week',
            value: 1,
            data: [
                [35, 19, 40, 61, 16, 55, 30],
                [48, 78, 10, 29, 76, 77, 10],
            ],
        },
    ];

    selectedWeek: Week = this.weeks[0];

    barData: any;

    barOptions: any;

    subscription: Subscription;

    constructor(private layoutService: LayoutService) {
        this.subscription = this.layoutService.configUpdate$
            .pipe(debounceTime(50))
            .subscribe(() => {
                this.initChart();
            });
    }

    ngOnInit() {
        this.initChart();
        this.selectedWeek = this.weeks[0];
    }

    initChart() {
        const documentStyle = getComputedStyle(document.documentElement);
        const textColor = documentStyle.getPropertyValue('--text-color');
        const textColorSecondary = documentStyle.getPropertyValue(
            '--text-color-secondary',
        );
        const surfaceBorder =
            documentStyle.getPropertyValue('--surface-border');

        this.barData = {
            labels: ['MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT', 'SUN'],
            datasets: [
                {
                    label: 'Revenue',
                    backgroundColor:
                        documentStyle.getPropertyValue('--p-primary-500'),
                    barThickness: 12,
                    borderRadius: 12,
                    data: this.selectedWeek?.data[0],
                },
                {
                    label: 'Profit',
                    backgroundColor:
                        documentStyle.getPropertyValue('--p-primary-200'),
                    barThickness: 12,
                    borderRadius: 12,
                    data: this.selectedWeek?.data[1],
                },
            ],
        };

        this.barOptions = {
            animation: {
                duration: 0,
            },
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    labels: {
                        color: textColor,
                        usePointStyle: true,
                        font: {
                            weight: 700,
                        },
                        padding: 28,
                    },
                    position: 'bottom',
                },
            },
            scales: {
                x: {
                    ticks: {
                        color: textColorSecondary,
                        font: {
                            weight: 500,
                        },
                    },
                    grid: {
                        display: false,
                        drawBorder: false,
                    },
                },
                y: {
                    ticks: {
                        color: textColorSecondary,
                    },
                    grid: {
                        color: surfaceBorder,
                        drawBorder: false,
                    },
                },
            },
        };
    }

    onWeekChange() {
        let newBarData = { ...this.barData };
        newBarData.datasets[0].data = this.selectedWeek.data[0];
        newBarData.datasets[1].data = this.selectedWeek.data[1];
        this.barData = newBarData;
        this.initChart();
    }
}
</file>

<file path="src/app/features/dashboard/salesbycategorywidget.ts">
import { Component } from '@angular/core';
import { ChartModule } from 'primeng/chart';
import { debounceTime, Subscription } from 'rxjs';
import { LayoutService } from '@/layout/service/layout.service';

@Component({
    standalone: true,
    selector: 'app-sales-by-category-widget',
    imports: [ChartModule],
    template: ` <div class="card h-full">
        <div
            class="text-surface-900 dark:text-surface-0 text-xl font-semibold mb-12"
        >
            Sales by Category
        </div>
        <p-chart
            type="pie"
            [data]="pieData"
            height="300"
            [options]="pieOptions"
        ></p-chart>
    </div>`,
})
export class SalesByCategoryWidget {
    pieData: any;

    pieOptions: any;

    subscription!: Subscription;

    constructor(public layoutService: LayoutService) {
        this.subscription = this.layoutService.configUpdate$
            .pipe(debounceTime(50))
            .subscribe(() => {
                this.initChart();
            });
    }

    ngOnInit() {
        this.initChart();
    }

    initChart() {
        const documentStyle = getComputedStyle(document.documentElement);
        const textColor = documentStyle.getPropertyValue('--text-color');

        this.pieData = {
            labels: ['Electronics', 'Fashion', 'Household'],
            datasets: [
                {
                    data: [300, 50, 100],
                    backgroundColor: [
                        documentStyle.getPropertyValue('--p-primary-700'),
                        documentStyle.getPropertyValue('--p-primary-400'),
                        documentStyle.getPropertyValue('--p-primary-100'),
                    ],
                    hoverBackgroundColor: [
                        documentStyle.getPropertyValue('--p-primary-600'),
                        documentStyle.getPropertyValue('--p-primary-300'),
                        documentStyle.getPropertyValue('--p-primary-200'),
                    ],
                },
            ],
        };
        this.pieOptions = {
            animation: {
                duration: 0,
            },
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    labels: {
                        color: textColor,
                        usePointStyle: true,
                        font: {
                            weight: 700,
                        },
                        padding: 28,
                    },
                    position: 'bottom',
                },
            },
        };
    }

    ngOnDestroy() {
        if (this.subscription) {
            this.subscription.unsubscribe();
        }
    }
}
</file>

<file path="src/app/features/dashboard/status-widgets/statuswidget.component.html">
<!-- src/app/features/dashboard/status-widgets/statuswidget.component.html -->

<!-- Loading State -->
@if (isLoading) {
  <div class="grid grid-cols-12 gap-8">
    <div class="col-span-12 md:col-span-4">
      <div class="card h-full text-center">
        <i class="pi pi-spin pi-spinner" style="font-size: 2rem"></i>
      </div>
    </div>
    <div class="col-span-12 md:col-span-4">
      <div class="card h-full text-center">
        <i class="pi pi-spin pi-spinner" style="font-size: 2rem"></i>
      </div>
    </div>
    <div class="col-span-12 md:col-span-4">
      <div class="card h-full text-center">
        <i class="pi pi-spin pi-spinner" style="font-size: 2rem"></i>
      </div>
    </div>
  </div>
}

<!-- Error State -->
@else if (errorMessage) {
  <div class="card">
    <div class="p-message p-message-error">
      <div class="p-message-wrapper">
        <span class="p-message-icon pi pi-times-circle"></span>
        <div class="p-message-detail">{{ errorMessage }}</div>
      </div>
    </div>
  </div>
}

<!-- Data -->
@else if (stats) {
  <div class="grid grid-cols-12 gap-8">
    <div class="col-span-12 md:col-span-4">
      <div class="card h-full text-center">
        <span class="font-semibold text-lg" i18n>Completed Tasks</span>
        <div class="text-4xl font-bold mt-4 text-green-500">{{ tasksCompletedToday }}</div>
      </div>
    </div>

    <div class="col-span-12 md:col-span-4">
      <div class="card h-full text-center">
        <span class="font-semibold text-lg" i18n>Pending Tasks</span>
        <div class="text-4xl font-bold mt-4 text-orange-500">{{ pendingApprovals }}</div>
      </div>
    </div>

    <div class="col-span-12 md:col-span-4">
      <div class="card h-full text-center">
        <span class="font-semibold text-lg" i18n>In Progress</span>
        <div class="text-4xl font-bold mt-4 text-blue-500">{{ tasksAssignedToday }}</div>
      </div>
    </div>
  </div>
}
</file>

<file path="src/app/features/dashboard/status-widgets/statuswidget.ts">
import { Component, Input, OnInit } from '@angular/core';
import { CommonModule } from '@angular/common';
import { KnobModule } from 'primeng/knob';
import { FormsModule } from '@angular/forms';
import { DashboardService } from '../dashboard.service'; 
import { AuthService } from '@/core/services/auth.service';
import { MyTaskStats, TaskService, TaskStats } from '@/features/settings/services/task.service';

@Component({
  standalone: true,
  selector: 'app-status-widget',
  imports: [CommonModule, KnobModule, FormsModule],
  templateUrl: './statuswidget.component.html'
})
export class StatusWidgetComponent implements OnInit {
stats: TaskStats | MyTaskStats | null = null;
 @Input() color: string = '#2196F3'; 
  isLoading = true;
  errorMessage = '';

  constructor(
    private taskService: TaskService,
    private authService: AuthService
  ) {}

  async ngOnInit() {
    await this.loadStats();
  }

  async loadStats() {
    this.isLoading = true;
    this.errorMessage = '';

    try {
      const user = this.authService.currentUser();
      
      if (!user) {
        throw new Error('User not authenticated');
      }

      // âœ… Get appropriate stats based on role
      if (user.roleLevel >= 4) {
        // Admin/Manager - get all task stats
        this.stats = await this.taskService.getTaskStats();
      } else {
        // Executive - get my task stats
        this.stats = await this.taskService.getMyTaskStats();
      }
    } catch (error: any) {
      console.error('Failed to load task stats:', error);
      this.errorMessage = error?.message || 'Failed to load stats';
    } finally {
      this.isLoading = false;
    }
  }

  // Helper getters for display
  get tasksCompletedToday(): number {
    return this.stats?.completed || 0;
  }

  get pendingApprovals(): number {
    return this.stats?.pending || 0;
  }

  get tasksAssignedToday(): number {
    return this.stats?.inProgress || 0;
  }
}
</file>

<file path="src/app/features/dashboard/top-perfomers/top-executives-widget.component.html">
<!-- src/app/features/dashboard/top-perfomers/top-executives-widget.component.html -->

<div class="card h-full">
  <div class="font-semibold text-xl mb-4" i18n>Top Executives</div>
  
  <!-- Loading State -->
  @if (isLoading) {
    <div class="flex justify-center items-center py-8">
      <i class="pi pi-spin pi-spinner" style="font-size: 2rem"></i>
      <span class="ml-3">Loading...</span>
    </div>
  }
  
  <!-- No Permission -->
  @else if (!hasPermission) {
    <div class="text-center py-8">
      <i class="pi pi-lock" style="font-size: 3rem; color: var(--text-color-secondary)"></i>
      <p class="mt-3 mb-0">{{ errorMessage }}</p>
    </div>
  }
  
  <!-- Error State -->
  @else if (errorMessage) {
    <div class="p-message p-message-error">
      <div class="p-message-wrapper">
        <span class="p-message-icon pi pi-times-circle"></span>
        <div class="p-message-detail">{{ errorMessage }}</div>
      </div>
    </div>
  }
  
  <!-- Empty State -->
  @else if (topExecutives.length === 0) {
    <div class="text-center py-8">
      <i class="pi pi-users" style="font-size: 3rem; color: var(--text-color-secondary)"></i>
      <p class="mt-3 mb-0">No executives found</p>
    </div>
  }
  
  <!-- Data -->
  @else {
    <ul class="list-none p-0 m-0">
      @for (executive of topExecutives; track executive._id) {
        <li class="flex items-center justify-between mb-4 pb-4 border-bottom">
          <div class="inline-flex items-center">
            <p-avatar 
              [label]="executive.name.substring(0, 2).toUpperCase()" 
              size="large" 
              shape="circle" 
              styleClass="mr-3"
            ></p-avatar>
            <div>
              <div class="font-medium text-lg">{{ executive.name }}</div>
              <div class="text-sm text-color-secondary">{{ executive.employeeId }}</div>
            </div>
          </div>
          <div class="mt-2 md:mt-0 ml-auto">
            <div class="bg-primary-100 dark:bg-primary-900/50 text-primary-600 dark:text-primary-300 font-semibold p-2 rounded-md text-center w-24">
              {{ executive.completedTasks }} Tasks
            </div>
            <div class="text-xs text-center mt-1 text-color-secondary">
              {{ executive.completionRate }}% rate
            </div>
          </div>
        </li>
      }
    </ul>
  }
</div>
</file>

<file path="src/app/features/dashboard/top-perfomers/top-executives-widget.ts.ts">
import { Component, OnInit } from '@angular/core';
import { CommonModule } from '@angular/common';
import { AvatarModule } from 'primeng/avatar';
import { UserService } from '@/features/user-management/user.service';
import { AuthService } from '@/core/services/auth.service';
import { TaskService, TopPerformer } from '@/features/settings/services/task.service';

@Component({
  standalone: true,
  selector: 'app-top-executives-widget', // Rename the selector
  imports: [CommonModule, AvatarModule],
  templateUrl: './top-executives-widget.component.html'
})
export class TopExecutivesWidgetComponent implements OnInit {
  topExecutives: TopPerformer[] = [];
  isLoading = true;
  errorMessage = '';
  hasPermission = false;

  constructor(
    private taskService: TaskService,
    private authService: AuthService
  ) {}

  async ngOnInit() {
    // âœ… Check permission first
    const user = this.authService.currentUser();
    this.hasPermission = !!user && user.roleLevel >= 6;

    if (this.hasPermission) {
      await this.loadTopPerformers();
    } else {
      this.isLoading = false;
      this.errorMessage = 'Requires manager or higher role';
    }
  }

  async loadTopPerformers() {
    this.isLoading = true;
    this.errorMessage = '';

    try {
      this.topExecutives = await this.taskService.getTopPerformers();
    } catch (error: any) {
      console.error('Failed to load top performers:', error);
      this.errorMessage = error?.message || 'Failed to load data';
      this.topExecutives = [];
    } finally {
      this.isLoading = false;
    }
  }
}
</file>

<file path="src/app/features/hr-recruitment/candidate-pipeline/candidate-pipeline-components/candidate-card/candidate-card.component.html">
<div class="candidate-card" (click)="onCardClick()">
  <!-- Header: avatar + name + email -->
  <div class="candidate-card-header">
    <div class="candidate-card-avatar">
      {{ getInitials(card.candidateName) }}
    </div>

    <div class="candidate-card-main">
      <div class="candidate-card-name">
        {{ card.candidateName }}
      </div>

      <div class="candidate-card-email">
        <i class="pi pi-envelope"></i>
        <span>{{ card.email }}</span>
      </div>
    </div>
  </div>

  <!-- Meta row -->
  <div class="candidate-card-meta">
    <div class="meta-item">
      <i class="pi pi-calendar"></i>
      <span>Applied: {{ card.appliedDate | date : 'dd/MM/yyyy' }}</span>
    </div>

    <div class="meta-item" *ngIf="card.experience !== undefined">
      <i class="pi pi-briefcase"></i>
      <span>{{ card.experience }} yrs</span>
    </div>

    <div class="meta-item" *ngIf="card.phone">
      <i class="pi pi-phone"></i>
      <span>{{ card.phone }}</span>
    </div>
  </div>
</div>
</file>

<file path="src/app/features/hr-recruitment/candidate-pipeline/candidate-pipeline-components/candidate-card/candidate-card.component.scss">
$neutral-100: #f3f4f6;
$neutral-200: #e5e7eb;
$neutral-500: #6b7280;
$neutral-700: #374151;
$neutral-900: #111827;
$primary-blue-light: #3b82f6;

.candidate-card {
    background: #ffffff;
    border-radius: 14px;
    padding: 1rem;
    border: 1px solid $neutral-200;
    box-shadow: 0 1px 3px rgba(15, 23, 42, 0.04);
    cursor: pointer;
    transition: all 0.2s ease;

    &:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(15, 23, 42, 0.14);
        border-color: $primary-blue-light;
    }
}

/* Header: avatar + info */
.candidate-card-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
}

.candidate-card-avatar {
    width: 40px;
    height: 40px;
    border-radius: 999px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 0.9rem;
    color: #ffffff;
    background: #10b981;
    flex-shrink: 0;
}

.candidate-card-main {
    flex: 1;
    min-width: 0;
}

.candidate-card-name {
    font-weight: 600;
    font-size: 0.95rem;
    color: $neutral-900;
    margin-bottom: 0.1rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.candidate-card-email {
    font-size: 0.8rem;
    color: $neutral-500;
    display: flex;
    align-items: center;
    gap: 0.25rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;

    i {
        font-size: 0.75rem;
    }
}

/* Meta row */
.candidate-card-meta {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 0.5rem;
    padding-top: 0.6rem;
    margin-top: 0.4rem;
    border-top: 1px solid $neutral-100;

    .meta-item {
        display: flex;
        align-items: center;
        gap: 0.25rem;
        font-size: 0.75rem;
        color: $neutral-500;

        i {
            font-size: 0.7rem;
        }
    }
}
</file>

<file path="src/app/features/hr-recruitment/candidate-pipeline/candidate-pipeline-components/candidate-card/candidate-card.component.ts">
import { Component, Input } from '@angular/core';
import { CommonModule } from '@angular/common';
import { CandidateCard, ApplicationStatus } from '../../types/pipeline.types';
import { PipelineService } from '../../services/pipeline.service';

@Component({
  selector: 'app-candidate-card',
  standalone: true,
  imports: [CommonModule],
  templateUrl: './candidate-card.component.html',
  styleUrls: ['./candidate-card.component.scss'],
})
export class CandidateCardComponent {
  @Input() card!: CandidateCard;
  @Input() stageId!: ApplicationStatus;

  constructor(private pipelineService: PipelineService) {}

  onCardClick() {
    this.pipelineService.onCardSelect(this.card, this.stageId);
  }

  getInitials(name: string): string {
    return name
      .split(' ')
      .filter(Boolean)
      .map((n) => n[0])
      .join('')
      .toUpperCase()
      .substring(0, 2);
  }
}
</file>

<file path="src/app/features/hr-recruitment/candidate-pipeline/candidate-pipeline-components/candidate-detail/candidate-detail.component.html">
<ng-container *ngIf="candidateData as card">
    <!-- Candidate Header -->
    <div class="text-center mb-4">
        <p-avatar
            data-cy="candidate-avatar"
            [label]="getInitials(card.candidateName)"
            size="xlarge"
            shape="circle"
            [style]="{
                'background-color': '#2196F3',
                color: '#ffffff',
                'font-size': '2rem'
            }"
        />
        <h3 data-cy="candidate-name" class="mt-3 mb-1">
            {{ card.candidateName }}
        </h3>
        <p-tag
            data-cy="candidate-stage-tag"
            [value]="stageId!"
            [severity]="
                stageId === 'selected'
                    ? 'success'
                    : stageId === 'rejected'
                      ? 'danger'
                      : 'info'
            "
        />
    </div>

    <p-divider />

    <!-- Contact Information -->
    <div class="mb-4">
        <h4 class="mb-3">Contact Information</h4>

        <div class="flex align-items-center gap-2 mb-2">
            <i class="pi pi-envelope"></i>
            <a
                data-cy="candidate-email"
                [href]="'mailto:' + card.email"
                class="text-primary"
            >
                {{ card.email }}
            </a>
        </div>

        <div class="flex align-items-center gap-2 mb-2">
            <i class="pi pi-phone"></i>
            <a
                data-cy="candidate-phone"
                [href]="'tel:' + card.phone"
                class="text-primary"
            >
                {{ card.phone }}
            </a>
        </div>

        <div class="flex align-items-center gap-2">
            <i class="pi pi-briefcase"></i>
            <span data-cy="candidate-experience"
                >{{ card.experience }} years of experience</span
            >
        </div>
    </div>

    <p-divider />

    <!-- Application Details -->
    <div class="mb-4">
        <h4 class="mb-3">Application Details</h4>

        <div class="mb-2">
            <span class="font-semibold">Applied Date:</span>
            <span data-cy="candidate-applied-date" class="ml-2">{{
                card.appliedDate
            }}</span>
        </div>

        <div *ngIf="card.wardId" class="mb-2">
            <span class="font-semibold">Assigned Ward:</span>
            <p-tag
                data-cy="candidate-ward-tag"
                [value]="card.wardId"
                severity="secondary"
                class="ml-2"
            />
        </div>

        <div *ngIf="card.interviewDate" class="mb-2">
            <span class="font-semibold">Interview Date:</span>
            <span class="ml-2">{{ card.interviewDate }}</span>
        </div>
    </div>

    <p-divider />

    <!-- Interview Notes -->
    <div *ngIf="card.interviewNotes" class="mb-4">
        <h4 class="mb-3">Interview Notes</h4>
        <p class="text-muted">{{ card.interviewNotes }}</p>
    </div>

    <!-- Rejection Reason -->
    <div *ngIf="card.rejectionReason" class="mb-4">
        <h4 class="mb-3">Rejection Reason</h4>
        <p class="text-danger">{{ card.rejectionReason }}</p>
    </div>

    <!-- Reject Candidate Section (if not already rejected) -->
    <div *ngIf="stageId !== 'rejected'" class="mb-4">
        <h4 class="mb-3">Reject Candidate</h4>
        <textarea
            data-cy="rejection-reason-input"
            pInputTextarea
            [(ngModel)]="rejectionReason"
            placeholder="Enter rejection reason..."
            rows="4"
            class="w-full mb-3"
        ></textarea>
        <p-button
            data-cy="reject-button"
            label="Reject Candidate"
            icon="pi pi-times"
            severity="danger"
            (onClick)="rejectCandidate()"
            [disabled]="!rejectionReason.trim()"
            styleClass="w-full"
        />
    </div>

    <p-divider />

    <!-- Actions -->
    <p-divider />

    <!-- Stage Actions -->
    <div class="mb-4">
        <h4 class="mb-3">Stage Actions</h4>

        <!-- From APPLIED -->
        <div *ngIf="stageId === 'applied'" class="flex gap-2 mb-2">
            <p-button
                label="Move to Shortlisted"
                icon="pi pi-arrow-right"
                severity="info"
                styleClass="flex-1"
                (onClick)="changeStatus('shortlisted')"
            ></p-button>
            <p-button
                label="Move to Interviewed"
                icon="pi pi-calendar"
                severity="info"
                styleClass="flex-1"
                (onClick)="changeStatus('interviewed')"
            ></p-button>
        </div>

        <!-- From SHORTLISTED -->
        <div *ngIf="stageId === 'shortlisted'" class="flex gap-2 mb-2">
            <p-button
                label="Move to Interviewed"
                icon="pi pi-calendar"
                severity="info"
                styleClass="flex-1"
                (onClick)="changeStatus('interviewed')"
            ></p-button>
            <p-button
                label="Mark as Selected"
                icon="pi pi-check"
                severity="success"
                styleClass="flex-1"
                (onClick)="changeStatus('selected')"
            ></p-button>
        </div>

        <!-- From INTERVIEWED -->
        <div *ngIf="stageId === 'interviewed'" class="flex gap-2 mb-2">
            <p-button
                label="Mark as Selected"
                icon="pi pi-check"
                severity="success"
                styleClass="flex-1"
                (onClick)="changeStatus('selected')"
            ></p-button>
        </div>

        <!-- From SELECTED -->
        <div *ngIf="stageId === 'selected'" class="flex gap-2 mb-2">
            <p-button
                label="Create {{
                    (candidateData?.jobTitle || '')
                        .toLowerCase()
                        .includes('executive')
                        ? 'Executive'
                        : 'Admin'
                }}"
                icon="pi pi-user-plus"
                severity="success"
                styleClass="flex-1"
                (onClick)="createUserAccount()"
            ></p-button>
        </div>

        <!-- From REJECTED -->
        <div *ngIf="stageId === 'rejected'" class="flex flex-column gap-2 mb-2">
            <p-button
                label="Move back to Applied"
                icon="pi pi-undo"
                severity="info"
                styleClass="w-full"
                (onClick)="changeStatus('applied')"
            ></p-button>
            <p-button
                label="Move to Shortlisted"
                icon="pi pi-arrow-right"
                severity="info"
                styleClass="w-full"
                (onClick)="changeStatus('shortlisted')"
            ></p-button>
            <p-button
                label="Move to Interviewed"
                icon="pi pi-calendar"
                severity="info"
                styleClass="w-full"
                (onClick)="changeStatus('interviewed')"
            ></p-button>
        </div>
    </div>

    <p-divider />

    <!-- Reject Candidate (available in all stages) -->
    <div class="mb-4">
        <h4 class="mb-3">Reject Candidate</h4>
        <textarea
            data-cy="rejection-reason-input"
            pInputTextarea
            [(ngModel)]="rejectionReason"
            placeholder="Enter rejection reason..."
            rows="4"
            class="w-full mb-3"
        ></textarea>
        <p-button
            data-cy="reject-button"
            label="Reject Candidate"
            icon="pi pi-times"
            severity="danger"
            (onClick)="rejectCandidate()"
            [disabled]="!rejectionReason.trim()"
            styleClass="w-full"
        ></p-button>
    </div>

    <p-divider />

    <!-- Footer actions -->
    <div class="flex gap-2">
        <p-button
            data-cy="view-resume-button"
            label="View Resume"
            icon="pi pi-file-pdf"
            severity="secondary"
            styleClass="flex-1"
            (onClick)="viewResume()"
        ></p-button>
        <p-button
            data-cy="close-drawer-button"
            label="Close"
            icon="pi pi-times"
            severity="secondary"
            styleClass="flex-1"
            (onClick)="onHide()"
        ></p-button>
    </div>
</ng-container>
</file>

<file path="src/app/features/hr-recruitment/candidate-pipeline/candidate-pipeline-components/candidate-detail/candidate-detail.component.scss">
:host ::ng-deep {
  .p-drawer .p-drawer-content {
    padding: 1.5rem;
  }

  .candidate-avatar {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }

  .candidate-name {
    font-size: 1.5rem;
    font-weight: 700;
    color: #1e293b;
    margin: 0;
  }

  .candidate-email {
    color: #475569;
    font-size: 0.95rem;
    text-decoration: none;
    
    &:hover {
      color: #06b6d4;
    }
  }

  .candidate-stage-tag {
    font-size: 0.85rem;
    font-weight: 600;
  }

  .meta-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.25rem;
    font-size: 0.9rem;
    
    i {
      color: #64748b;
      width: 16px;
    }
  }

  .create-user-section {
    background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
    border: 1px solid #bbf7d0;
    border-radius: 8px;
    padding: 1.25rem;
    margin: 1.5rem 0;
    
    h4 {
      color: #166534;
      margin: 0 0 1rem 0;
      font-size: 1.1rem;
    }
  }

  .reject-section {
    background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
    border: 1px solid #fecaca;
    border-radius: 8px;
    padding: 1.25rem;
    margin: 1.5rem 0;
  }

  .p-button.create-user {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    border: none;
    
    &:hover {
      background: linear-gradient(135deg, #059669 0%, #047857 100%);
      transform: translateY(-1px);
    }
  }

  .setup-link-input {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #e2e8f0;
    border-radius: 6px 0 0 6px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.875rem;
    background: #f8fafc;
  }

  .flex {
    gap: 0.75rem;
  }

  .text-center {
    text-align: center;
  }

  .mb-4 {
    margin-bottom: 1.5rem;
  }

  .mt-3 {
    margin-top: 1.25rem;
  }
}
</file>

<file path="src/app/features/hr-recruitment/candidate-pipeline/candidate-pipeline-components/candidate-detail/candidate-detail.component.ts">
import { Component, Input, Output, EventEmitter } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { DrawerModule } from 'primeng/drawer';
import { ButtonModule } from 'primeng/button';
import { InputTextModule } from 'primeng/inputtext';
import { TextareaModule } from 'primeng/textarea';
import { AvatarModule } from 'primeng/avatar';
import { TagModule } from 'primeng/tag';
import { DividerModule } from 'primeng/divider';
import { CandidateCard, ApplicationStatus } from '../../types/pipeline.types';
import { PipelineService } from '../../services/pipeline.service';
import { MessageService } from 'primeng/api';

@Component({
  selector: 'app-candidate-detail',
  standalone: true,
  imports: [
    CommonModule,
    FormsModule,
    DrawerModule,
    ButtonModule,
    InputTextModule,
    TextareaModule,
    AvatarModule,
    TagModule,
    DividerModule,
  ],
  templateUrl: './candidate-detail.component.html',
  styleUrls: ['./candidate-detail.component.scss'],
})
export class CandidateDetailComponent {
  @Input() candidate: CandidateCard | null = null;
  @Input() currentStage: ApplicationStatus | null = null;
  @Input() visible = false;

  @Output() visibleChange = new EventEmitter<boolean>();
  @Output() candidateUpdated = new EventEmitter<void>();
  @Output() closeDrawer = new EventEmitter<void>();

  rejectionReason = '';

  constructor(
    private pipelineService: PipelineService,
    private messageService: MessageService
  ) {}

  get candidateData() {
    return this.candidate;
  }

  get stageId() {
    return this.currentStage;
  }

  onHide() {
    this.visible = false;
    this.visibleChange.emit(false);
    this.closeDrawer.emit();
  }

 async changeStatus(targetStatus: ApplicationStatus) {
  const candidate = this.candidateData;
  if (!candidate) return;

  try {
    await this.pipelineService.moveCandidate(candidate.id, targetStatus);

    this.messageService.add({
      severity: 'success',
      summary: 'Status Updated',
      detail: `${candidate.candidateName} moved to ${targetStatus}`,
    });

    this.currentStage = targetStatus;
    this.candidateUpdated.emit();
  } catch (error: any) {
    this.messageService.add({
      severity: 'error',
      summary: 'Update Failed',
      detail: error.message || 'Failed to change status',
    });
  }
}

async rejectCandidate() {
  const candidate = this.candidateData;
  if (!candidate || !this.rejectionReason.trim()) {
    this.messageService.add({
      severity: 'warn',
      summary: 'Validation Error',
      detail: 'Please provide a rejection reason',
    });
    return;
  }

  try {
    await this.pipelineService.moveCandidate(
      candidate.id,
      'rejected',
      this.rejectionReason
    );

    this.messageService.add({
      severity: 'success',
      summary: 'Candidate Rejected',
      detail: `${candidate.candidateName} has been rejected`,
    });

    this.currentStage = 'rejected';
    this.candidateUpdated.emit();
  } catch (error: any) {
    this.messageService.add({
      severity: 'error',
      summary: 'Error',
      detail: error.message || 'Failed to reject candidate',
    });
  }
}

viewResume() {
  const candidate = this.candidateData;
  if (!candidate || !candidate.resumeUrl) {
    this.messageService.add({
      severity: 'info',
      summary: 'Resume Not Found',
      detail: 'No resume URL is available for this candidate yet.',
    });
    return;
  }

  window.open(candidate.resumeUrl, '_blank');
}


  async createUserAccount() {
    const candidate = this.candidateData;
    if (!candidate) {
      this.messageService.add({
        severity: 'warn',
        summary: 'No Candidate',
        detail: 'No candidate selected',
      });
      return;
    }

    if (this.stageId !== 'selected') {
      this.messageService.add({
        severity: 'warn',
        summary: 'Invalid Stage',
        detail: 'Only selected candidates can be converted to users',
      });
      return;
    }

    if (candidate.convertedToUserId) {
      this.messageService.add({
        severity: 'info',
        summary: 'Already Converted',
        detail: `${candidate.candidateName} is already an ${candidate.userType || 'user'}`,
      });
      return;
    }

    try {
      const result = await this.pipelineService.convertApplicationToUser(
        candidate.id,
        candidate.jobTitle || 'Field Executive'
      );

      this.messageService.add({
        severity: 'success',
        summary: `${result.userType.toUpperCase()} Created!`,
        detail: `${candidate.candidateName}'s account created successfully!`,
      });

      this.showSetupLinkDialog(result.setupLink, result.userType);
      this.onHide();
      this.candidateUpdated.emit();
    } catch (error: any) {
      this.messageService.add({
        severity: 'error',
        summary: 'Account Creation Failed',
        detail: error.message || 'Failed to create user account',
      });
    }
  }

  private showSetupLinkDialog(setupLink: string, userType: string) {
    const userLabel = userType === 'executive' ? 'Executive' : 'Admin';
    const message = `ðŸ“§ ${userLabel} account created!\n\nCopy this link and send to ${this.candidateData?.candidateName}:\n\n${setupLink}\n\nâ° Expires in 24 hours`;

    if (confirm(message)) {
      navigator.clipboard.writeText(setupLink).then(() => {
        this.messageService.add({
          severity: 'info',
          summary: 'Link Copied!',
          detail: 'Setup link copied to clipboard',
        });
      });
    }
  }

  getInitials(name: string): string {
    return name
      .split(' ')
      .filter(Boolean)
      .map((n) => n[0])
      .join('')
      .toUpperCase()
      .substring(0, 2);
  }
}
</file>

<file path="src/app/features/hr-recruitment/candidate-pipeline/candidate-pipeline-components/pipeline-stage/pipeline-stage.component.html">
<div class="pipeline-stage">
  <!-- Stage header + search -->
  <div class="stage-header">
    <div class="stage-header-top">
      <span class="stage-header-title">
        {{ stage.title }}
      </span>

      <span class="stage-header-count">
        {{ stage.totalCount }}
      </span>
    </div>

<div class="stage-search-wrapper p-input-icon-left">
  <i class="pi pi-search"></i>
  <input
    type="text"
    pInputText
    class="stage-search"
    placeholder="Search name, email, phone..."
    [(ngModel)]="searchTerm"
  />
</div>
  </div>

  <!-- Cards list with drag-drop -->
  <div
    class="stage-cards"
    cdkDropList
    [cdkDropListData]="stage.candidates"
    (cdkDropListDropped)="onDrop($event)"
  >
    <ng-container *ngIf="filteredCandidates.length; else emptyState">
      <app-candidate-card
        *ngFor="let candidate of filteredCandidates"
        class="candidate-card"
        cdkDrag
        [card]="candidate"
        [stageId]="stage.stageId"
        (click)="onCardClicked(candidate)"
      ></app-candidate-card>

      <!-- Load more button -->
      <button
        *ngIf="!stage.isDone"
        pButton
        type="button"
        label="Load more"
        class="load-more-btn p-button-text"
        (click)="onLoadMore()"
      ></button>
    </ng-container>

    <!-- Empty column state -->
    <ng-template #emptyState>
      <div class="empty-stage">
        <i class="pi pi-inbox"></i>
        <span>No candidates in this stage</span>
      </div>
    </ng-template>
  </div>
</div>
</file>

<file path="src/app/features/hr-recruitment/candidate-pipeline/candidate-pipeline-components/pipeline-stage/pipeline-stage.component.scss">
.pipeline-stage {
  display: flex;
  flex-direction: column;
  height: 100%;
}

/* Header with title, count and search */
.stage-header {
  padding: 0.5rem 0.75rem 0.35rem;
  display: flex;
  flex-direction: column;
  gap: 0.4rem;
  border-bottom: 1px solid #e5e7eb;
  background-color: #f9fafb;
}

.stage-header-top {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.5rem;
}

.stage-header-title {
  font-weight: 600;
  font-size: 0.9rem;
  color: #111827;
  white-space: nowrap;
}

.stage-header-count {
  font-size: 0.75rem;
  color: #6b7280;
}

/* Search input */
.stage-search {
  width: 100%;
  background-color: white;
}

:host ::ng-deep .p-inputtext.stage-search {
  width: 100%;
  padding: 0.1rem 0.5rem;   /* compact vertical padding */
  font-size: 0.7rem;
  height: 1.6rem;           /* smaller box */
  line-height: 1.4rem;
  border-radius: 999px;
  background-color: #ffffff;  /* white background */
  border: 1px solid #e5e7eb;  /* subtle border */
}
/* Cards area */
.stage-cards {
  flex: 1;
  overflow-y: auto;
  padding: 0.5rem 0.5rem 0.75rem;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

/* Empty state */
.empty-stage {
  padding: 1.5rem 0.5rem;
  text-align: center;
  color: #9ca3af;
  font-size: 0.8rem;

  i {
    display: block;
    margin-bottom: 0.5rem;
    font-size: 1.2rem;
  }
}

/* Load more button */
.load-more-btn {
  margin: 0.25rem auto 0;
  font-size: 0.8rem;
}
</file>

<file path="src/app/features/hr-recruitment/candidate-pipeline/candidate-pipeline-components/pipeline-stage/pipeline-stage.component.ts">
import { Component, Input, Output, EventEmitter, signal } from '@angular/core';
import { CommonModule } from '@angular/common';
import { CdkDragDrop, DragDropModule } from '@angular/cdk/drag-drop';
import { ButtonModule } from 'primeng/button';
import { PipelineStage, ApplicationStatus, CandidateCard } from '../../types/pipeline.types';
import { CandidateCardComponent } from '../candidate-card/candidate-card.component';
import { TagModule } from 'primeng/tag';
import { CardModule } from 'primeng/card';
import { FormsModule } from '@angular/forms';

@Component({
  selector: 'app-pipeline-stage',
  standalone: true,
  imports: [
    CommonModule,
    DragDropModule,
    ButtonModule,
    TagModule,
    CandidateCardComponent,
    CardModule,
    FormsModule
  ],
  templateUrl: './pipeline-stage.component.html',
styleUrls: ['./pipeline-stage.component.scss']
})
export class PipelineStageComponent {
  @Input() stage!: PipelineStage;
  @Input() allStageIds!: ApplicationStatus[];

  @Output() cardDropped = new EventEmitter<CdkDragDrop<any>>();
  @Output() cardSelected = new EventEmitter<{ card: CandidateCard; stageId: ApplicationStatus }>();
@Output() loadMore = new EventEmitter<ApplicationStatus>();
searchTerm = '';
isLoadingMore = signal(false);
  onDrop(event: CdkDragDrop<any>) {
    this.cardDropped.emit(event);
  }
get filteredCandidates(): CandidateCard[] {
  const term = this.searchTerm.trim().toLowerCase();
  if (!term) return this.stage.candidates;
  return this.stage.candidates.filter(c =>
    c.candidateName.toLowerCase().includes(term) ||
    c.email.toLowerCase().includes(term) ||
    c.phone?.includes(term)
  );
}
onSearchChange(value: string) {
  this.searchTerm = value;
}
  onCardClicked(card: CandidateCard) {
    console.log('ðŸ–±ï¸ Stage clicked card:', card.candidateName);
    this.cardSelected.emit({ card, stageId: this.stage.stageId });
  }

  getStageColor(stageId: ApplicationStatus): 'success' | 'secondary' | 'info' | 'warn' | 'danger' {
    const colorMap: Record<ApplicationStatus, 'success' | 'secondary' | 'info' | 'warn' | 'danger'> = {
      applied: 'info',
      shortlisted: 'secondary',
      interviewed: 'warn',
      selected: 'success',
      rejected: 'danger'
    };
    return colorMap[stageId];
  }

    async onLoadMoreClick() {
    if (this.stage.isDone || !this.stage.nextCursor) return;
    this.isLoadingMore.set(true);
    this.loadMore.emit(this.stage.stageId);
    this.isLoadingMore.set(false);
  }

   onLoadMore() {
    if (this.stage.isDone || !this.stage.nextCursor) return;
    this.loadMore.emit(this.stage.stageId);
  }
}
</file>

<file path="src/app/features/hr-recruitment/candidate-pipeline/candidate-pipeline.component.html">
<div class="candidate-pipeline-container">
  <p-toast></p-toast>

  <!-- Header with Job Filter -->
  <div class="pipeline-header">
    <h2>Candidate Pipeline</h2>

    <div class="job-filter">
      <p-select
        [options]="availableJobs()"
        [(ngModel)]="selectedJob"
        (onChange)="onJobSelect($event.value)"
        optionLabel="label"
        optionValue="value"
        placeholder="Select a job posting"
        [filter]="true"
        filterPlaceholder="Search jobs..."
        [showClear]="true"
        styleClass="job-select"
      >
      
        <ng-template let-job pTemplate="item">
          <div class="job-option">
            <span class="job-title">{{ job.label }}</span>
            <span class="job-count">{{ job.totalApplications }} applications</span>
          </div>
        </ng-template>
      </p-select>
    </div>
  </div>

  <!-- Location Filters (only when a job is selected) -->
  <div class="location-filters" *ngIf="selectedJob()">
    <div class="filter-header">
      <h3>Filter by Location</h3>
      <button
        pButton
        type="button"
        label="Clear All"
        icon="pi pi-times"
        class="p-button-text p-button-sm clear-btn"
        (click)="clearFilters()"
      ></button>
    </div>

    <!-- Quick Ward Search -->
    <div class="filter-row">
      <div class="filter-item full-width">
        <label>Quick Ward Search</label>
        <input
          pInputText
          type="text"
          class="ward-search-input"
          placeholder="Type ward name (min 2 chars)..."
          [(ngModel)]="wardSearchQuery"
          (ngModelChange)="onWardSearch($event)"
        />

        <div class="ward-search-results" *ngIf="wardSearchResults().length > 0">
          <div
            *ngFor="let ward of wardSearchResults()"
            class="ward-result-item"
            (click)="selectedWard.set(ward._id); applyFilters()"
          >
            <strong>{{ ward.wardName }}</strong>
            <span class="ward-path">{{ ward.fullPath }}</span>
          </div>
        </div>

        <div class="search-loading" *ngIf="searchingWards()">
          <i class="pi pi-spin pi-spinner"></i> Searching...
        </div>

        <div
          class="no-results"
          *ngIf="!searchingWards() && wardSearchResults().length === 0 && wardSearchQuery().length > 1"
        >
          No wards found
        </div>
      </div>
    </div>

    <div class="filter-divider">OR filter step by step:</div>

    <!-- Step-by-step filters -->
    <div class="filter-row">
      <div class="filter-item">
        <label>Zone</label>
        <p-select
          [options]="zones()"
          [(ngModel)]="selectedZone"
          (onChange)="onZoneChange($event.value)"
          optionLabel="label"
          optionValue="value"
          placeholder="Select zone"
          [showClear]="true"
          styleClass="filter-select"
        ></p-select>
      </div>

      <div class="filter-item">
        <label>District</label>
        <p-select
          [options]="districts()"
          [(ngModel)]="selectedDistrict"
          (onChange)="onDistrictChange($event.value)"
          optionLabel="label"
          optionValue="value"
          placeholder="Select district"
          [showClear]="true"
          [disabled]="districts().length === 0"
          styleClass="filter-select"
        ></p-select>
      </div>

      <div class="filter-item">
        <label>Subdistrict</label>
        <p-select
          [options]="subdistricts()"
          [(ngModel)]="selectedSubdistrict"
          (onChange)="onSubdistrictChange($event.value)"
          optionLabel="label"
          optionValue="value"
          placeholder="Select subdistrict"
          [showClear]="true"
          [disabled]="subdistricts().length === 0"
          styleClass="filter-select"
        ></p-select>
      </div>

      <div class="filter-item">
        <label>Local Body Type</label>
        <p-select
          [options]="localBodyTypes()"
          [(ngModel)]="selectedLocalBodyType"
          optionLabel="label"
          optionValue="value"
          placeholder="Select type"
          [showClear]="true"
          styleClass="filter-select"
        ></p-select>
      </div>

      <div class="filter-item">
        <label>Local Body</label>
        <p-select
          [options]="localBodies()"
          [(ngModel)]="selectedLocalBody"
          (onChange)="onLocalBodyChange($event.value)"
          optionLabel="label"
          optionValue="value"
          placeholder="Select local body"
          [showClear]="true"
          [disabled]="localBodies().length === 0"
          styleClass="filter-select"
        ></p-select>
      </div>

      <div class="filter-item">
        <label>Ward</label>
        <p-select
          [options]="wards()"
          [(ngModel)]="selectedWard"
          (onChange)="applyFilters()"
          optionLabel="label"
          optionValue="value"
          placeholder="Select ward"
          [showClear]="true"
          [disabled]="wards().length === 0"
          styleClass="filter-select"
        ></p-select>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading()" class="loading-state">
    <i class="pi pi-spin pi-spinner"></i>
    Loading pipeline data...
  </div>

  <!-- Pipeline stages -->
  <div
    *ngIf="!loading() && stages().length > 0"
    class="pipeline-stages"
  >
<app-pipeline-stage
  *ngFor="let stage of stages()"
  [stage]="stage"
  [allStageIds]="allStageIds"
  (cardDropped)="onDrop($event, stage.stageId)"
  (cardSelected)="onCardSelect($event.card, $event.stageId)"
  (loadMore)="onLoadMoreStage(stage.stageId)"
></app-pipeline-stage>
  </div>

  <!-- Empty state -->
  <div
    *ngIf="!loading() && stages().length === 0"
    class="empty-state"
  >
    <i class="pi pi-inbox"></i>
    <p>No applications found. Select a job to view candidates.</p>
  </div>

  <!-- Candidate detail drawer -->
<p-drawer
  [visible]="drawerVisible()"
  (visibleChange)="drawerVisible.set($event)"
  position="right"
  [style]="{ width: '500px' }"
  (onHide)="closeDrawer()"
>
    <ng-template pTemplate="header">
      <h3>Candidate Details</h3>
    </ng-template>

    <app-candidate-detail
      *ngIf="selectedCard() && selectedStageId()"
      [candidate]="selectedCard()!"
      [currentStage]="selectedStageId()!"
      (candidateUpdated)="onCandidateUpdate()"
      (closeDrawer)="closeDrawer()"
    ></app-candidate-detail>
  </p-drawer>
</div>
</file>

<file path="src/app/features/hr-recruitment/candidate-pipeline/candidate-pipeline.component.scss">
// ============================================
// CANDIDATE PIPELINE â€“ ENTERPRISE DESIGN
// ============================================

$primary-blue: #1e40af;
$primary-blue-light: #3b82f6;
$neutral-50: #f9fafb;
$neutral-100: #f3f4f6;
$neutral-200: #e5e7eb;
$neutral-300: #d1d5db;
$neutral-500: #6b7280;
$neutral-700: #374151;
$neutral-900: #111827;

// Root container
.candidate-pipeline-container {
  padding: 2rem;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  background: $neutral-50;

  @media (max-width: 768px) {
    padding: 1rem;
  }
}

// ============================================
// Header with job filter
// ============================================
.pipeline-header {
  background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
  border-radius: 16px;
  padding: 1.5rem 1.75rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 1.5rem;
  box-shadow: 0 1px 3px rgba(15, 23, 42, 0.06);
  border: 1px solid $neutral-200;

  h2 {
    margin: 0;
    color: $neutral-900;
    font-size: 1.6rem;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 0.5rem;

    &::before {
      content: '';
      width: 8px;
      height: 24px;
      border-radius: 999px;
      background: linear-gradient(135deg, $primary-blue-light, $primary-blue);
    }
  }

  .job-filter {
    width: 360px;

    @media (max-width: 768px) {
      width: 100%;
    }

    ::ng-deep .job-select {
      width: 100%;

      .p-select-label {
        font-size: 0.9rem;
      }
    }

    .job-option {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.35rem 0;

      .job-title {
        font-weight: 500;
        color: $neutral-900;
        font-size: 0.9rem;
      }

      .job-count {
        font-size: 0.8rem;
        color: $neutral-500;
        background: $neutral-100;
        padding: 0.15rem 0.5rem;
        border-radius: 999px;
      }
    }
  }

  @media (max-width: 768px) {
    flex-direction: column;
    align-items: flex-start;
  }
}

// ============================================
// Location filter card
// ============================================
.location-filters {
  background: #ffffff;
  border-radius: 16px;
  padding: 1.5rem 1.75rem;
  box-shadow: 0 1px 3px rgba(15, 23, 42, 0.05);
  border: 1px solid $neutral-200;

  .filter-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;

    h3 {
      margin: 0;
      color: $neutral-900;
      font-size: 1.1rem;
      font-weight: 600;
    }

    .clear-btn {
      color: $neutral-500;
    }
  }

  .filter-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .filter-item {
    display: flex;
    flex-direction: column;
    gap: 0.4rem;

    &.full-width {
      grid-column: 1 / -1;
    }

    label {
      font-size: 0.85rem;
      font-weight: 600;
      color: $neutral-700;
    }

    ::ng-deep .filter-select {
      width: 100%;

      .p-select {
        width: 100%;
      }
    }
  }

  // Quick ward search input
  .ward-search-input {
    width: 100%;
    padding: 0.7rem 0.85rem;
    border-radius: 8px;
    border: 1px solid $neutral-300;
    font-size: 0.95rem;
    transition: all 0.15s ease;

    &:focus {
      outline: none;
      border-color: $primary-blue;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);
    }
  }

  // Ward search results dropdown
  .ward-search-results {
    max-height: 260px;
    overflow-y: auto;
    border: 1px solid $neutral-200;
    border-radius: 8px;
    margin-top: 0.5rem;
    background: white;
    box-shadow: 0 6px 12px rgba(15, 23, 42, 0.12);
  }

  .ward-result-item {
    padding: 0.7rem 0.9rem;
    cursor: pointer;
    border-bottom: 1px solid $neutral-100;
    transition: background 0.15s ease;

    &:hover {
      background: $neutral-50;
    }

    &:last-child {
      border-bottom: none;
    }

    strong {
      display: block;
      color: $neutral-900;
      margin-bottom: 0.15rem;
      font-size: 0.9rem;
    }

    .ward-path {
      display: block;
      font-size: 0.8rem;
      color: $neutral-500;
    }
  }

  .search-loading,
  .no-results {
    margin-top: 0.35rem;
    font-size: 0.8rem;
    color: $neutral-500;

    i {
      margin-right: 0.25rem;
    }
  }

  .filter-divider {
    text-align: center;
    color: $neutral-500;
    font-size: 0.8rem;
    margin: 0.75rem 0 1rem 0;
    position: relative;

    &::before,
    &::after {
      content: '';
      position: absolute;
      top: 50%;
      width: 40%;
      height: 1px;
      background: $neutral-200;
    }

    &::before {
      left: 0;
    }

    &::after {
      right: 0;
    }
  }
}

// ============================================
// Loading + empty states
// ============================================
.loading-state,
.empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 0.6rem;
  padding: 2.5rem 1rem;
  border-radius: 16px;
  background: #ffffff;
  border: 1px solid $neutral-200;
  box-shadow: 0 1px 3px rgba(15, 23, 42, 0.04);
  color: $neutral-500;
  font-size: 0.95rem;

  i {
    font-size: 2.2rem;
    color: $primary-blue-light;
  }

  p {
    margin: 0;
    color: $neutral-700;
  }
}

// ============================================
// Pipeline stages board
// ============================================
.pipeline-stages {
  background: #ffffff;
  border-radius: 16px;
  border: 1px solid $neutral-200;
  box-shadow: 0 1px 3px rgba(15, 23, 42, 0.05);
  padding: 1rem;
  display: flex;
  gap: 1rem;
  overflow-x: auto;

  app-pipeline-stage {
    min-width: 280px;
    flex: 1;
  }

  &::-webkit-scrollbar {
    height: 6px;
  }

  &::-webkit-scrollbar-track {
    background: transparent;
  }

  &::-webkit-scrollbar-thumb {
    background: $neutral-200;
    border-radius: 999px;
  }
}

// ============================================
// Candidate detail drawer
// ============================================
::ng-deep .p-drawer {
  .p-drawer-header {
    padding: 1.25rem 1.5rem;
    border-bottom: 1px solid $neutral-200;

    h3 {
      margin: 0;
      font-size: 1.1rem;
      font-weight: 600;
      color: $neutral-900;
    }
  }

  .p-drawer-content {
    padding: 1.25rem 1.5rem;
    background: $neutral-50;
  }

  .p-drawer-footer {
    padding: 1rem 1.5rem;
    border-top: 1px solid $neutral-200;
    background: #ffffff;
  }
}

// ============================================
// Responsive adjustments
// ============================================
@media (max-width: 1024px) {
  .location-filters .filter-row {
    grid-template-columns: repeat(3, minmax(0, 1fr));
  }
}

@media (max-width: 768px) {
  .candidate-pipeline-container {
    padding: 1rem;
    gap: 1rem;
  }

  .pipeline-header {
    flex-direction: column;
    align-items: flex-start;
    padding: 1.25rem;

    h2 {
      font-size: 1.4rem;
    }

    .job-filter {
      width: 100%;
    }
  }

  .location-filters {
    padding: 1.25rem;

    .filter-row {
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.75rem;
    }

    .filter-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.5rem;
    }
  }

  .pipeline-stages {
    flex-direction: column;
    overflow-x: visible;
    padding: 0.75rem;

    app-pipeline-stage {
      min-width: 100%;
    }
  }

  ::ng-deep .p-drawer {
    .p-drawer {
      width: 100% !important;
      max-width: 100% !important;
    }
  }
}

@media (max-width: 480px) {
  .location-filters .filter-row {
    grid-template-columns: 1fr;
  }

  .pipeline-header h2 {
    font-size: 1.25rem;

    &::before {
      width: 6px;
      height: 20px;
    }
  }
}

// ============================================
// Additional polish & overrides
// ============================================

// Ensure PrimeNG components inherit proper sizing
::ng-deep {
  .job-select,
  .filter-select {
    .p-select {
      width: 100%;
      border-radius: 8px;
      border-color: $neutral-300;
      transition: all 0.15s ease;

      &:hover {
        border-color: $neutral-500;
      }

      &:focus,
      &.p-focus {
        border-color: $primary-blue;
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);
      }
    }

    .p-select-label {
      font-size: 0.95rem;
      color: $neutral-900;
    }

    .p-select-dropdown {
      color: $neutral-500;
    }
  }

  // Dropdown panel styling
  .p-select-overlay {
    border-radius: 8px;
    border: 1px solid $neutral-200;
    box-shadow: 0 6px 16px rgba(15, 23, 42, 0.12);

    .p-select-option {
      padding: 0.6rem 0.85rem;
      transition: background 0.15s ease;

      &:hover {
        background: $neutral-50;
      }

      &.p-selected {
        background: rgba(37, 99, 235, 0.1);
        color: $primary-blue;
      }
    }
  }

  // Toast positioning
  .p-toast {
    z-index: 9999;
  }

  .p-toast-message {
    border-radius: 12px;
    box-shadow: 0 6px 16px rgba(15, 23, 42, 0.15);
  }
}

// Button overrides in filter header
.location-filters .filter-header {
  ::ng-deep .p-button.p-button-text {
    color: $neutral-500;
    
    &:hover {
      background: $neutral-100;
      color: $neutral-700;
    }
  }
}

// Ensure no layout shift when scrollbar appears/disappears
.pipeline-stages {
  scrollbar-gutter: stable;
}

// Loading spinner animation polish
@keyframes spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

.loading-state i.pi-spinner,
.search-loading i.pi-spinner {
  animation: spin 1s linear infinite;
}
app-pipeline-stage {
  display: block;
  background: #f3f4f6;
  border-radius: 16px;
  padding: 0.75rem;
  border: 1px solid #e5e7eb;
}

/* Use the inner wrapper class if you have one */
app-pipeline-stage .stage-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.75rem;
  padding-bottom: 0.5rem;
  border-bottom: 1px solid #e5e7eb;
}

app-pipeline-stage .stage-header-title {
  font-size: 0.9rem;
  font-weight: 600;
  color: #111827;
}

app-pipeline-stage .stage-header-count {
  font-size: 0.75rem;
  font-weight: 600;
  padding: 0.1rem 0.5rem;
  border-radius: 999px;
  background: #eff6ff;
  color: #1d4ed8;
}

/* Stack cards with clean spacing */
app-pipeline-stage .stage-cards {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  max-height: 420px;
  overflow-y: auto;
}

/* === Candidate cards === */
app-candidate-card,
.candidate-card {
  display: block;
  background: #ffffff;
  border-radius: 14px;
  padding: 1rem;
  border: 1px solid #e5e7eb;
  box-shadow: 0 1px 3px rgba(15, 23, 42, 0.06);
  transition: transform 0.15s ease, box-shadow 0.15s ease, border-color 0.15s ease;
  cursor: pointer;
}

app-candidate-card:hover,
.candidate-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(15, 23, 42, 0.14);
  border-color: #3b82f6;
}

/* Avatar + info row */
.candidate-card-header {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-bottom: 0.75rem;
}

.candidate-card-avatar {
  width: 40px;
  height: 40px;
  border-radius: 999px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  font-size: 0.9rem;
  color: #ffffff;
  background: #10b981;
}

.candidate-card-main {
  flex: 1;
  min-width: 0;
}

.candidate-card-name {
  font-size: 0.95rem;
  font-weight: 600;
  color: #111827;
  margin-bottom: 0.1rem;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.candidate-card-email {
  font-size: 0.8rem;
  color: #6b7280;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Meta row at bottom of card */
.candidate-card-meta {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding-top: 0.6rem;
  border-top: 1px solid #f3f4f6;
  font-size: 0.75rem;
  color: #6b7280;
}

/* Drag preview placeholder */
.cdk-drag-preview.candidate-card {
  box-shadow: 0 8px 24px rgba(15, 23, 42, 0.2);
  transform: rotate(2deg);
}

.cdk-drag-placeholder.candidate-card {
  opacity: 0.3;
  background: #e5e7eb;
  border: 2px dashed #d1d5db;
}
</file>

<file path="src/app/features/hr-recruitment/candidate-pipeline/candidate-pipeline.component.ts">
import { Component, OnInit, OnDestroy, signal, inject } from '@angular/core';
import { CommonModule } from '@angular/common';
import {
    CdkDragDrop,
    DragDropModule,
    transferArrayItem
} from '@angular/cdk/drag-drop';
import { ButtonModule } from 'primeng/button';
import { SelectModule } from 'primeng/select';
import { FormsModule } from '@angular/forms';
import { InputTextModule } from 'primeng/inputtext'; // âœ… ADD THIS
import { PipelineService } from './services/pipeline.service';
import {
    CandidateCard,
    PipelineStage,
    ApplicationStatus,
    JobOption
} from './types/pipeline.types';
import { Subscription } from 'rxjs';
import { PipelineStageComponent } from './candidate-pipeline-components/pipeline-stage/pipeline-stage.component';
import { Drawer, DrawerModule } from 'primeng/drawer';
import { Id } from 'convex/_generated/dataModel';
import { MessageService } from 'primeng/api';
import { ToastModule } from 'primeng/toast';
import { CandidateDetailComponent } from './candidate-pipeline-components/candidate-detail/candidate-detail.component';
import { ConvexService } from '@/core/services/convex.service';
import { api } from 'convex/_generated/api';
import { AuthService } from '@/core/services/auth.service';

@Component({
    selector: 'app-candidate-pipeline',
    standalone: true,
    imports: [
        CommonModule,
        DragDropModule,
        ButtonModule,
        SelectModule,
        FormsModule,
        InputTextModule, // âœ… ADD THIS
        PipelineStageComponent,
        CandidateDetailComponent,
        DrawerModule,
        ToastModule
    ],
    providers: [MessageService],
    templateUrl: './candidate-pipeline.component.html',
    styleUrls: ['candidate-pipeline.component.scss']
})
export class CandidatePipelineComponent implements OnInit, OnDestroy {
    pipelineService = inject(PipelineService);
    messageService = inject(MessageService);

    // State
    stages = this.pipelineService.stages;
    loading = this.pipelineService.loading;
    selectedJob = signal<Id<'job_postings'> | null>(null);

    // âœ… NEW: Job filtering
    availableJobs = signal<JobOption[]>([]);

    // âœ… NEW: Location filters state
    zones = signal<any[]>([]);
    districts = signal<any[]>([]);
    subdistricts = signal<any[]>([]);
    localBodyTypes = signal<any[]>([]);
    localBodies = signal<any[]>([]);
    wards = signal<any[]>([]);

    selectedZone = signal<string | null>(null);
    selectedDistrict = signal<string | null>(null);
    selectedSubdistrict = signal<string | null>(null);
    selectedLocalBodyType = signal<string | null>(null);
    selectedLocalBody = signal<string | null>(null);
    selectedWard = signal<string | null>(null);
    searchingWards = signal(false);
    // âœ… NEW: Ward search
    wardSearchQuery = signal<string>('');
    wardSearchResults = signal<any[]>([]);
     private convex = inject(ConvexService);
       private authService = inject(AuthService);
    // Drawer
    drawerVisible = signal(false);
    selectedCard = signal<CandidateCard | null>(null);
    selectedStageId = signal<ApplicationStatus | null>(null);
    syncing = signal(false);

    private cardSelectSub?: Subscription;

    allStageIds: ApplicationStatus[] = [
        'applied',
        'shortlisted',
        'interviewed',
        'selected',
        'rejected'
    ];

    async ngOnInit() {
        await this.loadJobs();
        await this.loadZones();
        this.setupCardSelectionListener();
    }

    ngOnDestroy() {
        this.cardSelectSub?.unsubscribe();
    }



    async loadJobs() {
        try {
            const jobs = await this.pipelineService.getAvailableJobs();
            this.availableJobs.set(jobs);

            // Auto-select first job if available
            if (jobs.length > 0) {
                this.selectedJob.set(jobs[0].value);
                await this.onJobSelect(jobs[0].value);
            }
        } catch (error) {
            console.error('Failed to load jobs:', error);
            this.messageService.add({
                severity: 'error',
                summary: 'Error',
                detail: 'Failed to load jobs'
            });
        }
    }

    // âœ… NEW: Load zones
    async loadZones() {
        try {
            const zones = await this.pipelineService.getZones();
            this.zones.set(zones);

            const localBodyTypes =
                await this.pipelineService.getLocalBodyTypes();
            this.localBodyTypes.set(localBodyTypes);
        } catch (error) {
            console.error('Failed to load zones:', error);
        }
    }

    // âœ… NEW: Cascading zone â†’ district
    async onZoneChange(zone: string | null) {
        this.selectedZone.set(zone);
        this.selectedDistrict.set(null);
        this.selectedSubdistrict.set(null);
        this.selectedLocalBody.set(null);
        this.selectedWard.set(null);
        this.districts.set([]);
        this.subdistricts.set([]);
        this.localBodies.set([]);
        this.wards.set([]);

        if (zone) {
            try {
                const districts = await this.pipelineService.getDistricts(zone);
                this.districts.set(districts);
            } catch (error) {
                console.error('Failed to load districts:', error);
            }
        }

        await this.applyFilters();
    }

    // âœ… NEW: Cascading district â†’ subdistrict
    async onDistrictChange(district: string | null) {
        this.selectedDistrict.set(district);
        this.selectedSubdistrict.set(null);
        this.selectedLocalBody.set(null);
        this.selectedWard.set(null);
        this.subdistricts.set([]);
        this.localBodies.set([]);
        this.wards.set([]);

        if (district) {
            try {
                const subdistricts = await this.pipelineService.getSubdistricts(
                    this.selectedZone() || undefined,
                    district
                );
                this.subdistricts.set(subdistricts);
            } catch (error) {
                console.error('Failed to load subdistricts:', error);
            }
        }

        await this.applyFilters();
    }

    // âœ… NEW: Cascading subdistrict â†’ local body
    async onSubdistrictChange(subdistrict: string | null) {
        this.selectedSubdistrict.set(subdistrict);
        this.selectedLocalBody.set(null);
        this.selectedWard.set(null);
        this.localBodies.set([]);
        this.wards.set([]);

        if (subdistrict) {
            try {
                const localBodies = await this.pipelineService.getLocalBodies(
                    this.selectedZone() || undefined,
                    this.selectedDistrict() || undefined,
                    subdistrict
                );
                this.localBodies.set(localBodies);
            } catch (error) {
                console.error('Failed to load local bodies:', error);
            }
        }

        await this.applyFilters();
    }

    // âœ… NEW: Local body â†’ wards
    async onLocalBodyChange(localBody: string | null) {
        this.selectedLocalBody.set(localBody);
        this.selectedWard.set(null);
        this.wards.set([]);

        if (localBody) {
            try {
                const wards = await this.pipelineService.getWards(
                    this.selectedZone() || undefined,
                    this.selectedDistrict() || undefined,
                    this.selectedSubdistrict() || undefined,
                    localBody
                );
                this.wards.set(wards);
            } catch (error) {
                console.error('Failed to load wards:', error);
            }
        }

        await this.applyFilters();
    }

    // âœ… NEW: Ward search (debounced)
    async onWardSearch(query: string) {
        this.wardSearchQuery.set(query);

        if (query.length < 2) {
            this.wardSearchResults.set([]);
            return;
        }

        try {
            this.searchingWards.set(true);
            const results = await this.pipelineService.searchWards(query);
            this.wardSearchResults.set(results);
        } catch (error) {
            console.error('Ward search failed:', error);
        } finally {
            this.searchingWards.set(false); // âœ… Clear loading state
        }
    }

    // âœ… NEW: Apply all filters and reload pipeline
    async applyFilters() {
        const jobId = this.selectedJob();
        if (!jobId) return;

        // For now, just reload the pipeline
        // TODO: Implement filtered pipeline query
        await this.pipelineService.loadPipeline(jobId);
    }

    // âœ… NEW: Clear all filters
    async clearFilters() {
        this.selectedZone.set(null);
        this.selectedDistrict.set(null);
        this.selectedSubdistrict.set(null);
        this.selectedLocalBodyType.set(null);
        this.selectedLocalBody.set(null);
        this.selectedWard.set(null);
        this.wardSearchQuery.set('');
        this.wardSearchResults.set([]);

        this.districts.set([]);
        this.subdistricts.set([]);
        this.localBodies.set([]);
        this.wards.set([]);

        await this.applyFilters();
    }

    async onJobSelect(jobId: Id<'job_postings'>) {
        this.selectedJob.set(jobId);
        try {
            await this.pipelineService.loadPipeline(jobId);
        } catch (error) {
            console.error('Failed to load pipeline:', error);
            this.messageService.add({
                severity: 'error',
                summary: 'Error',
                detail: 'Failed to load pipeline data'
            });
        }
    }

    setupCardSelectionListener() {
        this.cardSelectSub = this.pipelineService.selectedCard$.subscribe(
            ({ card, stageId }) => {
                this.selectedCard.set(card);
                this.selectedStageId.set(stageId);
                this.drawerVisible.set(true);
            }
        );
    }

    async onDrop(
        event: CdkDragDrop<CandidateCard[]>,
        newStageId: ApplicationStatus
    ) {
        if (event.previousContainer === event.container) {
            return;
        }

        const card = event.previousContainer.data[event.previousIndex];
        const previousStageId = this.getStageIdFromContainer(
            event.previousContainer.id
        );

        try {
            // Optimistic UI update
            transferArrayItem(
                event.previousContainer.data,
                event.container.data,
                event.previousIndex,
                event.currentIndex
            );

            // Backend update
            await this.pipelineService.moveCandidate(card.id, newStageId);

            this.messageService.add({
                severity: 'success',
                summary: 'Success',
                detail: `Moved ${card.candidateName} to ${newStageId}`
            });
        } catch (error: any) {
            console.error('Move failed:', error);

            // Rollback optimistic update
            transferArrayItem(
                event.container.data,
                event.previousContainer.data,
                event.currentIndex,
                event.previousIndex
            );

            this.messageService.add({
                severity: 'error',
                summary: 'Error',
                detail: error.message || 'Failed to move candidate'
            });
        }
    }

    private getStageIdFromContainer(containerId: string): ApplicationStatus {
        return containerId.replace('stage-', '') as ApplicationStatus;
    }

    onCardSelect(card: CandidateCard, stageId: ApplicationStatus) {
        console.log('ðŸ–±ï¸ [Pipeline] Card selected:', card.candidateName);
        this.selectedCard.set(card);
        this.selectedStageId.set(stageId);
        this.drawerVisible.set(true);
    }

    closeDrawer() {
        this.drawerVisible.set(false);
        this.selectedCard.set(null);
        this.selectedStageId.set(null);
    }

    async onCandidateUpdate() {
        this.closeDrawer();
        const jobId = this.selectedJob();
        if (jobId) {
            await this.pipelineService.loadPipeline(jobId);
        }
    }

    async onLoadMoreStage(stageId: ApplicationStatus) {
        const jobId = this.selectedJob();
        if (!jobId) return;
        await this.pipelineService.loadMoreForStage(
            jobId as Id<'job_postings'>,
            stageId
        );
    }
}
</file>

<file path="src/app/features/hr-recruitment/candidate-pipeline/services/pipeline.service.ts">
import { Injectable, signal, computed, inject } from '@angular/core';
import { ConvexService } from 'src/app/core/services/convex.service';
import { api } from 'convex/_generated/api';
import { Id } from 'convex/_generated/dataModel';
import { CandidateCard, PipelineStage, ApplicationStatus, JobOption } from '../types/pipeline.types';
import { Subject } from 'rxjs';
import { AuthService } from '@/core/services/auth.service';

@Injectable({ providedIn: 'root' })
export class PipelineService {
  // Reactive state
  private _stages = signal<PipelineStage[]>([]);
  private _loading = signal(false);
  private _selectedJob = signal<Id<'job_postings'> | null>(null);

  // Computed values for template
  stages = computed(() => this._stages());
  loading = computed(() => this._loading());
  selectedJob = computed(() => this._selectedJob());
    private auth = inject(AuthService);

  // Card selection for detail sidebar
  selectedCard$ = new Subject<{ card: CandidateCard; stageId: ApplicationStatus }>();

  constructor(private convex: ConvexService) {}

  /**
   * Load pipeline data for selected job
   */
 async loadPipeline(jobPostingId: Id<'job_postings'>): Promise<void> {
  console.log('ðŸ” [PipelineService] loadPipeline called for job:', jobPostingId);
  this._loading.set(true);
  this._selectedJob.set(jobPostingId);

  try {
    const statuses: ApplicationStatus[] = [
      'applied',
      'shortlisted',
      'interviewed',
      'selected',
      'rejected',
    ];

    const PAGE_SIZE = 30;

    // âœ… Load first page for all stages in parallel
    const results = await Promise.all(
      statuses.map((status) =>
        this.convex.client.query(api.hr.pipeline.getStagePage, {
          jobPostingId,
          status,
          paginationOpts: {
            numItems: PAGE_SIZE,
            cursor: null,
          },
        })
      )
    );

    const stages: PipelineStage[] = results.map((res, idx) => {
      const status = statuses[idx];
      return {
        stageId: status,
        title: this.formatStageTitle(status),
        candidates: res.page,
        nextCursor: res.continueCursor,
        isDone: res.isDone,
        totalCount: res.totalCount,
      };
    });

    this._stages.set(stages);
    console.log('âœ… [PipelineService] Paged pipeline loaded:', stages);
  } catch (error) {
    console.error('âŒ [PipelineService] loadPipeline failed:', error);
    throw error;
  } finally {
    this._loading.set(false);
  }
}

private formatStageTitle(status: ApplicationStatus): string {
  const titles: Record<ApplicationStatus, string> = {
    applied: 'Applied',
    shortlisted: 'Shortlisted',
    interviewed: 'Interviewed',
    selected: 'Selected',
    rejected: 'Rejected',
  };
  return titles[status];
}
async loadMoreForStage(
  jobPostingId: Id<'job_postings'>,
  stageId: ApplicationStatus
): Promise<void> {
  const currentStages = this._stages();
  const stageIndex = currentStages.findIndex((s) => s.stageId === stageId);
  if (stageIndex === -1) return;

  const stage = currentStages[stageIndex];

  if (stage.isDone || !stage.nextCursor) {
    return; // Nothing more to load
  }

  const PAGE_SIZE = 30;

  try {
    const res = await this.convex.client.query(api.hr.pipeline.getStagePage, {
      jobPostingId,
      status: stageId,
      paginationOpts: {
        numItems: PAGE_SIZE,
        cursor: stage.nextCursor,
      },
    });

    const updatedStage: PipelineStage = {
      ...stage,
      candidates: [...stage.candidates, ...res.page],
      nextCursor: res.continueCursor,
      isDone: res.isDone,
      totalCount: res.totalCount,
    };

    const updatedStages = [...currentStages];
    updatedStages[stageIndex] = updatedStage;
    this._stages.set(updatedStages);
  } catch (error) {
    console.error('âŒ [PipelineService] loadMoreForStage failed:', error);
    throw error;
  }
}
// S

  /**
   * Move candidate to new stage with workflow validation
   */
  async moveCandidate(
    applicationId: Id<'job_applications'>,
    newStatus: ApplicationStatus,
    rejectionReason?: string,
    interviewNotes?: string
  ): Promise<void> {
    try {
      // âœ… FIXED: Use hr/pipeline (not hr/applications)
      await this.convex.client.mutation(
        api.hr.pipeline.moveApplicationStage,  // âœ… Changed from applications to pipeline
        {
          applicationId,
          newStatus,
          rejectionReason,
          interviewNotes,
        }
      );

      // Reload pipeline after move
      const selectedJob = this._selectedJob();
      if (selectedJob) {
        await this.loadPipeline(selectedJob);
      }
    } catch (error: any) {
      console.error('Failed to move candidate:', error);
      throw new Error(error.message || 'Failed to move candidate');
    }
  }

  /**
   * Get available jobs for filter dropdown
   */
  async getAvailableJobs(): Promise<JobOption[]> {
    console.log('ðŸ” [PipelineService] getAvailableJobs() called');
    console.log()
        const user = this.auth.currentUser(); // signal read
    const rootId = user?.rootId;

    if (!rootId) {
      console.error(
        '[PipelineService] No rootId on current user. Is profile loaded / logged in?',
      );
      return [];
    }
    // âœ… CORRECT: Use hr/pipeline.getJobsForPipeline
 const result = await this.convex.query(
      api.hr.pipeline.getJobsForPipeline,
      { rootId }
    );

    console.log('âœ… [PipelineService] Jobs returned:', result);
    return result as JobOption[];
  }
  

  /**
   * Trigger card selection (opens detail sidebar)
   */
  onCardSelect(card: CandidateCard, stageId: ApplicationStatus): void {
    this.selectedCard$.next({ card, stageId });
  }

  /**
   * Assign application to ward (for blanket jobs)
   */
  async assignToWard(
    applicationId: Id<'job_applications'>,
    wardId: string
  ): Promise<void> {
    // âœ… Use hr/pipeline version
    await this.convex.client.mutation(
      api.hr.pipeline.assignApplicationToWard,
      {
        applicationId,
        wardId,
      }
    );

    // Reload pipeline
    const selectedJob = this._selectedJob();
    if (selectedJob) {
      await this.loadPipeline(selectedJob);
    }
  }

  // âœ… Use wards.ts API endpoints directly
async getZones() {
  return this.convex.client.query(api.wards.getZones, {});
}

async getDistricts(zone?: string) {
  return this.convex.client.query(api.wards.getDistricts, { zone });
}

async getSubdistricts(zone?: string, district?: string) {
  return this.convex.client.query(api.wards.getSubdistricts, { zone, district });
}

async getLocalBodies(zone?: string, district?: string, subdistrict?: string) {
  return this.convex.client.query(api.wards.getLocalBodies, { 
    zone, district, subdistrict 
  });
}

async getLocalBodyTypes() {
  return this.convex.client.query(api.wards.getLocalBodyTypes, {});
}

async getWards(zone?: string, district?: string, subdistrict?: string, localBodyName?: string) {
  return this.convex.client.query(api.wards.getWards, { 
    zone, district, subdistrict, localBodyName 
  });
}

async searchWards(query: string) {
  return this.convex.client.query(api.wards.searchWards, { 
    searchTerm: query, 
    limit: 20 
  });
}


async convertApplicationToUser(
  applicationId: Id<'job_applications'>,
  jobTitle: string
): Promise<{ success: boolean; setupLink: string; userType: string }> {
  console.log('ðŸ”„ PipelineService.convertApplicationToUser called:', { applicationId, jobTitle });
  
  // âœ… STEP 1: Get caller profile FIRST (works in frontend query context)
const profile = await this.convex.client.query(api.auth.getCurrentUserProfile, {});
  console.log('ðŸ” Caller profile:', profile?.roleLevel, profile?.name);
  
  if (!profile || profile.roleLevel < 5) {
    throw new Error('Permission Denied: Insufficient role level');
  }
  
  // Determine user type from job title
  const isExecutiveJob = jobTitle.toLowerCase().includes('executive') ||
                        jobTitle.toLowerCase().includes('field') ||
                        jobTitle.toLowerCase().includes('exec');
  const userType = isExecutiveJob ? 'executive' : 'admin';
  
  // âœ… FIXED: Use correct paginationOpts
  const managersResult = await this.convex.client.query(
    api.users.admin.queries.listAdmins, 
    {
      isActive: true,
      paginationOpts: { numItems: 1, cursor: null }
    }
  ) as any;
  
  const managers = managersResult.page || [];
  
  if (managers.length === 0) {
    throw new Error('No active managers found. Please assign a manager first.');
  }
  
  const managerId = managers[0]._id as Id<'admin_users'>;
  
  console.log('ðŸ‘¤ Using manager:', managerId, 'for userType:', userType);
  
  // âœ… STEP 2: PASS PROFILE TO MUTATION
  const result = await this.convex.client.mutation(api.hr.applications.convertApplicationToUser, {
    applicationId,
    userType,
    managerId,
    jobTitle,
    roleLevel: userType === 'admin' ? 6 : undefined,
    hierarchyId: undefined,
    callerProfile: profile  // âœ… CRITICAL: Pass profile down the chain
  });
  
  console.log('âœ… User creation result:', result);
  return result;
}



}
</file>

<file path="src/app/features/hr-recruitment/candidate-pipeline/types/pipeline.types.ts">
import { Id } from 'convex/_generated/dataModel';

// Backend status (5 stages)
export type ApplicationStatus =
    | 'applied'
    | 'shortlisted'
    | 'interviewed'
    | 'selected'
    | 'rejected';

export interface CandidateCard {
    id: Id<'job_applications'>;
    candidateName: string;
    email: string;
    phone: string;
    experience: number;
    appliedDate: string;
    wardId?: string;
    interviewDate?: string;
    interviewNotes?: string;
    rejectionReason?: string;
    jobTitle?: string;
    resumeUrl?: string;   
    convertedToUserId?: Id<'admin_users'> | Id<'executives'>;
    convertedAt?: number;
    userType?: 'admin' | 'executive';
}

export interface PipelineStage {
    stageId: ApplicationStatus;
    title: string;
    candidates: CandidateCard[];

    // âœ… New for pagination
    nextCursor: string | null;
    isDone: boolean;
    totalCount: number;
}
export interface JobOption {
    value: Id<'job_postings'>;
    label: string;
    totalApplications: number;
}
export interface CandidateCardExtended extends CandidateCard {
    jobTitle: string; // from job_postings
}
</file>

<file path="src/app/features/hr-recruitment/hr-recruitment.routes.ts">
import { Routes } from '@angular/router';
import { CandidatePipelineComponent } from './candidate-pipeline/candidate-pipeline.component';
import { ManageJobsComponent } from './manage-jobs/jobs-list/manage-jobs.component';
import { JobFormComponent } from './manage-jobs/jobs-form/job-form.component';

// Define all routes for the HR & Recruitment feature here
export const RECRUITMENT_ROUTES: Routes = [
    {
        path: 'pipeline',
        component: CandidatePipelineComponent,
        title: 'Candidate Pipeline'
    },
    {
        path: 'jobs', // The list of jobs
        component: ManageJobsComponent,
        title: 'Manage Jobs'
    },
    {
        path: 'jobs/new', // The "Create New" form
        component: JobFormComponent,
        title: 'New Job Posting'
    },
    {
        path: 'jobs/edit/:id', // The "Edit" form
        component: JobFormComponent,
        title: 'Edit Job Posting'
    },
];
</file>

<file path="src/app/features/hr-recruitment/interfaces/application.interface.ts">
import { LocationFilterState } from "./wards.interface";

export interface JobApplication {
  _id: string;
  name: string;
  email: string;
  phone: string;
  rootId: string;
  jobPostingId: string;
  status: 'applied' | 'shortlisted' | 'interviewed' | 'selected' | 'rejected';
  experience: number;
  
  // Location fields
  zone?: string;
  district?: string;
  subdistrict?: string;
  localBodyName?: string;
  localBodyType?: 'P' | 'M' | 'C';
  wardName?: string;
  wardId?: string;
  
  // Additional fields
  coverLetter?: string;
  source?: string;
  googleSheetRowNumber?: number;
  createdAt: number;
  updatedAt: number;
}

export interface ApplicationFilters extends LocationFilterState {
  jobPostingId: string | null;
  status: JobApplication['status'] | null;
  searchQuery: string | null;
  dateFrom: number | null;
  dateTo: number | null;
}

export interface ApplicationsResponse {
  items: JobApplication[];
  total: number;
}

export interface ApplicationStats {
  totalApplications: number;
  byStatus: Record<string, number>;
  byZone: Record<string, number>;
  byDistrict: Record<string, number>;
  conversionRate: number;
}
</file>

<file path="src/app/features/hr-recruitment/interfaces/google-sheet.interface.ts">
export interface SyncState {
  _id: string;
  syncType: 'applications';
  rootId: string;
  lastSyncedRow: number;
  totalSynced: number;
  totalFailed: number;
  spreadsheetId: string;
  sheetName: string;
  status: 'idle' | 'syncing' | 'completed' | 'failed';
  lastSyncTime: number;
  errorMessage?: string;
  createdAt: number;
  updatedAt: number;
}

export interface ManualSyncResult {
  success: boolean;
  message: string;
}
</file>

<file path="src/app/features/hr-recruitment/interfaces/wards.interface.ts">
export interface Ward {
  _id: string;
  wardName: string;
  wardCode?: string;
  localBodyName: string;
  localBodyType: 'P' | 'M' | 'C';
  district: string;
  subdistrict: string;
  zone: string;
  state: string;
  rootId: string;
  population?: number;
  totalApplications?: number;
  totalHires?: number;
  createdAt: number;
  updatedAt: number;
}


export interface LocationFilterState {
  zone: string | null;
  district: string | null;
  subdistrict: string | null;
  localBodyType: 'P' | 'M' | 'C' | null;
  localBodyName: string | null;
  wardId: string | null;
}
</file>

<file path="src/app/features/hr-recruitment/manage-jobs/jobs-form/job-form.component.html">
<!-- job-form.component.html -->

<div class="surface-ground px-4 py-5 md:px-6 lg:px-8">
  <div class="flex align-items-center justify-content-between mb-4">
    <div>
      <h2 class="text-900 font-bold text-4xl mb-2">
        {{ isEditMode ? 'Edit Job Posting' : 'Create Job Posting' }}
      </h2>
      <p class="text-600 text-lg">
        {{ isEditMode ? 'Update job details and requirements' : 'Post a new job opening' }}
      </p>
    </div>
    <button
      pButton
      type="button"
      label="Back"
      icon="pi pi-arrow-left"
      class="p-button-outlined"
      (click)="onCancel()"
    ></button>
  </div>

  <p-toast />

  <form [formGroup]="jobForm" (ngSubmit)="onSubmit()">
    <div class="grid">
      <!-- ========================================================================== -->
      <!-- BASIC INFORMATION -->
      <!-- ========================================================================== -->
      <div class="col-12">
        <p-card>
          <ng-template pTemplate="header">
            <div class="px-3 pt-3">
              <h3 class="text-900 font-semibold text-xl mb-1">Basic Information</h3>
              <p class="text-600 text-sm">Job title, description, and employment details</p>
            </div>
          </ng-template>

          <div class="grid">
            <!-- Job Title -->
            <div class="field col-12">
              <label for="title" class="font-medium">
                Job Title <span class="text-red-500">*</span>
              </label>
              <input
                pInputText
                id="title"
                formControlName="title"
                placeholder="e.g., Field Executive"
                class="w-full"
              />
              <small class="text-red-500" *ngIf="isFieldInvalid('title')">
                {{ getFieldError('title') }}
              </small>
            </div>

            <!-- Job Description -->
            <div class="field col-12">
              <label for="description" class="font-medium">
                Job Description <span class="text-red-500">*</span>
              </label>
              <p-editor
                formControlName="description"
                [style]="{ height: '200px' }"
              />
              <small class="text-red-500" *ngIf="isFieldInvalid('description')">
                {{ getFieldError('description') }}
              </small>
            </div>

            <!-- Location -->
            <div class="field col-12 md:col-6">
              <label for="location" class="font-medium">
                Location <span class="text-red-500">*</span>
              </label>
              <input
                pInputText
                id="location"
                formControlName="location"
                placeholder="e.g., Kasaragod, Kerala"
                class="w-full"
              />
              <small class="text-red-500" *ngIf="isFieldInvalid('location')">
                {{ getFieldError('location') }}
              </small>
            </div>

            <!-- Employment Type -->
            <div class="field col-12 md:col-6">
              <label for="employmentType" class="font-medium">
                Employment Type <span class="text-red-500">*</span>
              </label>
              <p-select
                id="employmentType"
                formControlName="employmentType"
                [options]="employmentTypes"
                optionLabel="label"
                optionValue="value"
                placeholder="Select Type"
                styleClass="w-full"
              />
              <small class="text-red-500" *ngIf="isFieldInvalid('employmentType')">
                {{ getFieldError('employmentType') }}
              </small>
            </div>

            <!-- Salary Range -->
            <div class="field col-12 md:col-6">
              <label for="salaryMin" class="font-medium">
                Minimum Salary (â‚¹) <span class="text-red-500">*</span>
              </label>
              <p-inputNumber
                id="salaryMin"
                formControlName="salaryMin"
                mode="currency"
                currency="INR"
                locale="en-IN"
                [min]="0"
                styleClass="w-full"
              />
              <small class="text-red-500" *ngIf="isFieldInvalid('salaryMin')">
                {{ getFieldError('salaryMin') }}
              </small>
            </div>

            <div class="field col-12 md:col-6">
              <label for="salaryMax" class="font-medium">
                Maximum Salary (â‚¹) <span class="text-red-500">*</span>
              </label>
              <p-inputNumber
                id="salaryMax"
                formControlName="salaryMax"
                mode="currency"
                currency="INR"
                locale="en-IN"
                [min]="0"
                styleClass="w-full"
              />
              <small class="text-red-500" *ngIf="isFieldInvalid('salaryMax')">
                {{ getFieldError('salaryMax') }}
              </small>
            </div>

            <!-- Application Deadline -->
            <div class="field col-12 md:col-6">
              <label for="applicationDeadline" class="font-medium">
                Application Deadline <span class="text-red-500">*</span>
              </label>
              <p-datepicker
                id="applicationDeadline"
                formControlName="applicationDeadline"
                [minDate]="minDate"
                dateFormat="dd/mm/yy"
                [showIcon]="true"
                placeholder="Select Date"
                styleClass="w-full"
              />
              <small class="text-red-500" *ngIf="isFieldInvalid('applicationDeadline')">
                {{ getFieldError('applicationDeadline') }}
              </small>
            </div>
          </div>
        </p-card>
      </div>

      <!-- ========================================================================== -->
      <!-- GEOGRAPHIC LOCATION -->
      <!-- ========================================================================== -->
      <div class="col-12">
        <p-card>
          <ng-template pTemplate="header">
            <div class="px-3 pt-3">
              <h3 class="text-900 font-semibold text-xl mb-1">Geographic Location</h3>
              <p class="text-600 text-sm">Select the area where this job is posted</p>
            </div>
          </ng-template>

          <div class="grid">
            <!-- Zone -->
            <div class="field col-12 md:col-6">
              <label for="zone" class="font-medium">
                Zone <span class="text-red-500">*</span>
              </label>
              <p-select
                id="zone"
                formControlName="zone"
                [options]="zones()"
                optionLabel="label"
                optionValue="value"
                placeholder="Select Zone"
                (onChange)="onZoneChange($event)"
                styleClass="w-full"
              />
              <small class="text-red-500" *ngIf="isFieldInvalid('zone')">
                {{ getFieldError('zone') }}
              </small>
            </div>

            <!-- District -->
            <div class="field col-12 md:col-6">
              <label for="district" class="font-medium">
                District <span class="text-red-500">*</span>
              </label>
              <p-select
                id="district"
                formControlName="district"
                [options]="districts()"
                optionLabel="label"
                optionValue="value"
                placeholder="Select District"
                [loading]="loadingDistricts()"
                [disabled]="!jobForm.get('zone')?.value"
                (onChange)="onDistrictChange($event)"
                styleClass="w-full"
              />
              <small class="text-red-500" *ngIf="isFieldInvalid('district')">
                {{ getFieldError('district') }}
              </small>
            </div>

            <!-- Subdistrict -->
            <div class="field col-12 md:col-6">
              <label for="subdistrict" class="font-medium">Subdistrict (Optional)</label>
              <p-select
                id="subdistrict"
                formControlName="subdistrict"
                [options]="subdistricts()"
                optionLabel="label"
                optionValue="value"
                placeholder="Select Subdistrict"
                [loading]="loadingSubdistricts()"
                [disabled]="!jobForm.get('district')?.value"
                (onChange)="onSubdistrictChange($event)"
                styleClass="w-full"
              />
            </div>

            <!-- Local Body Type -->
            <div class="field col-12 md:col-6">
              <label for="localBodyType" class="font-medium">Local Body Type (Optional)</label>
              <p-select
                id="localBodyType"
                formControlName="localBodyType"
                [options]="localBodyTypes()"
                optionLabel="label"
                optionValue="value"
                placeholder="All Types"
                (onChange)="onLocalBodyTypeChange($event)"
                styleClass="w-full"
              />
            </div>

            <!-- Local Body Name -->
            <div class="field col-12 md:col-6">
              <label for="localBodyName" class="font-medium">Local Body (Optional)</label>
              <p-select
                id="localBodyName"
                formControlName="localBodyName"
                [options]="localBodies()"
                optionLabel="label"
                optionValue="value"
                placeholder="Select Local Body"
                [loading]="loadingLocalBodies()"
                [disabled]="!jobForm.get('subdistrict')?.value"
                (onChange)="onLocalBodyChange($event)"
                styleClass="w-full"
              />
            </div>
          </div>
        </p-card>
      </div>

      <!-- ========================================================================== -->
      <!-- WARD SELECTION / BLANKETED -->
      <!-- ========================================================================== -->
      <div class="col-12">
        <p-card>
          <ng-template pTemplate="header">
            <div class="px-3 pt-3">
              <h3 class="text-900 font-semibold text-xl mb-1">Ward Selection</h3>
              <p class="text-600 text-sm">Choose specific ward or enable blanketed posting</p>
            </div>
          </ng-template>

          <div class="grid">
            <!-- Blanketed Checkbox -->
            <div class="field col-12">
              <div class="flex items-center gap-2">
                <p-checkbox
                  formControlName="isBlanketed"
                  [binary]="true"
                  inputId="isBlanketed"
                />
                <label for="isBlanketed" class="font-medium cursor-pointer">
                  Blanketed Posting (Open to multiple wards)
                </label>
              </div>
              <small class="text-gray-600 block mt-1">
                Enable this to post the job to all wards in the selected area
              </small>
            </div>

            <!-- Blanketed Job Info -->
            <div class="field col-12" *ngIf="jobForm.get('isBlanketed')?.value">
              <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                <div class="flex items-start gap-3">
                  <i class="pi pi-info-circle text-blue-500 text-xl"></i>
                  <div class="flex-1">
                    <p class="font-medium text-blue-900 mb-1">
                      Blanketed Job Scope
                    </p>
                    <p class="text-sm text-blue-700">
                      This job will be posted to
                      <strong>{{ wardCount() }} ward{{ wardCount() !== 1 ? 's' : '' }}</strong>
                      in the selected area.
                    </p>
                    <p class="text-sm text-blue-600 mt-2" *ngIf="wardCount() === 0">
                      âš ï¸ Please select at least a district to see targeted wards.
                    </p>

                    <!-- Target Area Breakdown -->
                    <div class="mt-3 text-sm text-blue-700" *ngIf="wardCount() > 0">
                      <strong>Target Area:</strong>
                      <ul class="list-disc ml-5 mt-1 space-y-1">
                        <li *ngIf="jobForm.get('zone')?.value">
                          <strong>Zone:</strong> {{ jobForm.get('zone')?.value }}
                        </li>
                        <li *ngIf="jobForm.get('district')?.value">
                          <strong>District:</strong> {{ jobForm.get('district')?.value }}
                        </li>
                        <li *ngIf="jobForm.get('subdistrict')?.value">
                          <strong>Subdistrict:</strong> {{ jobForm.get('subdistrict')?.value }}
                        </li>
                        <li *ngIf="jobForm.get('localBodyName')?.value">
                          <strong>Local Body:</strong> {{ jobForm.get('localBodyName')?.value }}
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Single Ward Selection -->
            <div class="field col-12" *ngIf="!jobForm.get('isBlanketed')?.value">
              <label for="wardId" class="font-medium">
                Ward <span class="text-red-500">*</span>
              </label>
              <p-select
                id="wardId"
                formControlName="wardId"
                [options]="wards()"
                optionLabel="label"
                optionValue="value"
                placeholder="Select Ward"
                [filter]="true"
                filterBy="label,fullPath"
                [loading]="loadingWards()"
                [disabled]="!jobForm.get('localBodyName')?.value"
                styleClass="w-full"
              />
              <small class="text-gray-600 block mt-1" *ngIf="getSelectedWardPath()">
                ðŸ“ {{ getSelectedWardPath() }}
              </small>
              <small class="text-red-500" *ngIf="isFieldInvalid('wardId')">
                {{ getFieldError('wardId') }}
              </small>
            </div>
          </div>
        </p-card>
      </div>

      <!-- ========================================================================== -->
      <!-- REQUIREMENTS -->
      <!-- ========================================================================== -->
      <div class="col-12">
        <p-card>
          <ng-template pTemplate="header">
            <div class="px-3 pt-3 flex justify-content-between align-items-center">
              <div>
                <h3 class="text-900 font-semibold text-xl mb-1">Requirements</h3>
                <p class="text-600 text-sm">List the key requirements for this position</p>
              </div>
              <button
                pButton
                type="button"
                label="Add Requirement"
                icon="pi pi-plus"
                class="p-button-sm"
                (click)="addRequirement()"
              ></button>
            </div>
          </ng-template>

          <div formArrayName="requirements">
            <div
              *ngFor="let requirement of requirementsArray.controls; let i = index"
              class="flex gap-2 mb-3"
            >
              <div class="flex-1">
                <input
                  pInputText
                  [formControlName]="i"
                  placeholder="e.g., Bachelor's degree in relevant field"
                  class="w-full"
                />
              </div>
              <button
                pButton
                type="button"
                icon="pi pi-trash"
                class="p-button-danger p-button-outlined"
                (click)="removeRequirement(i)"
                [disabled]="requirementsArray.length === 1"
              ></button>
            </div>
          </div>
        </p-card>
      </div>

      <!-- ========================================================================== -->
      <!-- FORM ACTIONS -->
      <!-- ========================================================================== -->
      <div class="col-12">
        <div class="flex justify-content-end gap-2">
          <button
            pButton
            type="button"
            label="Cancel"
            icon="pi pi-times"
            class="p-button-outlined"
            (click)="onCancel()"
            [disabled]="loading"
          ></button>
          <button
            pButton
            type="submit"
            [label]="isEditMode ? 'Update Job' : 'Create Job'"
            icon="pi pi-check"
            [loading]="loading"
          ></button>
        </div>
      </div>
    </div>
  </form>
</div>
</file>

<file path="src/app/features/hr-recruitment/manage-jobs/jobs-form/job-form.component.scss">
.job-form-page {
  padding: 2rem;
  background: #f9fafb;
  min-height: 100vh;
}

/* Header row */
.job-form-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 1rem;
  margin-bottom: 1rem;
}

.job-form-title {
  margin: 0;
  font-size: 1.4rem;
  font-weight: 700;
  color: #111827;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.job-form-subtitle {
  margin: 0.15rem 0 0;
  font-size: 0.85rem;
  color: #6b7280;
}

/* Main card */
.job-form-card {
  background: #ffffff;
  border-radius: 1rem;
  border: 1px solid #e5e7eb;
  box-shadow: 0 18px 40px rgba(15, 23, 42, 0.06);
  padding: 1.25rem 1.5rem;
}

/* Two-column layout like executive form */
.job-form-grid {
  display: grid;
  grid-template-columns: minmax(0, 2fr) minmax(0, 1.5fr);
  gap: 1.5rem;
}

/* Section titles */
.section-title {
  font-size: 0.9rem;
  font-weight: 600;
  color: #4b5563;
  margin-bottom: 0.75rem;
}

/* Field layout */
.form-field {
  margin-bottom: 0.75rem;
}

.form-label {
  display: flex;
  align-items: center;
  justify-content: space-between;
  font-size: 0.8rem;
  font-weight: 500;
  color: #4b5563;
  margin-bottom: 0.25rem;
}

.form-label .required {
  color: #ef4444;
  margin-left: 0.15rem;
}

/* PrimeNG inputs */
:host ::ng-deep .p-inputtext,
:host ::ng-deep .p-inputnumber-input,
:host ::ng-deep .p-inputtextarea {
  width: 100%;
  font-size: 0.85rem;
}

:host ::ng-deep .p-editor-container {
  border-radius: 0.75rem;
}

/* Chips / tags for requirements list */
.requirement-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.35rem;
}

/* Footer actions */
.job-form-footer {
  display: flex;
  justify-content: flex-end;
  gap: 0.5rem;
  margin-top: 1.5rem;
}

/* Buttons */
:host ::ng-deep .p-button {
  border-radius: 999px;
  font-size: 0.8rem;
  padding: 0.4rem 1.1rem;
}

:host ::ng-deep .p-button.p-button-outlined {
  border-color: #d1d5db;
  color: #4b5563;
}

/* Responsive */
@media (max-width: 960px) {
  .job-form-page {
    padding: 1.25rem;
  }

  .job-form-grid {
    grid-template-columns: minmax(0, 1fr);
  }
}
</file>

<file path="src/app/features/hr-recruitment/manage-jobs/jobs-form/job-form.component.ts">
// job-form.component.ts

import { Component, OnInit, inject, signal, computed } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormBuilder, FormGroup, Validators, ReactiveFormsModule, FormArray } from '@angular/forms';
import { ActivatedRoute, Router } from '@angular/router';
import { MessageService } from 'primeng/api';
import { ButtonModule } from 'primeng/button';
import { InputTextModule } from 'primeng/inputtext';
import { EditorModule } from 'primeng/editor';
import { SelectModule } from 'primeng/select';
import { InputNumberModule } from 'primeng/inputnumber';
import { DatePickerModule } from 'primeng/datepicker';
import { ToastModule } from 'primeng/toast';
import { CardModule } from 'primeng/card';
import { CheckboxModule } from 'primeng/checkbox';
import { DividerModule } from 'primeng/divider';
import { TagModule } from 'primeng/tag';
import { Id } from 'convex/_generated/dataModel';
import { JobsService } from '../services/jobs.service';
import { AuthService } from '../../../../core/services/auth.service';
import { ConvexService } from '../../../../core/services/convex.service';
import { api } from 'convex/_generated/api';

interface OptionItem {
  value: string;
  label: string;
  wardCode?: string;
  fullPath?: string;
}

@Component({
  selector: 'app-job-form',
  standalone: true,
  imports: [
    CommonModule,
    ReactiveFormsModule,
    ButtonModule,
    InputTextModule,
    EditorModule,
    SelectModule,
    InputNumberModule,
    DatePickerModule,
    ToastModule,
    CardModule,
    CheckboxModule,
    DividerModule,
    TagModule,
  ],
  templateUrl: './job-form.component.html',
  styleUrls: ['./job-form.component.scss'],
  providers: [MessageService],
})
export class JobFormComponent implements OnInit {
  private fb = inject(FormBuilder);
  private jobsService = inject(JobsService);
  private router = inject(Router);
  private route = inject(ActivatedRoute);
  private messageService = inject(MessageService);
  private authService = inject(AuthService);
  private convex = inject(ConvexService);

  jobForm!: FormGroup;
  isEditMode = false;
  jobId: Id<'job_postings'> | null = null;
  loading = false;
  submitted = false;

  employmentTypes = [
    { label: 'Full-time', value: 'full_time' },
    { label: 'Part-time', value: 'part_time' },
    { label: 'Contract', value: 'contract' },
  ];

  minDate = new Date();

  // Location cascading signals
  zones = signal<OptionItem[]>([]);
  districts = signal<OptionItem[]>([]);
  subdistricts = signal<OptionItem[]>([]);
  localBodyTypes = signal<OptionItem[]>([]);
  localBodies = signal<OptionItem[]>([]);
  wards = signal<OptionItem[]>([]);

  // Selected values
  selectedZone = signal<string | null>(null);
  selectedDistrict = signal<string | null>(null);
  selectedSubdistrict = signal<string | null>(null);
  selectedLocalBodyType = signal<string | null>(null);
  selectedLocalBodyName = signal<string | null>(null);

  // Loading states
  loadingDistricts = signal(false);
  loadingSubdistricts = signal(false);
  loadingLocalBodies = signal(false);
  loadingWards = signal(false);

  // Computed: Show ward selection only if not blanketed
  showWardSelection = computed(() => {
    return !this.jobForm?.get('isBlanketed')?.value;
  });

  // Computed: Ward count for blanketed jobs
  wardCount = computed(() => {
    return this.wards().length;
  });

  async ngOnInit() {
    // RBAC Check
    const user = this.authService.currentUser();
    if (!user) {
      this.messageService.add({
        severity: 'error',
        summary: 'Unauthorized',
        detail: 'You must be logged in to access this page',
      });
      this.router.navigate(['/auth/login']);
      return;
    }

    if (!this.authService.can('canManageHR')) {
      this.messageService.add({
        severity: 'error',
        summary: 'Access Denied',
        detail: 'You do not have permission to manage job postings',
      });
      this.router.navigate(['/recruitment/jobs']);
      return;
    }

    this.initForm();
    await this.loadZones();
    await this.loadLocalBodyTypes();

    // Check if editing existing job
    const id = this.route.snapshot.paramMap.get('id');
    if (id) {
      this.isEditMode = true;
      this.jobId = id as Id<'job_postings'>;
      await this.loadJobData();
    }
  }

initForm() {
  const user = this.authService.currentUser();

  this.jobForm = this.fb.group({
    title: ['', [Validators.required, Validators.minLength(3)]],
    description: ['', Validators.required],
    location: ['', Validators.required],
    employmentType: ['full_time', Validators.required],
    salaryMin: [0, [Validators.required, Validators.min(0)]],
    salaryMax: [0, [Validators.required, Validators.min(0)]],
    applicationDeadline: [null, Validators.required],
    requirements: this.fb.array([this.createRequirementControl()]),

    // Geographic fields (zone & district required)
    isBlanketed: [false],
    zone: [null, Validators.required],
    district: [null, Validators.required],
    subdistrict: [null],
    localBodyType: [null],
    localBodyName: [null],
    wardId: [null],
  });

  // âœ… FIXED: Only auto-populate fields that exist in UserProfile
  if (user) {
    this.jobForm.patchValue({
      location: user.hierarchyName || '',
    });

    // âœ… REMOVED: No auto-fill of zone/district/etc since they don't exist in UserProfile
    // The user will manually select these from dropdowns
  }

  // Watch isBlanketed changes
  this.jobForm.get('isBlanketed')?.valueChanges.subscribe((isBlanketed) => {
    const wardIdControl = this.jobForm.get('wardId');

    if (isBlanketed) {
      wardIdControl?.clearValidators();
      wardIdControl?.setValue(null);
      this.loadWardsForBlanketedJob();
    } else {
      wardIdControl?.setValidators(Validators.required);
    }

    wardIdControl?.updateValueAndValidity();
  });
}


  createRequirementControl() {
    return this.fb.control('', Validators.required);
  }

  get requirementsArray(): FormArray {
    return this.jobForm.get('requirements') as FormArray;
  }

  addRequirement() {
    this.requirementsArray.push(this.createRequirementControl());
  }

  removeRequirement(index: number) {
    if (this.requirementsArray.length > 1) {
      this.requirementsArray.removeAt(index);
    }
  }

  // ============================================================================
  // CASCADING LOCATION LOADERS
  // ============================================================================

  async loadZones() {
    try {
      const data = await this.convex.client.query(api.wards.getZones, {});
      this.zones.set(data);
    } catch (error) {
      console.error('Failed to load zones:', error);
    }
  }

  async loadLocalBodyTypes() {
    try {
      const data = await this.convex.client.query(api.wards.getLocalBodyTypes, {});
      this.localBodyTypes.set(data);
    } catch (error) {
      console.error('Failed to load local body types:', error);
    }
  }

  async loadDistricts() {
    const zone = this.selectedZone();
    if (!zone) return;

    this.loadingDistricts.set(true);
    try {
      const data = await this.convex.client.query(api.wards.getDistricts, { zone });
      this.districts.set(data);
    } catch (error) {
      console.error('Failed to load districts:', error);
      this.messageService.add({
        severity: 'error',
        summary: 'Error',
        detail: 'Failed to load districts. Please try again.',
      });
    } finally {
      this.loadingDistricts.set(false);
    }
  }

  async loadSubdistricts() {
    const zone = this.selectedZone();
    const district = this.selectedDistrict();
    if (!zone || !district) return;

    this.loadingSubdistricts.set(true);
    try {
      const data = await this.convex.client.query(api.wards.getSubdistricts, {
        zone,
        district,
      });
      this.subdistricts.set(data);
    } catch (error) {
      console.error('Failed to load subdistricts:', error);
    } finally {
      this.loadingSubdistricts.set(false);
    }
  }

  async loadLocalBodies() {
    const zone = this.selectedZone();
    const district = this.selectedDistrict();
    const subdistrict = this.selectedSubdistrict();
    const localBodyType = this.selectedLocalBodyType();
    if (!zone || !district || !subdistrict) return;

    this.loadingLocalBodies.set(true);
    try {
      const data = await this.convex.client.query(api.wards.getLocalBodies, {
        zone,
        district,
        subdistrict,
        localBodyType: localBodyType || undefined,
      });
      this.localBodies.set(data);
    } catch (error) {
      console.error('Failed to load local bodies:', error);
    } finally {
      this.loadingLocalBodies.set(false);
    }
  }

  async loadWards() {
    const zone = this.selectedZone();
    const district = this.selectedDistrict();
    const subdistrict = this.selectedSubdistrict();
    const localBodyName = this.selectedLocalBodyName();
    if (!zone || !district || !subdistrict || !localBodyName) return;

    this.loadingWards.set(true);
    try {
      const data = await this.convex.client.query(api.wards.getWards, {
        zone,
        district,
        subdistrict,
        localBodyName,
        limit: 500,
      });
      this.wards.set(data);
    } catch (error) {
      console.error('Failed to load wards:', error);
    } finally {
      this.loadingWards.set(false);
    }
  }

  // ============================================================================
  // BLANKETED JOB: Load wards based on current selection depth
  // ============================================================================

async loadWardsForBlanketedJob() {
  const zone = this.selectedZone();
  const district = this.selectedDistrict();
  const subdistrict = this.selectedSubdistrict();
  const localBodyName = this.selectedLocalBodyName();

  if (localBodyName && subdistrict) {
    // Local Body level - use existing getWards with all params
    await this.loadWards();
  } else if (subdistrict) {
    // Subdistrict level - use existing getWards with zone/district/subdistrict
    await this.loadWardsForSubdistrict();
  } else if (district) {
    // District level - use existing getWards with zone/district
    await this.loadWardsForDistrict();
  }
}

 async loadWardsForDistrict() {
  const zone = this.selectedZone();
  const district = this.selectedDistrict();
  if (!zone || !district) return;

  this.loadingWards.set(true);
  try {
    // âœ… Use EXISTING api.wards.getWards (no new backend query needed)
    const data = await this.convex.client.query(api.wards.getWards, {
      zone,
      district,
      limit: 5000, // For blanketed jobs, load more wards
    });
    
    this.wards.set(data);
    console.log(`ðŸ“‹ Loaded ${data.length} wards for ${district} district`);
  } catch (error) {
    console.error('Failed to load wards for district:', error);
  } finally {
    this.loadingWards.set(false);
  }
}

  async loadWardsForSubdistrict() {
  const zone = this.selectedZone();
  const district = this.selectedDistrict();
  const subdistrict = this.selectedSubdistrict();
  if (!zone || !district || !subdistrict) return;

  this.loadingWards.set(true);
  try {
    // âœ… Use EXISTING api.wards.getWards (no new backend query needed)
    const data = await this.convex.client.query(api.wards.getWards, {
      zone,
      district,
      subdistrict,
      limit: 5000,
    });
    
    this.wards.set(data);
    console.log(`ðŸ“‹ Loaded ${data.length} wards for ${subdistrict} subdistrict`);
  } catch (error) {
    console.error('Failed to load wards for subdistrict:', error);
  } finally {
    this.loadingWards.set(false);
  }
}


  // ============================================================================
  // LOCATION CHANGE HANDLERS
  // ============================================================================

  onZoneChange(event: any) {
    this.selectedZone.set(event.value);
    
    // Reset downstream selections
    this.selectedDistrict.set(null);
    this.selectedSubdistrict.set(null);
    this.selectedLocalBodyType.set(null);
    this.selectedLocalBodyName.set(null);
    
    this.jobForm.patchValue({
      district: null,
      subdistrict: null,
      localBodyType: null,
      localBodyName: null,
      wardId: null,
    });
    
    this.districts.set([]);
    this.subdistricts.set([]);
    this.localBodies.set([]);
    this.wards.set([]);
    
    this.loadDistricts();
    
    // Reload wards if blanketed
    if (this.jobForm.get('isBlanketed')?.value) {
      this.loadWardsForBlanketedJob();
    }
  }

  onDistrictChange(event: any) {
    this.selectedDistrict.set(event.value);
    
    this.selectedSubdistrict.set(null);
    this.selectedLocalBodyType.set(null);
    this.selectedLocalBodyName.set(null);
    
    this.jobForm.patchValue({
      subdistrict: null,
      localBodyType: null,
      localBodyName: null,
      wardId: null,
    });
    
    this.subdistricts.set([]);
    this.localBodies.set([]);
    this.wards.set([]);
    
    this.loadSubdistricts();
    
    // Reload wards if blanketed
    if (this.jobForm.get('isBlanketed')?.value) {
      this.loadWardsForBlanketedJob();
    }
  }

  onSubdistrictChange(event: any) {
    this.selectedSubdistrict.set(event.value);
    
    this.selectedLocalBodyType.set(null);
    this.selectedLocalBodyName.set(null);
    
    this.jobForm.patchValue({
      localBodyType: null,
      localBodyName: null,
      wardId: null,
    });
    
    this.localBodies.set([]);
    this.wards.set([]);
    
    this.loadLocalBodies();
    
    // Reload wards if blanketed
    if (this.jobForm.get('isBlanketed')?.value) {
      this.loadWardsForBlanketedJob();
    }
  }

  onLocalBodyTypeChange(event: any) {
    this.selectedLocalBodyType.set(event.value);
    
    this.selectedLocalBodyName.set(null);
    
    this.jobForm.patchValue({
      localBodyName: null,
      wardId: null,
    });
    
    this.localBodies.set([]);
    this.wards.set([]);
    
    this.loadLocalBodies();
  }

  onLocalBodyChange(event: any) {
    this.selectedLocalBodyName.set(event.value);
    
    this.jobForm.patchValue({ wardId: null });
    
    this.wards.set([]);
    
    this.loadWards();
    
    // Reload wards if blanketed
    if (this.jobForm.get('isBlanketed')?.value) {
      this.loadWardsForBlanketedJob();
    }
  }

  // ============================================================================
  // TEMPLATE HELPERS
  // ============================================================================

  getSelectedWardPath(): string {
    const wardId = this.jobForm.get('wardId')?.value;
    if (!wardId) return '';
    const ward = this.wards().find(w => w.value === wardId);
    return ward?.fullPath || '';
  }

  getWardNameById(wardId: string): string | undefined {
    const ward = this.wards().find(w => w.value === wardId);
    return ward?.label;
  }

  // ============================================================================
  // LOAD & SAVE
  // ============================================================================

  async loadJobData() {
    if (!this.jobId) return;

    this.loading = true;
    try {
      const job = await this.jobsService.getJobById(this.jobId);

      // Populate form
      this.jobForm.patchValue({
        title: job.title,
        description: job.description,
        location: job.location,
        employmentType: job.employmentType,
        salaryMin: job.salaryMin,
        salaryMax: job.salaryMax,
        applicationDeadline: new Date(job.applicationDeadline),
        isBlanketed: job.isBlanketed,
        zone: job.zone,
        district: job.district,
        subdistrict: job.subdistrict,
        localBodyName: job.localBody,
        wardId: job.wardId,
      });

      // Populate requirements
      if (job.requirements && job.requirements.length > 0) {
        this.requirementsArray.clear();
        job.requirements.forEach((req: string) => {
          this.requirementsArray.push(this.fb.control(req, Validators.required));
        });
      }
    } catch (error: any) {
      this.messageService.add({
        severity: 'error',
        summary: 'Error',
        detail: error.message || 'Failed to load job details',
      });
      this.router.navigate(['/recruitment/jobs']);
    } finally {
      this.loading = false;
    }
  }

async onSubmit() {
  this.submitted = true;

  if (this.jobForm.invalid) {
    this.messageService.add({
      severity: 'warn',
      summary: 'Validation Error',
      detail: 'Please fill all required fields',
    });
    return;
  }

  const salaryMin = this.jobForm.value.salaryMin;
  const salaryMax = this.jobForm.value.salaryMax;
  if (salaryMin > salaryMax) {
    this.messageService.add({
      severity: 'error',
      summary: 'Validation Error',
      detail: 'Minimum salary cannot be greater than maximum salary',
    });
    return;
  }

  if (!this.jobForm.value.zone || !this.jobForm.value.district) {
    this.messageService.add({
      severity: 'error',
      summary: 'Validation Error',
      detail: 'Please select zone and district',
    });
    return;
  }

  const isBlanketed = this.jobForm.value.isBlanketed;

  if (isBlanketed) {
    if (this.wards().length === 0) {
      this.messageService.add({
        severity: 'error',
        summary: 'Validation Error',
        detail: 'No wards found for selected area. Please refine your selection.',
      });
      return;
    }
  } else {
    if (!this.jobForm.value.wardId) {
      this.messageService.add({
        severity: 'error',
        summary: 'Validation Error',
        detail: 'Please select a specific ward or enable blanketed posting',
      });
      return;
    }
  }

  this.loading = true;
  try {
    const user = this.authService.currentUser();
    if (!user) throw new Error('User not authenticated');

    const formData = this.jobForm.value;
    const deadline = new Date(formData.applicationDeadline).getTime();

    // Build targetWards array
    let targetWards: string[] | undefined = undefined;

    if (isBlanketed) {
      targetWards = this.wards().map(w => w.value);
    } else {
      targetWards = [formData.wardId];
    }

    // âœ… FIXED: Only use fields that match backend expectations
    const jobData = {
      title: formData.title,
      description: formData.description,
      requirements: formData.requirements.filter((r: string) => r.trim()),
      location: formData.location,
      employmentType: formData.employmentType,
      salaryMin: formData.salaryMin,
      salaryMax: formData.salaryMax,
      applicationDeadline: deadline,

      // Geographic fields (required)
      zone: formData.zone,
      district: formData.district,
      subdistrict: formData.subdistrict || undefined,
      localBody: formData.localBodyName || undefined,
      ward: !isBlanketed ? this.getWardNameById(formData.wardId) : undefined,

      // Legacy hierarchy fields (optional)
      hierarchyId: user.hierarchyId as Id<'hierarchies'> | undefined,

      // Blanketed job fields
      isBlanketed: isBlanketed,
      wardId: !isBlanketed ? formData.wardId : undefined,
      targetWards: targetWards,
    };

    console.log('ðŸ“¤ Submitting job data:', jobData);

    if (this.isEditMode && this.jobId) {
      await this.jobsService.updateJob(this.jobId, jobData);
      this.messageService.add({
        severity: 'success',
        summary: 'Success',
        detail: 'Job updated successfully',
      });
    } else {
      await this.jobsService.createJob(jobData);
      this.messageService.add({
        severity: 'success',
        summary: 'Success',
        detail: `Job created successfully (${targetWards.length} ward${targetWards.length > 1 ? 's' : ''} targeted)`,
      });
    }

    setTimeout(() => {
      this.router.navigate(['/recruitment/jobs']);
    }, 1000);
  } catch (error: any) {
    this.messageService.add({
      severity: 'error',
      summary: 'Error',
      detail:
        error.message ||
        `Failed to ${this.isEditMode ? 'update' : 'create'} job`,
    });
  } finally {
    this.loading = false;
  }
}



  onCancel() {
    this.router.navigate(['/recruitment/jobs']);
  }

  // Form validation helpers
  isFieldInvalid(fieldName: string): boolean {
    const field = this.jobForm.get(fieldName);
    return !!(
      field &&
      field.invalid &&
      (field.dirty || field.touched || this.submitted)
    );
  }

  getFieldError(fieldName: string): string {
    const field = this.jobForm.get(fieldName);
    if (field?.errors) {
      if (field.errors['required']) return 'This field is required';
      if (field.errors['minlength'])
        return `Minimum length is ${field.errors['minlength'].requiredLength}`;
      if (field.errors['min']) return `Minimum value is ${field.errors['min'].min}`;
    }
    return '';
  }
}
</file>

<file path="src/app/features/hr-recruitment/manage-jobs/jobs-list/manage-jobs.component.html">
<div class="manage-jobs-page">
  <p-toast></p-toast>
  <p-confirmDialog></p-confirmDialog>

  <!-- Header -->
  <div class="page-header">
    <h2 class="page-title">Manage Job Postings</h2>

    <div class="page-actions">
      <button
        pButton
        type="button"
        label="New Job"
        icon="pi pi-plus"
        class="p-button-sm"
        (click)="openNew()"
      ></button>

      <button
        pButton
        type="button"
        label="Delete Selected"
        icon="pi pi-trash"
        class="p-button-sm p-button-danger"
        [disabled]="!selectedJobs || selectedJobs.length === 0"
        (click)="deleteSelectedJobs()"
      ></button>
    </div>
  </div>

  <!-- Search toolbar -->
  <div class="jobs-toolbar">
    <div class="jobs-search-wrapper">
      <p-iconField iconPosition="left">
        <p-inputIcon>
          <i class="pi pi-search"></i>
        </p-inputIcon>
        <input
          pInputText
          #globalFilter
          type="text"
          class="jobs-search-input"
          placeholder="Search jobs..."
          (input)="onGlobalFilter(dt, $event)"
        />
      </p-iconField>
    </div>
  </div>

  <!-- Jobs table -->
  <div class="jobs-card">
    <p-table
      #dt
      [value]="jobs()"
      [(selection)]="selectedJobs"
      dataKey="_id"
      [loading]="loading()"
      [rows]="10"
      [paginator]="true"
      [rowsPerPageOptions]="[10, 25, 50]"
      [responsiveLayout]="'scroll'"
    >
      <ng-template pTemplate="header">
        <tr>
          <th style="width: 3rem">
            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
          </th>
          <th pSortableColumn="title">
            Title
            <p-sortIcon field="title"></p-sortIcon>
          </th>
          <th>Location</th>
          <th>Employment Type</th>
          <th>Status</th>
          <th>Applications</th>
          <th>Deadline</th>
          <th style="width: 5rem; text-align: center;">Actions</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-job>
        <tr>
          <td>
            <p-tableCheckbox [value]="job"></p-tableCheckbox>
          </td>
          <td>{{ job.title }}</td>
          <td>{{ job.location }}</td>
          <td>{{ getEmploymentTypeLabel(job.employmentType) }}</td>
          <td>
            <p-tag
              [value]="job.isActive ? 'Active' : 'Inactive'"
              [severity]="getStatusSeverity(job.isActive)"
            ></p-tag>
          </td>
          <td>{{ job.totalApplications }}</td>
          <td>{{ job.applicationDeadline | date: 'dd/MM/yyyy' }}</td>
          <td style="text-align: center;">
            <!-- Inline edit/delete buttons (already working) -->
            <button
              pButton
              icon="pi pi-pencil"
              class="p-button-text p-button-rounded p-button-sm"
              (click)="editJob(job)"
              type="button"
              [title]="'Edit job'"
            ></button>

            <button
              pButton
              icon="pi pi-trash"
              class="p-button-text p-button-rounded p-button-sm p-button-danger"
              (click)="deleteJob(job)"
              type="button"
              [title]="'Delete job'"
            ></button>

            <!-- Three-dot actions menu -->
            <button
              pButton
              type="button"
              icon="pi pi-ellipsis-v"
              class="p-button-text p-button-rounded p-button-sm"
              (click)="onActionsMenuClick(actionsMenu, $event, job)"
              [title]="'More actions'"
            ></button>
          </td>
        </tr>
      </ng-template>
    </p-table>

    <!-- The overlay menu (must be inside template and have #actionsMenu) -->
<p-menu
  #actionsMenu
  [popup]="true"
  [model]="actionMenuItems"
  [style]="{ 'z-index': 1000 }"
></p-menu>
  </div>
</div>
</file>

<file path="src/app/features/hr-recruitment/manage-jobs/jobs-list/manage-jobs.component.scss">
.manage-jobs-page {
  padding: 1.5rem 2rem;
  background: radial-gradient(circle at top left, #eef2ff 0, #f9fafb 40%, #f3f4f6 100%);
  min-height: 100vh;
}

/* Page header */
.page-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 1rem;
  margin-bottom: 0.75rem;
}

.page-title {
  margin: 0;
  font-size: 1.45rem;
  font-weight: 700;
  letter-spacing: 0.01em;
  color: #111827;
  display: flex;
  align-items: center;
  gap: 0.5rem;

  &::before {
    content: '';
    width: 6px;
    height: 24px;
    border-radius: 999px;
    background: linear-gradient(135deg, #4f46e5, #06b6d4);
  }
}

.page-actions {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

/* PrimeNG buttons refinement */
:host ::ng-deep .p-button {
  border-radius: 999px;
  font-size: 0.78rem;
  padding: 0.35rem 0.9rem;
}

:host ::ng-deep .p-button.p-button-sm {
  font-size: 0.78rem;
}

:host ::ng-deep .p-button.p-button-danger {
  background: linear-gradient(135deg, #ef4444, #b91c1c);
  border: none;
}

/* Search toolbar */
.jobs-toolbar {
  margin-bottom: 0.75rem;
}

.jobs-search-wrapper {
  max-width: 320px;
  width: 100%;
}

:host ::ng-deep .p-input-icon-left .p-inputtext.jobs-search-input {
  width: 100%;
  padding: 0.35rem 0.75rem 0.35rem 2rem;
  font-size: 0.8rem;
  height: 2rem;
  line-height: 1.6rem;
  border-radius: 999px;
  background-color: #ffffff;
  border: 1px solid #e5e7eb;
  transition: box-shadow 0.15s ease, border-color 0.15s ease;
}

:host ::ng-deep .p-input-icon-left .p-inputtext.jobs-search-input:focus {
  border-color: #4f46e5;
  box-shadow: 0 0 0 1px rgba(79, 70, 229, 0.25);
}

:host ::ng-deep .p-input-icon-left > .pi {
  font-size: 0.9rem;
  color: #9ca3af;
}

/* Card around the table */
.jobs-card {
  background-color: #ffffff;
  border-radius: 1rem;
  box-shadow: 0 18px 40px rgba(15, 23, 42, 0.06);
  padding: 0.75rem 1rem 0.5rem;
  border: 1px solid #e5e7eb;
  position: relative;
  overflow: hidden;
}

.jobs-card::before {
  content: '';
  position: absolute;
  inset: 0;
  pointer-events: none;
  background: radial-gradient(circle at top right, rgba(79, 70, 229, 0.06), transparent 55%);
}

/* Table header/body tuning */
.jobs-card ::ng-deep .p-datatable-thead > tr > th {
  font-size: 0.78rem;
  font-weight: 600;
  color: #6b7280;
  padding: 0.6rem 0.75rem;
  border-bottom: 1px solid #e5e7eb;
  background: #f9fafb;
}

.jobs-card ::ng-deep .p-datatable-tbody > tr > td {
  font-size: 0.85rem;
  padding: 0.55rem 0.75rem;
  border-bottom: 1px solid #f3f4f6;
}

/* Row hover and selection */
.jobs-card ::ng-deep .p-datatable-tbody > tr {
  transition: background-color 0.12s ease, transform 0.08s ease;
}

.jobs-card ::ng-deep .p-datatable-tbody > tr:hover {
  background-color: #f9fafb;
}

.jobs-card ::ng-deep .p-datatable-tbody > tr.p-highlight {
  background: linear-gradient(
    135deg,
    rgba(79, 70, 229, 0.04),
    rgba(6, 182, 212, 0.04)
  );
}

/* Status tags */
:host ::ng-deep .p-tag {
  border-radius: 999px;
  font-size: 0.75rem;
  font-weight: 600;
  padding: 0.15rem 0.75rem;
}

:host ::ng-deep .p-tag-success {
  background: #dcfce7;
  color: #166534;
}

:host ::ng-deep .p-tag-danger {
  background: #fee2e2;
  color: #b91c1c;
}

/*
:host ::ng-deep .p-tag-success {
  background: #dcfce7;
  color: #166534;
}

:host ::ng-deep .p-tag-danger {
  background: #fee2e2;
  color: #b91c1c;
}

/* Actions column buttons */
:host ::ng-deep .p-button.p-button-text.p-button-rounded.p-button-sm {
  width: 1.9rem;
  height: 1.9rem;
  padding: 0;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

:host ::ng-deep .p-button.p-button-text.p-button-rounded.p-button-sm .pi {
  font-size: 0.85rem;
}

/* Three-dot menu overlay */
:host ::ng-deep .p-menu {
  border-radius: 10px;
  box-shadow: 0 10px 30px rgba(15, 23, 42, 0.12);
  border: 1px solid #e5e7eb;
  padding: 0.25rem 0;
  min-width: 9rem;
}

:host ::ng-deep .p-menu .p-menuitem-link {
  padding: 0.4rem 0.8rem;
  font-size: 0.8rem;
  gap: 0.45rem;
}

:host ::ng-deep .p-menu .p-menuitem-icon {
  font-size: 0.85rem;
  color: #6b7280;
}

:host ::ng-deep .p-menu .p-menuitem-text {
  color: #374151;
}

:host ::ng-deep .p-menu .p-menuitem-link:hover {
  background: #f3f4f6;
}

/* Paginator styling */
.jobs-card ::ng-deep .p-paginator {
  border: none;
  padding: 0.5rem 0 0.25rem;
}

.jobs-card ::ng-deep .p-paginator .p-paginator-pages .p-paginator-page {
  border-radius: 999px;
  width: 2rem;
  height: 2rem;
  font-size: 0.8rem;
}

.jobs-card ::ng-deep .p-paginator .p-paginator-page.p-highlight {
  background: #ecfdf5;
  color: #16a34a;
  border-color: #bbf7d0;
}

.jobs-card ::ng-deep .p-paginator .p-paginator-first,
.jobs-card ::ng-deep .p-paginator .p-paginator-prev,
.jobs-card ::ng-deep .p-paginator .p-paginator-next,
.jobs-card ::ng-deep .p-paginator .p-paginator-last {
  border-radius: 999px;
}

/* Responsive layout */
@media (max-width: 768px) {
  .manage-jobs-page {
    padding: 1rem;
  }

  .page-header {
    flex-direction: column;
    align-items: flex-start;
  }

  .page-actions {
    width: 100%;
    justify-content: flex-start;
    flex-wrap: wrap;
  }

  .jobs-search-wrapper {
    max-width: 100%;
  }
}
</file>

<file path="src/app/features/hr-recruitment/manage-jobs/jobs-list/manage-jobs.component.ts">
import { Component, OnInit, signal, ViewChild } from '@angular/core';
import { ConfirmationService, MenuItem, MessageService } from 'primeng/api';
import { Table, TableModule } from 'primeng/table';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { ButtonModule } from 'primeng/button';
import { ToastModule } from 'primeng/toast';
import { ToolbarModule } from 'primeng/toolbar';
import { InputTextModule } from 'primeng/inputtext';
import { SelectModule } from 'primeng/select';
import { TagModule } from 'primeng/tag';
import { IconFieldModule } from 'primeng/iconfield';
import { InputIconModule } from 'primeng/inputicon';
import { ConfirmDialogModule } from 'primeng/confirmdialog';
import { MenuModule } from 'primeng/menu';
import { RippleModule } from 'primeng/ripple';
import { Router, RouterLink } from '@angular/router';
import { Id } from 'convex/_generated/dataModel';
import { JobPosting, JobsService } from '../services/jobs.service';

@Component({
  selector: 'app-manage-jobs',
  standalone: true,
  imports: [
    CommonModule,
    TableModule,
    FormsModule,
    ButtonModule,
    RippleModule,
    ToastModule,
    ToolbarModule,
    InputTextModule,
    SelectModule,
    TagModule,
    IconFieldModule,
    InputIconModule,
    ConfirmDialogModule,
    MenuModule,
  ],
  templateUrl: './manage-jobs.component.html',
  styleUrls: ['./manage-jobs.component.scss'],

  providers: [MessageService, ConfirmationService],
})
export class ManageJobsComponent implements OnInit {
  @ViewChild('dt') dt!: Table;

  jobs = signal<JobPosting[]>([]);
  selectedJobs: JobPosting[] | null = [];
  loading = signal<boolean>(false);
  
  actionMenuItems: MenuItem[] = [];

  constructor(
    private jobsService: JobsService,
    private router: Router,
    private messageService: MessageService,
    private confirmationService: ConfirmationService
  ) {}

  async ngOnInit() {
    await this.loadJobs();
  }

  /**
   * Load jobs from backend
   */
  async loadJobs() {
    this.loading.set(true);
    try {
      const result = await this.jobsService.getJobs(100); // Load first 100
      this.jobs.set(result.page as JobPosting[]);
    } catch (error: any) {
      this.messageService.add({
        severity: 'error',
        summary: 'Error',
        detail: error.message || 'Failed to load jobs',
      });
    } finally {
      this.loading.set(false);
    }
  }

  /**
   * Global table filter
   */
  onGlobalFilter(table: Table, event: Event) {
    table.filterGlobal((event.target as HTMLInputElement).value, 'contains');
  }

  /**
   * Navigate to create new job
   */
  openNew() {
    this.router.navigate(['/recruitment/jobs/new']);
  }

  /**
   * Navigate to edit job
   */
  editJob(job: JobPosting) {
    this.router.navigate(['/recruitment/jobs/edit/', job._id]);
  }

  /**
   * Delete single job
   */
  async deleteJob(job: JobPosting) {
    this.confirmationService.confirm({
      message: `Are you sure you want to delete "${job.title}"?`,
      header: 'Confirm',
      icon: 'pi pi-exclamation-triangle',
      accept: async () => {
        try {
          await this.jobsService.deleteJob(job._id);
          
          // Remove from UI
          this.jobs.update((jobs) => jobs.filter((j) => j._id !== job._id));
          
          this.messageService.add({
            severity: 'success',
            summary: 'Successful',
            detail: 'Job Deleted',
            life: 3000,
          });
        } catch (error: any) {
          this.messageService.add({
            severity: 'error',
            summary: 'Error',
            detail: error.message || 'Failed to delete job',
          });
        }
      },
    });
  }

  /**
   * Delete multiple selected jobs
   */
  async deleteSelectedJobs() {
    this.confirmationService.confirm({
      message: 'Are you sure you want to delete the selected jobs?',
      header: 'Confirm',
      icon: 'pi pi-exclamation-triangle',
      accept: async () => {
        try {
          // Delete all selected jobs
          for (const job of this.selectedJobs || []) {
            await this.jobsService.deleteJob(job._id);
          }

          // Remove from UI
          const selectedIds = this.selectedJobs?.map((j) => j._id);
          this.jobs.update((jobs) =>
            jobs.filter((job) => !selectedIds?.includes(job._id))
          );

          this.selectedJobs = null;
          
          this.messageService.add({
            severity: 'success',
            summary: 'Successful',
            detail: 'Jobs Deleted',
            life: 3000,
          });
        } catch (error: any) {
          this.messageService.add({
            severity: 'error',
            summary: 'Error',
            detail: error.message || 'Failed to delete jobs',
          });
        }
      },
    });
  }

  /**
   * Toggle job active status
   */
  async toggleJobStatus(job: JobPosting) {
    try {
      await this.jobsService.updateJob(job._id, {
        isActive: !job.isActive,
      });

      // Update UI
      this.jobs.update((jobs) =>
        jobs.map((j) =>
          j._id === job._id ? { ...j, isActive: !j.isActive } : j
        )
      );

      this.messageService.add({
        severity: 'success',
        summary: 'Success',
        detail: `Job ${job.isActive ? 'deactivated' : 'activated'}`,
      });
    } catch (error: any) {
      this.messageService.add({
        severity: 'error',
        summary: 'Error',
        detail: error.message || 'Failed to update job status',
      });
    }
  }

  /**
   * Get status severity for PrimeNG tag
   */
  getStatusSeverity(isActive: boolean): 'success' | 'danger' {
    return isActive ? 'success' : 'danger';
  }

  /**
   * Get employment type label
   */
  getEmploymentTypeLabel(type: string): string {
    const map: Record<string, string> = {
      full_time: 'Full-time',
      part_time: 'Part-time',
      contract: 'Contract',
    };
    return map[type] || type;
  }

  /**
   * Actions menu click
   */
  onActionsMenuClick(menu: any, event: any, job: JobPosting) {
    this.actionMenuItems = [
      {
        label: 'Edit',
        icon: 'pi pi-pencil',
        command: () => this.editJob(job),
      },
      {
        label: job.isActive ? 'Deactivate' : 'Activate',
        icon: job.isActive ? 'pi pi-ban' : 'pi pi-check',
        command: () => this.toggleJobStatus(job),
      },
      {
        label: 'Delete',
        icon: 'pi pi-trash',
        command: () => this.deleteJob(job),
      },
    ];
    menu.toggle(event);
  }
}
</file>

<file path="src/app/features/hr-recruitment/manage-jobs/services/jobs.service.ts">
import { Injectable } from '@angular/core';
import { ConvexService } from 'src/app/core/services/convex.service';
import { api } from 'convex/_generated/api';
import { Id } from 'convex/_generated/dataModel';

export interface JobPosting {
  _id: Id<'job_postings'>;
  _creationTime: number;
  title: string;
  description: string;
  location: string;
  rootId: string;
  hierarchyId: Id<'hierarchies'>;
  hierarchyPath: string;
  wardId?: string;
  isBlanketed: boolean;
  targetWards?: string[];
  employmentType: 'full_time' | 'part_time' | 'contract';
  salaryMin: number;
  salaryMax: number;
  isActive: boolean;
  postedBy: Id<'admin_users'>;
  applicationDeadline: number;
  totalApplications: number;
  shortlistedCount: number;
  createdAt: number;
  updatedAt: number;
  isDeleted: boolean;
  posterName?: string; // Enriched field
  requirements?: string[]; // Enriched field
}
interface CreateJobData {
    title: string;
    description: string;
    requirements: string[];
    location: string;
    employmentType: 'full_time' | 'part_time' | 'contract';
    salaryMin: number;
    salaryMax: number;
    applicationDeadline: number;
    
    // âœ… REQUIRED: Geographic fields
    zone: string;
    district: string;
    
    // âœ… OPTIONAL: Additional geographic fields
    subdistrict?: string;
    localBody?: string;
    ward?: string;
    
    // Legacy/optional fields
    hierarchyId?: Id<'hierarchies'>;
    wardId?: string;
    isBlanketed?: boolean;
    targetWards?: string[];
}

@Injectable({ providedIn: 'root' })
export class JobsService {
  constructor(private convex: ConvexService) {}

  /**
   * Get all jobs with pagination
   */
  async getJobs(numItems: number = 50, cursor: string | null = null, isActive?: boolean) {
    return this.convex.client.query(api.hr.jobs.listJobs, {
      paginationOpts: {
        numItems,
        cursor: cursor || null,
      },
      isActive,
    });
  }

  /**
   * Get single job details
   */
  async getJobById(jobId: Id<'job_postings'>) {
    return this.convex.client.query(api.hr.jobs.getJob, { jobId });
  }

  /**
   * Create new job
   */
async createJob(jobData: CreateJobData) {
    // âœ… Ensure zone and district are included
    const payload = {
        ...jobData,
        zone: jobData.zone || 'Default Zone',      // âœ… Required field
        district: jobData.district || 'Default District', // âœ… Required field
        
        // Optional fields (can be undefined)
        subdistrict: jobData.subdistrict,
        localBody: jobData.localBody,
        ward: jobData.ward,
        
        // Existing fields
        hierarchyId: jobData.hierarchyId,
        wardId: jobData.wardId,
        isBlanketed: jobData.isBlanketed || false,
        targetWards: jobData.targetWards || [],
    };

    return this.convex.client.mutation(api.hr.jobs.createJob, payload);
}

  /**
   * Update existing job
   */
  async updateJob(
    jobId: Id<'job_postings'>,
    updates: Partial<{
      title: string;
      description: string;
      requirements: string[];
      location: string;
      employmentType: 'full_time' | 'part_time' | 'contract';
      salaryMin: number;
      salaryMax: number;
      applicationDeadline: number;
      isActive: boolean;
    }>
  ) {
    return this.convex.client.mutation(api.hr.jobs.updateJob, {
      jobId,
      ...updates,
    });
  }

  /**
   * Delete job (soft delete)
   */
  async deleteJob(jobId: Id<'job_postings'>) {
    return this.convex.client.mutation(api.hr.jobs.deleteJob, { jobId });
  }

  /**
   * Get job statistics
   */
  async getJobStats() {
    return this.convex.client.query(api.hr.jobs.getJobStats, {});
  }
}
</file>

<file path="src/app/features/hr-recruitment/public/component/public-application-form.component.html">
<div class="public-application-page">
    <p-toast></p-toast>

    <div class="public-form-header">
        <div>
            <h2 class="public-form-title">Apply for a Job</h2>
            <p class="public-form-subtitle">
                Select a job posting and submit your application with resume and
                ID card.
            </p>
        </div>
    </div>

    <p-card class="public-form-card">
        <!-- Job selection -->
        <div class="job-select-section">
            <h3 class="section-title">Choose a Job</h3>

            <div class="form-field">
                <label class="form-label"
                    >Job Posting <span class="required">*</span></label
                >
                <p-select
                    [options]="jobs()"
                    [loading]="loadingJobs()"
                    [style]="{ width: '100%' }"
                    optionLabel="title"
                    optionValue="_id"
                    placeholder="Select a job"
                    [filter]="true"
                    filterBy="title,location"
                    (onChange)="onJobChange($event.value)"
                    [ngModel]="selectedJobId()"
                >
                    <ng-template let-job pTemplate="item">
                        <div class="job-option">
                            <div class="job-option-main">
                                <div class="job-option-title">
                                    {{ job.title }}
                                </div>
                                <div class="job-option-meta">
                                    {{ job.location }} â€¢
                                    {{
                                        employmentTypeLabel(job.employmentType)
                                    }}
                                </div>
                            </div>
                            <div class="job-option-deadline">
                                <span>Deadline:</span>
                                <strong>{{
                                    formatDeadline(job.applicationDeadline)
                                }}</strong>
                            </div>
                        </div>
                    </ng-template>
                </p-select>
            </div>

            <p-divider></p-divider>
        </div>

        <!-- Main form; hidden until job is selected -->
        <form
            [formGroup]="form"
            (ngSubmit)="onSubmit()"
            class="public-form-grid"
        >
            <!-- LEFT: Personal details -->
            <div>
                <h3 class="section-title">Personal Details</h3>

                <div class="form-field">
                    <div class="form-label">
                        <span>Full Name <span class="required">*</span></span>
                    </div>
                    <input
                        pInputText
                        type="text"
                        formControlName="name"
                        placeholder="Your full name"
                    />
                </div>

                <div class="form-field">
                    <div class="form-label">
                        <span>Email <span class="required">*</span></span>
                    </div>
                    <input
                        pInputText
                        type="email"
                        formControlName="email"
                        placeholder="you@example.com"
                    />
                </div>

                <div class="form-field">
                    <div class="form-label">
                        <span>Phone <span class="required">*</span></span>
                    </div>
                    <input
                        pInputText
                        type="text"
                        formControlName="phone"
                        placeholder="Mobile number"
                    />
                </div>

                <div class="form-field">
                    <div class="form-label">
                        <span
                            >Experience (years)
                            <span class="required">*</span></span
                        >
                    </div>
                    <p-inputNumber
                        formControlName="experience"
                        [min]="0"
                        [maxFractionDigits]="1"
                        [style]="{ width: '100%' }"
                    ></p-inputNumber>
                </div>

                <p-divider></p-divider>

                <h3 class="section-title">Uploads</h3>

                <div class="form-field">
                    <div class="form-label">
                        <span
                            >Resume (PDF, max 1 MB)
                            <span class="required">*</span></span
                        >
                    </div>
                    <p-fileUpload
                        mode="basic"
                        name="resume"
                        accept=".pdf"
                        [auto]="true"
                        [customUpload]="true"
                        [maxFileSize]="1024 * 1024"
                        [chooseLabel]="
                            uploadingResume() ? 'Uploadingâ€¦' : 'Choose Resume'
                        "
                        (uploadHandler)="onFileSelect($event, 'resume')"
                    ></p-fileUpload>
                </div>

                <div class="form-field">
                    <div class="form-label">
                        <span
                            >ID Card (JPG/PNG/PDF, max 1 MB)
                            <span class="required">*</span></span
                        >
                    </div>
                    <p-fileUpload
                        mode="basic"
                        name="idCard"
                        accept=".jpg,.jpeg,.png,.pdf"
                        [auto]="true"
                        [customUpload]="true"
                        [maxFileSize]="1024 * 1024"
                        [chooseLabel]="
                            uploadingIdCard() ? 'Uploadingâ€¦' : 'Choose ID Card'
                        "
                        (uploadHandler)="onFileSelect($event, 'idCard')"
                    ></p-fileUpload>
                </div>
            </div>

            <!-- RIGHT: Location -->
            <div>
                <h3 class="section-title">Location</h3>

                <!-- Zone -->
                <div class="form-field">
                    <div class="form-label">
                        <span>Zone</span>
                    </div>
                    <p-select
                        formControlName="zone"
                        [options]="zones()"
                        optionLabel="label"
                        optionValue="value"
                        placeholder="Select zone"
                        [loading]="loadingZones()"
                        (onChange)="onZoneChange($event)"
                        [style]="{ width: '100%' }"
                    ></p-select>
                </div>

                <!-- District -->
                <div class="form-field">
                    <div class="form-label">
                        <span>District</span>
                    </div>
                    <p-select
                        formControlName="district"
                        [options]="districts()"
                        optionLabel="label"
                        optionValue="value"
                        placeholder="Select district"
                        [loading]="loadingDistricts()"
                        (onChange)="onDistrictChange($event)"
                        [style]="{ width: '100%' }"
                    ></p-select>
                </div>

                <!-- Subdistrict -->
                <div class="form-field">
                    <div class="form-label">
                        <span>Subdistrict</span>
                    </div>
                    <p-select
                        formControlName="subdistrict"
                        [options]="subdistricts()"
                        optionLabel="label"
                        optionValue="value"
                        placeholder="Select subdistrict"
                        [loading]="loadingSubdistricts()"
                        (onChange)="onSubdistrictChange($event)"
                        [style]="{ width: '100%' }"
                    ></p-select>
                </div>

                <!-- Local body -->
                <div class="form-field">
                    <div class="form-label">
                        <span>Local Body</span>
                    </div>
                    <p-select
                        formControlName="localBodyName"
                        [options]="localBodies()"
                        optionLabel="label"
                        optionValue="value"
                        placeholder="Select local body"
                        [loading]="loadingLocalBodies()"
                        (onChange)="onLocalBodyChange($event)"
                        [style]="{ width: '100%' }"
                    ></p-select>
                </div>

                <!-- Ward -->
                <div class="form-field">
                    <div class="form-label">
                        <span>Ward <span class="required">*</span></span>
                    </div>
                    <p-select
                        formControlName="wardId"
                        [options]="wards()"
                        optionLabel="label"
                        optionValue="value"
                        placeholder="Select ward"
                        [loading]="loadingWards()"
                        (onChange)="onWardChange($event)"
                        [style]="{ width: '100%' }"
                    ></p-select>
                    <small class="helper-text" *ngIf="form.value.wardName">
                        {{ form.value.wardName }}
                    </small>
                </div>
            </div>

            <!-- Footer -->
            <div class="public-form-footer" style="grid-column: 1 / span 2">
                <button
                    pButton
                    type="submit"
                    label="Submit Application"
                    [loading]="submitting()"
                ></button>
            </div>
        </form>
    </p-card>
</div>
</file>

<file path="src/app/features/hr-recruitment/public/component/public-application-form.component.scss">
.public-application-page {
  padding: 2rem;
  background: #f9fafb;
  min-height: 100vh;
}

/* Header */
.public-form-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 1rem;
  margin-bottom: 1rem;
}

.public-form-title {
  margin: 0;
  font-size: 1.5rem;
  font-weight: 700;
  color: #111827;
}

.public-form-subtitle {
  margin: 0.25rem 0 0;
  font-size: 0.9rem;
  color: #6b7280;
}

/* Card wrapper */
.public-form-card {
  border-radius: 1rem;
  box-shadow: 0 18px 40px rgba(15, 23, 42, 0.06);
  border: 1px solid #e5e7eb;
}

/* Sections */
.section-title {
  font-size: 0.9rem;
  font-weight: 600;
  color: #4b5563;
  margin-bottom: 0.75rem;
}

/* Form layout */
.public-form-grid {
  display: grid;
  grid-template-columns: minmax(0, 1.6fr) minmax(0, 1.4fr);
  gap: 1.5rem;
  margin-top: 1rem;
}

/* Fields */
.form-field {
  margin-bottom: 0.75rem;
}

.form-label {
  display: flex;
  align-items: center;
  justify-content: space-between;
  font-size: 0.8rem;
  font-weight: 500;
  color: #4b5563;
  margin-bottom: 0.25rem;
}

.required {
  color: #ef4444;
  margin-left: 0.15rem;
}

/* Job option item in dropdown */
.job-option {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.75rem;
}

.job-option-main {
  min-width: 0;
}

.job-option-title {
  font-size: 0.85rem;
  font-weight: 600;
  color: #111827;
}

.job-option-meta {
  font-size: 0.75rem;
  color: #6b7280;
}

.job-option-deadline {
  font-size: 0.75rem;
  color: #6b7280;

  span {
    margin-right: 0.2rem;
  }

  strong {
    color: #111827;
  }
}

/* Footer */
.public-form-footer {
  display: flex;
  justify-content: flex-end;
  margin-top: 0.5rem;
}

/* PrimeNG overrides */
:host ::ng-deep .p-card.public-form-card .p-card-body {
  padding: 1.5rem 1.75rem 1.25rem;
}

:host ::ng-deep .p-inputtext,
:host ::ng-deep .p-inputnumber-input {
  font-size: 0.85rem;
}

:host ::ng-deep .p-fileupload-choose {
  border-radius: 999px;
  font-size: 0.8rem;
  padding: 0.35rem 0.95rem;
}

/* Responsive */
@media (max-width: 960px) {
  .public-application-page {
    padding: 1.25rem;
  }

  .public-form-grid {
    grid-template-columns: minmax(0, 1fr);
  }

  .public-form-footer {
    justify-content: center;
  }
}
</file>

<file path="src/app/features/hr-recruitment/public/component/public-application-form.component.ts">
import { Component, OnInit, computed, inject, signal } from '@angular/core';
import { CommonModule } from '@angular/common';
import {
    FormBuilder,
    FormGroup,
    Validators,
    ReactiveFormsModule,
    FormsModule
} from '@angular/forms';
import { Router } from '@angular/router';

import {
    PublicApplicationService,
    PublicFileType
} from '../services/public-application.service';
import { Id } from 'convex/_generated/dataModel';
import { MessageService } from 'primeng/api';

// PrimeNG
import { ButtonModule } from 'primeng/button';
import { InputTextModule } from 'primeng/inputtext';
import { InputNumberModule } from 'primeng/inputnumber';
import { SelectModule } from 'primeng/select';
import { FileUploadModule } from 'primeng/fileupload';
import { ToastModule } from 'primeng/toast';
import { CardModule } from 'primeng/card';
import { DividerModule } from 'primeng/divider';
import { IconFieldModule } from 'primeng/iconfield';
import { InputIconModule } from 'primeng/inputicon';
import { DatePipe } from '@angular/common';
import { PipelineService } from '../../candidate-pipeline/services/pipeline.service';

interface PublicJobOption {
    _id: Id<'job_postings'>;
    title: string;
    location: string;
    employmentType: 'full_time' | 'part_time' | 'contract';
    applicationDeadline: number;
    isBlanketed: boolean;
    wardId?: string;
    targetWards: string[];
    
    // âœ… ADD GEOGRAPHIC FIELDS
    zone?: string;
    district?: string;
    subdistrict?: string;
}

@Component({
    selector: 'app-public-application-form',
    standalone: true,
    imports: [
        CommonModule,
        ReactiveFormsModule,
        ButtonModule,
        InputTextModule,
        InputNumberModule,
        SelectModule,
        FileUploadModule,
        ToastModule,
        CardModule,
        DividerModule,
        IconFieldModule,
        InputIconModule,
        FormsModule
    ],
    templateUrl: './public-application-form.component.html',
    styleUrls: ['./public-application-form.component.scss'],
    providers: [MessageService, DatePipe]
})
export class PublicApplicationFormComponent implements OnInit {
    private fb = inject(FormBuilder);
    private publicAppService = inject(PublicApplicationService);
    private messageService = inject(MessageService);
    private router = inject(Router);
    private datePipe = inject(DatePipe);
    zones = signal<{ label: string; value: string }[]>([]);
    districts = signal<{ label: string; value: string }[]>([]);
    subdistricts = signal<{ label: string; value: string }[]>([]);
    localBodies = signal<{ label: string; value: string }[]>([]);
    wards = signal<{ label: string; value: string; fullPath?: string }[]>([]);
    private pipelineService = inject(PipelineService);
    loadingZones = signal(false);
    loadingDistricts = signal(false);
    loadingSubdistricts = signal(false);
    loadingLocalBodies = signal(false);
    loadingWards = signal(false);
    form!: FormGroup;

    loadingJobs = signal(false);
    submitting = signal(false);
    uploadingResume = signal(false);
    uploadingIdCard = signal(false);

    jobs = signal<PublicJobOption[]>([]);
    selectedJobId = signal<Id<'job_postings'> | null>(null);

    resumeId = signal<Id<'_storage'> | null>(null);
    idCardId = signal<Id<'_storage'> | null>(null);

    showForm = computed(() => !!this.selectedJobId());

    employmentTypeLabel = (type: string) => {
        const map: Record<string, string> = {
            full_time: 'Full-time',
            part_time: 'Part-time',
            contract: 'Contract'
        };
        return map[type] || type;
    };

    selectedJob = computed(
        () => this.jobs().find((j) => j._id === this.selectedJobId()) || null
    );

    minDate = new Date(); // for display only if needed

    async ngOnInit() {
        this.initForm();
        await this.loadJobs();
        await this.loadZones();
    }

    initForm() {
        this.form = this.fb.group({
            jobPostingId: [null, Validators.required],

            name: ['', [Validators.required, Validators.minLength(3)]],
            email: ['', [Validators.required, Validators.email]],
            phone: ['', [Validators.required, Validators.minLength(7)]],
            experience: [0, [Validators.required, Validators.min(0)]],

            zone: [''],
            district: [''],
            subdistrict: [''],
            localBodyName: [''],
            localBodyType: [''],
            wardId: ['', Validators.required],
            wardName: ['']
        });
    }

    async loadJobs() {
        this.loadingJobs.set(true);
        try {
            // If multi-tenant, youâ€™ll pass the rootId here; for now assume single-tenant
            // Replace 'default-root' with actual rootId if needed
            const result = await this.publicAppService.listPublicJobs();

            this.jobs.set(result as PublicJobOption[]);
        } catch (error: any) {
            this.messageService.add({
                severity: 'error',
                summary: 'Error',
                detail: error.message || 'Failed to load jobs'
            });
        } finally {
            this.loadingJobs.set(false);
        }
    }

    onJobChange(jobId: Id<'job_postings'> | null) {
        this.selectedJobId.set(jobId);
        this.form.patchValue({ jobPostingId: jobId });
    }

    formatDeadline(deadline: number | null | undefined): string {
        if (!deadline) return '';
        return this.datePipe.transform(deadline, 'dd/MM/yyyy') || '';
    }

    // =======================
    // File upload handlers
    // =======================

    async onFileSelect(event: any, type: PublicFileType) {
        const file: File | undefined = event.files?.[0];
        if (!file) return;

        const loadingSignal =
            type === 'resume' ? this.uploadingResume : this.uploadingIdCard;
        loadingSignal.set(true);

        try {
            const storageId = await this.publicAppService.uploadFile(file);
            if (type === 'resume') {
                this.resumeId.set(storageId);
            } else {
                this.idCardId.set(storageId);
            }

            this.messageService.add({
                severity: 'success',
                summary: 'Uploaded',
                detail: `${type === 'resume' ? 'Resume' : 'ID card'} uploaded successfully`
            });
        } catch (error: any) {
            this.messageService.add({
                severity: 'error',
                summary: 'Upload Failed',
                detail: error.message || 'Could not upload file'
            });
        } finally {
            loadingSignal.set(false);
        }
    }

    // =======================
    // Submit
    // =======================

    async onSubmit() {
        if (!this.form.valid) {
            this.form.markAllAsTouched();
            this.messageService.add({
                severity: 'warn',
                summary: 'Validation',
                detail: 'Please fill all required fields correctly'
            });
            return;
        }

        const jobId = this.selectedJobId();
        if (!jobId) {
            this.messageService.add({
                severity: 'warn',
                summary: 'No Job',
                detail: 'Please select a job to apply for'
            });
            return;
        }

        const resume = this.resumeId();
        const idCard = this.idCardId();

        if (!resume || !idCard) {
            this.messageService.add({
                severity: 'warn',
                summary: 'Files Required',
                detail: 'Please upload both resume and ID card'
            });
            return;
        }

        this.submitting.set(true);

        try {
            const value = this.form.value;

            await this.publicAppService.submitApplication({
                jobPostingId: jobId,
                name: value.name,
                email: value.email,
                phone: value.phone,
                experience: value.experience,

                zone: value.zone || null,
                district: value.district || null,
                subdistrict: value.subdistrict || null,
                localBodyName: value.localBodyName || null,
                localBodyType: value.localBodyType || null,
                wardId: value.wardId || null,
                wardName: value.wardName || null,

                resumeId: resume,
                idCardId: idCard,
                source: 'public_form'
            });

            this.messageService.add({
                severity: 'success',
                summary: 'Application submitted',
                detail: 'Thank you for applying. Your application has been received.'
            });

            this.form.reset();
            this.selectedJobId.set(null);
            this.resumeId.set(null);
            this.idCardId.set(null);
        } catch (error: any) {
            this.messageService.add({
                severity: 'error',
                summary: 'Submission Failed',
                detail: error.message || 'Could not submit application'
            });
        } finally {
            this.submitting.set(false);
        }
    }

    async loadZones() {
        this.loadingZones.set(true);
        try {
            const res = await this.pipelineService.getZones();
            this.zones.set(res);
            // res is string[]
        } catch (e) {
            console.error('Failed to load zones', e);
        } finally {
            this.loadingZones.set(false);
        }
    }

    async loadDistricts() {
        this.loadingDistricts.set(true);
        try {
            const zone = this.form.value.zone || undefined;
            const res = await this.pipelineService.getDistricts(zone);
            this.districts.set(res);
        } catch (e) {
            console.error('Failed to load districts', e);
        } finally {
            this.loadingDistricts.set(false);
        }
    }

    async loadSubdistricts() {
        this.loadingSubdistricts.set(true);
        try {
            const zone = this.form.value.zone || undefined;
            const district = this.form.value.district || undefined;
            const res = await this.pipelineService.getSubdistricts(
                zone,
                district
            );
            this.subdistricts.set(res);
        } catch (e) {
            console.error('Failed to load subdistricts', e);
        } finally {
            this.loadingSubdistricts.set(false);
        }
    }

    async loadLocalBodies() {
        this.loadingLocalBodies.set(true);
        try {
            const zone = this.form.value.zone || undefined;
            const district = this.form.value.district || undefined;
            const subdistrict = this.form.value.subdistrict || undefined;
            const res = await this.pipelineService.getLocalBodies(
                zone,
                district,
                subdistrict
            );
            this.localBodies.set(res);
        } catch (e) {
            console.error('Failed to load local bodies', e);
        } finally {
            this.loadingLocalBodies.set(false);
        }
    }

    async loadWards() {
        this.loadingWards.set(true);
        try {
            const zone = this.form.value.zone || undefined;
            const district = this.form.value.district || undefined;
            const subdistrict = this.form.value.subdistrict || undefined;
            const localBodyName = this.form.value.localBodyName || undefined;
            const res = await this.pipelineService.getWards(
                zone,
                district,
                subdistrict,
                localBodyName
            );
            this.wards.set(res);
        } catch (e) {
            console.error('Failed to load wards', e);
        } finally {
            this.loadingWards.set(false);
        }
    }

    // Change handlers
    onZoneChange(event: any) {
        this.form.patchValue({
            zone: event.value,
            district: null,
            subdistrict: null,
            localBodyName: null,
            localBodyType: null,
            wardId: null,
            wardName: null
        });
        this.districts.set([]);
        this.subdistricts.set([]);
        this.localBodies.set([]);
        this.wards.set([]);
        this.loadDistricts();
    }

    onDistrictChange(event: any) {
        this.form.patchValue({
            district: event.value,
            subdistrict: null,
            localBodyName: null,
            localBodyType: null,
            wardId: null,
            wardName: null
        });
        this.subdistricts.set([]);
        this.localBodies.set([]);
        this.wards.set([]);
        this.loadSubdistricts();
    }

    onSubdistrictChange(event: any) {
        this.form.patchValue({
            subdistrict: event.value,
            localBodyName: null,
            localBodyType: null,
            wardId: null,
            wardName: null
        });
        this.localBodies.set([]);
        this.wards.set([]);
        this.loadLocalBodies();
    }

    onLocalBodyChange(event: any) {
        this.form.patchValue({
            localBodyName: event.value,
            wardId: null,
            wardName: null
        });
        this.wards.set([]);
        this.loadWards();
    }

    onWardChange(event: any) {
        const selected = this.wards().find((w) => w.value === event.value);
        this.form.patchValue({
            wardId: event.value,
            wardName: selected?.label || null
        });
    }
}
</file>

<file path="src/app/features/hr-recruitment/public/services/public-application.service.ts">
import { Injectable, inject } from '@angular/core';
import { ConvexService } from 'src/app/core/services/convex.service';
import { api } from 'convex/_generated/api';
import { Id } from 'convex/_generated/dataModel';

export type PublicFileType = 'resume' | 'idCard';

export interface PublicApplicationPayload {
  jobPostingId: Id<'job_postings'>;

  name: string;
  email: string;
  phone: string;
  experience: number;

  // Location
  zone?: string | null;
  district?: string | null;
  subdistrict?: string | null;
  localBodyName?: string | null;
  localBodyType?: string | null;
  wardId?: string | null;
  wardName?: string | null;

  // Files
  resumeId: Id<'_storage'>;
  idCardId: Id<'_storage'>;

  source?: string | null;
}

@Injectable({ providedIn: 'root' })
export class PublicApplicationService {
  private convex = inject(ConvexService);


async listPublicJobs() {
  return this.convex.client.query(api.hr.jobs.listActiveJobs, {});
}

  /**
   * Upload a single file (resume or ID card) to Convex storage.
   * Returns the storageId to be passed into submitPublicApplication.
   */
async uploadFile(file: File): Promise<Id<'_storage'>> {
  // Reuse the same logic as training upload
  const uploadUrl = await this.convex.client.mutation(api.files.generateUploadUrl, {});

  const response = await fetch(uploadUrl, {
    method: 'POST',
    headers: { 'Content-Type': file.type },
    body: file,
  });

  if (!response.ok) {
    throw new Error(`Upload failed: ${response.statusText}`);
  }

  const { storageId } = await response.json();
  return storageId as Id<'_storage'>;
}


  /**
   * Submit a public application for a given job.
   * Assumes files are already uploaded and you have their storage IDs.
   */
  async submitApplication(payload: PublicApplicationPayload) {
    const {
      jobPostingId,
      name,
      email,
      phone,
      experience,
      zone,
      district,
      subdistrict,
      localBodyName,
      localBodyType,
      wardId,
      wardName,
      resumeId,
      idCardId,
      source,
    } = payload;

    return this.convex.client.mutation(
      api.hr.applications.submitPublicApplication,
      {
        jobPostingId,
        name,
        email,
        phone,
        experience,
        zone: zone || undefined,
        district: district || undefined,
        subdistrict: subdistrict || undefined,
        localBodyName: localBodyName || undefined,
        localBodyType: localBodyType || undefined,
        wardId: wardId || undefined,
        wardName: wardName || undefined,
        resumeId,
        idCardId,
        source: source || 'public_form',
      }
    );
  }

  /**
   * (Optional but useful) Fetch minimal job info to show on the public form
   * like title, location, and deadline.
   */
  async getJobSummary(jobPostingId: Id<'job_postings'>) {
    // If you already have a lightweight getJob query, use it here.
    // Otherwise, you can create a minimal one; for now we call existing jobs.getJob.
    return this.convex.client.query(api.hr.jobs.getJob, { jobId: jobPostingId });
  }
}
</file>

<file path="src/app/features/hr-recruitment/services/applications-filter.service.ts">
import { ConvexService } from "@/core/services/convex.service";
import { inject, signal, computed, DestroyRef, effect, Injectable } from "@angular/core";
import { toSignal } from "@angular/core/rxjs-interop";
import { api } from "convex/_generated/api";
import { JobApplication, ApplicationFilters, ApplicationStats, ApplicationsResponse } from "../interfaces/application.interface";
import { WardsService } from "./wards.service";

@Injectable({
  providedIn: 'root'
})
export class ApplicationsFilterService {
  private readonly convex = inject(ConvexService);
  private readonly wardsService = inject(WardsService);
  private readonly destroyRef = inject(DestroyRef);
  
  private readonly _rootId = signal<string>('');
  private readonly _applications = signal<ApplicationsResponse>({ items: [], total: 0 });
  private readonly _isLoading = signal(false);

  // âœ… Filter signals
  readonly jobPostingId = signal<string | null>(null);
  readonly status = signal<JobApplication['status'] | null>(null);
  readonly searchQuery = signal<string | null>(null);
  readonly dateFrom = signal<number | null>(null);
  readonly dateTo = signal<number | null>(null);

  // âœ… Pagination signals
  readonly currentPage = signal(0);
  readonly pageSize = signal(100);

  readonly isLoading = this._isLoading.asReadonly();
  readonly applications = this._applications.asReadonly();

  // âœ… Computed: Combined filters for Convex query
  private readonly activeFilters = computed((): ApplicationFilters => ({
    ...this.wardsService.getFilterState(),
    jobPostingId: this.jobPostingId(),
    status: this.status(),
    searchQuery: this.searchQuery(),
    dateFrom: this.dateFrom(),
    dateTo: this.dateTo(),
  }));

  // âœ… Auto-fetch when filters change
  constructor() {
    effect(() => {
      // Track filter changes
      const filters = this.activeFilters();
      const page = this.currentPage();
      const pageSize = this.pageSize();
      
      // Trigger fetch
      this.fetchApplications();
    });
  }

  /**
   * Fetch applications using client.query()
   */
  private async fetchApplications(): Promise<void> {
    const rootId = this._rootId();
    if (!rootId) return;

    this._isLoading.set(true);

    try {
      // âœ… Use client.query() - returns Promise<ApplicationsResponse>
      const result = await this.convex.client.query(
        api.applications.listFiltered,
        {
          rootId,
          filters: this.activeFilters(),
          pagination: {
            page: this.currentPage(),
            pageSize: this.pageSize(),
          }
        }
      );

      this._applications.set(result);
    } catch (error) {
      console.error('Failed to fetch applications:', error);
      this._applications.set({ items: [], total: 0 });
    } finally {
      this._isLoading.set(false);
    }
  }

  // âœ… Computed: Statistics
  readonly stats = computed((): ApplicationStats => {
    const apps = this.applications().items;
    
    const byStatus = apps.reduce((acc, app) => {
      acc[app.status] = (acc[app.status] || 0) + 1;
      return acc;
    }, {} as Record<string, number>);

    const byZone = apps.reduce((acc, app) => {
      if (app.zone) acc[app.zone] = (acc[app.zone] || 0) + 1;
      return acc;
    }, {} as Record<string, number>);

    const byDistrict = apps.reduce((acc, app) => {
      if (app.district) acc[app.district] = (acc[app.district] || 0) + 1;
      return acc;
    }, {} as Record<string, number>);

    const selected = byStatus['selected'] || 0;
    const total = apps.length;
    const conversionRate = total > 0 ? (selected / total) * 100 : 0;

    return {
      totalApplications: this.applications().total,
      byStatus,
      byZone,
      byDistrict,
      conversionRate,
    };
  });

  // âœ… Computed: Has active filters
  readonly hasActiveFilters = computed(() => {
    const filters = this.activeFilters();
    return !!(
      filters.zone ||
      filters.district ||
      filters.jobPostingId ||
      filters.status ||
      filters.searchQuery
    );
  });

  /**
   * Set rootId from auth context
   */
  setRootId(rootId: string): void {
    this._rootId.set(rootId);
  }

  /**
   * Clear all filters
   */
  clearAllFilters(): void {
    this.jobPostingId.set(null);
    this.status.set(null);
    this.searchQuery.set(null);
    this.dateFrom.set(null);
    this.dateTo.set(null);
    this.wardsService.clearFilters();
    this.currentPage.set(0);
  }

  /**
   * Refresh applications data
   */
  async refresh(): Promise<void> {
    await this.fetchApplications();
  }

  /**
   * Bulk update application status
   */
  async bulkUpdateStatus(
    applicationIds: string[],
    newStatus: JobApplication['status']
  ): Promise<void> {
    // âœ… Use client.mutation()
    await this.convex.client.mutation(
      api.applications.bulkUpdateStatus,
      { applicationIds, status: newStatus }
    );
    
    // Refresh after mutation
    await this.refresh();
  }

  /**
   * Export filtered applications to CSV
   */
  async exportToCSV(): Promise<Blob> {
    // âœ… Use client.query() for export
    const data = await this.convex.client.query(
      api.applications.exportFiltered,
      {
        rootId: this._rootId(),
        filters: this.activeFilters(),
      }
    );

    // Convert to CSV
    const headers = [
      'Name', 'Email', 'Phone', 'Job Title', 'Status', 
      'Zone', 'District', 'Subdistrict', 'Local Body', 'Ward',
      'Experience', 'Applied Date'
    ].join(',');

    const rows = data.map((app: JobApplication) => [
      app.name,
      app.email,
      app.phone,
      app.jobPostingId, // You'll need to resolve job title
      app.status,
      app.zone || '',
      app.district || '',
      app.subdistrict || '',
      app.localBodyName || '',
      app.wardName || '',
      app.experience,
      new Date(app.createdAt).toLocaleDateString(),
    ].join(','));

    const csv = [headers, ...rows].join('\n');
    return new Blob([csv], { type: 'text/csv' });
  }

  /**
   * Navigate pagination
   */
  nextPage(): void {
    const total = this.applications().total;
    const maxPage = Math.ceil(total / this.pageSize()) - 1;
    if (this.currentPage() < maxPage) {
      this.currentPage.update(p => p + 1);
    }
  }

  previousPage(): void {
    if (this.currentPage() > 0) {
      this.currentPage.update(p => p - 1);
    }
  }

  goToPage(page: number): void {
    this.currentPage.set(Math.max(0, page));
  }
}
</file>

<file path="src/app/features/hr-recruitment/services/google-sheets-sync.service.ts">
import { ConvexService } from "@/core/services/convex.service";
import { inject, signal, computed, DestroyRef } from "@angular/core";
import { toSignal } from "@angular/core/rxjs-interop";
import { api } from "convex/_generated/api";
import { catchError, from, interval, of, startWith, switchMap } from "rxjs";
import { ManualSyncResult, SyncState } from "../interfaces/google-sheet.interface";

export class GoogleSheetsSyncService {
  private readonly convex = inject(ConvexService);
  private readonly destroyRef = inject(DestroyRef);

  // âœ… Signals for reactive state
  private readonly _rootId = signal<string>('');
  private readonly _pollingEnabled = signal(false);
  private readonly _syncStateData = signal<SyncState | null>(null);

  // âœ… Use ConvexClient.query() in an Observable stream
  private readonly syncStateQuery$ = interval(5000).pipe(
    startWith(0),
    switchMap(() => {
      const rootId = this._rootId();
      if (!rootId || !this._pollingEnabled()) return of(null);
      
      // âœ… Use client.query() - returns Promise
      return from(
        this.convex.client.query(
          api.integrations.googleSheets.getSyncStatusPublic,
          { rootId }
        )
      ).pipe(
        catchError(err => {
          console.error('Sync state query error:', err);
          return of(null);
        })
      );
    })
  );

  // âœ… Convert Observable to Signal
  readonly syncState = toSignal(this.syncStateQuery$, { 
    initialValue: null 
  });

  // âœ… Computed signals for derived state
  readonly isSyncing = computed(() => 
    this.syncState()?.status === 'syncing'
  );

  readonly hasErrors = computed(() => 
    this.syncState()?.status === 'failed'
  );

  readonly syncProgress = computed(() => {
    const state = this.syncState();
    if (!state) return 0;
    const total = state.totalSynced + state.totalFailed;
    return total > 0 ? (state.totalSynced / total) * 100 : 0;
  });

  readonly lastSyncFormatted = computed(() => {
    const state = this.syncState();
    if (!state?.lastSyncTime) return 'Never';
    
    const date = new Date(state.lastSyncTime);
    const now = Date.now();
    const diff = now - state.lastSyncTime;
    
    if (diff < 60000) return 'Just now';
    if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;
    if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;
    return date.toLocaleDateString();
  });

  /**
   * Initialize service with rootId from auth context
   */
  setRootId(rootId: string): void {
    this._rootId.set(rootId);
  }

  /**
   * Enable/disable auto-refresh polling
   */
  enablePolling(enabled: boolean): void {
    this._pollingEnabled.set(enabled);
  }

  /**
   * Trigger manual sync
   */
  async triggerManualSync(
    spreadsheetId: string,
    force = false
  ): Promise<ManualSyncResult> {
    const rootId = this._rootId();
    if (!rootId) {
      throw new Error('RootId not set. Call setRootId() first.');
    }

    // âœ… Use client.mutation() - returns Promise
    return await this.convex.client.mutation(
      api.integrations.googleSheets.triggerManualSync,
      { spreadsheetId, rootId, force }
    );
  }

  /**
   * Force full resync (starts from row 2)
   */
  async forceFullResync(spreadsheetId: string): Promise<ManualSyncResult> {
    return this.triggerManualSync(spreadsheetId, true);
  }

  /**
   * Get import statistics (one-time query)
   */
  async getImportStats(): Promise<{
    totalApplications: number;
    lastImportDate: Date | null;
    errorCount: number;
  }> {
    const state = this.syncState();
    
    return {
      totalApplications: state?.totalSynced || 0,
      lastImportDate: state?.lastSyncTime ? new Date(state.lastSyncTime) : null,
      errorCount: state?.totalFailed || 0,
    };
  }
}
</file>

<file path="src/app/features/hr-recruitment/services/wards.service.ts">
import { ConvexService } from "../../../core/services/convex.service";
import { inject, signal, Injectable } from "@angular/core";
import { api } from "convex/_generated/api";



export interface LocationFilterState {
  zone: string | null;
  district: string | null;
  subdistrict: string | null;
  localBodyType: 'P' | 'M' | 'C' | null;
  localBodyName: string | null;
  wardId: string | null;
}

interface OptionItem {
  value: string;
  label: string;
}

@Injectable({
  providedIn: 'root'
})
export class WardsService {
  private readonly convex = inject(ConvexService);
  
  // âœ… No need to store all wards - use backend queries directly
  private readonly _rootId = signal<string>('');

  // âœ… Filter state signals (cascading behavior)
  readonly selectedZone = signal<string | null>(null);
  readonly selectedDistrict = signal<string | null>(null);
  readonly selectedSubdistrict = signal<string | null>(null);
  readonly selectedLocalBodyType = signal<'P' | 'M' | 'C' | null>(null);
  readonly selectedLocalBodyName = signal<string | null>(null);
  readonly selectedWardId = signal<string | null>(null);

  /**
   * Set rootId from auth context
   */
  setRootId(rootId: string): void {
    this._rootId.set(rootId);
  }

  /**
   * Get zones (hardcoded for performance)
   */
  async getZones(): Promise<OptionItem[]> {
    return await this.convex.client.query(api.wards.getZones, {});
  }

  /**
   * Get districts for selected zone
   */
  async getDistricts(zone?: string): Promise<OptionItem[]> {
    return await this.convex.client.query(api.wards.getDistricts, {
      zone: zone || undefined
    });
  }

  /**
   * Get subdistricts
   */
  async getSubdistricts(zone?: string, district?: string): Promise<OptionItem[]> {
    return await this.convex.client.query(api.wards.getSubdistricts, {
      zone: zone || undefined,
      district: district || undefined
    });
  }

  /**
   * Get local body types (P/M/C)
   */
  async getLocalBodyTypes(): Promise<OptionItem[]> {
    return await this.convex.client.query(api.wards.getLocalBodyTypes, {});
  }

  /**
   * Get local bodies
   */
  async getLocalBodies(
    zone?: string,
    district?: string,
    subdistrict?: string,
    localBodyType?: string
  ): Promise<OptionItem[]> {
    return await this.convex.client.query(api.wards.getLocalBodies, {
      zone: zone || undefined,
      district: district || undefined,
      subdistrict: subdistrict || undefined,
      localBodyType: localBodyType || undefined
    });
  }

  /**
   * Get wards (with limit for performance)
   */
  async getWards(
    zone?: string,
    district?: string,
    subdistrict?: string,
    localBodyName?: string,
    limit: number = 500
  ): Promise<OptionItem[]> {
    return await this.convex.client.query(api.wards.getWards, {
      zone: zone || undefined,
      district: district || undefined,
      subdistrict: subdistrict || undefined,
      localBodyName: localBodyName || undefined,
      limit
    });
  }

  /**
   * Get current filter state as object
   */
  getFilterState(): LocationFilterState {
    return {
      zone: this.selectedZone(),
      district: this.selectedDistrict(),
      subdistrict: this.selectedSubdistrict(),
      localBodyType: this.selectedLocalBodyType(),
      localBodyName: this.selectedLocalBodyName(),
      wardId: this.selectedWardId(),
    };
  }

  /**
   * Clear all filters
   */
  clearFilters(): void {
    this.selectedZone.set(null);
    this.selectedDistrict.set(null);
    this.selectedSubdistrict.set(null);
    this.selectedLocalBodyType.set(null);
    this.selectedLocalBodyName.set(null);
    this.selectedWardId.set(null);
  }

  /**
   * Validate ward selection (useful for form submission)
   */
  isValidWardSelection(): boolean {
    return !!(
      this.selectedZone() &&
      this.selectedDistrict() &&
      this.selectedSubdistrict() &&
      this.selectedLocalBodyName() &&
      this.selectedWardId()
    );
  }
}
</file>

<file path="src/app/features/settings/certificate-template/certificate-template.component.html">
<p-toast></p-toast>
<div class="card">
    <h2 class="text-2xl font-semibold mb-4">Manage Certificate Template</h2>
    <p class="text-surface-500 mb-6">
        Upload the single "blanket" PDF template that will be issued for all course completions.
    </p>

    <div class="border rounded-lg p-4">
        @if (currentTemplate$ | async; as template) {
            <h3 class="font-semibold text-lg mb-4">Current Template</h3>
            <div class="flex items-center">
                <i class="pi pi-file-pdf text-4xl text-red-500 mr-4"></i>
                <div>
                    <div class="font-semibold">{{ template.fileName }}</div>
                    <div class="text-sm text-surface-500">Uploaded on: {{ template.uploadDate | date:'longDate' }}</div>
                </div>
            </div>
        } @else {
            <div class="text-center p-4">
                <p class="text-surface-500">No certificate template is currently saved.</p>
            </div>
        }
    </div>

    <div class="mt-6">
        <h3 class="font-semibold text-lg mb-4">Upload and Preview New Template</h3>
        <p-fileUpload 
            name="certificate" 
            accept="application/pdf" 
            [multiple]="false" 
            [customUpload]="true"
            (onSelect)="onSelect($event)"
            [showUploadButton]="false" 
            [showCancelButton]="false"
            chooseLabel="Select PDF to Preview">
        </p-fileUpload>
    </div>
</div>

@if (showPreview && previewUrl) {
    <div class="card mt-4">
        <div class="flex justify-between items-center mb-4">
            <h3 class="font-semibold text-lg">New Template Preview</h3>
            <div class="flex gap-2">
                <p-button label="Cancel" icon="pi pi-times" styleClass="p-button-secondary" (click)="closePreview()"></p-button>
                <p-button label="Confirm Upload" icon="pi pi-check" (click)="confirmUpload()"></p-button>
            </div>
        </div>
        <iframe [src]="previewUrl" width="100%" height="700px" style="border: 1px solid var(--surface-border);"></iframe>
    </div>
}
</file>

<file path="src/app/features/settings/certificate-template/certificate-template.component.ts">
import { Component } from '@angular/core';
import { CommonModule } from '@angular/common';
import { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';
import { MessageService } from 'primeng/api';
import { CardModule } from 'primeng/card';
import { ButtonModule } from 'primeng/button';
import { FileUploadModule } from 'primeng/fileupload';
import { ToastModule } from 'primeng/toast';
import { CertificateService } from '../services/certificate.service';
import { CertificateTemplate } from '../types/certificate.types';
import { Observable } from 'rxjs';

@Component({
    selector: 'app-certificate-template',
    standalone: true,
    imports: [CommonModule, CardModule, ButtonModule, FileUploadModule, ToastModule],
    providers: [MessageService],
    templateUrl: './certificate-template.component.html'
})
export class CertificateTemplateComponent {
    
    currentTemplate$: Observable<CertificateTemplate | null>;
    showPreview = false;
    previewUrl: SafeResourceUrl | null = null;

    constructor(
        private certificateService: CertificateService,
        private messageService: MessageService,
        private sanitizer: DomSanitizer
    ) {
        this.currentTemplate$ = this.certificateService.getCurrentTemplate();
    }

    // This method is now triggered when a file is SELECTED
    onSelect(event: { files: File[] }) {
        const file = event.files[0];
        if (file && file.type === 'application/pdf') {
            const reader = new FileReader();
            reader.onload = (e: any) => {
                // Read the file as a Base64 data URL and sanitize it
                this.previewUrl = this.sanitizer.bypassSecurityTrustResourceUrl(e.target.result);
                this.showPreview = true;
            };
            reader.readAsDataURL(file);
        } else {
            this.messageService.add({ 
                severity: 'error', 
                summary: 'Invalid File', 
                detail: 'Please select a PDF file.' 
            });
        }
    }

    // This method would be called by a new "Confirm Upload" button
    confirmUpload() {
        // Here you would take the selected file and send it to your service
        console.log('Confirming upload...');
        this.messageService.add({ 
            severity: 'success', 
            summary: 'Success', 
            detail: 'New template has been saved.' 
        });
        this.closePreview();
    }

    closePreview() {
        this.showPreview = false;
        this.previewUrl = null;
    }
}
</file>

<file path="src/app/features/settings/services/certificate.service.ts">
// src/app/features/settings/services/certificate.service.ts

import { Injectable } from '@angular/core';
import { CertificateTemplate } from '../types/certificate.types';
import { BehaviorSubject, Observable } from 'rxjs';

@Injectable({
    providedIn: 'root'
})
export class CertificateService {

    // Use a BehaviorSubject to hold the state of the current template
    private _currentTemplate = new BehaviorSubject<CertificateTemplate | null>(null);
    currentTemplate$ = this._currentTemplate.asObservable();

    constructor() {
        // Initialize with some mock data for the current template
        this._currentTemplate.next({
            id: 'cert-main-01',
            fileName: 'Apollo_Completion_Certificate_v1.pdf',
            uploadDate: new Date().toISOString(),
            fileUrl: '/path/to/mock/certificate.pdf'
        });
    }

    getCurrentTemplate(): Observable<CertificateTemplate | null> {
        return this.currentTemplate$;
    }

    // Simulates uploading a new file and replacing the old one
    uploadNewTemplate(file: File): Promise<CertificateTemplate> {
        const newTemplate: CertificateTemplate = {
            id: 'cert-main-01', // ID is constant since we're replacing
            fileName: file.name,
            uploadDate: new Date().toISOString(),
            fileUrl: URL.createObjectURL(file) // Create a temporary local URL for preview
        };

        this._currentTemplate.next(newTemplate);
        console.log('Uploaded new certificate template:', newTemplate);
        return Promise.resolve(newTemplate);
    }
}
</file>

<file path="src/app/features/settings/services/task-category.service.ts">
// src/app/features/settings/services/task-category.service.ts

import { Injectable } from '@angular/core';

export interface TaskCategory {
  id?: string;
  name: string;
  description?: string;
  color: string;
}

@Injectable({
  providedIn: 'root'
})
export class TaskCategoryService {
  private _categories: TaskCategory[] = [
    { id: 'cat-1', name: 'Site Visit', description: 'Tasks related to on-site executive visits.', color: '#42A5F5' },
    { id: 'cat-2', name: 'Client Meeting', description: 'All tasks involving client-facing meetings.', color: '#66BB6A' },
    { id: 'cat-3', name: 'Report Submission', description: 'Includes daily, weekly, and monthly reports.', color: '#FFA726' },
    { id: 'cat-4', name: 'Internal Training', description: 'Tasks for completing training modules.', color: '#AB47BC' }
  ];

  getCategories(): Promise<TaskCategory[]> {
    return Promise.resolve(this._categories);
  }

  addCategory(category: TaskCategory): Promise<TaskCategory> {
    category.id = 'cat-' + Math.random().toString(36).substring(2, 9);
    this._categories.push(category);
    return Promise.resolve(category);
  }

  updateCategory(updatedCategory: TaskCategory): Promise<TaskCategory> {
    const index = this._categories.findIndex(c => c.id === updatedCategory.id);
    if (index > -1) {
      this._categories[index] = updatedCategory;
    }
    return Promise.resolve(updatedCategory);
  }

  deleteCategory(id: string): Promise<void> {
    this._categories = this._categories.filter(c => c.id !== id);
    return Promise.resolve();
  }
}
</file>

<file path="src/app/features/settings/services/task.service.ts">
// src/app/features/tasks/services/task.service.ts

import { Injectable } from '@angular/core';
import { ConvexService } from '@/core/services/convex.service';
import { Id } from 'convex/_generated/dataModel';
import { api } from 'convex/_generated/api';

// ============================================================================
// TYPE DEFINITIONS
// ============================================================================

export type TaskStatus = 'pending' | 'in_progress' | 'overdue' | 'completed';
export type ExecutiveTaskStatus = 'in_progress' | 'completed';
export type AdminTaskStatus =
    | 'pending'
    | 'in_progress'
    | 'overdue'
    | 'completed';
export type TaskPriority = 'low' | 'medium' | 'high' | 'urgent';
export interface MyTaskStats {
    total: number;
    pending: number;
    inProgress: number;
    completed: number;
    overdue: number;
    thisWeek: number;
    completionRate: number;
}

// âœ… Keep the full TaskStats
export interface TaskStats {
    total: number;
    pending: number;
    inProgress: number;
    completed: number;
    overdue: number;
    urgent: number;
    high: number;
    medium: number;
    low: number;
    completionRate: number;
}

export interface Task {
    _id: Id<'tasks'>;
    title: string;
    description: string;
    status: TaskStatus;
    priority: TaskPriority;
    assignedTo: Id<'executives'>;
    assignedBy: Id<'admin_users'>;
    dueDate: number;
    completedAt?: number;
    hierarchyId: Id<'hierarchies'>;
    rootId: Id<'hierarchies'>;
    isDeleted: boolean;
    createdAt: number;
    _creationTime: number;
}

export interface EnrichedTask extends Task {
    executiveName: string;
    executiveEmployeeId: string;
    executivePhone?: string;
    assignerName: string;
    isOverdue: boolean;
}

export interface DashboardTaskStats {
    total: number;
    pending: number;
    inProgress: number;
    completed: number;
    overdue: number;
    completionRate: number;
}

export interface TaskStats {
    total: number;
    pending: number;
    inProgress: number;
    completed: number;
    overdue: number;
    urgent: number;
    high: number;
    medium: number;
    low: number;
    completionRate: number;
}

export interface TopPerformer {
    _id: Id<'executives'>;
    name: string;
    employeeId: string;
    email: string;
    totalTasks: number;
    completedTasks: number;
    completionRate: number;
}

export interface DashboardSummary {
    taskStats: DashboardTaskStats;
    topPerformers: TopPerformer[];
    recentActivity: Array<{
        _id: Id<'tasks'>;
        title: string;
        status: TaskStatus;
        priority: TaskPriority;
        dueDate: number;
        createdAt: number;
    }>;
    totalExecutives: number;
    activeExecutives: number;
}

export interface CreateTaskData {
    title: string;
    description: string;
    priority: TaskPriority;
    assignedTo: Id<'executives'>;
    dueDate: number;
    estimatedHours: number;
    wardId: string;
    location?: {
        latitude: number;
        longitude: number;
        address: string;
    };
    notes?: string;
    type: 'verification' | 'survey' | 'collection' | 'other';
}

export interface UpdateTaskData {
    title?: string;
    description?: string;
    status?: AdminTaskStatus;
    priority?: TaskPriority;
    dueDate?: number;
    estimatedHours?: number;
    notes?: string;
}

// ============================================================================
// TASK SERVICE
// ============================================================================

@Injectable({
    providedIn: 'root'
})
export class TaskService {
    private get convex() {
        return this.convexService.client;
    }

    constructor(private convexService: ConvexService) {}

    // ============================================================================
    // ADMIN TASK QUERIES
    // ============================================================================

    listTasks(
        paginationOpts: any,
        filters?: {
            status?: TaskStatus;
            priority?: TaskPriority;
            assignedTo?: Id<'executives'>;
            search?: string;
        }
    ) {
        return this.convex.query(api.tasks.admin.queries.listTasks, {
            paginationOpts,
            ...filters
        });
    }

    getTask(taskId: Id<'tasks'>) {
        return this.convex.query(api.tasks.admin.queries.getTask, { taskId });
    }

    getExecutiveTasks(
        executiveId: Id<'executives'>,
        startDate?: number,
        endDate?: number
    ) {
        return this.convex.query(api.tasks.admin.queries.getExecutiveTasks, {
            executiveId,
            startDate,
            endDate
        });
    }

    getTaskStats(): Promise<TaskStats> {
        return this.convex.query(api.tasks.admin.queries.getTaskStats, {});
    }

    getRecentActivity(limit?: number) {
        return this.convex.query(api.tasks.admin.queries.getRecentActivity, {
            limit
        });
    }

    getDashboardSummary(): Promise<DashboardSummary> {
        return this.convex.query(
            api.tasks.admin.queries.getDashboardSummary,
            {}
        );
    }

    async getTopPerformers(): Promise<TopPerformer[]> {
        const dashboard = await this.getDashboardSummary();
        return dashboard.topPerformers;
    }

    // ============================================================================
    // ADMIN TASK MUTATIONS
    // ============================================================================

    createTask(taskData: CreateTaskData) {
        return this.convex.mutation(
            api.tasks.admin.mutation.createTask,
            taskData
        );
    }

    updateTask(taskId: Id<'tasks'>, updates: UpdateTaskData) {
        return this.convex.mutation(api.tasks.admin.mutation.updateTask, {
            taskId,
            ...updates
        });
    }

    deleteTask(taskId: Id<'tasks'>) {
        return this.convex.mutation(api.tasks.admin.mutation.deleteTask, {
            taskId
        });
    }

    reassignTask(taskId: Id<'tasks'>, newExecutiveId: Id<'executives'>) {
        return this.convex.mutation(api.tasks.admin.mutation.reassignTask, {
            taskId,
            newExecutiveId
        });
    }

    // ============================================================================
    // MY TASKS (For executives)
    // ============================================================================

    getMyTasks(filters?: { status?: TaskStatus; priority?: TaskPriority }) {
        return this.convex.query(
            api.tasks.me.queries.getMyTasks,
            filters || {}
        );
    }

    getMyTaskStats() {
        return this.convex.query(api.tasks.me.queries.getMyTaskStats, {});
    }

    updateMyTaskStatus(
        taskId: Id<'tasks'>,
        status: ExecutiveTaskStatus,
        notes?: string,
        location?: {
            latitude: number;
            longitude: number;
            address: string;
        }
    ) {
        return this.convex.mutation(api.tasks.me.mutation.updateTaskStatus, {
            taskId,
            status,
            notes,
            location
        });
    }

    completeMyTask(
        taskId: Id<'tasks'>,
        notes?: string,
        location?: {
            latitude: number;
            longitude: number;
            address: string;
        }
    ) {
        return this.updateMyTaskStatus(taskId, 'completed', notes, location);
    }

    startMyTask(
        taskId: Id<'tasks'>,
        notes?: string,
        location?: {
            latitude: number;
            longitude: number;
            address: string;
        }
    ) {
        return this.updateMyTaskStatus(taskId, 'in_progress', notes, location);
    }

    // ============================================================================
    // ADDITIONAL EXECUTIVE MUTATIONS
    // ============================================================================

    submitForApproval(
        taskId: Id<'tasks'>,
        completionNotes: string,
        attachmentIds?: Id<'_storage'>[]
    ) {
        return this.convex.mutation(api.tasks.me.mutation.submitForApproval, {
            taskId,
            completionNotes,
            attachmentIds
        });
    }

    addTaskAttachment(
        taskId: Id<'tasks'>,
        storageId: Id<'_storage'>,
        fileName: string,
        fileType: string,
        fileSize: number
    ) {
        return this.convex.mutation(api.tasks.me.mutation.addTaskAttachment, {
            taskId,
            storageId,
            fileName,
            fileType,
            fileSize
        });
    }

    // ============================================================================
    // APPROVAL MUTATIONS (For managers)
    // ============================================================================

    /**
     * âœ… FIXED: Table name is "approval_requests", not "task_approvals"
     */
    async approveTaskCompletion(approvalId: Id<'approval_requests'>) {
      const profile = await this.convex.query(api.auth.getCurrentUserProfile, {});
      
      if (!profile?.adminUserId) {
        throw new Error("No admin profile found");
      }
      
      const approverId = profile.adminUserId;
      
      return this.convex.mutation(api.tasks.me.mutation.approveTaskCompletion, {
        approvalId,
        approverId
      });
    }
    
    
    async rejectTaskCompletion(approvalId: Id<'approval_requests'>, rejectionReason: string) {
      const profile = await this.convex.query(api.auth.getCurrentUserProfile, {});
    
        if (!profile?.adminUserId) {
        throw new Error("No admin profile found");
      }
      const approverId = profile.adminUserId!;  // âœ… Same fix
      
      return this.convex.mutation(api.tasks.me.mutation.rejectTaskCompletion, {
        approvalId,
        rejectionReason,
        approverId
      });
    }

    // ============================================================================
    // UTILITY METHODS
    // ============================================================================

    isTaskOverdue(task: Task): boolean {
        return !task.completedAt && task.dueDate < Date.now();
    }

    getStatusColor(status: TaskStatus): string {
        const colors: Record<TaskStatus, string> = {
            pending: '#FFA726',
            in_progress: '#42A5F5',
            overdue: '#EF5350',
            completed: '#66BB6A'
        };
        return colors[status] || '#757575';
    }

    getPriorityColor(priority: TaskPriority): string {
        const colors: Record<TaskPriority, string> = {
            low: '#78909C',
            medium: '#FFA726',
            high: '#FF7043',
            urgent: '#EF5350'
        };
        return colors[priority] || '#757575';
    }

    formatDueDate(timestamp: number): string {
        const date = new Date(timestamp);
        const now = new Date();
        const diffMs = timestamp - now.getTime();
        const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

        if (diffDays < 0) {
            return `${Math.abs(diffDays)} days overdue`;
        } else if (diffDays === 0) {
            return 'Due today';
        } else if (diffDays === 1) {
            return 'Due tomorrow';
        } else if (diffDays < 7) {
            return `Due in ${diffDays} days`;
        } else {
            return date.toLocaleDateString('en-IN', {
                day: 'numeric',
                month: 'short',
                year: 'numeric'
            });
        }
    }

    canExecutiveSetStatus(status: TaskStatus): status is ExecutiveTaskStatus {
        return status === 'in_progress' || status === 'completed';
    }

    convertToStorageIds(stringIds: string[]): Id<'_storage'>[] {
        return stringIds as unknown as Id<'_storage'>[];
    }
}
</file>

<file path="src/app/features/settings/settings.routes.ts">
import { Routes } from "@angular/router";

export const SETTINGS_ROUTES: Routes = [
    {
        path: 'certificate-templates',
        loadComponent: () => import('./certificate-template/certificate-template.component').then(m => m.CertificateTemplateComponent),
        title: 'Certificate Templates'
    },
    {
        path:'tasks-settings',
        loadComponent: () => import('./tasks-settings/tasks-settings-component').then(m => m.TasksSettingsComponent),
        title: 'Tasks Settings'
    }
]
</file>

<file path="src/app/features/settings/tasks-settings/task-settings.component.html">
<div class="card flex flex-col h-full">
    <p-toast></p-toast>
    <p-toolbar styleClass="mb-4">
        <ng-template pTemplate="start">
            <h2 class="text-2xl font-semibold m-0">Task Categories</h2>
        </ng-template>
        <ng-template pTemplate="end">
            <p-button label="New Category" icon="pi pi-plus" class="p-button-primary" (click)="openNew()"></p-button>
        </ng-template>
    </p-toolbar>

    <div class="flex-grow">
        <p-table [value]="categories()" dataKey="id" [tableStyle]="{ 'min-width': '50rem' }" [scrollHeight]="'flex'">
            <ng-template pTemplate="header">
                <tr>
                    <th style="width: 5rem;">Color</th>
                    <th pSortableColumn="name">Name <p-sortIcon field="name" /></th>
                    <th>Description</th>
                    <th style="width: 8rem;">Actions</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-category>
                <tr>
                    <td>
                        <p-tag [style]="{'background': category.color}"></p-tag>
                    </td>
                    <td>{{ category.name }}</td>
                    <td>{{ category.description }}</td>
                    <td>
                        <p-button icon="pi pi-pencil" styleClass="p-button-text p-button-rounded" (click)="editCategory(category)"></p-button>
                        <p-button icon="pi pi-trash" styleClass="p-button-text p-button-rounded p-button-danger" (click)="deleteCategory(category)"></p-button>
                    </td>
                </tr>
            </ng-template>
             <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="4" class="text-center">No categories found.</td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</div>

<p-dialog [(visible)]="categoryDialog" [style]="{ width: '30rem' }" [header]="category.id ? 'Edit Category' : 'New Category'" [modal]="true">
    <ng-template pTemplate="content">
        <div class="flex flex-col gap-4">
            <div class="flex flex-col gap-2">
                <label for="name">Category Name</label>
                <input pInputText id="name" [(ngModel)]="category.name" required autofocus />
                <small class="p-error" *ngIf="submitted && !category.name">Name is required.</small>
            </div>
            <div class="flex flex-col gap-2">
                <label for="description">Description</label>
                <textarea pTextarea id="description" [(ngModel)]="category.description" [rows]="3"></textarea>
            </div>
             <div class="flex flex-col gap-2">
                <label for="color">Color</label>
                <p-colorPicker id="color" [(ngModel)]="category.color"></p-colorPicker>
            </div>
        </div>
    </ng-template>
    <ng-template pTemplate="footer">
        <p-button label="Cancel" icon="pi pi-times" class="p-button-text" (click)="hideDialog()"></p-button>
        <p-button label="Save" icon="pi pi-check" class="p-button-primary" (click)="saveCategory()"></p-button>
    </ng-template>
</p-dialog>

<p-confirmdialog />
</file>

<file path="src/app/features/settings/tasks-settings/tasks-settings-component.ts">
// src/app/features/settings/tasks-settings/tasks-settings-component.ts

import { Component, OnInit, signal } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { ConfirmationService, MessageService } from 'primeng/api';
import { TableModule } from 'primeng/table';
import { ButtonModule } from 'primeng/button';
import { ToolbarModule } from 'primeng/toolbar';
import { DialogModule } from 'primeng/dialog';
import { ToastModule } from 'primeng/toast';
import { ConfirmDialogModule } from 'primeng/confirmdialog';
import { InputTextModule } from 'primeng/inputtext';
import { TextareaModule } from 'primeng/textarea';
import { ColorPickerModule } from 'primeng/colorpicker';
import { TagModule } from 'primeng/tag';

// âœ… FIXED: Import from the new task-category.service
import { TaskCategoryService, TaskCategory } from '../services/task-category.service';

@Component({
    selector: 'app-task-categories',
    standalone: true,
    imports: [
        CommonModule,
        FormsModule,
        TableModule,
        ButtonModule,
        ToolbarModule,
        DialogModule,
        ToastModule,
        ConfirmDialogModule,
        InputTextModule,
        TextareaModule,
        ColorPickerModule,
        TagModule
    ],
    providers: [MessageService, ConfirmationService],
    templateUrl: './task-settings.component.html'
})
export class TasksSettingsComponent implements OnInit {
    categoryDialog = false;
    categories = signal<TaskCategory[]>([]);
    category: TaskCategory = { name: '', color: '#ffffff' };
    submitted = false;

    constructor(
        private taskCategoryService: TaskCategoryService,
        private messageService: MessageService,
        private confirmationService: ConfirmationService
    ) {}

    ngOnInit() {
        this.taskCategoryService
            .getCategories()
            .then((data) => this.categories.set(data));
    }

    openNew() {
        this.category = { name: '', color: '#6366F1' };
        this.submitted = false;
        this.categoryDialog = true;
    }

    editCategory(category: TaskCategory) {
        this.category = { ...category };
        this.categoryDialog = true;
    }

    deleteCategory(category: TaskCategory) {
        this.confirmationService.confirm({
            message: 'Are you sure you want to delete "' + category.name + '"?',
            header: 'Confirm',
            icon: 'pi pi-exclamation-triangle',
            accept: () => {
                this.taskCategoryService
                    .deleteCategory(category.id!)
                    .then(() => {
                        this.categories.update((cats) =>
                            cats.filter((c) => c.id !== category.id)
                        );
                        this.messageService.add({
                            severity: 'success',
                            summary: 'Successful',
                            detail: 'Category Deleted',
                            life: 3000
                        });
                    });
            }
        });
    }

    hideDialog() {
        this.categoryDialog = false;
        this.submitted = false;
    }

    saveCategory() {
        this.submitted = true;

        if (!this.category.name?.trim()) {
            return;
        }

        if (this.category.id) {
            // Update existing category
            this.taskCategoryService
                .updateCategory(this.category)
                .then((updatedCategory) => {
                    this.categories.update((cats) =>
                        cats.map((c) =>
                            c.id === updatedCategory.id ? updatedCategory : c
                        )
                    );
                    this.messageService.add({
                        severity: 'success',
                        summary: 'Successful',
                        detail: 'Category Updated',
                        life: 3000
                    });
                });
        } else {
            // Create new category
            this.taskCategoryService
                .addCategory(this.category)
                .then((newCategory) => {
                    this.categories.update((cats) => [...cats, newCategory]);
                    this.messageService.add({
                        severity: 'success',
                        summary: 'Successful',
                        detail: 'Category Created',
                        life: 3000
                    });
                });
        }

        this.categoryDialog = false;
    }
}
</file>

<file path="src/app/features/settings/types/certificate.types.ts">
export interface CertificateTemplate {
    id: string;
    fileName: string;
    uploadDate: string;
    fileUrl: string; // A URL to the stored PDF for preview/download
}
</file>

<file path="src/app/features/settings/types/task.types.ts">
// src/app/features/tasks/types/task.types.ts

export interface TaskCategory {
    id?: string;
    name: string;
    description?: string;
    color: string; // e.g., a hex code for the color picker
}
</file>

<file path="src/app/features/store/interfaces/order.interface.ts">
import { Id } from "convex/_generated/dataModel";

export interface OrderItem {
  _id: Id<'order_items'>;
  _creationTime: number;
  orderId: Id<'orders'>;
  rootId: string;
  productId: Id<'products'>;
  productName: string;
  productSku: string;
  quantity: number;
  unitPrice: number;
  totalPrice: number;
  createdAt: number;
}

export interface Order {
  _id: Id<'orders'>;
  orderNumber?: string;

  executiveId: Id<'executives'>;
  executiveEmployeeId?: string;
  executiveName?: string; // <-- add this

  customerName: string;
  customerEmail: string;
  customerPhone: string;
  shipToName: string;
  shipToPhone: string;
  shipToAddress: string;
  shipToCity: string;
  shipToState: string;
  shipToPincode: string;
  status: string;
  paymentStatus: string;
  paymentMethod?: string;
  subtotal: number;
  discount: number;
  tax: number;
  shippingCost: number;
  totalAmount: number;
  trackingNumber?: string;
  shippedAt?: number;
  deliveredAt?: number;
  notes?: string;
  createdAt: number;
}

export interface OrderStats {
  totalOrders: number;
  pendingOrders: number;
  confirmedOrders: number;
  shippedOrders: number;
  deliveredOrders: number;
  cancelledOrders: number;
  totalRevenue: number;
}
</file>

<file path="src/app/features/store/interfaces/product.interface.ts">
import { Id } from "convex/_generated/dataModel";

export interface Product {
  _id: Id<'products'>;
  _creationTime: number;
  rootId: string;
  name: string;
  description: string;
  category: string;
  price: number;
  discountPrice?: number;
  stock: number;
  lowStockThreshold: number;
  sku: string;
  isActive: boolean;
  weight?: number;
  length?: number;
  width?: number;
  height?: number;
  createdAt: number;
  updatedAt: number;
}

// âœ… Fixed: Backend returns '_id' not 'category'
export interface CategoryInfo {
  _id: string;  // âœ… Changed from 'category'
  count: number;
}

// âœ… Fixed: Removed 'inactiveProducts' (backend doesn't return it)
export interface InventoryStats {
  totalProducts: number;
  activeProducts: number;
  lowStockProducts: number;
  outOfStockProducts: number;
  totalInventoryValue: number;
}
</file>

<file path="src/app/features/store/product-management/product-management.component.html">
<div class="p-4">
  <p-toast />
  <p-confirmDialog />

  <!-- Toolbar -->
  <p-toolbar class="mb-4">
    <ng-template pTemplate="left">
      <h2 class="m-0 text-2xl font-semibold">Product Management</h2>
    </ng-template>
    <ng-template pTemplate="right">
      <p-button
        label="New Product"
        icon="pi pi-plus"
        severity="success"
        (onClick)="openNew()"
      />
    </ng-template>
  </p-toolbar>

  <!-- Data Table -->
  <p-table
    #dt
    [value]="products()"
    [rows]="10"
    [paginator]="true"
    [globalFilterFields]="['name', 'sku', 'category']"
    [tableStyle]="{ 'min-width': '75rem' }"
    [(selection)]="selectedProducts"
    [rowHover]="true"
    dataKey="_id"
    currentPageReportTemplate="Showing {first} to {last} of {totalRecords} products"
    [showCurrentPageReport]="true"
    [loading]="loading()"
  >
    <!-- Header -->
    <ng-template pTemplate="caption">
      <div class="flex align-items-center justify-content-between">
        <span class="p-input-icon-left">
          <i class="pi pi-search"></i>
          <input
            pInputText
            type="text"
            (input)="onGlobalFilter(dt, $event)"
            placeholder="Search products..."
          />
        </span>
      </div>
    </ng-template>

    <!-- Table Headers -->
    <ng-template pTemplate="header">
      <tr>
        <th style="width: 4rem">
          <p-tableHeaderCheckbox />
        </th>
        <th pSortableColumn="name">
          Product <p-sortIcon field="name" />
        </th>
        <th pSortableColumn="sku">
          SKU <p-sortIcon field="sku" />
        </th>
        <th pSortableColumn="category">
          Category <p-sortIcon field="category" />
        </th>
        <th pSortableColumn="price">
          Price <p-sortIcon field="price" />
        </th>
        <th pSortableColumn="stock">
          Stock <p-sortIcon field="stock" />
        </th>
        <th>Status</th>
        <th pSortableColumn="isActive">
          Active <p-sortIcon field="isActive" />
        </th>
        <th>Actions</th>
      </tr>
    </ng-template>

    <!-- Table Body -->
    <ng-template pTemplate="body" let-product>
      <tr>
        <td>
          <p-tableCheckbox [value]="product" />
        </td>
        <td class="font-semibold">{{ product.name }}</td>
        <td>
          <span class="text-color-secondary">{{ product.sku }}</span>
        </td>
        <td>
          <p-tag [value]="product.category" severity="secondary" />
        </td>
        <td>
          <div class="flex flex-column gap-1">
            <span class="font-semibold">â‚¹{{ product.price | number }}</span>
            <span *ngIf="product.discountPrice" class="text-sm text-color-secondary">
              <s>â‚¹{{ product.discountPrice | number }}</s>
              <span class="text-green-500 ml-1">
                (-{{ product.discountPercentage }}%)
              </span>
            </span>
          </div>
        </td>
        <td>
          <p-tag [value]="product.stock.toString()" severity="info" />
        </td>
        <td>
          <p-tag
            [value]="getStockLabel(product)"
            [severity]="getStockSeverity(product)"
          />
        </td>
        <td>
          <p-tag
            [value]="product.isActive ? 'Active' : 'Inactive'"
            [severity]="product.isActive ? 'success' : 'danger'"
          />
        </td>
        <td>
          <div class="flex gap-2">
            <p-button
              icon="pi pi-pencil"
              severity="info"
              [rounded]="true"
              [text]="true"
              (onClick)="editProduct(product)"
              pTooltip="Edit"
            />
            <p-button
              icon="pi pi-trash"
              severity="danger"
              [rounded]="true"
              [text]="true"
              (onClick)="deleteProduct(product)"
              pTooltip="Delete"
            />
            <p-button
              icon="pi pi-ellipsis-v"
              severity="secondary"
              [rounded]="true"
              [text]="true"
              (onClick)="menu.toggle($event)"
              #menuButton
            />
            <p-menu
              #menu
              [model]="actionMenuItems"
              [popup]="true"
              appendTo="body"
            />
          </div>
        </td>
      </tr>
    </ng-template>

    <!-- Empty State -->
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="9" class="text-center py-8">
          <div class="flex flex-column align-items-center gap-3">
            <i class="pi pi-shopping-cart text-6xl text-color-secondary"></i>
            <h3 class="m-0">No products found</h3>
            <p class="text-color-secondary">Start by adding your first product</p>
            <p-button
              label="Add Product"
              icon="pi pi-plus"
              (onClick)="openNew()"
            />
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <!-- Product Dialog (Create/Edit) -->
  <p-dialog
    [(visible)]="productDialog"
    [style]="{ width: '600px' }"
    header="Product Details"
    [modal]="true"
    class="p-fluid"
  >
    <ng-template pTemplate="content">
      <div class="grid">
        <!-- Product Name -->
        <div class="col-12">
          <div class="field">
            <label for="name" class="font-semibold">Name *</label>
            <input
              pInputText
              id="name"
              [(ngModel)]="product.name"
              required
              class="w-full"
              [class.ng-invalid]="submitted && !product.name"
            />
            <small *ngIf="submitted && !product.name" class="p-error">
              Name is required.
            </small>
          </div>
        </div>

        <!-- SKU -->
        <div class="col-12 md:col-6">
          <div class="field">
            <label for="sku" class="font-semibold">SKU *</label>
            <input
              pInputText
              id="sku"
              [(ngModel)]="product.sku"
              required
              class="w-full"
              [class.ng-invalid]="submitted && !product.sku"
              [disabled]="!!product._id"
            />
            <small *ngIf="submitted && !product.sku" class="p-error">
              SKU is required.
            </small>
          </div>
        </div>

        <!-- Category -->
        <div class="col-12 md:col-6">
          <div class="field">
            <label for="category" class="font-semibold">Category</label>
            <p-select
              inputId="category"
              [(ngModel)]="product.category"
              [options]="categories"
              optionLabel="label"
              optionValue="value"
              placeholder="Select a category"
              class="w-full"
            />
          </div>
        </div>

        <!-- Price -->
        <div class="col-12 md:col-6">
          <div class="field">
            <label for="price" class="font-semibold">Price (â‚¹) *</label>
            <p-inputNumber
              inputId="price"
              [(ngModel)]="product.price"
              mode="currency"
              currency="INR"
              locale="en-IN"
              required
              class="w-full"
              [class.ng-invalid]="submitted && !product.price"
            />
            <small *ngIf="submitted && !product.price" class="p-error">
              Price is required.
            </small>
          </div>
        </div>

        <!-- Discount Price -->
        <div class="col-12 md:col-6">
          <div class="field">
            <label for="discountPrice" class="font-semibold">Discount Price (â‚¹)</label>
            <p-inputNumber
              inputId="discountPrice"
              [(ngModel)]="product.discountPrice"
              mode="currency"
              currency="INR"
              locale="en-IN"
              class="w-full"
            />
          </div>
        </div>

        <!-- Stock -->
        <div class="col-12 md:col-6">
          <div class="field">
            <label for="stock" class="font-semibold">Stock Quantity</label>
            <p-inputNumber
              inputId="stock"
              [(ngModel)]="product.stock"
              class="w-full"
            />
          </div>
        </div>

        <!-- Low Stock Threshold -->
        <div class="col-12 md:col-6">
          <div class="field">
            <label for="lowStockThreshold" class="font-semibold">
              Low Stock Alert Threshold
            </label>
            <p-inputNumber
              inputId="lowStockThreshold"
              [(ngModel)]="product.lowStockThreshold"
              class="w-full"
            />
          </div>
        </div>

        <!-- Weight -->
        <div class="col-12 md:col-4">
          <div class="field">
            <label for="weight" class="font-semibold">Weight (kg)</label>
            <p-inputNumber
              inputId="weight"
              [(ngModel)]="product.weight"
              [minFractionDigits]="2"
              [maxFractionDigits]="2"
              class="w-full"
            />
          </div>
        </div>

        <!-- Dimensions -->
        <div class="col-12 md:col-4">
          <div class="field">
            <label for="length" class="font-semibold">Length (cm)</label>
            <p-inputNumber
              inputId="length"
              [(ngModel)]="product.length"
              class="w-full"
            />
          </div>
        </div>

        <div class="col-12 md:col-4">
          <div class="field">
            <label for="width" class="font-semibold">Width (cm)</label>
            <p-inputNumber
              inputId="width"
              [(ngModel)]="product.width"
              class="w-full"
            />
          </div>
        </div>

        <!-- Description -->
        <div class="col-12">
          <div class="field">
            <label for="description" class="font-semibold">Description</label>
            <p-editor
              [(ngModel)]="product.description"
              [style]="{ height: '150px' }"
            />
          </div>
        </div>

        <!-- Active Status -->
        <div class="col-12">
          <div class="field-checkbox">
            <p-checkbox
              inputId="isActive"
              [(ngModel)]="product.isActive"
            />
            <label for="isActive" class="ml-2">Active</label>
          </div>
        </div>
      </div>
    </ng-template>

    <ng-template pTemplate="footer">
      <p-button
        label="Cancel"
        icon="pi pi-times"
        [text]="true"
        (onClick)="hideDialog()"
      />
      <p-button
        label="Save"
        icon="pi pi-check"
        [loading]="loading()"
        (onClick)="saveProduct()"
      />
    </ng-template>
  </p-dialog>
</div>
</file>

<file path="src/app/features/store/product-management/product-management.component.ts">
import { Component, OnInit, signal, ViewChild } from '@angular/core';
import { ConfirmationService, MenuItem, MessageService } from 'primeng/api';
import { Table, TableModule } from 'primeng/table';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
// --- PrimeNG Modules ---
import { ButtonModule } from 'primeng/button';
import { ToastModule } from 'primeng/toast';
import { ToolbarModule } from 'primeng/toolbar';
import { InputTextModule } from 'primeng/inputtext';
import { InputNumberModule } from 'primeng/inputnumber';
import { SelectModule } from 'primeng/select';
import { DialogModule } from 'primeng/dialog';
import { TagModule } from 'primeng/tag';
import { ConfirmDialogModule } from 'primeng/confirmdialog';
import { EditorModule } from 'primeng/editor';
import { MenuModule } from 'primeng/menu';
import { Injectable } from '@angular/core';
import { Product } from '../interfaces/product.interface';
import { ProductsService } from '../services/product.service';
import saveAs from 'file-saver';
import { Workbook } from 'exceljs';

// --- Data Interface for a Product ---
@Component({
  selector: 'app-product-management',
  standalone: true,
  imports: [
    CommonModule,
    TableModule,
    FormsModule,
    ButtonModule,
    ToastModule,
    ToolbarModule,
    InputTextModule,
    InputNumberModule,
    SelectModule,
    DialogModule,
    TagModule,
    ConfirmDialogModule,
    EditorModule,
    MenuModule,
  ],
  templateUrl: './product-management.component.html',
  providers: [MessageService, ConfirmationService],
})
export class ProductManagementComponent implements OnInit {
  @ViewChild('dt') dt!: Table;

  productDialog = false;
  products = signal<Product[]>([]);
  product: Partial<Product> = {};
  selectedProducts: Product[] | null = [];
  submitted = false;
  loading = signal<boolean>(false);

  categories: any[] = [];
  statuses: any[] = [];
  actionMenuItems: MenuItem[] = [];

  constructor(
    private productsService: ProductsService,
    private messageService: MessageService,
    private confirmationService: ConfirmationService
  ) {}

  async ngOnInit() {
    await this.loadProducts();

    this.statuses = [
      { label: 'Active', value: true },
      { label: 'Inactive', value: false },
    ];
  }

  /**
   * Load products from backend
   */
  async loadProducts() {
    this.loading.set(true);
    try {
      const result = await this.productsService.listProducts(100); // Load first 100
      this.products.set(result.page as Product[]);
    } catch (error: any) {
      this.messageService.add({
        severity: 'error',
        summary: 'Error',
        detail: error.message || 'Failed to load products',
      });
    } finally {
      this.loading.set(false);
    }
  }

  /**
   * Load categories from backend
   */


  /**
   * Open dialog for new product
   */
  openNew() {
    this.product = {
      stock: 0,
      lowStockThreshold: 10,
      isActive: true,
    };
    this.submitted = false;
    this.productDialog = true;
  }

  /**
   * Edit existing product
   */
  async editProduct(product: Product) {
    try {
      // Fetch full product details including images
      const fullProduct = await this.productsService.getProduct(product._id);
      this.product = { ...fullProduct };
      this.productDialog = true;
    } catch (error: any) {
      this.messageService.add({
        severity: 'error',
        summary: 'Error',
        detail: error.message || 'Failed to load product details',
      });
    }
  }

  /**
   * Delete product
   */
  async deleteProduct(product: Product) {
    this.confirmationService.confirm({
      message: `Are you sure you want to delete "${product.name}"?`,
      header: 'Confirm',
      icon: 'pi pi-exclamation-triangle',
      accept: async () => {
        try {
          await this.productsService.deleteProduct(product._id);

          // Remove from UI
          this.products.update((products) =>
            products.filter((p) => p._id !== product._id)
          );

          this.messageService.add({
            severity: 'success',
            summary: 'Successful',
            detail: 'Product Deleted',
            life: 3000,
          });
        } catch (error: any) {
          this.messageService.add({
            severity: 'error',
            summary: 'Error',
            detail: error.message || 'Failed to delete product',
          });
        }
      },
    });
  }

  /**
   * Hide dialog
   */
  hideDialog() {
    this.productDialog = false;
    this.submitted = false;
  }

  /**
   * Save product (create or update)
   */
  async saveProduct() {
    this.submitted = true;

    if (!this.product.name?.trim() || !this.product.sku?.trim()) {
      this.messageService.add({
        severity: 'warn',
        summary: 'Validation Error',
        detail: 'Name and SKU are required',
      });
      return;
    }

    if (!this.product.price || this.product.price <= 0) {
      this.messageService.add({
        severity: 'error',
        summary: 'Validation Error',
        detail: 'Price must be greater than 0',
      });
      return;
    }

    this.loading.set(true);

    try {
      if (this.product._id) {
        // Update existing product
        await this.productsService.updateProduct(this.product._id, {
          name: this.product.name,
          description: this.product.description,
          category: this.product.category,
          price: this.product.price,
          discountPrice: this.product.discountPrice,
          stock: this.product.stock,
          lowStockThreshold: this.product.lowStockThreshold,
          isActive: this.product.isActive,
          weight: this.product.weight,
          length: this.product.length,
          width: this.product.width,
          height: this.product.height,
        });

        this.messageService.add({
          severity: 'success',
          summary: 'Successful',
          detail: 'Product Updated',
          life: 3000,
        });
      } else {
        // Create new product
        await this.productsService.createProduct({
          name: this.product.name!,
          description: this.product.description || '',
          category: this.product.category || 'General',
          price: this.product.price!,
          discountPrice: this.product.discountPrice,
          stock: this.product.stock || 0,
          lowStockThreshold: this.product.lowStockThreshold || 10,
          sku: this.product.sku!,
          weight: this.product.weight,
          length: this.product.length,
          width: this.product.width,
          height: this.product.height,
        });

        this.messageService.add({
          severity: 'success',
          summary: 'Successful',
          detail: 'Product Created',
          life: 3000,
        });
      }

      // Reload products
      await this.loadProducts();

      this.productDialog = false;
      this.product = {};
    } catch (error: any) {
      this.messageService.add({
        severity: 'error',
        summary: 'Error',
        detail: error.message || 'Failed to save product',
      });
    } finally {
      this.loading.set(false);
    }
  }

  /**
   * Get stock status severity
   */
  getStockSeverity(product: Product): 'success' | 'warn' | 'danger' {
    if (product.stock === 0) return 'danger';
    return 'success';
  }

  /**
   * Get stock status label
   */
  getStockLabel(product: Product): string {
    if (product.stock === 0) return 'OUT OF STOCK';
    return 'IN STOCK';
  }

  /**
   * Actions menu
   */
  onActionsMenuClick(menu: any, event: any, product: Product) {
    this.actionMenuItems = [
      {
        label: 'Edit',
        icon: 'pi pi-pencil',
        command: () => this.editProduct(product),
      },
      {
        label: 'Delete',
        icon: 'pi pi-trash',
        command: () => this.deleteProduct(product),
      },
    ];
    menu.toggle(event);
  }

  /**
   * Global filter
   */
  onGlobalFilter(table: Table, event: Event) {
    table.filterGlobal((event.target as HTMLInputElement).value, 'contains');
  }

   async exportToExcel() {
    const currentProducts = this.products();
    
    if (currentProducts.length === 0) {
      this.messageService.add({
        severity: 'warn',
        summary: 'No Data',
        detail: 'No products to export',
      });
      return;
    }

    try {
      const workbook = new Workbook();
      workbook.creator = 'Admin Panel';
      workbook.created = new Date();

      const worksheet = workbook.addWorksheet('Products');

      worksheet.columns = [
        { header: 'SKU', key: 'sku', width: 15 },
        { header: 'Name', key: 'name', width: 30 },
        { header: 'Category', key: 'category', width: 15 },
        { header: 'Price', key: 'price', width: 12 },
        { header: 'Discount Price', key: 'discountPrice', width: 15 },
        { header: 'Stock', key: 'stock', width: 10 },
        { header: 'Low Stock Threshold', key: 'lowStockThreshold', width: 20 },
        { header: 'Status', key: 'status', width: 10 },
        { header: 'Stock Status', key: 'stockStatus', width: 15 },
        { header: 'Created', key: 'created', width: 15 },
      ];

      worksheet.getRow(1).font = { bold: true };
      worksheet.getRow(1).fill = {
        type: 'pattern',
        pattern: 'solid',
        fgColor: { argb: 'FFE0E0E0' }
      };

      currentProducts.forEach((product) => {
        worksheet.addRow({
          sku: this.sanitizeCell(product.sku),
          name: this.sanitizeCell(product.name),
          category: this.sanitizeCell(product.category),
          price: product.price,
          discountPrice: product.discountPrice || '',
          stock: product.stock,
          lowStockThreshold: product.lowStockThreshold,
          status: product.isActive ? 'Active' : 'Inactive',
          stockStatus: this.getStockLabel(product),
          created: new Date(product.createdAt),
        });
      });

      worksheet.getColumn('price').numFmt = 'â‚¹#,##0.00';
      worksheet.getColumn('discountPrice').numFmt = 'â‚¹#,##0.00';
      worksheet.getColumn('created').numFmt = 'dd/mm/yyyy';

      const buffer = await workbook.xlsx.writeBuffer();
      const timestamp = new Date().toISOString().split('T')[0];
      const filename = `products_export_${timestamp}.xlsx`;

      const blob = new Blob([buffer], {
        type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'
      });
      saveAs(blob, filename);

      this.messageService.add({
        severity: 'success',
        summary: 'Export Successful',
        detail: `${currentProducts.length} products exported`,
        life: 3000,
      });
    } catch (error: any) {
      this.messageService.add({
        severity: 'error',
        summary: 'Export Failed',
        detail: error.message,
      });
    }
  }

  /**
   * âœ… SECURITY: Sanitize cell values
   */
  private sanitizeCell(value: string | undefined): string {
    if (!value) return '';
    let sanitized = String(value);
    const dangerousChars = ['=', '+', '-', '@', '\t', '\r'];
    if (dangerousChars.some(char => sanitized.startsWith(char))) {
      sanitized = "'" + sanitized;
    }
    return sanitized.replace(/[\x00-\x1F\x7F]/g, '');
  }
}
</file>

<file path="src/app/features/store/services/orders.service.ts">
import { Injectable } from '@angular/core';
import { ConvexService } from 'src/app/core/services/convex.service';
import { api } from 'convex/_generated/api';
import { Id } from 'convex/_generated/dataModel';
import { Order } from '../interfaces/order.interface';

@Injectable({
  providedIn: 'root',
})
export class OrdersService {
  constructor(private convex: ConvexService) {}

async listOrders(filters?: {
  status?: string;
  executiveId?: string;
  paginationOpts?: any;
}) {
  // Default pagination if not provided
  const pagination = filters?.paginationOpts ?? { numItems: 100, cursor: null };
  
  return this.convex.query(api.store.orders.listOrders, {
    paginationOpts: pagination,
    status: filters?.status as any,
    executiveId: filters?.executiveId as any,
  });
}


  async getOrder(orderId: Id<'orders'>) {
    return this.convex.client.query(api.store.orders.getOrder, { orderId });
  }

  async getOrderStats() {
    
    return this.convex.client.query(api.store.orders.getOrderStats, {});
  }

  // âœ… FIXED: Backend only accepts 'confirmed' | 'shipped' | 'delivered' | 'cancelled' (NO 'pending')
  async updateOrderStatus(
    orderId: Id<'orders'>,
    status: 'confirmed' | 'shipped' | 'delivered' | 'cancelled',  // âœ… Removed 'pending'
    trackingNumber?: string,
    notes?: string
  ) {
    return this.convex.client.mutation(api.store.orders.updateOrderStatus, {
      orderId,
      status,
      trackingNumber,
    });
  }

  async createOrder(orderData: {
    executiveId: Id<'executives'>;
    customerName: string;
    customerEmail: string;
    customerPhone: string;
    shipToName: string;
    shipToPhone: string;
    shipToAddress: string;
    shipToCity: string;
    shipToState: string;
    shipToPincode: string;
    paymentMethod: string;
    items: Array<{ productId: Id<'products'>; quantity: number }>;
    discount?: number;
    notes?: string;
  }) {
    return this.convex.client.mutation(api.store.orders.createOrder, orderData);
  }
}
</file>

<file path="src/app/features/store/services/product.service.ts">
import { Injectable } from '@angular/core';
import { ConvexService } from '@/core/services/convex.service';
import { api } from 'convex/_generated/api';
import { Id } from 'convex/_generated/dataModel';
import { CategoryInfo, InventoryStats } from '../interfaces/product.interface';
@Injectable({ 
  providedIn: 'root' 
})
export class ProductsService {
  constructor(private convex: ConvexService) {}

  /**
   * List products with pagination and filters
   */
  async listProducts(
    numItems: number = 50,
    cursor: string | null = null,
    category?: string,
    isActive?: boolean,
    lowStock?: boolean
  ) {
    return this.convex.client.query(api.store.products.listProducts, {
      paginationOpts: {
        numItems,
        cursor,
      },
      category,
      isActive,
      lowStock,
    });
  }

  /**
   * Get single product with images
   */
  async getProduct(productId: Id<'products'>) {
    return this.convex.client.query(api.store.products.getProduct, {
      productId,
    });
  }

  /**
   * Create new product
   */
  async createProduct(productData: {
    name: string;
    description: string;
    category: string;
    price: number;
    discountPrice?: number;
    stock: number;
    lowStockThreshold: number;
    sku: string;
    weight?: number;
    length?: number;
    width?: number;
    height?: number;
  }) {
    return this.convex.client.mutation(api.store.products.createProduct, productData);
  }

  /**
   * Update existing product
   */
  async updateProduct(
    productId: Id<'products'>,
    updates: Partial<{
      name: string;
      description: string;
      category: string;
      price: number;
      discountPrice: number;
      stock: number;
      lowStockThreshold: number;
      isActive: boolean;
      weight: number;
      length: number;
      width: number;
      height: number;
    }>
  ) {
    return this.convex.client.mutation(api.store.products.updateProduct, {
      productId,
      ...updates,
    });
  }

  /**
   * Delete product (soft delete)
   */
  async deleteProduct(productId: Id<'products'>) {
    return this.convex.client.mutation(api.store.products.deleteProduct, {
      productId,
    });
  }

  /**
   * Get product categories
   */
async getCategories(): Promise<CategoryInfo[]> {
  const categories = await this.convex.client.query(api.store.products.getCategories, {});
  return categories.map((c: any) => ({
    _id: c._id ?? c.category,
    count: c.count,
  }));
}


  /**
   * Get inventory statistics
   */
  async getInventoryStats(): Promise<InventoryStats> {
    return this.convex.client.query(api.store.products.getInventoryStats, {});
  }

  /**
   * Add product image
   */
  async addProductImage(
    productId: Id<'products'>,
    storageId: Id<'_storage'>,
    order?: number,
    isPrimary?: boolean
  ) {
    return this.convex.client.mutation(api.store.products.addProductImage, {
      productId,
      storageId,
      order,
      isPrimary,
    });
  }

  /**
   * Remove product image
   */
  async removeProductImage(
    productId: Id<'products'>,
    storageId: Id<'_storage'>
  ) {
    return this.convex.client.mutation(api.store.products.removeProductImage, {
      productId,
      storageId,
    });
  }
}
</file>

<file path="src/app/features/store/store.routes.ts">
import { Routes } from "@angular/router";
import { ProductManagementComponent } from "./product-management/product-management.component";
import { ViewOrdersComponent } from "./view-orders/view-orders.component";

export const STORE_ROUTES: Routes = [
    {path: 'products', component: ProductManagementComponent, title: 'Product Management'},
   { path: 'orders', component: ViewOrdersComponent, title: 'View Orders'}
]
</file>

<file path="src/app/features/store/view-orders/view-orders.component.html">
<div class="view-orders-page">
    <div class="page-header">
        <div>
            <h1 class="page-title">
                <i class="pi pi-shopping-cart"></i>
                Orders Management
            </h1>
            <p class="page-subtitle">
                Monitor orders, revenue and statuses for the last 7 days by
                default.
            </p>
        </div>
        <div class="page-actions">
            <p-button
                icon="pi pi-refresh"
                label="Refresh"
                [outlined]="true"
                size="small"
                (onClick)="refreshOrders()"
            ></p-button>
            <p-button
                icon="pi pi-download"
                label="Export"
                [outlined]="true"
                size="small"
                (onClick)="exportOrders()"
            ></p-button>
        </div>
    </div>

    <div class="stats-row" *ngIf="stats() as s">
        <button
            class="stat-card"
            type="button"
            (click)="onQuickFilter('today')"
        >
            <div class="stat-icon-wrapper icon-blue">
                <i class="pi pi-calendar"></i>
            </div>
            <div class="stat-content">
                <div class="stat-label">Orders today</div>
                <div class="stat-value">{{ s.totalOrdersToday ?? 0 }}</div>
                <div class="stat-hint">Click to view only today</div>
            </div>
        </button>

        <button
            class="stat-card"
            type="button"
            (click)="onQuickFilter('pending')"
        >
            <div class="stat-icon-wrapper icon-amber">
                <i class="pi pi-clock"></i>
            </div>
            <div class="stat-content">
                <div class="stat-label">Pending</div>
                <div class="stat-value">{{ s.pendingOrders }}</div>
                <div class="stat-hint">Awaiting confirmation</div>
            </div>
        </button>

        <button
            class="stat-card"
            type="button"
            (click)="onQuickFilter('shipped')"
        >
            <div class="stat-icon-wrapper icon-sky">
                <i class="pi pi-send"></i>
            </div>
            <div class="stat-content">
                <div class="stat-label">Shipped</div>
                <div class="stat-value">{{ s.shippedOrders }}</div>
                <div class="stat-hint">On the way</div>
            </div>
        </button>

        <button
            class="stat-card"
            type="button"
            (click)="onQuickFilter('delivered')"
        >
            <div class="stat-icon-wrapper icon-green">
                <i class="pi pi-check-circle"></i>
            </div>
            <div class="stat-content">
                <div class="stat-label">Delivered</div>
                <div class="stat-value">{{ s.deliveredOrders }}</div>
                <div class="stat-hint">Completed orders</div>
            </div>
        </button>

        <button
            class="stat-card"
            type="button"
            (click)="onQuickFilter('revenue7')"
        >
            <div class="stat-icon-wrapper icon-teal">
                <i class="pi pi-dollar"></i>
            </div>
            <div class="stat-content">
                <div class="stat-label">Revenue (7 days)</div>
                <div class="stat-value">
                    â‚¹{{ s.weeklyRevenue ?? s.totalRevenue | number: '1.0-0' }}
                </div>
                <div class="stat-hint">Last 7 days</div>
            </div>
        </button>
    </div>

    <div class="filter-bar">
        <div class="filter-search">
            <span class="p-input-icon-left">
                <i class="pi pi-search"></i>
                <input
                    pInputText
                    type="text"
                    placeholder="Search by order ID, customer, email or executive"
                    class="search-input"
                    [(ngModel)]="searchQuery"
                    (input)="onSearch()"
                />
            </span>
        </div>

        <div class="filter-controls">
            <p-select
                [options]="statusOptions"
                [(ngModel)]="selectedStatus"
                optionLabel="label"
                optionValue="value"
                placeholder="All"
                [showClear]="false"
                styleClass="filter-select"
                (onChange)="onStatusFilter()"
            ></p-select>

            <p-select
                [options]="dateRangeOptions"
                [(ngModel)]="selectedDateRange"
                optionLabel="label"
                optionValue="value"
                placeholder="All time"
                [showClear]="false"
                styleClass="filter-select"
                (onChange)="onDateRangeChange()"
            ></p-select>

            <p-select
                [options]="executiveFilterOptions"
                [(ngModel)]="selectedExecutiveId"
                optionLabel="label"
                optionValue="value"
                placeholder="All executives"
                [showClear]="false"
                styleClass="filter-select"
                (onChange)="onExecutiveFilterChange()"
            ></p-select>

            <button
                type="button"
                class="clear-btn"
                pButton
                label="Clear"
                [text]="true"
                size="small"
                (click)="onClearFilters()"
            ></button>
        </div>
    </div>

    <div class="table-wrapper">
        <p-table
            #dt
            [value]="filteredOrders"
            [loading]="loading()"
            [paginator]="true"
            [rows]="10"
            [rowsPerPageOptions]="[10, 25, 50]"
            [showCurrentPageReport]="true"
            currentPageReportTemplate="Showing {first} to {last} of {totalRecords} orders"
            dataKey="_id"
            [rowHover]="true"
            styleClass="p-datatable-sm"
            [tableStyle]="{ 'min-width': '60rem' }"
        >
            <ng-template pTemplate="header">
                <tr>
                    <th class="col-id">Order ID</th>
                    <th class="col-person">Customer / Executive</th>
                    <th class="col-status">Status</th>
                    <th class="col-payment">Payment</th>
                    <th class="col-total">Total</th>
                    <th class="col-date">Date</th>
                    <th class="col-actions" style="padding-left: 2rem;">Actions</th>
                </tr>
            </ng-template>

            <ng-template pTemplate="body" let-order>
                <tr>
                    <td class="col-id">
                        <span class="order-id-badge">
                            {{
                                order.orderNumber ?? (order._id | slice: 0 : 8)
                            }}
                        </span>
                    </td>

                    <td class="col-person">
                        <div class="person-cell">
                            <span class="person-name">{{
                                getExecutiveName(order)
                            }}</span>
                            <span class="person-meta">
                                {{ order.customerEmail || 'N/A' }}
                            </span>
                        </div>
                    </td>

                    <td class="col-status">
                        <p-tag
                            [value]="order.status"
                            [severity]="getStatusSeverity(order.status)"
                        ></p-tag>
                    </td>

                    <td class="col-payment">
                        <p-tag
                            [value]="order.paymentStatus || 'N/A'"
                            [severity]="
                                order.paymentStatus === 'paid'
                                    ? 'success'
                                    : order.paymentStatus === 'failed'
                                      ? 'danger'
                                      : 'warn'
                            "
                        ></p-tag>
                    </td>

                    <td class="col-total">
                        <span class="total-value">
                            {{ formatCurrency(order.totalAmount) }}
                        </span>
                    </td>

                    <td class="col-date">
                        {{ order.createdAt | date: 'dd MMM, yyyy' }}
                    </td>

                    <td class="col-actions">
                        <div class="action-buttons" >
                            <p-button
                                icon="pi pi-eye"
                                [rounded]="true"
                                [text]="true"
                                severity="info"
                                size="small"
                                pTooltip="View details"
                                tooltipPosition="top"
                                (onClick)="viewOrderDetails(order)"
                            ></p-button>
                            <p-button
                                icon="pi pi-print"
                                [rounded]="true"
                                [text]="true"
                                severity="secondary"
                                size="small"
                                pTooltip="Print invoice"
                                tooltipPosition="top"
                                (onClick)="downloadInvoice(order)"
                            ></p-button>
                        </div>
                    </td>
                </tr>
            </ng-template>

            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="7">
                        <div class="empty-state">
                            <i class="pi pi-inbox"></i>
                            <p>
                                No orders match the current filters. Adjust the
                                date, status or search text to see more results.
                            </p>
                        </div>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>

    <p-dialog
        [(visible)]="orderDetailsVisible"
        [modal]="true"
        [closable]="true"
        [style]="{ width: '90vw', maxWidth: '900px' }"
        [contentStyle]="{ padding: 0 }"
        [header]="'Order ' + (selectedOrder?._id | slice: 0 : 8 | uppercase)"
        *ngIf="selectedOrder"
    >
        <div class="order-details-wrapper">
            <div class="details-header">
                <div class="info-card">
                    <div class="card-icon" style="background-color: #dbeafe">
                        <i
                            class="pi pi-shopping-bag"
                            style="color: #3b82f6"
                        ></i>
                    </div>
                    <div class="card-content">
                        <div class="card-label">Order ID</div>
                        <div class="card-value">
                            {{ selectedOrder._id | slice: 0 : 8 | uppercase }}
                        </div>
                    </div>
                </div>

                <div class="info-card">
                    <div class="card-icon" style="background-color: #fef3c7">
                        <i class="pi pi-calendar" style="color: #f59e0b"></i>
                    </div>
                    <div class="card-content">
                        <div class="card-label">Order Date</div>
                        <div class="card-value">
                            {{ selectedOrder.createdAt | date: 'MMM dd, yyyy' }}
                        </div>
                    </div>
                </div>

                <div class="info-card">
                    <div class="card-icon" style="background-color: #d1fae5">
                        <i class="pi pi-dollar" style="color: #10b981"></i>
                    </div>
                    <div class="card-content">
                        <div class="card-label">Total Amount</div>
                        <div class="card-value">
                            {{ formatCurrency(selectedOrder.totalAmount) }}
                        </div>
                    </div>
                </div>
            </div>

            <div class="details-content">
                <div class="details-grid">
                    <div class="grid-col">
                        <div class="section-card">
                            <h4 class="section-title">
                                <i class="pi pi-user"></i>
                                Customer Information
                            </h4>
                            <div class="info-row">
                                <span class="info-label">Name:</span>
                                <span class="info-value">
                                    {{ selectedOrder.customerName || 'N/A' }}
                                </span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Email:</span>
                                <span class="info-value">
                                    {{ selectedOrder.customerEmail || 'N/A' }}
                                </span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Phone:</span>
                                <span class="info-value">
                                    {{ selectedOrder.customerPhone || 'N/A' }}
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="grid-col">
                        <div class="section-card">
                            <h4 class="section-title">
                                <i class="pi pi-briefcase"></i>
                                Executive & Status
                            </h4>
                            <div class="info-row">
                                <span class="info-label">Executive:</span>
                                <span class="info-value">
                                    {{ getExecutiveName(selectedOrder) }}
                                </span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Order Status:</span>
                                <p-tag
                                    [value]="selectedOrder.status"
                                    [severity]="
                                        getStatusSeverity(selectedOrder.status)
                                    "
                                ></p-tag>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Payment:</span>
                                <p-tag
                                    [value]="selectedOrder.paymentStatus"
                                    [severity]="
                                        selectedOrder.paymentStatus === 'paid'
                                            ? 'success'
                                            : 'warn'
                                    "
                                ></p-tag>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section-card">
                    <h4 class="section-title">
                        <i class="pi pi-map-marker"></i>
                        Shipping Address
                    </h4>
                    <div class="address-block">
                        <p class="address-name">
                            <strong>{{
                                selectedOrder.shipToName || 'N/A'
                            }}</strong>
                        </p>
                        <p class="address-line">
                            {{ selectedOrder.shipToPhone || 'N/A' }}
                        </p>
                        <p class="address-line">
                            {{ selectedOrder.shipToAddress || 'N/A' }}
                        </p>
                        <p class="address-line">
                            {{ selectedOrder.shipToCity || '' }}
                            {{
                                selectedOrder.shipToState
                                    ? ', ' + selectedOrder.shipToState
                                    : ''
                            }}
                            {{
                                selectedOrder.shipToPincode
                                    ? '- ' + selectedOrder.shipToPincode
                                    : ''
                            }}
                        </p>
                    </div>
                </div>

                <div class="section-card">
                    <h4 class="section-title">
                        <i class="pi pi-box"></i>
                        Order Items
                    </h4>
                    <div class="table-scroll">
                        <table class="items-table">
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th class="center-cell">Quantity</th>
                                    <th class="right-cell">Unit Price</th>
                                    <th class="right-cell">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let item of orderItems()">
                                    <td>
                                        <div class="product-info">
                                            <span class="product-name">
                                                {{ item.productName }}
                                            </span>
                                            <span class="product-sku">
                                                SKU: {{ item.productSku }}
                                            </span>
                                        </div>
                                    </td>
                                    <td class="center-cell">
                                        {{ item.quantity }}
                                    </td>
                                    <td class="right-cell">
                                        {{ formatCurrency(item.unitPrice) }}
                                    </td>
                                    <td class="right-cell amount-bold">
                                        {{ formatCurrency(item.totalPrice) }}
                                    </td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr class="summary-row">
                                    <td colspan="3" class="summary-label">
                                        Subtotal:
                                    </td>
                                    <td class="summary-value">
                                        {{
                                            formatCurrency(
                                                selectedOrder.subtotal
                                            )
                                        }}
                                    </td>
                                </tr>
                                <tr class="summary-row">
                                    <td colspan="3" class="summary-label">
                                        Discount:
                                    </td>
                                    <td class="summary-value discount">
                                        -{{
                                            formatCurrency(
                                                selectedOrder.discount
                                            )
                                        }}
                                    </td>
                                </tr>
                                <tr class="summary-row">
                                    <td colspan="3" class="summary-label">
                                        Tax:
                                    </td>
                                    <td class="summary-value">
                                        {{ formatCurrency(selectedOrder.tax) }}
                                    </td>
                                </tr>
                                <tr class="summary-row">
                                    <td colspan="3" class="summary-label">
                                        Shipping:
                                    </td>
                                    <td class="summary-value">
                                        {{
                                            formatCurrency(
                                                selectedOrder.shippingCost
                                            )
                                        }}
                                    </td>
                                </tr>
                                <tr class="total-row">
                                    <td colspan="3" class="summary-label">
                                        <strong>Final Amount:</strong>
                                    </td>
                                    <td class="summary-value">
                                        <strong>
                                            {{
                                                formatCurrency(
                                                    selectedOrder.totalAmount
                                                )
                                            }}
                                        </strong>
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <ng-template pTemplate="footer">
            <div class="dialog-actions">
                <p-button
                    label="Close"
                    icon="pi pi-times"
                    severity="secondary"
                    (onClick)="orderDetailsVisible = false"
                ></p-button>
                <p-button
                    label="Print Invoice"
                    icon="pi pi-print"
                    severity="success"
                    (onClick)="printOrder(selectedOrder!)"
                ></p-button>
            </div>
        </ng-template>
    </p-dialog>
</div>
</file>

<file path="src/app/features/store/view-orders/view-orders.component.scss">
// ============================================================================
// ORDERS MANAGEMENT - FOLLOWING ADMIN/EXECUTIVE PATTERN
// ============================================================================

// Color Palette (Enterprise Blue)
$primary-blue: #1e40af;
$primary-blue-light: #3b82f6;
$primary-blue-dark: #1e3a8a;
$primary-green: #10b981;
$success-green: #10b981;
$danger-red: #ef4444;
$warning-orange: #f59e0b;
$neutral-50: #f9fafb;
$neutral-100: #f3f4f6;
$neutral-200: #e5e7eb;
$neutral-300: #d1d5db;
$neutral-500: #6b7280;
$neutral-700: #374151;
$neutral-900: #111827;

// ============================================================================
// CONTAINER
// ============================================================================
.view-orders-page {
    padding: 1.5rem 2rem;
    background: $neutral-50;
    min-height: 100vh;

    @media (max-width: 768px) {
        padding: 1rem;
    }
}

// ============================================================================
// PAGE HEADER
// ============================================================================
.page-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 1.5rem;
    margin-bottom: 1.5rem;

    @media (max-width: 768px) {
        flex-direction: column;
    }
}

.page-title {
    margin: 0;
    font-size: 1.75rem;
    font-weight: 700;
    color: $neutral-900;
    display: flex;
    align-items: center;
    gap: 0.75rem;

    i {
        font-size: 1.4rem;
        color: $primary-green;
    }
}

.page-subtitle {
    margin: 0.25rem 0 0;
    font-size: 0.875rem;
    color: $neutral-500;
}

.page-actions {
    display: flex;
    gap: 0.75rem;
    flex-shrink: 0;
}

// ============================================================================
// STATS CARDS
// ============================================================================
.stats-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(190px, 1fr));
    gap: 0.75rem;
    margin-bottom: 1.25rem;
}

.stat-card {
    border: 1px solid $neutral-200;
    border-radius: 0.9rem;
    padding: 0.85rem 0.9rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    background: #ffffff;
    cursor: pointer;
    text-align: left;
    transition:
        box-shadow 0.15s ease,
        border-color 0.15s ease,
        transform 0.1s ease;

    &:hover {
        box-shadow: 0 6px 16px rgba(15, 23, 42, 0.12);
        border-color: $neutral-300;
        transform: translateY(-1px);
    }
}

.stat-icon-wrapper {
    width: 2.4rem;
    height: 2.4rem;
    border-radius: 0.75rem;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #ffffff;
    flex-shrink: 0;
}

.icon-blue {
    background: #3b82f6;
}
.icon-amber {
    background: #f59e0b;
}
.icon-sky {
    background: #0ea5e9;
}
.icon-green {
    background: #10b981;
}
.icon-teal {
    background: #14b8a6;
}

.stat-content {
    display: flex;
    flex-direction: column;
    gap: 0.15rem;
    min-width: 0;
}

.stat-label {
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: $neutral-500;
}

.stat-value {
    font-size: 1.3rem;
    font-weight: 700;
    color: $neutral-900;
}

.stat-hint {
    font-size: 0.75rem;
    color: #9ca3af;
}

// ============================================================================
// FILTER BAR
// ============================================================================
.filter-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    padding: 0.85rem 1.1rem;
    border-radius: 0.75rem;
    background: #ffffff;
    border: 1px solid $neutral-200;
    margin-bottom: 1.1rem;

    @media (max-width: 1024px) {
        flex-direction: column;
        align-items: stretch;
    }
}

.filter-search {
    flex: 1;
    min-width: 0;
    max-width: 420px;
}

.search-input {
    width: 100%;
    padding: 0.5rem 0.65rem 0.5rem 2.2rem !important;
    font-size: 0.875rem;
    border-radius: 0.6rem;
    border: 1px solid $neutral-300 !important;
    background: #ffffff !important;
    transition:
        border-color 0.15s ease,
        box-shadow 0.15s ease;

    &:focus {
        border-color: #6366f1 !important;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1) !important;
        outline: none;
    }
}

::ng-deep .p-input-icon-left > .pi {
    left: 0.65rem;
    color: #9ca3af;
    font-size: 0.9rem;
}

.filter-controls {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex-shrink: 0;

    @media (max-width: 1024px) {
        justify-content: flex-start;
        flex-wrap: wrap;
    }
}

::ng-deep .filter-select {
    min-width: 110px;

    .p-select-label {
        padding: 0.45rem 0.65rem;
        font-size: 0.8125rem;
    }

    .p-select-dropdown {
        width: 2rem;
    }
}

.clear-btn {
    margin-left: 0.25rem;
    font-size: 0.8125rem;
    font-weight: 500;
    color: $neutral-500;
    padding: 0.45rem 0.75rem;

    &:hover {
        background: $neutral-100 !important;
        color: $neutral-700;
    }
}

// ============================================================================
// TABLE WRAPPER - FOLLOWING ADMIN PATTERN
// ============================================================================
.table-wrapper {
    background: #ffffff;
    border: 1px solid $neutral-200;
    border-radius: 0.9rem;
    overflow: hidden;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

// ============================================================================
// TABLE STYLES - SIMPLE ::ng-deep LIKE ADMIN COMPONENT
// ============================================================================
::ng-deep {
    .p-datatable {
        border: none;
    }

    // Table Header - Blue gradient like admin
    .p-datatable .p-datatable-thead > tr > th {
        background: linear-gradient(
            135deg,
            $primary-blue-dark 0%,
            $primary-blue 100%
        );
        color: white;
        font-weight: 600;
        padding: 1rem 0.75rem;
        border: none;
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        vertical-align: middle;
        white-space: nowrap;
    }

    // Table Body Cells
    .p-datatable .p-datatable-tbody > tr {
        transition: all 0.2s ease;

        &:hover {
            background: rgba(30, 64, 175, 0.05);
        }

        > td {
            padding: 1rem 0.75rem;
            color: $neutral-700;
            font-size: 0.875rem;
            border-bottom: 1px solid $neutral-100;
            vertical-align: middle;
        }
    }

    // Column-specific padding - Order ID
    .col-id {
        padding-left: 0.75rem !important;
        padding-right: 0.5rem !important;
    }

    // Customer/Executive column
    .col-person {
        padding-left: 1.5rem !important;
        padding-right: 1.5rem !important;
    }

    // Status column
    .col-status {
        text-align: center !important;
        padding-left: 0.5rem !important;
        padding-right: 0.75rem !important;
    }

    // Payment column
    .col-payment {
        text-align: center !important;
        padding-left: 0.5rem !important;
        padding-right: 0.5rem !important;
    }

    // Total column
    .col-total {
        text-align: right !important;
        padding-left: 0.5rem !important;
        padding-right: 1.5rem !important;
    }

    // Date column
    .col-date {
        padding-left: 1.5rem !important;
        padding-right: 0.75rem !important;
    }

    // Actions column
    .col-actions {
        text-align: center !important;
        padding-left: 0.75rem !important;
        padding-right: 2rem !important;
    }

    // Pagination
    .p-paginator {
        background: $neutral-50;
        border-top: 2px solid $neutral-100;
        padding: 1rem;

        .p-paginator-current {
            color: $neutral-700;
            font-weight: 500;
        }

        .p-paginator-pages .p-paginator-page {
            min-width: 2.5rem;
            height: 2.5rem;
            color: $neutral-700;
            border-radius: 8px;

            &.p-highlight {
                background: $primary-blue;
                color: white;
            }

            &:not(.p-highlight):hover {
                background: rgba(30, 64, 175, 0.1);
            }
        }
    }

    // Tags
    .p-tag {
        padding: 0.375rem 0.75rem;
        border-radius: 0.5rem;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: capitalize;
    }
}

// ============================================================================
// CELL CONTENT STYLES
// ============================================================================
.order-id-badge {
    font-family:
        ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
    font-weight: 700;
    color: $primary-green;
    font-size: 0.85rem;
}

.person-cell {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.person-name {
    font-weight: 600;
    color: $neutral-900;
    font-size: 0.875rem;
}

.person-meta {
    font-size: 0.75rem;
    color: #9ca3af;
}

.total-value {
    font-weight: 700;
    color: $neutral-900;
    font-size: 0.875rem;
}

.action-buttons {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 0.5rem;
}

::ng-deep .action-buttons .p-button {
    width: 2rem;
    height: 2rem;
    padding: 0;

    .p-button-icon {
        font-size: 0.875rem;
    }
}

// ============================================================================
// EMPTY STATE
// ============================================================================
.empty-state {
    text-align: center;
    padding: 3rem 1.5rem;
    color: $neutral-500;

    i {
        font-size: 2.5rem;
        color: $neutral-300;
        margin-bottom: 0.75rem;
        display: block;
    }

    p {
        margin: 0;
        font-size: 0.95rem;
    }
}

// ============================================================================
// DIALOG STYLES
// ============================================================================
.order-details-wrapper {
    background-color: #fff;
    font-family: inherit;
}

.details-header {
    background-color: #f8fafc;
    padding: 1.5rem;
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    border-bottom: 1px solid #e2e8f0;
}

.info-card {
    flex: 1;
    min-width: 180px;
    background: white;
    padding: 1rem;
    border-radius: 0.75rem;
    border: 1px solid #e2e8f0;
    display: flex;
    align-items: center;
    gap: 1rem;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

.card-icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
}

.card-content {
    display: flex;
    flex-direction: column;
}

.card-label {
    font-size: 0.75rem;
    color: #64748b;
    text-transform: uppercase;
    font-weight: 600;
    margin-bottom: 0.25rem;
}

.card-value {
    font-size: 1.125rem;
    font-weight: 700;
    color: #0f172a;
}

.details-content {
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.details-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
}

.section-card {
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 0.75rem;
    padding: 1.25rem;
}

.section-title {
    margin: 0 0 1rem 0;
    font-size: 1rem;
    color: #334155;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid #f1f5f9;

    i {
        color: #64748b;
    }
}

.info-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.75rem;
    font-size: 0.9rem;

    &:last-child {
        margin-bottom: 0;
    }
}

.info-label {
    color: #64748b;
}

.info-value {
    color: #0f172a;
    font-weight: 500;
    text-align: right;
}

.address-block {
    font-size: 0.9rem;
    color: #334155;
    line-height: 1.5;
}

.address-name {
    margin: 0 0 0.25rem 0;
    font-size: 1rem;
    color: #0f172a;
}

.address-line {
    margin: 0;
}

.table-scroll {
    overflow-x: auto;
}

.items-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9rem;

    th {
        text-align: left;
        padding: 0.75rem;
        background: #f8fafc;
        color: #64748b;
        font-weight: 600;
        font-size: 0.8rem;
        text-transform: uppercase;
    }

    td {
        padding: 0.75rem;
        border-bottom: 1px solid #f1f5f9;
        color: #334155;
        vertical-align: middle;
    }

    .center-cell {
        text-align: center;
    }

    .right-cell {
        text-align: right;
    }
}

.product-info {
    display: flex;
    flex-direction: column;
}

.product-name {
    font-weight: 500;
    color: #0f172a;
}

.product-sku {
    font-size: 0.75rem;
    color: #94a3b8;
}

.amount-bold {
    font-weight: 600;
    color: #0f172a;
}

.summary-row td {
    border-bottom: none;
    padding: 0.5rem 0.75rem;
}

.summary-label {
    text-align: right;
    color: #64748b;
    padding-right: 1rem;
}

.summary-value {
    text-align: right;
    color: #0f172a;
    font-weight: 500;

    &.discount {
        color: #ef4444;
    }
}

.total-row td {
    padding-top: 1rem;
    border-top: 2px solid #e2e8f0;
    font-size: 1.1rem;
}

.dialog-actions {
    padding: 1rem 1.5rem;
    background: #f8fafc;
    border-top: 1px solid #e2e8f0;
    display: flex;
    justify-content: flex-end;
    gap: 0.75rem;
}

// ============================================================================
// RESPONSIVE
// ============================================================================
@media (max-width: 1024px) {
    .filter-bar {
        flex-direction: column;
        align-items: stretch;
    }

    .filter-controls {
        justify-content: flex-start;
        flex-wrap: wrap;
    }
}

@media (max-width: 768px) {
    .view-orders-page {
        padding: 1rem;
    }

    .page-header {
        flex-direction: column;
    }

    .stats-row {
        grid-template-columns: repeat(2, minmax(0, 1fr));
    }

    .table-wrapper {
        overflow-x: auto;
    }
}

@media (max-width: 480px) {
    .stats-row {
        grid-template-columns: 1fr;
    }

    .page-title {
        font-size: 1.35rem;
    }
}
</file>

<file path="src/app/features/store/view-orders/view-orders.component.ts">
import { Component, OnInit, signal, ViewChild, ViewEncapsulation } from '@angular/core';
import { CommonModule } from '@angular/common';
import {
  FormsModule,
  FormBuilder,
  FormGroup,
  ReactiveFormsModule,
  Validators,
} from '@angular/forms';
import { Table, TableModule } from 'primeng/table';
import { ButtonModule } from 'primeng/button';
import { InputTextModule } from 'primeng/inputtext';
import { TagModule } from 'primeng/tag';
import { ToastModule } from 'primeng/toast';
import { SelectModule } from 'primeng/select';
import { DialogModule } from 'primeng/dialog';
import { InputNumberModule } from 'primeng/inputnumber';
import { MessageService } from 'primeng/api';

import { OrdersService } from '../services/orders.service';
import { Order, OrderItem, OrderStats } from '../interfaces/order.interface';
import { UserService } from '@/features/user-management/user.service';

@Component({
  selector: 'app-view-orders',
  standalone: true,
  imports: [
    CommonModule,
    FormsModule,
    ReactiveFormsModule,
    TableModule,
    ButtonModule,
    InputTextModule,
    TagModule,
    ToastModule,
    SelectModule,
    DialogModule,
    InputNumberModule,
  ],
  encapsulation:ViewEncapsulation.None,
  templateUrl: './view-orders.component.html',
  styleUrls: ['./view-orders.component.scss'],
  providers: [MessageService],
  
})
export class ViewOrdersComponent implements OnInit {
  @ViewChild('dt') dt!: Table;

  orders = signal<Order[]>([]);
  filteredOrders: Order[] = [];
  stats = signal<OrderStats & { totalOrdersToday?: number; weeklyRevenue?: number }>({
    totalOrders: 0,
    pendingOrders: 0,
    confirmedOrders: 0,
    shippedOrders: 0,
    deliveredOrders: 0,
    cancelledOrders: 0,
    totalRevenue: 0,
  });

  selectedOrder: Order | null = null;
  orderItems = signal<OrderItem[]>([]);
  orderDetailsVisible = false;
  loading = signal(false);

  searchQuery = '';
  selectedStatus: string | null = null;

  statusOptions = [
    { label: 'All', value: null },
    { label: 'Pending', value: 'pending' },
    { label: 'Confirmed', value: 'confirmed' },
    { label: 'Shipped', value: 'shipped' },
    { label: 'Delivered', value: 'delivered' },
    { label: 'Cancelled', value: 'cancelled' },
  ];
  
dateRangeOptions = [
  { label: 'Today', value: 'today' },
  { label: 'Last 7 days', value: 'last7' },
  { label: 'Last 30 days', value: 'last30' },
  { label: 'All time', value: 'all' },
];
selectedDateRange: 'today' | 'last7' | 'last30' | 'all' = 'last7';
selectedExecutiveId: string | null = null;

executiveFilterOptions: { label: string; value: string | null }[] = [
  { label: 'All executives', value: null },
  // after loadData, push { label: exec.name, value: exec._id }
];
  // Executive lookup
  private executivesById = new Map<string, { name: string; phone?: string }>();

  constructor(
    private ordersService: OrdersService,
    private userService: UserService,
    private messageService: MessageService,
  ) {}

  ngOnInit(): void {
    this.loadData();
  }

  // -------- DATA LOAD --------
 private async loadData() {
    this.loading.set(true);
    try {
      const [ordersResult, statsResult, execResult] = await Promise.all([
        this.ordersService.listOrders({
          status: this.selectedStatus ?? undefined,
          executiveId: this.selectedExecutiveId ?? undefined,
        }),
        this.ordersService.getOrderStats(),
        this.userService.getExecutives(
          { numItems: 500, cursor: null },
          { isActive: true },
        ),
      ]);

      const rawOrders = (ordersResult as any).page ?? ordersResult;
console.log('LIST ORDERS RAW LENGTH:', (rawOrders as any[]).length);
console.log('LIST ORDERS SAMPLE:', rawOrders.slice(0, 5));
      const normalizedOrders = (rawOrders as any[]).map((o) => {
        const subtotal = o.subtotal ?? 0;
        const discount = o.discount ?? 0;
        const tax = o.tax ?? 0;
        const shipping = o.shippingCost ?? 0;

        const computedTotal =
          o.totalAmount != null
            ? o.totalAmount
            : subtotal - discount + tax + shipping;

        return {
          ...o,
          customerName: o.customerName ?? 'N/A',
          customerEmail: o.customerEmail ?? 'N/A',
          totalAmount: computedTotal,
        } as Order & { executiveName?: string };
      });

      this.orders.set(normalizedOrders);

      // Stats (Convex already computes a lot; you can extend later)
      this.stats.set(statsResult as any);

      // Executives lookup + filter options
      const execList = (execResult as any).page ?? execResult;
      this.executivesById.clear();
      const filterOptions: { label: string; value: string | null }[] = [
        { label: 'All executives', value: null },
      ];

      for (const e of execList as any[]) {
        const rawId = (e as any)._id ?? (e as any).id ?? e.id;
        const key = String(rawId);
        let fullName: string | undefined = e.name;
        if (!fullName) {
          fullName = `${e.firstName ?? ''} ${e.lastName ?? ''}`.trim();
        }
        if (!fullName) {
          fullName = 'Unknown';
        }

        this.executivesById.set(key, {
          name: fullName,
          phone: e.phone,
        });

        filterOptions.push({
          label: fullName,
          value: key,
        });
      }

      this.executiveFilterOptions = filterOptions;

      this.applyFilters();
    } catch (err) {
      console.error('LOAD DATA ERROR:', err);
      this.messageService.add({
        severity: 'error',
        summary: 'Error',
        detail: 'Failed to load orders',
      });
    } finally {
      this.loading.set(false);
    }
  }


getExecutiveName(order: Order): string {
  // Prefer per-order name from API; fall back to map if needed
  if (order.executiveName) {
    return order.executiveName;
  }

  const ex = this.executivesById.get(String(order.executiveId));
  return ex?.name || 'Unknown';
}

  // -------- FILTERING --------
  onSearch() {
    this.applyFilters();
  }

  onStatusFilter() {
    this.applyFilters();
  }

private applyFilters() {
    const all = this.orders();
    const now = Date.now();

    let from: number | null = null;

    switch (this.selectedDateRange) {
      case 'today':
        from = new Date(
          new Date().setHours(0, 0, 0, 0),
        ).getTime();
        break;
      case 'last7':
        from = now - 7 * 24 * 60 * 60 * 1000;
        break;
      case 'last30':
        from = now - 30 * 24 * 60 * 60 * 1000;
        break;
      case 'all':
      default:
        from = null;
    }

    let filtered = all;

    if (from != null) {
      filtered = filtered.filter((o) => o.createdAt >= from);
    }

    if (this.searchQuery.trim()) {
      const q = this.searchQuery.toLowerCase();
      filtered = filtered.filter((o: any) => {
        const id = (o.orderNumber ?? String(o._id).slice(0, 8)).toLowerCase();
        const customer = (o.customerName ?? '').toLowerCase();
        const email = (o.customerEmail ?? '').toLowerCase();
        const exec = (o.executiveName ??
          this.getExecutiveName(o as Order & { executiveName?: string })).toLowerCase();

        return (
          id.includes(q) ||
          customer.includes(q) ||
          email.includes(q) ||
          exec.includes(q)
        );
      });
    }

    this.filteredOrders = filtered;
  }
  onQuickFilter(
    kind: 'today' | 'pending' | 'shipped' | 'delivered' | 'revenue7',
  ) {
    if (kind === 'today') {
      this.selectedDateRange = 'today';
      this.selectedStatus = null;
      this.applyFilters();
      return;
    }

    if (kind === 'pending' || kind === 'shipped' || kind === 'delivered') {
      this.selectedStatus = kind;
      this.selectedDateRange = 'last7';
      this.loadData();
      return;
    }

    if (kind === 'revenue7') {
      this.selectedDateRange = 'last7';
      // status left as-is; card is mainly about range
      this.applyFilters();
    }
  }
  onClearFilters() {
    this.searchQuery = '';
    this.selectedStatus = null;
    this.selectedExecutiveId = null;
    this.selectedDateRange = 'last7';
    this.loadData();
  }

  onExecutiveFilterChange() {
    this.loadData();
  }
  onDateRangeChange() {
    this.applyFilters();
  }
  // -------- DETAILS + ITEMS --------
  async viewOrderDetails(order: Order) {
    this.selectedOrder = order;
    this.orderItems.set([]);
    this.orderDetailsVisible = true;
    this.loading.set(true);

    try {
      const fullOrder = await this.ordersService.getOrder(order._id);

      if (fullOrder) {
        // merge full order so dialog + invoice see the same data
        this.selectedOrder = { ...order, ...(fullOrder as any) } as Order;

        if ('items' in fullOrder) {
          this.orderItems.set(
            ((fullOrder as any).items || []) as OrderItem[],
          );
        }
      }
    } catch {
      this.messageService.add({
        severity: 'error',
        summary: 'Error',
        detail: 'Failed to load order items',
      });
    } finally {
      this.loading.set(false);
    }
  }

  // -------- HELPERS --------
  formatCurrency(value: number | undefined | null): string {
    const n = value ?? 0;
    return `â‚¹${n.toFixed(2)}`;
  }

  getStatusSeverity(
    status: string,
  ): 'success' | 'info' | 'warn' | 'danger' | 'secondary' {
    const map: Record<
      string,
      'success' | 'info' | 'warn' | 'danger' | 'secondary'
    > = {
      pending: 'warn',
      confirmed: 'info',
      shipped: 'info',
      delivered: 'success',
      cancelled: 'danger',
    };
    return map[status.toLowerCase()] || 'secondary';
  }

  // -------- REFRESH + EXPORT --------
  refreshOrders() {
    this.loadData();
    this.messageService.add({
      severity: 'success',
      summary: 'Refreshed',
      detail: 'Orders data reloaded',
    });
  }

  exportOrders() {
    const headers = [
      'Order ID',
      'Executive',
      'Customer',
      'Email',
      'Phone',
      'Amount',
      'Status',
      'Payment Status',
      'Date',
    ];

    const data = this.filteredOrders.map((order) => [
      order.orderNumber ?? String(order._id).substring(0, 8),
      this.getExecutiveName(order),
      order.customerName ?? '',
      order.customerEmail ?? '',
      order.customerPhone ?? '',
      (order.totalAmount ?? 0).toString(),
      order.status ?? '',
      order.paymentStatus ?? '',
      new Date(order.createdAt).toLocaleDateString('en-IN'),
    ]);

    const csv = [headers, ...data].map((row) => row.join(',')).join('\n');
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `orders-${new Date()
      .toISOString()
      .split('T')[0]}.csv`;
    link.click();
    window.URL.revokeObjectURL(url);

    this.messageService.add({
      severity: 'success',
      summary: 'Success',
      detail: 'Orders exported successfully',
    });
  }

  // -------- INVOICE PRINTING --------
  async downloadInvoice(order: Order) {
    if (!this.selectedOrder || this.selectedOrder._id !== order._id) {
      await this.viewOrderDetails(order);
    }
    if (this.selectedOrder) {
      this.printOrder(this.selectedOrder);
    }
  }

  printOrder(order: Order) {
    const items = this.orderItems();

    const printWindow = window.open('', '', 'height=600,width=800');
    if (!printWindow) return;

    const itemsRows = items
      .map(
        (item) => `
        <tr>
          <td>
            ${item.productName || 'N/A'}
            <br /><small style="color: #6b7280;">SKU: ${
              item.productSku || 'N/A'
            }</small>
          </td>
          <td style="text-align: center;">${item.quantity || 0}</td>
          <td style="text-align: right;">â‚¹${(item.unitPrice ?? 0).toFixed(
            2,
          )}</td>
          <td style="text-align: right;">â‚¹${(item.totalPrice ?? 0).toFixed(
            2,
          )}</td>
        </tr>`,
      )
      .join('');

    const safeOrderId = (
      order.orderNumber ?? String(order._id).substring(0, 8) ?? 'N/A'
    )
      .toString()
      .toUpperCase();

    const safeStatus = (order.status ?? 'N/A').toString().toUpperCase();
    const safePaymentStatus = (order.paymentStatus ?? 'N/A')
      .toString()
      .toUpperCase();

    const executiveName = this.getExecutiveName(order);

    const subtotal = order.subtotal ?? 0;
    const discount = order.discount ?? 0;
    const tax = order.tax ?? 0;
    const shipping = order.shippingCost ?? 0;
    const total =
      order.totalAmount ?? subtotal - discount + tax + shipping;

    printWindow.document.write(`
      <html>
        <head>
          <title>Order Invoice - ${safeOrderId}</title>
          <style>
            body {
              font-family: Arial, sans-serif;
              padding: 20px;
              max-width: 800px;
              margin: 0 auto;
            }
            .header {
              text-align: center;
              margin-bottom: 30px;
              border-bottom: 2px solid #111827;
              padding-bottom: 20px;
            }
            .header h1 {
              margin: 0 0 10px 0;
              color: #111827;
            }
            .section {
              margin-bottom: 25px;
            }
            .section h3 {
              margin: 0 0 10px 0;
              color: #111827;
            }
            .label {
              font-weight: bold;
              color: #374151;
            }
            table {
              width: 100%;
              border-collapse: collapse;
              margin-top: 10px;
            }
            th, td {
              border: 1px solid #e5e7eb;
              padding: 10px;
              text-align: left;
              font-size: 0.875rem;
            }
            th {
              background-color: #f9fafb;
              font-weight: 600;
              color: #374151;
            }
            tfoot td {
              font-weight: 500;
            }
            tfoot tr:last-child td {
              font-weight: 700;
              font-size: 1.1em;
              background-color: #f9fafb;
            }
            .info-grid {
              display: grid;
              grid-template-columns: 1fr 1fr;
              gap: 20px;
              margin-bottom: 20px;
            }
            @media print {
              body {
                padding: 0;
              }
            }
          </style>
        </head>
        <body>
          <div class="header">
            <h1>Order Invoice</h1>
            <p style="margin: 5px 0; color: #6b7280;">
              Order ID: <strong>${safeOrderId}</strong>
            </p>
            <p style="margin: 5px 0; color: #6b7280;">
              Date: ${new Date(order.createdAt).toLocaleDateString('en-IN', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
              })}
            </p>
          </div>

          <div class="info-grid">
            <div class="section">
              <h3>Executive Information</h3>
              <p><span class="label">Name: </span>${executiveName}</p>
            </div>

            <div class="section">
              <h3>Customer Information</h3>
              <p><span class="label">Name: </span>${order.customerName ?? 'N/A'}</p>
              <p><span class="label">Email: </span>${order.customerEmail ?? 'N/A'}</p>
              <p><span class="label">Phone: </span>${order.customerPhone ?? 'N/A'}</p>
            </div>
          </div>

          <div class="section">
            <h3>Shipping Address</h3>
            <p><span class="label">Ship To: </span>${order.shipToName ?? 'N/A'}</p>
            <p><span class="label">Phone: </span>${order.shipToPhone ?? 'N/A'}</p>
            <p>${order.shipToAddress ?? 'N/A'}</p>
            <p>
              ${order.shipToCity ?? 'N/A'}, 
              ${order.shipToState ?? 'N/A'} - 
              ${order.shipToPincode ?? 'N/A'}
            </p>
          </div>

          <div class="section">
            <h3>Order Items</h3>
            <table>
              <thead>
                <tr>
                  <th>Product</th>
                  <th style="text-align: center; width: 100px;">Quantity</th>
                  <th style="text-align: right; width: 120px;">Unit Price</th>
                  <th style="text-align: right; width: 120px;">Total</th>
                </tr>
              </thead>
              <tbody>
                ${itemsRows}
              </tbody>
              <tfoot>
                <tr>
                  <td colspan="3" style="text-align: right;">Subtotal:</td>
                  <td style="text-align: right;">â‚¹${subtotal.toFixed(2)}</td>
                </tr>
                <tr>
                  <td colspan="3" style="text-align: right;">Discount:</td>
                  <td style="text-align: right;">-â‚¹${discount.toFixed(2)}</td>
                </tr>
                <tr>
                  <td colspan="3" style="text-align: right;">Tax:</td>
                  <td style="text-align: right;">â‚¹${tax.toFixed(2)}</td>
                </tr>
                <tr>
                  <td colspan="3" style="text-align: right;">Shipping:</td>
                  <td style="text-align: right;">â‚¹${shipping.toFixed(2)}</td>
                </tr>
                <tr>
                  <td colspan="3" style="text-align: right;"><strong>Final Amount:</strong></td>
                  <td style="text-align: right;"><strong>â‚¹${total.toFixed(2)}</strong></td>
                </tr>
              </tfoot>
            </table>
          </div>

          <div class="section">
            <h3>Order Details</h3>
            <p><span class="label">Status: </span>${safeStatus}</p>
            <p><span class="label">Payment Status: </span>${safePaymentStatus}</p>
            <p><span class="label">Payment Method: </span>${order.paymentMethod ?? 'N/A'}</p>
            ${
              order.trackingNumber
                ? `<p><span class="label">Tracking Number: </span>${order.trackingNumber}</p>`
                : ''
            }
            ${
              order.notes
                ? `<p><span class="label">Notes: </span>${order.notes}</p>`
                : ''
            }
          </div>
        </body>
      </html>
    `);

    printWindow.document.close();
    printWindow.focus();
    setTimeout(() => {
      printWindow.print();
      printWindow.close();
    }, 250);
  }
}
</file>

<file path="src/app/features/task-management/models/index.ts">
// src/app/features/task-management/models/index.ts

// Re-export everything for clean imports
export * from './task.interface';
export * from './task-stats.interface';
</file>

<file path="src/app/features/task-management/models/task-stats.interface.ts">
// src/app/features/task-management/models/task-stats.interface.ts

import { Id } from 'convex/_generated/dataModel';
import { TaskStatus, TaskPriority } from './task.interface';

// ============================================================================
// STATS INTERFACES
// ============================================================================

export interface MyTaskStats {
  total: number;
  pending: number;
  inProgress: number;
  completed: number;
  overdue: number;
  thisWeek: number;
  completionRate: number;
}

export interface TaskStats {
  total: number;
  pending: number;
  inProgress: number;
  completed: number;
  overdue: number;
  urgent: number;
  high: number;
  medium: number;
  low: number;
  completionRate: number;
}

export interface DashboardTaskStats {
  total: number;
  pending: number;
  inProgress: number;
  completed: number;
  overdue: number;
  completionRate: number;
}

// ============================================================================
// TOP PERFORMERS
// ============================================================================

export interface TopPerformer {
  _id: Id<'executives'>;
  name: string;
  employeeId: string;
  email: string;
  totalTasks: number;
  completedTasks: number;
  completionRate: number;
}

// ============================================================================
// DASHBOARD SUMMARY
// ============================================================================

export interface DashboardSummary {
  taskStats: DashboardTaskStats;
  topPerformers: TopPerformer[];
  recentActivity: RecentActivityItem[];
  totalExecutives: number;
  activeExecutives: number;
}

export interface RecentActivityItem {
  _id: Id<'tasks'>;
  title: string;
  status: TaskStatus;
  priority: TaskPriority;
  dueDate: number;
  createdAt: number;
}
</file>

<file path="src/app/features/task-management/models/task.interface.ts">
// src/app/features/task-management/models/task.interface.ts

import { Id } from "convex/_generated/dataModel";


// ============================================================================
// TYPE ALIASES
// ============================================================================

export type TaskStatus = 'pending' | 'in_progress' | 'overdue' | 'completed';
export type ExecutiveTaskStatus = 'in_progress' | 'completed';
export type AdminTaskStatus = 'pending' | 'in_progress' | 'overdue' | 'completed';
export type TaskPriority = 'low' | 'medium' | 'high' | 'urgent';
export type TaskType = 'verification' | 'survey' | 'collection' | 'other';

// ============================================================================
// BASE TASK INTERFACE
// ============================================================================

export interface Task {
  _id: Id<'tasks'>;
  title: string;
  description: string;
  type: 'verification' | 'survey' | 'collection' | 'other';
  priority: 'low' | 'medium' | 'high' | 'urgent';
  rootId: string;
  hierarchyId?: Id<'hierarchies'>; // âœ… Optional
  
  // âœ… Geographic fields
  zone?: string;
  district?: string;
  subdistrict?: string;
  localBody?: string;
  ward?: string;
  
  assignedBy: Id<'admin_users'>;
  assignedTo: Id<'executives'>;
  dueDate: number;
  estimatedHours: number;
  status: 'pending' | 'in_progress' | 'completed' | 'overdue';
  completedAt?: number;
  wardId: string;
  location?: {
    latitude: number;
    longitude: number;
    address: string;
  };
  notes?: string;
  createdAt: number;
  updatedAt: number;
  isDeleted: boolean;
}

// ============================================================================
// ENRICHED TASK (with joined data)
// ============================================================================

export interface EnrichedTask extends Task {
  executiveName?: string; // âœ… Make optional
  executiveEmployeeId?: string; // âœ… Make optional
  executivePhone?: string; // âœ… Make optional
  assignerName?: string; // âœ… Make optional
  isOverdue: boolean;
  hierarchyName?: string;
  assignedToName?: string; // âœ… Add this
  assignedByName?: string; // âœ… Add this
  approvalId?: Id<"approval_requests">;
}

// ============================================================================
// CREATE/UPDATE DTOs
// ============================================================================

export interface CreateTaskData {
  title: string;
  description: string;
  priority: TaskPriority;
  assignedTo: Id<'executives'>;
  dueDate: number;
  estimatedHours: number;
  wardId: string;
  location?: TaskLocation;
  notes?: string;
  type: TaskType;
}

export interface UpdateTaskData {
  title?: string;
  description?: string;
  status?: AdminTaskStatus;
  priority?: TaskPriority;
  dueDate?: number;
  estimatedHours?: number;
  notes?: string;
  assignedTo?: Id<'executives'>;  
  wardId?: string;                
}

export interface TaskLocation {
  latitude: number;
  longitude: number;
  address: string;
}

export interface TaskFilters {
  status?: 'pending' | 'in_progress' | 'completed' | 'overdue';
  assignedTo?: Id<'executives'>;
  priority?: 'low' | 'medium' | 'high' | 'urgent';
  zone?: string;
  district?: string;
}

export interface CreateTaskArgs {
  title: string;
  description: string;
  type: 'verification' | 'survey' | 'collection' | 'other';
  priority: 'low' | 'medium' | 'high' | 'urgent';
  hierarchyId?: Id<'hierarchies'>; // âœ… Optional
  zone?: string;
  district?: string;
  subdistrict?: string;
  localBody?: string;
  ward?: string;
  assignedTo: Id<'executives'>;
  dueDate: number;
  estimatedHours: number;
  wardId: string;
  location?: {
    latitude: number;
    longitude: number;
    address: string;
  };
  notes?: string;
}

export interface UpdateTaskArgs {
  taskId: Id<'tasks'>;
  title?: string;
  description?: string;
  priority?: 'low' | 'medium' | 'high' | 'urgent';
  status?: 'pending' | 'in_progress' | 'completed' | 'overdue';
  dueDate?: number;
  estimatedHours?: number;
  notes?: string;
  location?: {
    latitude: number;
    longitude: number;
    address: string;
  };
}

export interface Executive {
  _id: Id<'executives'>;
  name: string;
  email: string;
  employeeId: string;
  wardId: string;
  wardName?: string;           // âœ… display name
  assignedWards?: string[];
  assignedWardNames?: string[]; // optional, if you use multiple wards later
  zone?: string;
  district?: string;
  hierarchyId?: Id<'hierarchies'>;
}
</file>

<file path="src/app/features/task-management/services/task.service.ts">
// src/app/features/task-management/services/task.service.ts

import { Injectable } from '@angular/core';
import { ConvexService } from '@/core/services/convex.service';
import { api } from 'convex/_generated/api';
import { Id } from 'convex/_generated/dataModel';

import {
    Task,
    EnrichedTask,
    TaskStatus,
    TaskPriority,
    ExecutiveTaskStatus,
    AdminTaskStatus,
    CreateTaskData,
    UpdateTaskData,
    TaskStats,
    MyTaskStats,
    DashboardSummary,
    TopPerformer
} from '../models';

@Injectable({
    providedIn: 'root'
})
export class TaskService {
    private get convex() {
        return this.convexService.client;
    }

    constructor(private convexService: ConvexService) {}

    // ============================================================================
    // ADMIN TASK QUERIES
    // ============================================================================
    listTasks(
        paginationOpts: { numItems: number; cursor: string | null },
        filters?: {
            status?: TaskStatus;
            priority?: TaskPriority;
            assignedTo?: Id<'executives'>;
            search?: string;
        }
    ) {
        return this.convex.query(api.tasks.admin.queries.listTasks, {
            paginationOpts,
            ...filters
        });
    }

    getTask(taskId: Id<'tasks'>) {
        return this.convex.query(api.tasks.admin.queries.getTask, { taskId });
    }
async getPendingApprovals(): Promise<EnrichedTask[]> {
  return this.convex.query(api.tasks.admin.queries.getPendingApprovals, {});
}
    // ============================================================================
    // APPROVAL MUTATIONS (YOUR PATH: tasks/me/mutation)
    // ============================================================================
async approveTaskCompletion(approvalId: Id<'approval_requests'>) {
  console.log('ðŸ”µ [SERVICE] approveTaskCompletion called with:', approvalId);
  console.log('ðŸ”µ [SERVICE] approvalId type:', typeof approvalId);
  
  try {
    const profile = await this.convex.query(api.auth.getCurrentUserProfile, {});
    console.log('ðŸ”µ [SERVICE] Profile loaded:', profile);
    
    if (!profile?.adminUserId) {
      throw new Error("No admin profile found");
    }
    
    const approverId = profile.adminUserId;
    console.log('ðŸ”µ [SERVICE] Calling mutation with:', { approvalId, approverId });
    
    const result = await this.convex.mutation(api.tasks.me.mutation.approveTaskCompletion, {
      approvalId,
      approverId
    });
    
    console.log('ðŸ”µ [SERVICE] Mutation result:', result);
    return result;
    
  } catch (error) {
    console.error('ðŸ”´ [SERVICE] Error in approveTaskCompletion:', error);
    throw error;
  }
}

async rejectTaskCompletion(approvalId: Id<'approval_requests'>, rejectionReason: string) {
  const profile = await this.convex.query(api.auth.getCurrentUserProfile, {});

    if (!profile?.adminUserId) {
    throw new Error("No admin profile found");
  }
  const approverId = profile.adminUserId!;  // âœ… Same fix
  
  return this.convex.mutation(api.tasks.me.mutation.rejectTaskCompletion, {
    approvalId,
    rejectionReason,
    approverId
  });
}

    // ============================================================================
    // ADMIN TASK MUTATIONS
    // ============================================================================
    createTask(taskData: CreateTaskData) {
        return this.convex.mutation(
            api.tasks.admin.mutation.createTask,
            taskData
        );
    }

updateTask(taskId: Id<'tasks'>, updates: UpdateTaskData) {
  return this.convex.mutation(api.tasks.admin.mutation.updateTask, {
    taskId,
    ...updates
  });
}

    deleteTask(taskId: Id<'tasks'>) {
        return this.convex.mutation(api.tasks.admin.mutation.deleteTask, {
            taskId
        });
    }

    // ============================================================================
    // EXECUTIVE TASKS (tasks/me)
    // ============================================================================
    getMyTasks(filters?: { status?: TaskStatus; priority?: TaskPriority }) {
        return this.convex.query(
            api.tasks.me.queries.getMyTasks,
            filters || {}
        );
    }

    updateMyTaskStatus(
        taskId: Id<'tasks'>,
        status: ExecutiveTaskStatus,
        notes?: string,
        location?: { latitude: number; longitude: number; address: string }
    ) {
        return this.convex.mutation(api.tasks.me.mutation.updateTaskStatus, {
            taskId,
            status,
            notes,
            location
        });
    }

    // ============================================================================
    // UTILITY METHODS
    // ============================================================================
    isTaskOverdue(task: Task): boolean {
        return !task.completedAt && task.dueDate < Date.now();
    }

    getStatusColor(status: TaskStatus): string {
        const colors: Record<TaskStatus, string> = {
            pending: '#FFA726',
            in_progress: '#42A5F5',
            overdue: '#EF5350',
            completed: '#66BB6A'
        };
        return colors[status] || '#757575';
    }

    getPriorityColor(priority: TaskPriority): string {
        const colors: Record<TaskPriority, string> = {
            low: '#78909C',
            medium: '#FFA726',
            high: '#FF7043',
            urgent: '#EF5350'
        };
        return colors[priority] || '#757575';
    }

    formatDueDate(timestamp: number): string {
        const date = new Date(timestamp);
        const now = new Date();
        const diffMs = timestamp - now.getTime();
        const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

        if (diffDays < 0) {
            return `${Math.abs(diffDays)} days overdue`;
        } else if (diffDays === 0) {
            return 'Due today';
        } else if (diffDays === 1) {
            return 'Due tomorrow';
        } else if (diffDays < 7) {
            return `Due in ${diffDays} days`;
        } else {
            return date.toLocaleDateString('en-IN', {
                day: 'numeric',
                month: 'short',
                year: 'numeric'
            });
        }
    }

    getStatusSeverity(
        status: TaskStatus
    ): 'success' | 'info' | 'warn' | 'danger' {
        switch (status) {
            case 'completed':
                return 'success';
            case 'in_progress':
                return 'info';
            case 'pending':
                return 'warn';
            case 'overdue':
                return 'danger';
            default:
                return 'info';
        }
    }

    getPrioritySeverity(
        priority: TaskPriority
    ): 'success' | 'info' | 'warn' | 'danger' {
        switch (priority) {
            case 'low':
                return 'success';
            case 'medium':
                return 'info';
            case 'high':
                return 'warn';
            case 'urgent':
                return 'danger';
            default:
                return 'info';
        }
    }
}
</file>

<file path="src/app/features/task-management/task-management.route.ts">
import { Component } from "@angular/core";
import { TaskFormComponent } from "./tasks/tasks-create/task-form.component";
import { Routes } from "@angular/router";
import { TaskListComponent } from "./tasks/task-list/tasks-list.component";
import { TaskApproveComponent } from "./tasks/tasks-approve/task-approve";


export const TASK_MANAGEMENT_ROUTE: Routes =[
    {path:'tasks-add',component:TaskFormComponent},
    {path:'tasks-edit/:id',component:TaskFormComponent},
    {path:'tasks-list',component:TaskListComponent},
    {path:'tasks-approve',component:TaskApproveComponent}
    

]
</file>

<file path="src/app/features/task-management/tasks/task-list/tasks-list.component.scss">
// ============================================
// TASK LIST - ENTERPRISE DESIGN
// ============================================

// Color System
$primary-blue: #1e40af;
$primary-blue-light: #3b82f6;
$success-green: #10b981;
$success-light: #d1fae5;
$warning-orange: #f59e0b;
$warning-light: #fef3c7;
$danger-red: #ef4444;
$danger-light: #fee2e2;
$info-blue: #3b82f6;
$info-light: #dbeafe;
$neutral-50: #f9fafb;
$neutral-100: #f3f4f6;
$neutral-200: #e5e7eb;
$neutral-300: #d1d5db;
$neutral-500: #6b7280;
$neutral-700: #374151;
$neutral-900: #111827;

// ============================================
// PAGE CONTAINER
// ============================================
.task-list-container {
  padding: 2rem;
  background: $neutral-50;
  min-height: 100vh;

  @media (max-width: 768px) {
    padding: 1rem;
  }
}

// ============================================
// HEADER SECTION
// ============================================
.page-header {
  background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
  border-radius: 16px;
  padding: 2rem;
  margin-bottom: 2rem;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  border: 1px solid $neutral-200;

  .header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1.5rem;

    @media (max-width: 768px) {
      flex-direction: column;
      align-items: flex-start;
    }
  }

  .title-section {
    flex: 1;

    .page-title {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin: 0 0 0.5rem 0;
      font-size: 1.75rem;
      font-weight: 700;
      color: $neutral-900;

      i {
        font-size: 2rem;
        background: linear-gradient(135deg, $primary-blue-light, $primary-blue);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
    }

    .page-subtitle {
      margin: 0;
      color: $neutral-500;
      font-size: 0.95rem;
      font-weight: 500;
    }
  }

  .create-btn {
    background: linear-gradient(135deg, $primary-blue-light, $primary-blue);
    border: none;
    box-shadow: 0 2px 8px rgba(30, 64, 175, 0.25);
    transition: all 0.3s ease;
    font-weight: 600;

    &:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(30, 64, 175, 0.35);
    }
  }
}

// ============================================
// SEARCH & FILTERS
// ============================================
.filters-section {
  background: white;
  border-radius: 12px;
  padding: 1.5rem;
  margin-bottom: 2rem;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  border: 1px solid $neutral-200;

  .search-wrapper {
    display: flex;
    gap: 1rem;
    align-items: center;

    @media (max-width: 768px) {
      flex-direction: column;
    }

    ::ng-deep {
      .p-iconfield {
        flex: 1;

        .p-inputtext {
          width: 100%;
          border-radius: 8px;
          border: 1px solid $neutral-300;
          padding: 0.75rem 1rem 0.75rem 2.5rem;
          font-size: 0.95rem;
          transition: all 0.2s ease;

          &:focus {
            border-color: $primary-blue;
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
          }
        }

        .p-inputicon {
          color: $neutral-500;
          left: 0.75rem;
        }
      }
    }
  }
}

// ============================================
// TABLE CARD
// ============================================
.table-card {
  background: white;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  border: 1px solid $neutral-200;

  ::ng-deep {
    // Table Header
    .p-datatable-thead > tr > th {
      background: linear-gradient(180deg, #f8fafc 0%, #f1f5f9 100%);
      color: $neutral-700;
      font-weight: 600;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      padding: 1rem;
      border-bottom: 2px solid $neutral-200;

      &:hover {
        background: linear-gradient(180deg, #f1f5f9 0%, #e2e8f0 100%);
      }
    }

    // Table Body
    .p-datatable-tbody > tr {
      transition: all 0.2s ease;
      border-bottom: 1px solid $neutral-100;

      &:hover {
        background: linear-gradient(90deg, rgba(30, 64, 175, 0.02) 0%, rgba(30, 64, 175, 0.05) 100%);
        transform: translateX(2px);
      }

      > td {
        padding: 1rem;
        color: $neutral-700;
        font-size: 0.95rem;
        vertical-align: middle;
      }
    }

    // Remove default PrimeNG striping
    .p-datatable-striped .p-datatable-tbody > tr:nth-child(even) {
      background: transparent;
    }
  }
}

// ============================================
// TASK TITLE CELL
// ============================================
.task-title-cell {
  .task-name {
    font-weight: 600;
    color: $neutral-900;
    display: block;
    margin-bottom: 0.25rem;
    font-size: 0.95rem;
  }

  .task-description {
    font-size: 0.85rem;
    color: $neutral-500;
    font-style: italic;
    display: block;
    margin-top: 0.25rem;
  }
}

// ============================================
// ASSIGNEE CELL
// ============================================
.assignee-cell {
  display: flex;
  align-items: center;
  gap: 0.75rem;

  ::ng-deep .p-avatar {
    background: linear-gradient(135deg, $primary-blue-light, $primary-blue);
    color: white;
    font-weight: 600;
    font-size: 0.9rem;
    box-shadow: 0 2px 6px rgba(30, 64, 175, 0.2);
  }

  .assignee-info {
    display: flex;
    flex-direction: column;

    .assignee-name {
      font-weight: 600;
      color: $neutral-900;
      font-size: 0.95rem;
    }

    .assignee-id {
      font-size: 0.8rem;
      color: $neutral-500;
      font-family: 'Courier New', monospace;
    }
  }
}

// ============================================
// PRIORITY BADGES (Muted, less repetitive)
// ============================================
.priority-badge {
  display: inline-block;
  padding: 0.35rem 0.75rem;
  border-radius: 6px;
  font-size: 0.8rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.3px;

  &.priority-urgent {
    background: $danger-light;
    color: $danger-red;
    border: 1px solid rgba(239, 68, 68, 0.2);
  }

  &.priority-high {
    background: $warning-light;
    color: $warning-orange;
    border: 1px solid rgba(245, 158, 11, 0.2);
  }

  &.priority-medium {
    background: $info-light;
    color: $info-blue;
    border: 1px solid rgba(59, 130, 246, 0.2);
  }

  &.priority-low {
    background: $success-light;
    color: $success-green;
    border: 1px solid rgba(16, 185, 129, 0.2);
  }
}

// ============================================
// DUE DATE CELL (Smart colors)
// ============================================
.due-date-cell {
  font-weight: 500;
  font-size: 0.9rem;

  &.overdue {
    color: $danger-red;
    font-weight: 600;
    
    .overdue-icon {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.25rem 0.5rem;
      background: $danger-light;
      border-radius: 6px;
      font-size: 0.8rem;
      margin-top: 0.25rem;
      border: 1px solid rgba(239, 68, 68, 0.2);

      i {
        font-size: 0.75rem;
      }
    }
  }

  &.upcoming {
    color: $warning-orange;
    font-weight: 500;
  }

  &.normal {
    color: $neutral-700;
  }
}

// ============================================
// STATUS TAGS (Softer, refined)
// ============================================
::ng-deep .p-tag {
  font-size: 0.8rem;
  font-weight: 600;
  padding: 0.4rem 0.8rem;
  border-radius: 6px;
  text-transform: uppercase;
  letter-spacing: 0.3px;

  &.p-tag-success {
    background: $success-light;
    color: $success-green;
    border: 1px solid rgba(16, 185, 129, 0.2);
  }

  &.p-tag-info {
    background: $info-light;
    color: $info-blue;
    border: 1px solid rgba(59, 130, 246, 0.2);
  }

  &.p-tag-warn,
  &.p-tag-warning {
    background: $warning-light;
    color: $warning-orange;
    border: 1px solid rgba(245, 158, 11, 0.2);
  }

  &.p-tag-danger {
    background: $danger-light;
    color: $danger-red;
    border: 1px solid rgba(239, 68, 68, 0.2);
  }
}

// ============================================
// ACTION MENU (Three-dot button)
// ============================================
.action-menu-btn {
  ::ng-deep .p-button {
    width: 36px;
    height: 36px;
    border-radius: 8px;
    background: transparent;
    color: $neutral-500;
    border: 1px solid $neutral-300;
    transition: all 0.2s ease;

    &:hover {
      background: $neutral-100;
      color: $neutral-700;
      transform: translateY(-2px);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }

    &:focus {
      box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
    }
  }
}

// ============================================
// CONTACT COLUMN (if exists)
// ============================================
.contact-cell {
  color: $neutral-500;
  font-size: 0.9rem;
  font-style: italic;
}

// ============================================
// EMPTY STATE
// ============================================
.empty-state {
  text-align: center;
  padding: 4rem 2rem;
  color: $neutral-500;

  i {
    font-size: 4rem;
    color: $neutral-300;
    margin-bottom: 1rem;
  }

  h3 {
    color: $neutral-700;
    font-size: 1.25rem;
    margin: 1rem 0 0.5rem 0;
  }

  p {
    color: $neutral-500;
    margin: 0;
  }
}

// ============================================
// LOADING STATE
// ============================================
.loading-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 4rem 2rem;
  background: white;
  border-radius: 12px;
  margin-top: 2rem;

  i {
    font-size: 3rem;
    color: $primary-blue;
    margin-bottom: 1rem;
  }

  p {
    color: $neutral-500;
    font-size: 1rem;
  }
}

// ============================================
// RESPONSIVE DESIGN
// ============================================
@media (max-width: 992px) {
  .table-card ::ng-deep {
    .p-datatable-thead > tr > th,
    .p-datatable-tbody > tr > td {
      padding: 0.75rem;
      font-size: 0.85rem;
    }
  }

  .assignee-cell {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.5rem;
  }
}

@media (max-width: 768px) {
  .page-header {
    padding: 1.5rem;

    .title-section .page-title {
      font-size: 1.5rem;
    }
  }

  .filters-section {
    padding: 1rem;
  }
}
</file>

<file path="src/app/features/task-management/tasks/task-list/tasks-list.component.ts">
// src/app/features/task-management/tasks/tasks-list/tasks-list.component.ts

import { Component, OnInit } from '@angular/core';
import { CommonModule } from '@angular/common';
import { Router } from '@angular/router';
import { Table, TableModule } from 'primeng/table';
import { ButtonModule } from 'primeng/button';
import { InputTextModule } from 'primeng/inputtext';
import { TagModule } from 'primeng/tag';
import { AvatarModule } from 'primeng/avatar';
import { IconFieldModule } from 'primeng/iconfield';
import { InputIconModule } from 'primeng/inputicon';
import { MenuModule } from 'primeng/menu';
import { MenuItem, MessageService } from 'primeng/api';
import { TooltipModule } from 'primeng/tooltip';
import { ToastModule } from 'primeng/toast';

// âœ… Import from centralized models and service
import { EnrichedTask, TaskStatus, TaskPriority } from '../../models';
import { TaskService } from '../../services/task.service';

@Component({
  selector: 'app-task-list',
  standalone: true,
  imports: [
    CommonModule,
    TableModule,
    ButtonModule,
    InputTextModule,
    TagModule,
    AvatarModule,
    IconFieldModule,
    InputIconModule,
    MenuModule,
    TooltipModule,
    ToastModule
  ],
  providers: [MessageService],
  templateUrl: './tasks.list.component.html',
  styleUrls: ['./tasks-list.component.scss']
})
export class TaskListComponent implements OnInit {
  tasks: EnrichedTask[] = [];
  isLoading = true;
  actionMenuItems: MenuItem[] = [];

  constructor(
    private taskService: TaskService,
    private messageService: MessageService,
    private router: Router
  ) {}

  async ngOnInit() {
    await this.loadTasks();
  }

async loadTasks() {
  this.isLoading = true;
  try {
    console.log('ðŸ” Loading tasks...');
    console.log('ðŸ” Auth token:', localStorage.getItem('convex-token')); // Debug
    
    const result = await this.taskService.listTasks(
      { numItems: 100, cursor: null }
    );
    
    console.log('âœ… Tasks loaded:', result); // Debug
    this.tasks = result.page;
  } catch (error: any) {
    console.error('âŒ Failed to load tasks:', error);
    console.error('Error details:', error.message, error.stack); // Debug
    
    this.messageService.add({
      severity: 'error',
      summary: 'Error',
      detail: error.message || 'Failed to load tasks',
      life: 3000
    });
  } finally {
    this.isLoading = false;
  }
}
  onGlobalFilter(table: Table, event: Event) {
    table.filterGlobal((event.target as HTMLInputElement).value, 'contains');
  }

  onActionsMenuClick(menu: any, event: any, task: EnrichedTask) {
    this.actionMenuItems = [
      {
        label: 'View Details',
        icon: 'pi pi-eye',
        command: () => this.viewTask(task)
      },
      {
        label: 'Edit Task',
        icon: 'pi pi-pencil',
        command: () => this.editTask(task)
      },
      {
        label: 'Reassign',
        icon: 'pi pi-user-edit',
        command: () => this.reassignTask(task)
      },
      {
        separator: true
      },
      {
        label: 'Delete',
        icon: 'pi pi-trash',
        command: () => this.deleteTask(task),
        styleClass: 'text-red-500'
      }
    ];
    menu.toggle(event);
  }

  viewTask(task: EnrichedTask) {
    // TODO: Navigate to task details or open dialog
    console.log('View task:', task);
  }

  editTask(task: EnrichedTask) {
    // TODO: Navigate to edit page or open dialog
    this.router.navigate(['tasks/tasks-edit/', task._id]);
  }

  async reassignTask(task: EnrichedTask) {
    // TODO: Open reassign dialog
    console.log('Reassign task:', task);
  }

  async deleteTask(task: EnrichedTask) {
    // TODO: Add confirmation dialog
    try {
      await this.taskService.deleteTask(task._id);
      this.messageService.add({
        severity: 'success',
        summary: 'Success',
        detail: 'Task deleted successfully',
        life: 3000
      });
      await this.loadTasks();
    } catch (error) {
      console.error('Failed to delete task:', error);
      this.messageService.add({
        severity: 'error',
        summary: 'Error',
        detail: 'Failed to delete task',
        life: 3000
      });
    }
  }

  getSeverity(status: TaskStatus): 'success' | 'info' | 'warn' | 'danger' {
    switch (status) {
      case 'completed':
        return 'success';
      case 'in_progress':
        return 'info';
      case 'pending':
        return 'warn';
      case 'overdue':
        return 'danger';
      default:
        return 'info';
    }
  }

  getPrioritySeverity(priority: TaskPriority): 'success' | 'info' | 'warn' | 'danger' {
    switch (priority) {
      case 'low':
        return 'success';
      case 'medium':
        return 'info';
      case 'high':
        return 'warn';
      case 'urgent':
        return 'danger';
      default:
        return 'info';
    }
  }

  formatDueDate(timestamp: number): string {
    return this.taskService.formatDueDate(timestamp);
  }

  navigateToCreate() {
    this.router.navigate(['tasks/tasks-add']);
  }
}
</file>

<file path="src/app/features/task-management/tasks/task-list/tasks.list.component.html">
<!-- tasks-list.component.html -->
<div class="task-list-container">
    <!-- Page Header -->
    <div class="page-header">
        <div class="header-content">
            <div class="title-section">
                <h1 class="page-title">
                    <i class="pi pi-list-check"></i>
                    Manage All Tasks
                </h1>
                <p class="page-subtitle">
                    Monitor and manage {{ tasks.length }} tasks across your
                    organization
                </p>
            </div>
            <div class="header-actions">
                <button
                    pButton
                    type="button"
                    label="Create Task"
                    icon="pi pi-plus"
                    class="create-btn"
                    (click)="navigateToCreate()"
                ></button>
                <button
                    pButton
                    type="button"
                    icon="pi pi-refresh"
                    class="p-button-outlined refresh-btn-outline"
                    [loading]="isLoading"
                    (click)="loadTasks()"
                    pTooltip="Refresh"
                ></button>
            </div>
        </div>
    </div>

    <!-- Filters Section -->
    <div class="filters-section">
        <div class="search-wrapper">
            <p-iconfield iconPosition="left">
                <p-inputicon styleClass="pi pi-search" />
                <input
                    pInputText
                    type="text"
                    placeholder="Search tasks..."
                    (input)="onGlobalFilter(dt, $event)"
                />
            </p-iconfield>
        </div>
    </div>

    <!-- Table Card -->
    <div class="table-card">
        <p-table
            #dt
            [value]="tasks"
            [rows]="10"
            [paginator]="true"
            [loading]="isLoading"
            [globalFilterFields]="[
                'title',
                'executiveName',
                'executiveEmployeeId',
                'status',
                'priority'
            ]"
            [tableStyle]="{ 'min-width': '75rem' }"
            [showCurrentPageReport]="true"
            currentPageReportTemplate="Showing {first} to {last} of {totalRecords} tasks"
        >
            <!-- Header -->
            <ng-template pTemplate="header">
                <tr>
                    <th pSortableColumn="title" style="min-width: 18rem">
                        Task Title <p-sortIcon field="title" />
                    </th>
                    <th pSortableColumn="executiveName">
                        Assigned To <p-sortIcon field="executiveName" />
                    </th>
                    <th pSortableColumn="priority">
                        Priority <p-sortIcon field="priority" />
                    </th>
                    <th pSortableColumn="dueDate">
                        Due Date <p-sortIcon field="dueDate" />
                    </th>
                    <th pSortableColumn="status">
                        Status <p-sortIcon field="status" />
                    </th>
                    <th style="width: 5rem">Actions</th>
                </tr>
            </ng-template>

            <!-- Body -->
            <ng-template pTemplate="body" let-task>
                <tr>
                    <!-- Task Title -->
                    <td>
                        <div class="task-title-cell">
                            <span class="task-name">{{ task.title }}</span>
                            <span class="task-description">
                                {{ task.ward | slice: 0 : 50
                                }}{{
                                    task.description.length > 50 ? '...' : ''
                                }}
                            </span>
                        </div>
                    </td>

                    <!-- Assigned To -->
                    <td>
                        <div class="assignee-cell">
                            <p-avatar
                                [label]="
                                    task.executiveName
                                        .substring(0, 2)
                                        .toUpperCase()
                                "
                                shape="circle"
                            />
                            <div class="assignee-info">
                                <span class="assignee-name">{{
                                    task.executiveName
                                }}</span>
                                <span class="assignee-id">{{
                                    task.executiveEmployeeId
                                }}</span>
                            </div>
                        </div>
                    </td>

                    <!-- Priority -->
                    <td>
                        <span
                            class="priority-badge priority-{{ task.priority }}"
                        >
                            {{ task.priority.toUpperCase() }}
                        </span>
                    </td>

                    <!-- Due Date -->
                    <td>
                        <div
                            class="due-date-cell"
                            [class.overdue]="task.isOverdue"
                            [class.normal]="!task.isOverdue"
                        >
                            {{ formatDueDate(task.dueDate) }}
                            @if (task.isOverdue) {
                                <div class="overdue-icon">
                                    <i class="pi pi-exclamation-triangle"></i>
                                    Overdue
                                </div>
                            }
                        </div>
                    </td>

                    <!-- Status -->
                    <td>
                        <p-tag
                            [value]="
                                task.status.replace('_', ' ').toUpperCase()
                            "
                            [severity]="getSeverity(task.status)"
                        />
                    </td>

                    <!-- Actions -->
                    <td>
                        <div class="action-menu-btn">
                            <p-button
                                icon="pi pi-ellipsis-v"
                                styleClass="p-button-text p-button-rounded"
                                (click)="onActionsMenuClick(menu, $event, task)"
                            />
                            <p-menu
                                #menu
                                [model]="actionMenuItems"
                                [popup]="true"
                                [appendTo]="'body'"
                            ></p-menu>
                        </div>
                    </td>
                </tr>
            </ng-template>

            <!-- Empty State -->
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="6">
                        @if (isLoading) {
                            <div class="loading-state">
                                <i class="pi pi-spin pi-spinner"></i>
                                <p>Loading tasks...</p>
                            </div>
                        } @else {
                            <div class="empty-state">
                                <i class="pi pi-inbox"></i>
                                <h3>No tasks found</h3>
                                <p>Create a new task to get started</p>
                                <button
                                    pButton
                                    label="Create First Task"
                                    icon="pi pi-plus"
                                    (click)="navigateToCreate()"
                                ></button>
                            </div>
                        }
                    </td>
                </tr>
            </ng-template>
        </p-table>
        <!-- âœ… SIDE DRAWER -->
  

 
    </div>

    <p-toast />
</div>
</file>

<file path="src/app/features/task-management/tasks/tasks-approve/task-approve.html">
<!-- task-approve.component.html -->
<div class="task-approve-container">
    <p-confirmdialog></p-confirmdialog>

  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="title-section">
        <h1 class="page-title">
          <i class="pi pi-check-circle"></i>
          Tasks Pending Approval
        </h1>
        <p class="page-subtitle">
          Review and approve {{ tasks.length }} completed tasks
        </p>
      </div>
      <button
        pButton
        type="button"
        label="Refresh"
        icon="pi pi-refresh"
        class="refresh-btn"
        [loading]="isLoading"
        (click)="loadTasks()"
      ></button>
    </div>
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <div class="search-wrapper">
      <p-iconfield iconPosition="left">
        <p-inputicon styleClass="pi pi-search" />
        <input
          pInputText
          type="text"
          placeholder="Search tasks..."
          (input)="onGlobalFilter(dt, $event)"
        />
      </p-iconfield>
    </div>
  </div>
  
  <!-- âœ… CHANGED: .card â†’ .table-card -->
  <div class="table-card">
    <p-table
      #dt
      [value]="tasks"
      [rows]="10"
      [paginator]="true"
      [loading]="isLoading"
      [globalFilterFields]="['title', 'executiveName', 'executiveEmployeeId', 'status', 'priority']"
      [tableStyle]="{ 'min-width': '75rem' }"
      [scrollHeight]="'flex'"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} tasks"
    >
      <!-- âœ… REMOVED: Duplicate caption with search/title -->

      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="title">
            Task Title <p-sortIcon field="title" />
          </th>
          <th pSortableColumn="executiveName">
            Assigned To <p-sortIcon field="executiveName" />
          </th>
          <th>Contact</th>
          <th pSortableColumn="priority">
            Priority <p-sortIcon field="priority" />
          </th>
          <th pSortableColumn="dueDate">
            Due Date <p-sortIcon field="dueDate" />
          </th>
          <th pSortableColumn="completedAt">
            Completed <p-sortIcon field="completedAt" />
          </th>
          <th pSortableColumn="status">
            Status <p-sortIcon field="status" />
          </th>
          <th style="width: 10rem">Actions</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-task>
        <tr>
          <!-- Task Title -->
          <td>
            <div class="task-title-cell">
              <span class="task-name">{{ task.title }}</span>
              <span class="task-description">
                {{ task.description | slice:0:60 }}{{ task.description.length > 60 ? '...' : '' }}
              </span>
            </div>
          </td>

          <!-- Assigned To -->
          <td>
            <div class="assignee-cell">
              <p-avatar
                [label]="task.executiveName.substring(0, 2).toUpperCase()"
                shape="circle"
              />
              <div class="assignee-info">
                <span class="assignee-name">{{ task.executiveName }}</span>
                <span class="assignee-id">{{ task.executiveEmployeeId }}</span>
              </div>
            </div>
          </td>

          <!-- Contact -->
          <td>
            <div class="contact-cell">
              @if (task.executivePhone) {
                <a [href]="'tel:' + task.executivePhone" class="text-primary">
                  <i class="pi pi-phone"></i>
                  {{ task.executivePhone }}
                </a>
              } @else {
                <span>N/A</span>
              }
            </div>
          </td>

          <!-- Priority -->
          <td>
            <span class="priority-badge priority-{{ task.priority }}">
              {{ task.priority.toUpperCase() }}
            </span>
          </td>

          <!-- Due Date -->
          <td>
            <div class="due-date-cell" [class.overdue]="task.isOverdue">
              {{ task.dueDate | date:'mediumDate' }}
              @if (task.isOverdue) {
                <div class="overdue-icon">
                  <i class="pi pi-exclamation-triangle"></i> Overdue
                </div>
              }
            </div>
          </td>

          <!-- Completed At -->
          <td>
            @if (task.completedAt) {
              <span class="completed-time">{{ task.completedAt | date:'short' }}</span>
            } @else {
              <span class="text-muted">â€”</span>
            }
          </td>

          <!-- Status -->
          <td>
            <p-tag
              [value]="task.status.replace('_', ' ').toUpperCase()"
              [severity]="getSeverity(task.status)"
            />
          </td>

          <!-- Actions -->
          <td>
            <div class="action-buttons">
              <button
                pButton
                icon="pi pi-check"
                class="p-button-rounded p-button-sm approve-btn"
                pTooltip="Approve"
                tooltipPosition="top"
                (click)="approveTask(task)"
              ></button>
              <button
                pButton
                icon="pi pi-times"
                class="p-button-rounded p-button-sm reject-btn"
                pTooltip="Reject"
                tooltipPosition="top"
                (click)="rejectTask(task)"
              ></button>
              <button
                pButton
                icon="pi pi-eye"
                class="p-button-rounded p-button-sm view-btn"
                pTooltip="View Details"
                tooltipPosition="top"
                (click)="viewTask(task)"
              ></button>
            </div>
          </td>
        </tr>
      </ng-template>

      <!-- Empty State -->
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="8">
            @if (isLoading) {
              <div class="loading-state">
                <i class="pi pi-spin pi-spinner"></i>
                <p>Loading tasks...</p>
              </div>
            } @else {
              <div class="empty-state">
                <i class="pi pi-inbox"></i>
                <h3>No tasks pending approval</h3>
                <p>All caught up! Check back later.</p>
              </div>
            }
          </td>
        </tr>
      </ng-template>
    </p-table>

          <p-drawer
            [(visible)]="showSideDrawer"
            position="right"
            modal="true"
            [baseZIndex]="10000"
            styleClass="task-detail-drawer"
        >
            <ng-container *ngIf="selectedTask">
                <div class="drawer-header">
                    <h3>{{ selectedTask.title }}</h3>
                    <h3>{{ selectedTask | json }}</h3>
                    <i class="pi pi-times" (click)="closeDrawer()"></i>
                </div>

                <div class="drawer-content">
                    <p class="task-description">
                        {{ selectedTask.description }}
                    </p>

                    <div class="task-meta">
                        <p>
                            <strong>Assigned To:</strong>
                            {{ selectedTask.executiveName }}
                        </p>
                        <p>
                            <strong>Ward ID:</strong> {{ selectedTask.wardId }}
                        </p>
                        <p>
                            <strong>Due:</strong>
                            {{ selectedTask.dueDate | date: 'mediumDate' }}
                        </p>
                        <p>
                            <strong>Status:</strong>
                            <p-tag
                                [value]="selectedTask.status"
                                [severity]="getSeverity(selectedTask.status)"
                            ></p-tag>
                        </p>
                    </div>
                </div>
            </ng-container>
        </p-drawer>
  </div>

  <p-toast></p-toast>
</div>
</file>

<file path="src/app/features/task-management/tasks/tasks-approve/task-approve.scss">
// ============================================
// TASK APPROVAL - ENTERPRISE DESIGN
// ============================================

// Color System
$primary-blue: #1e40af;
$primary-blue-light: #3b82f6;
$success-green: #10b981;
$success-light: #d1fae5;
$warning-orange: #f59e0b;
$warning-light: #fef3c7;
$danger-red: #ef4444;
$danger-light: #fee2e2;
$neutral-50: #f9fafb;
$neutral-100: #f3f4f6;
$neutral-200: #e5e7eb;
$neutral-300: #d1d5db;
$neutral-500: #6b7280;
$neutral-700: #374151;
$neutral-900: #111827;

// ============================================
// PAGE CONTAINER
// ============================================
.task-approve-container {
  padding: 2rem;
  background: $neutral-50;
  min-height: 100vh;

  @media (max-width: 768px) {
    padding: 1rem;
  }
}

// ============================================
// HEADER SECTION
// ============================================
.page-header {
  background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
  border-radius: 16px;
  padding: 2rem;
  margin-bottom: 2rem;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  border: 1px solid $neutral-200;

  .header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1.5rem;

    @media (max-width: 768px) {
      flex-direction: column;
      align-items: flex-start;
    }
  }

  .title-section {
    flex: 1;

    .page-title {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin: 0 0 0.5rem 0;
      font-size: 1.75rem;
      font-weight: 700;
      color: $neutral-900;

      i {
        font-size: 2rem;
        background: linear-gradient(135deg, $primary-blue-light, $primary-blue);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
    }

    .page-subtitle {
      margin: 0;
      color: $neutral-500;
      font-size: 0.95rem;
      font-weight: 500;
    }
  }

  .refresh-btn {
    background: linear-gradient(135deg, $success-green, #059669);
    border: none;
    box-shadow: 0 2px 8px rgba(16, 185, 129, 0.25);
    transition: all 0.3s ease;

    &:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.35);
    }
  }
}

// ============================================
// SEARCH & FILTERS
// ============================================
.filters-section {
  background: white;
  border-radius: 12px;
  padding: 1.5rem;
  margin-bottom: 2rem;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  border: 1px solid $neutral-200;

  .search-wrapper {
    display: flex;
    gap: 1rem;
    align-items: center;

    @media (max-width: 768px) {
      flex-direction: column;
    }

    ::ng-deep {
      .p-iconfield {
        flex: 1;

        .p-inputtext {
          width: 100%;
          border-radius: 8px;
          border: 1px solid $neutral-300;
          padding: 0.75rem 1rem 0.75rem 2.5rem;
          font-size: 0.95rem;
          transition: all 0.2s ease;

          &:focus {
            border-color: $primary-blue;
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
          }
        }

        .p-inputicon {
          color: $neutral-500;
          left: 0.75rem;
        }
      }
    }
  }
}

// ============================================
// TABLE CARD
// ============================================
.table-card {
  background: white;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  border: 1px solid $neutral-200;

  ::ng-deep {
    // Table Header
    .p-datatable-thead > tr > th {
      background: linear-gradient(180deg, #f8fafc 0%, #f1f5f9 100%);
      color: $neutral-700;
      font-weight: 600;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      padding: 1rem;
      border-bottom: 2px solid $neutral-200;

      &:hover {
        background: linear-gradient(180deg, #f1f5f9 0%, #e2e8f0 100%);
      }
    }

    // Table Body
    .p-datatable-tbody > tr {
      transition: all 0.2s ease;
      border-bottom: 1px solid $neutral-100;

      &:hover {
        background: linear-gradient(90deg, rgba(30, 64, 175, 0.02) 0%, rgba(30, 64, 175, 0.05) 100%);
        transform: translateX(2px);
      }

      > td {
        padding: 1rem;
        color: $neutral-700;
        font-size: 0.95rem;
        vertical-align: middle;
      }
    }

    // Remove default PrimeNG striping
    .p-datatable-striped .p-datatable-tbody > tr:nth-child(even) {
      background: transparent;
    }
  }
}

// ============================================
// TASK TITLE CELL
// ============================================
.task-title-cell {
  .task-name {
    font-weight: 600;
    color: $neutral-900;
    display: block;
    margin-bottom: 0.25rem;
  }

  .task-description {
    font-size: 0.85rem;
    color: $neutral-500;
    font-style: italic;
  }
}

// ============================================
// ASSIGNEE CELL
// ============================================
.assignee-cell {
  display: flex;
  align-items: center;
  gap: 0.75rem;

  ::ng-deep .p-avatar {
    background: linear-gradient(135deg, $primary-blue-light, $primary-blue);
    color: white;
    font-weight: 600;
    font-size: 0.9rem;
    box-shadow: 0 2px 6px rgba(30, 64, 175, 0.2);
  }

  .assignee-info {
    display: flex;
    flex-direction: column;

    .assignee-name {
      font-weight: 600;
      color: $neutral-900;
      font-size: 0.95rem;
    }

    .assignee-id {
      font-size: 0.8rem;
      color: $neutral-500;
      font-family: 'Courier New', monospace;
    }
  }
}

// ============================================
// PRIORITY BADGES (Muted)
// ============================================
.priority-badge {
  display: inline-block;
  padding: 0.35rem 0.75rem;
  border-radius: 6px;
  font-size: 0.8rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.3px;

  &.priority-urgent {
    background: $danger-light;
    color: $danger-red;
    border: 1px solid rgba(239, 68, 68, 0.2);
  }

  &.priority-high {
    background: $warning-light;
    color: $warning-orange;
    border: 1px solid rgba(245, 158, 11, 0.2);
  }

  &.priority-medium {
    background: rgba(59, 130, 246, 0.1);
    color: $primary-blue-light;
    border: 1px solid rgba(59, 130, 246, 0.2);
  }

  &.priority-low {
    background: $success-light;
    color: $success-green;
    border: 1px solid rgba(16, 185, 129, 0.2);
  }
}

// ============================================
// STATUS TAGS (Softer colors)
// ============================================
::ng-deep .p-tag {
  font-size: 0.8rem;
  font-weight: 600;
  padding: 0.4rem 0.8rem;
  border-radius: 6px;
  text-transform: uppercase;
  letter-spacing: 0.3px;

  &.p-tag-success {
    background: $success-light;
    color: $success-green;
    border: 1px solid rgba(16, 185, 129, 0.2);
  }

  &.p-tag-warning {
    background: $warning-light;
    color: $warning-orange;
    border: 1px solid rgba(245, 158, 11, 0.2);
  }

  &.p-tag-danger {
    background: $danger-light;
    color: $danger-red;
    border: 1px solid rgba(239, 68, 68, 0.2);
  }

  &.p-tag-info {
    background: rgba(59, 130, 246, 0.1);
    color: $primary-blue-light;
    border: 1px solid rgba(59, 130, 246, 0.2);
  }
}

// ============================================
// DUE DATE CELL
// ============================================
.due-date-cell {
  color: $neutral-700;
  font-weight: 500;
  font-size: 0.9rem;
}

// ============================================
// COMPLETED TIMESTAMP
// ============================================
.completed-time {
  color: $neutral-500;
  font-size: 0.85rem;
  font-family: 'Courier New', monospace;
}

// ============================================
// ACTION BUTTONS (Refined)
// ============================================
.action-buttons {
  display: flex;
  gap: 0.5rem;
  align-items: center;

  ::ng-deep {
    .p-button {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      transition: all 0.2s ease;
      border: 1px solid transparent;

      &:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      }

      // Approve Button (Green)
      &.approve-btn {
        background: linear-gradient(135deg, $success-green, #059669);
        border-color: $success-green;

        &:hover {
          box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }
      }

      // Reject Button (Red)
      &.reject-btn {
        background: linear-gradient(135deg, $danger-red, #dc2626);
        border-color: $danger-red;

        &:hover {
          box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }
      }

      // View Button (Blue)
      &.view-btn {
        background: linear-gradient(135deg, $primary-blue-light, $primary-blue);
        border-color: $primary-blue;

        &:hover {
          box-shadow: 0 4px 12px rgba(30, 64, 175, 0.3);
        }
      }
    }
  }
}

// ============================================
// EMPTY STATE
// ============================================
.empty-state {
  text-align: center;
  padding: 4rem 2rem;
  color: $neutral-500;

  i {
    font-size: 4rem;
    color: $neutral-300;
    margin-bottom: 1rem;
  }

  h3 {
    color: $neutral-700;
    font-size: 1.25rem;
    margin: 1rem 0 0.5rem 0;
  }

  p {
    color: $neutral-500;
    margin: 0;
  }
}

// ============================================
// LOADING STATE
// ============================================
.loading-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 4rem 2rem;
  background: white;
  border-radius: 12px;
  margin-top: 2rem;

  i {
    font-size: 3rem;
    color: $primary-blue;
    margin-bottom: 1rem;
  }

  p {
    color: $neutral-500;
    font-size: 1rem;
  }
}
</file>

<file path="src/app/features/task-management/tasks/tasks-approve/task-approve.ts">
// src/app/features/task-management/components/task-approve/task-approve.component.ts

import { Component, OnInit } from '@angular/core';
import { CommonModule } from '@angular/common';
import { Table, TableModule } from 'primeng/table';
import { ButtonModule } from 'primeng/button';
import { InputTextModule } from 'primeng/inputtext';
import { TagModule } from 'primeng/tag';
import { AvatarModule } from 'primeng/avatar';
import { IconFieldModule } from 'primeng/iconfield';
import { InputIconModule } from 'primeng/inputicon';
import { TooltipModule } from 'primeng/tooltip';
import { ProgressBarModule } from 'primeng/progressbar';

// âœ… Import from centralized models
import { EnrichedTask, TaskStatus,TaskPriority  } from '../../models';
import { TaskService } from '../../services/task.service';
import { MenuModule } from 'primeng/menu';
import { ConfirmationService, MessageService } from 'primeng/api';
import { ToastModule } from 'primeng/toast';
import { DrawerModule } from "primeng/drawer";
import { ConfirmDialogModule } from "primeng/confirmdialog";

@Component({
  selector: 'app-task-approve',
  standalone: true,
  imports: [
    CommonModule,
    TableModule,
    ButtonModule,
    InputTextModule,
    TagModule,
    AvatarModule,
    IconFieldModule,
    InputIconModule,
    TooltipModule,
    ProgressBarModule,
    MenuModule,
    ToastModule,
    DrawerModule,
    ConfirmDialogModule
],
   providers: [ConfirmationService, MessageService],
  templateUrl: './task-approve.html',
   styleUrls: ['./task-approve.scss']
})
export class TaskApproveComponent implements OnInit {
  tasks: EnrichedTask[] = [];
  isLoading = true;

  selectedTask: EnrichedTask | null = null;
  showSideDrawer = false;
  constructor(
    private taskService: TaskService,
    private confirmationService: ConfirmationService,
    private messageService: MessageService
  ) {}

  async ngOnInit() {
    await this.loadTasks();
  }

  // In your approval-queue component
async loadTasks() {
  try {
    this.isLoading = true;
    console.log('ðŸ”„ Loading pending approvals...');
    
    // âœ… Use the correct query that includes approvalId
    this.tasks = await this.taskService.getPendingApprovals();
    
    console.log('âœ… Tasks loaded:', this.tasks.length);
    console.log('ðŸ” First task approvalId:', this.tasks[0]?.approvalId);
    
  } catch (error) {
    console.error('âŒ Error loading tasks:', error);
    this.messageService.add({
      severity: 'error',
      summary: 'Error',
      detail: 'Failed to load approval tasks'
    });
  } finally {
    this.isLoading = false;
  }
}

  onGlobalFilter(table: Table, event: Event) {
    table.filterGlobal((event.target as HTMLInputElement).value, 'contains');
  }

  getSeverity(status: TaskStatus): 'success' | 'info' | 'warn' | 'danger' {
    switch (status) {
      case 'completed':
        return 'success';
      case 'in_progress':
        return 'info';
      case 'pending':
        return 'warn';
      case 'overdue':
        return 'danger';
      default:
        return 'info';
    }
  }

  formatDueDate(timestamp: number): string {
    return this.taskService.formatDueDate(timestamp);
  }

getPrioritySeverity(priority: TaskPriority): 'success' | 'info' | 'warn' | 'danger' {
  switch (priority as string) {  // âœ… Cast to string
    case 'low':
      return 'success';
    case 'medium':
      return 'info';
    case 'high':
      return 'warn';
    case 'urgent':
      return 'danger';
    default:
      return 'info';
  }
}

async approveTask(task: EnrichedTask) {
  console.log("ðŸ” [FRONTEND] Task full object:", task);
  console.log("ðŸ” [FRONTEND] approvalId:", task.approvalId);
  console.log("ðŸ” [FRONTEND] approvalId type:", typeof task.approvalId);
  
  // âœ… SAFETY CHECK
  if (!task.approvalId) {
    console.error("âŒ NO APPROVAL ID! Cannot approve");
    this.messageService.add({
      severity: 'error',
      summary: 'Error',
      detail: 'No approval ID found for this task',
      life: 3000,
    });
    return;
  }

  this.confirmationService.confirm({
    message: `Approve "${task.title}"?`,
    accept: async () => {
      try {
        console.log("ðŸ” [FRONTEND] CALLING SERVICE with approvalId:", task.approvalId);
        await this.taskService.approveTaskCompletion(task.approvalId!);
        console.log("âœ… [FRONTEND] SERVICE CALLED SUCCESSFULLY");
        
        await this.loadTasks();
        this.messageService.add({
          severity: 'success',
          summary: 'Approved!',
          detail: `${task.title} approved`,
          life: 3000,
        });
      } catch (error: any) {
        console.error("âŒ [FRONTEND] Service error:", error);
        this.messageService.add({
          severity: 'error',
          summary: 'Error',
          detail: error?.message || 'Approval failed',
          life: 3000,
        });
      }
    }
  });
}

async rejectTask(task: EnrichedTask) {
  const reason = prompt('Rejection reason (required):');
  if (!reason?.trim()) return;

  this.confirmationService.confirm({
    message: `Reject "${task.title}"?\n\nReason: ${reason}`,
    header: 'Confirm Rejection',
    icon: 'pi pi-exclamation-triangle',
    accept: async () => {
      try {
        await this.taskService.rejectTaskCompletion(task.approvalId!, reason);
        this.messageService.add({
          severity: 'warn',
          summary: 'Rejected',
          detail: `${task.title} rejected`,
          life: 3000,
        });
        await this.loadTasks();
      } catch (error: any) {
        this.messageService.add({
          severity: 'error',
          summary: 'Error',
          detail: error?.message || 'Rejection failed',
          life: 3000,
        });
      }
    }
  });
}

 viewTask(task: EnrichedTask) {
    this.selectedTask = task;
    this.showSideDrawer = true;  // âœ… OPEN DRAWER
  }
 closeDrawer() {
    this.showSideDrawer = false;
    this.selectedTask = null;
  }
}
</file>

<file path="src/app/features/task-management/tasks/tasks-create/task-form.component.html">
<!-- task-form.component.html -->

<p-toast />

<div class="card">
    <h2 class="text-2xl font-semibold mb-6">
        {{ isEditMode ? 'Edit Task' : 'Create New Task' }}
    </h2>

    @if (isLoading) {
        <div class="flex justify-center items-center py-12">
            <i class="pi pi-spin pi-spinner" style="font-size: 2rem"></i>
            <span class="ml-3">Loading...</span>
        </div>
    } @else {
        <form [formGroup]="taskForm" (ngSubmit)="onSubmit()">
            <div class="grid grid-cols-12 gap-4">
                <!-- Left Column - Main Details -->
                <div class="col-span-12 lg:col-span-8">
                    <div class="flex flex-col gap-6">
                        <!-- Task Title -->
                        <div class="flex flex-col gap-2">
                            <label for="title" class="font-medium">
                                Task Title <span class="text-red-500">*</span>
                            </label>
                            <input
                                id="title"
                                type="text"
                                pInputText
                                formControlName="title"
                                placeholder="Enter task title"
                            />
                            @if (
                                taskForm.get('title')?.invalid &&
                                taskForm.get('title')?.touched
                            ) {
                                <small class="text-red-500"
                                    >Task title is required (min 3
                                    characters)</small
                                >
                            }
                        </div>

                        <!-- Description -->
                        <div class="flex flex-col gap-2">
                            <label for="description" class="font-medium">
                                Description <span class="text-red-500">*</span>
                            </label>
                            <textarea
                                id="description"
                                pInputTextarea
                                formControlName="description"
                                rows="6"
                                placeholder="Describe the task in detail..."
                            ></textarea>
                            @if (
                                taskForm.get('description')?.invalid &&
                                taskForm.get('description')?.touched
                            ) {
                                <small class="text-red-500"
                                    >Description is required</small
                                >
                            }
                        </div>

                        <!-- Notes -->
                        <div class="flex flex-col gap-2">
                            <label for="notes" class="font-medium"
                                >Additional Notes</label
                            >
                            <textarea
                                id="notes"
                                pInputTextarea
                                formControlName="notes"
                                rows="3"
                                placeholder="Any additional instructions or notes..."
                            ></textarea>
                        </div>

                        <!-- File Upload (TODO: Implement storage integration) -->
                        <!-- <div class="flex flex-col gap-2">
                            <label class="font-medium">Attachments</label>
                            <p-fileUpload
                                name="taskFiles[]"
                                [multiple]="true"
                                accept="image/*,.pdf,.doc,.docx"
                                [maxFileSize]="5000000"
                                [disabled]="true"
                            >
                                <ng-template pTemplate="content">
                                    <div
                                        class="h-full flex flex-col justify-center items-center py-8"
                                    >
                                        <i
                                            class="pi pi-upload text-4xl mb-3 text-color-secondary"
                                        ></i>
                                        <span class="font-semibold"
                                            >File upload coming soon</span
                                        >
                                        <small class="text-color-secondary"
                                            >Currently unavailable</small
                                        >
                                    </div>
                                </ng-template>
                            </p-fileUpload>
                        </div> -->
                    </div>
                </div>

                <!-- Right Column - Task Details -->
                <div class="col-span-12 lg:col-span-4 flex flex-col gap-y-4">
                    <div
                        class="border border-surface rounded p-4 flex flex-col gap-4"
                    >
                        <!-- Assign To Executive -->
                     <!-- Assign To Executive -->
<!-- Assign To Executive -->
<!-- Assign To Executive -->
<div class="flex flex-col gap-2">
    <label for="assignedTo" class="font-medium">
        Assign To <span class="text-red-500">*</span>
    </label>
    <p-autoComplete
        id="assignedTo"
        [(ngModel)]="selectedExecutiveName"
        [ngModelOptions]="{ standalone: true }"
        [suggestions]="filteredExecutives"
        (completeMethod)="filterExecutives($event)"
        (onSelect)="onExecutiveSelect($event)"
        field="name"
        [dropdown]="true"
        placeholder="Search executive by name or ID..."
        styleClass="w-full"
    >
        <ng-template let-exec pTemplate="item">
            <div class="flex items-center gap-2">
                <div>
                    <div class="font-medium">{{ exec.name }}</div>
                    <small class="text-color-secondary">{{ exec.wardName  }}</small>
                </div>
            </div>
        </ng-template>
    </p-autoComplete>
    
    @if (selectedExecutive) {
        <small style="color: green; display: flex; align-items: center; gap: 0.25rem;">
            <i class="pi pi-check-circle"></i> 
            Selected: {{ selectedExecutive.name }} ({{ selectedExecutive.employeeId }})
        </small>
    }
    
    @if (
        taskForm.get('assignedTo')?.invalid &&
        taskForm.get('assignedTo')?.touched
    ) {
        <small class="text-red-500">
            Please assign to an executive
        </small>
    }
</div>
                        <!-- Task Type -->
                        <div class="flex flex-col gap-2">
                            <label for="type" class="font-medium">
                                Task Type <span class="text-red-500">*</span>
                            </label>
                            <p-select
                                id="type"
                                [options]="taskTypes"
                                formControlName="type"
                                optionLabel="label"
                                optionValue="value"
                                placeholder="Select type"
                                styleClass="w-full"
                            />
                        </div>

                        <!-- Priority -->
                        <div class="flex flex-col gap-2">
                            <label for="priority" class="font-medium">
                                Priority <span class="text-red-500">*</span>
                            </label>
                            <p-select
                                id="priority"
                                [options]="taskPriorities"
                                formControlName="priority"
                                optionLabel="label"
                                optionValue="value"
                                placeholder="Select priority"
                                styleClass="w-full"
                            />
                        </div>

                        <!-- Due Date -->
                        <div class="flex flex-col gap-2">
                            <label for="dueDate" class="font-medium">
                                Due Date <span class="text-red-500">*</span>
                            </label>
                            <p-datepicker
                                id="dueDate"
                                formControlName="dueDate"
                                [showIcon]="true"
                                dateFormat="yy-mm-dd"
                                [minDate]="minDate"
                                placeholder="Select date"
                                styleClass="w-full"
                            />
                            @if (
                                taskForm.get('dueDate')?.invalid &&
                                taskForm.get('dueDate')?.touched
                            ) {
                                <small class="text-red-500"
                                    >Due date is required</small
                                >
                            }
                        </div>

                        <!-- Estimated Hours -->
                        <div class="flex flex-col gap-2">
                            <label for="estimatedHours" class="font-medium">
                                Estimated Hours
                                <span class="text-red-500">*</span>
                            </label>
                            <p-inputNumber
                                id="estimatedHours"
                                formControlName="estimatedHours"
                                [min]="0.5"
                                [step]="0.5"
                                suffix=" hrs"
                                styleClass="w-full"
                            />
                        </div>

                        <!-- Ward ID -->
                        <div class="flex flex-col gap-2">
                            <label for="wardId" class="font-medium">
                                Ward ID <span class="text-red-500">*</span>
                            </label>
                            <input
                                id="wardId"
                                type="text"
                                pInputText
                                formControlName="wardId"
                                placeholder="e.g., WARD-001"
                            />
                            @if (
                                taskForm.get('wardId')?.invalid &&
                                taskForm.get('wardId')?.touched
                            ) {
                                <small class="text-red-500"
                                    >Ward ID is required</small
                                >
                            }
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex justify-between gap-4">
                        <button
                            pButton
                            pRipple
                            type="button"
                            severity="secondary"
                            outlined
                            label="Cancel"
                            icon="pi pi-times"
                            (click)="onCancel()"
                        ></button>
                        <button
                            pButton
                            pRipple
                            type="submit"
                            [label]="isEditMode ? 'Update Task' : 'Create Task'"
                            icon="pi pi-check"
                            [disabled]="taskForm.invalid"
                        ></button>
                    </div>
                </div>
            </div>
        </form>
    }
</div>
</file>

<file path="src/app/features/task-management/tasks/tasks-create/task-form.component.scss">
.task-form-container {
  width: 100%;
  max-width: 1400px;
  margin: 0 auto;
  padding: 1rem;

  // Tablet and up
  @media (min-width: 768px) {
    padding: 1.5rem;
  }

  // Desktop and up
  @media (min-width: 1024px) {
    padding: 2rem;
  }

  .card {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    padding: 1rem;

    @media (min-width: 768px) {
      border-radius: 12px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      padding: 1.5rem;
    }

    @media (min-width: 1024px) {
      padding: 2rem;
    }

    // Page Title
    .page-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: #334155;
      margin: 0 0 0.5rem 0;
      display: flex;
      align-items: center;
      gap: 0.5rem;

      @media (min-width: 768px) {
        font-size: 1.5rem;
        gap: 0.75rem;
      }

      @media (min-width: 1024px) {
        font-size: 1.75rem;
      }

      i {
        color: #667eea;
        font-size: 1.5rem;

        @media (min-width: 768px) {
          font-size: 1.75rem;
        }

        @media (min-width: 1024px) {
          font-size: 2rem;
        }
      }
    }

    .page-subtitle {
      color: #64748b;
      margin: 0 0 1.5rem 0;
      font-size: 0.875rem;

      @media (min-width: 768px) {
        font-size: 0.9375rem;
        margin: 0 0 2rem 0;
      }
    }
  }

  // Loading State
  .loading-state {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 2rem;
    gap: 0.75rem;
    color: #64748b;

    @media (min-width: 768px) {
      flex-direction: row;
      padding: 3rem;
      gap: 1rem;
    }

    i {
      font-size: 1.5rem;
      color: #667eea;

      @media (min-width: 768px) {
        font-size: 2rem;
      }
    }

    span {
      font-size: 1rem;
      font-weight: 500;
      text-align: center;

      @media (min-width: 768px) {
        font-size: 1.125rem;
      }
    }
  }

  // Form Layout - Mobile First
  .form-grid {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;

    // Tablet: Still stacked but with more spacing
    @media (min-width: 768px) {
      gap: 2rem;
    }

    // Desktop: Side-by-side layout
    @media (min-width: 1024px) {
      display: grid;
      grid-template-columns: 1fr 400px;
      gap: 2rem;
    }

    // Large desktop: More spacious sidebar
    @media (min-width: 1280px) {
      grid-template-columns: 1fr 450px;
      gap: 2.5rem;
    }
  }

  // Main Content
  .main-content {
    display: flex;
    flex-direction: column;
    gap: 1.25rem;

    @media (min-width: 768px) {
      gap: 1.5rem;
    }
  }

  // Sidebar Content
  .sidebar-content {
    display: flex;
    flex-direction: column;
    gap: 1.25rem;

    @media (min-width: 768px) {
      gap: 1.5rem;
    }

    // On desktop, make it sticky
    @media (min-width: 1024px) {
      position: sticky;
      top: 2rem;
      height: fit-content;
    }

    .details-card {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: 1.25rem;

      @media (min-width: 768px) {
        border-radius: 12px;
        padding: 1.5rem;
        gap: 1.5rem;
      }
    }
  }

  // Form Field - Mobile Optimized
  .form-field {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;

    label {
      font-weight: 600;
      color: #475569;
      font-size: 0.8125rem;
      display: flex;
      align-items: center;
      gap: 0.25rem;

      @media (min-width: 768px) {
        font-size: 0.875rem;
      }

      .required {
        color: #ef4444;
        font-weight: 700;
      }
    }

    input,
    textarea {
      width: 100%;
      font-size: 16px; // Prevents zoom on iOS

      @media (min-width: 768px) {
        font-size: 0.9375rem;
      }
    }

    small.error {
      color: #ef4444;
      font-size: 0.75rem;
      font-weight: 500;
      margin-top: 0.25rem;

      @media (min-width: 768px) {
        font-size: 0.8125rem;
      }
    }
  }

  // PrimeNG Component Overrides
  ::ng-deep {
    // Input Text & Textarea - Mobile Optimized
    .p-inputtext,
    .p-textarea {
      padding: 0.75rem;
      border-radius: 8px;
      border: 1px solid #cbd5e1;
      transition: all 0.2s;
      font-size: 16px; // Prevents iOS zoom
      width: 100%;
      
      @media (min-width: 768px) {
        font-size: 0.9375rem;
      }

      &:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        outline: none;
      }

      &.ng-invalid.ng-touched {
        border-color: #ef4444;

        &:focus {
          box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
        }
      }
    }

    .p-textarea {
      resize: vertical;
      min-height: 100px;
      touch-action: manipulation; // Better mobile scrolling
    }

    // Select Dropdown - Mobile Optimized
    .p-select {
      width: 100%;

      .p-select-label {
        padding: 0.75rem;
        font-size: 16px; // Prevents iOS zoom

        @media (min-width: 768px) {
          font-size: 0.9375rem;
        }
      }

      .p-select-dropdown {
        // Larger touch target on mobile
        width: 2.5rem;

        @media (min-width: 768px) {
          width: 2.357rem;
        }
      }

      &.p-focus {
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      &.ng-invalid.ng-touched {
        border-color: #ef4444;
      }
    }

    // Select Panel - Mobile Optimized
    .p-select-overlay {
      // On mobile, make it fullscreen
      @media (max-width: 767px) {
        max-height: 70vh !important;
        width: 90vw !important;
        left: 50% !important;
        transform: translateX(-50%) !important;
      }

      .p-select-list {
        .p-select-option {
          padding: 0.875rem;
          font-size: 16px;

          @media (min-width: 768px) {
            padding: 0.75rem;
            font-size: 0.9375rem;
          }
        }
      }
    }

    // AutoComplete - Mobile Optimized
    .p-autocomplete {
      width: 100%;

      .p-autocomplete-input {
        padding: 0.75rem;
        font-size: 16px;
        width: 100%;

        @media (min-width: 768px) {
          font-size: 0.9375rem;
        }
      }

      .p-autocomplete-dropdown {
        width: 2.5rem;

        @media (min-width: 768px) {
          width: 2.357rem;
        }
      }

      &.p-focus {
        .p-autocomplete-input {
          border-color: #667eea;
          box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
      }
    }

    // AutoComplete Panel - Mobile Optimized
    .p-autocomplete-overlay {
      @media (max-width: 767px) {
        max-height: 60vh !important;
        width: 90vw !important;
        left: 50% !important;
        transform: translateX(-50%) !important;
      }

      .p-autocomplete-list {
        .p-autocomplete-option {
          padding: 0.875rem;

          @media (min-width: 768px) {
            padding: 0.75rem;
          }

          .executive-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;

            .executive-info {
              display: flex;
              flex-direction: column;
              gap: 0.125rem;

              .executive-name {
                font-weight: 600;
                color: #334155;
                font-size: 0.9375rem;
              }

              .executive-id {
                font-size: 0.8125rem;
                color: #64748b;
              }
            }
          }

          &:hover {
            background: #f1f5f9;
          }
        }
      }
    }

    // DatePicker - Mobile Optimized
    .p-datepicker {
      width: 100%;

      .p-inputtext {
        padding: 0.75rem;
        font-size: 16px;

        @media (min-width: 768px) {
          font-size: 0.9375rem;
        }
      }

      .p-datepicker-icon {
        // Larger touch target
        width: 2.5rem;

        @media (min-width: 768px) {
          width: 2.357rem;
        }
      }

      &.p-focus {
        .p-inputtext {
          border-color: #667eea;
          box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
      }
    }

    // DatePicker Panel - Mobile Optimized
    .p-datepicker-panel {
      @media (max-width: 767px) {
        width: 90vw !important;
        max-width: 340px !important;
        left: 50% !important;
        transform: translateX(-50%) !important;
      }

      .p-datepicker-calendar {
        table {
          // Larger touch targets
          td {
            padding: 0.25rem;

            @media (min-width: 768px) {
              padding: 0.5rem;
            }

            span {
              min-width: 2.5rem;
              min-height: 2.5rem;
              display: flex;
              align-items: center;
              justify-content: center;

              @media (min-width: 768px) {
                min-width: 2rem;
                min-height: 2rem;
              }
            }
          }
        }
      }
    }

    // Input Number - Mobile Optimized
    .p-inputnumber {
      width: 100%;

      .p-inputtext {
        padding: 0.75rem;
        font-size: 16px;

        @media (min-width: 768px) {
          font-size: 0.9375rem;
        }
      }

      .p-inputnumber-button-group {
        .p-button {
          width: 2.5rem;

          @media (min-width: 768px) {
            width: 2rem;
          }
        }
      }
    }

    // Buttons - Mobile Optimized
    .p-button {
      padding: 0.875rem 1.25rem;
      font-weight: 600;
      border-radius: 8px;
      transition: all 0.2s;
      font-size: 0.9375rem;
      min-height: 48px; // Touch target size
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;

      @media (min-width: 768px) {
        padding: 0.75rem 1.5rem;
        min-height: auto;
      }

      &:not(:disabled):hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      }

      &:not(:disabled):active {
        transform: translateY(0);
      }

      &.p-button-outlined {
        border-width: 2px;
      }

      &:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      // Icon spacing
      .p-button-icon {
        font-size: 1rem;

        @media (min-width: 768px) {
          font-size: 1.125rem;
        }
      }
    }

    // File Upload - Mobile Optimized
    .p-fileupload {
      .p-fileupload-content {
        background: #f8fafc;
        border: 2px dashed #cbd5e1;
        border-radius: 8px;
        padding: 1.5rem 1rem;
        text-align: center;
        transition: all 0.2s;
        min-height: 150px;
        display: flex;
        align-items: center;
        justify-content: center;

        @media (min-width: 768px) {
          padding: 2rem;
          min-height: 180px;
        }

        &:active {
          border-color: #667eea;
          background: #f1f5f9;
        }

        .upload-placeholder {
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 0.5rem;
          color: #64748b;
          padding: 1rem 0;

          @media (min-width: 768px) {
            gap: 0.75rem;
            padding: 1.5rem 0;
          }

          i {
            font-size: 2.5rem;
            color: #94a3b8;

            @media (min-width: 768px) {
              font-size: 3rem;
            }
          }

          .upload-title {
            font-size: 0.9375rem;
            font-weight: 600;
            color: #475569;

            @media (min-width: 768px) {
              font-size: 1rem;
            }
          }

          .upload-subtitle {
            font-size: 0.8125rem;
            color: #94a3b8;

            @media (min-width: 768px) {
              font-size: 0.875rem;
            }
          }
        }
      }
    }
  }

  // Action Buttons - Mobile First
  .form-actions {
    display: flex;
    flex-direction: column-reverse;
    gap: 0.75rem;
    padding-top: 1.5rem;
    border-top: 1px solid #e2e8f0;

    @media (min-width: 640px) {
      flex-direction: row;
      justify-content: space-between;
      gap: 1rem;
    }

    button {
      width: 100%;

      @media (min-width: 640px) {
        flex: 1;
      }
    }
  }

  // Attachments Section
  .attachments-section {
    .section-title {
      font-size: 0.9375rem;
      font-weight: 600;
      color: #334155;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;

      @media (min-width: 768px) {
        font-size: 1rem;
        margin-bottom: 1rem;
      }

      i {
        color: #667eea;
        font-size: 1.125rem;

        @media (min-width: 768px) {
          font-size: 1.25rem;
        }
      }
    }
  }

  // Landscape Mobile Optimization
  @media (max-width: 767px) and (orientation: landscape) {
    padding: 0.75rem;

    .card {
      padding: 0.75rem;
    }

    .form-grid {
      gap: 1rem;
    }

    .main-content,
    .sidebar-content {
      gap: 1rem;
    }

    .form-field {
      gap: 0.375rem;
    }

    .sidebar-content .details-card {
      padding: 0.75rem;
      gap: 1rem;
    }
  }

  // Very Small Devices (< 360px)
  @media (max-width: 359px) {
    padding: 0.5rem;

    .card {
      padding: 0.75rem;
      border-radius: 6px;

      .page-title {
        font-size: 1.125rem;

        i {
          font-size: 1.25rem;
        }
      }

      .page-subtitle {
        font-size: 0.8125rem;
      }
    }
  }
}
</file>

<file path="src/app/features/task-management/tasks/tasks-create/task-form.component.ts">
// src/app/features/task-management/tasks/tasks-create/task-form.component.ts

import { Component, OnInit, inject } from '@angular/core';
import { CommonModule } from '@angular/common';
import {
    FormBuilder,
    FormGroup,
    FormsModule,
    ReactiveFormsModule,
    Validators
} from '@angular/forms';
import { ActivatedRoute, Router } from '@angular/router';
import { ButtonModule } from 'primeng/button';
import { InputTextModule } from 'primeng/inputtext';
import { EditorModule } from 'primeng/editor';
import { SelectModule } from 'primeng/select';
import { DatePickerModule } from 'primeng/datepicker';
import { AutoCompleteModule } from 'primeng/autocomplete';
import { FileUploadModule } from 'primeng/fileupload';
import { MessageService } from 'primeng/api';
import { ToastModule } from 'primeng/toast';
import { InputNumberModule } from 'primeng/inputnumber';

// âœ… Import from real services and models
import { TaskService } from '../../services/task.service';
import { UserService } from '@/features/user-management/user.service';
import {
    CreateTaskData,
    TaskPriority,
    TaskType,
    EnrichedTask,
    Executive
} from '../../models';
import { Id } from 'convex/_generated/dataModel';

@Component({
    selector: 'app-task-form',
    standalone: true,
    imports: [
        CommonModule,
        ReactiveFormsModule,
        ButtonModule,
        InputTextModule,
        InputNumberModule,
        EditorModule,
        SelectModule,
        DatePickerModule,
        AutoCompleteModule,
        FileUploadModule,
        ToastModule,
        FormsModule
    ],
    providers: [MessageService],
    templateUrl: './task-form.component.html',
    styleUrls: ['./task-form.component.scss']
})
export class TaskFormComponent implements OnInit {
    taskForm!: FormGroup;
    isEditMode = false;
    currentTaskId: Id<'tasks'> | null = null;
    isLoading = true;
    minDate = new Date();

    allExecutives: Executive[] = [];
    filteredExecutives: Executive[] = [];
    selectedExecutive: Executive | null = null; // âœ… TRACK SELECTED
    selectedExecutiveName: string = ''; // For display in autocomplete
    taskPriorities: { label: string; value: TaskPriority }[] = [
        { label: 'Low', value: 'low' },
        { label: 'Medium', value: 'medium' },
        { label: 'High', value: 'high' },
        { label: 'Urgent', value: 'urgent' }
    ];

    taskTypes: { label: string; value: TaskType }[] = [
        { label: 'Verification', value: 'verification' },
        { label: 'Survey', value: 'survey' },
        { label: 'Collection', value: 'collection' },
        { label: 'Other', value: 'other' }
    ];

    fb = inject(FormBuilder);
    router = inject(Router);
    route = inject(ActivatedRoute);
    taskService = inject(TaskService);
    userService = inject(UserService);
    messageService = inject(MessageService);

    constructor() {
        this.taskForm = this.fb.group({
            title: ['', [Validators.required, Validators.minLength(3)]],
            description: ['', Validators.required],
            type: ['verification' as TaskType, Validators.required],
            priority: ['medium' as TaskPriority, Validators.required],
            assignedTo: [null, Validators.required],
            dueDate: [null, Validators.required],
            estimatedHours: [1, [Validators.required, Validators.min(0.5)]],
            wardId: ['', Validators.required], // âœ… WARD ID FIELD (auto-filled)
            wardDisplay: [''],
            notes: ['']
        });
    }

    async ngOnInit() {
        await this.loadExecutives();

        const taskId = this.route.snapshot.paramMap.get('id');
        if (taskId) {
            this.currentTaskId = taskId as Id<'tasks'>;
            this.isEditMode = true;
            await this.loadTask(this.currentTaskId);
        }
        this.isLoading = false;
    }

    async loadExecutives() {
        try {
            const result = await this.userService.getExecutives(
                { numItems: 100, cursor: null },
                { isActive: true }
            );

            // âœ… MAP TO INCLUDE WARD ID
            this.allExecutives = result.page.map((exec: any) => ({
                _id: exec._id,
                name: exec.name,
                email: exec.email,
                employeeId: exec.employeeId,
                wardId: exec.wardId, // âœ… EXTRACT WARD ID
                wardName: exec.wardName,
                zone: exec.zone,
                district: exec.district,
                hierarchyId: exec.hierarchyId
            }));

            console.log('âœ… Loaded executives:', this.allExecutives.length);
        } catch (error) {
            console.error('Failed to load executives:', error);
            this.messageService.add({
                severity: 'error',
                summary: 'Error',
                detail: 'Failed to load executives',
                life: 3000
            });
        }
    }

    async loadTask(taskId: Id<'tasks'>) {
        try {
            const task = await this.taskService.getTask(taskId);
            console.log('âœ… Loaded task for editing:', task);
            // âœ… Find and set the selected executive
            this.selectedExecutiveName = task.executiveName || '';
            this.selectedExecutive =
                this.allExecutives.find((e) => e._id === task.assignedTo) ||
                null;
            if (this.selectedExecutive) {
                this.selectedExecutiveName = this.selectedExecutive.name;
            }

            this.taskForm.patchValue({
                title: task.title,
                description: task.description,
                type: (task as any).type || 'other',
                priority: task.priority,
                assignedTo: task.assignedTo,
                dueDate: new Date(task.dueDate),
                estimatedHours: (task as any).estimatedHours || 1,
                wardId: (task as any).wardId || '',
                notes: (task as any).notes || ''
            });

            console.log('âœ… Task loaded for editing');
        } catch (error) {
            console.error('Failed to load task:', error);
            this.messageService.add({
                severity: 'error',
                summary: 'Error',
                detail: 'Failed to load task',
                life: 3000
            });
        }
    }
    filterExecutives(event: any) {
        const query = event.query.toLowerCase();

        // Filter and return just the names as suggestions
        const filtered = this.allExecutives.filter(
            (exec) =>
                exec.name.toLowerCase().includes(query) ||
                exec.employeeId.toLowerCase().includes(query) ||
                exec.email.toLowerCase().includes(query)
        );

        this.filteredExecutives = filtered;
    }

    // âœ… WHEN EXECUTIVE SELECTED â†’ AUTO-FILL WARD ID
 onExecutiveSelect(event: any) {
  console.log('âœ… Executive selected (raw event):', event);

  // For PrimeNG p-autoComplete the selected value is usually in event.value
  const executive = event?.value ?? event;
  console.log('ðŸ” Matched executive object:', executive);

  if (executive) {
    this.selectedExecutiveName = executive.name;
    this.selectedExecutive = executive;  // âœ… actually store the object
    console.log('âœ… Full executive object:', this.selectedExecutive);

    this.taskForm.patchValue({
      assignedTo: executive._id,
      wardId: executive.wardId
    });

    console.log('âœ… Assigned To ID:', executive._id);
    console.log('âœ… Ward ID set:', executive.wardId);
    console.log('âœ… Ward Name (if present):', executive.wardName);
  }
}


    // âœ… DISPLAY EXECUTIVE NAME (not [object])
    getExecutiveName(executiveId: Id<'executives'>): string {
        const exec = this.allExecutives.find((e) => e._id === executiveId);
        return exec ? exec.name : '';
    }

    onCancel() {
        this.router.navigate(['/tasks']);
    }

    async onSubmit() {
        if (this.taskForm.invalid) {
            this.messageService.add({
                severity: 'error',
                summary: 'Validation Error',
                detail: 'Please fill in all required fields',
                life: 3000
            });
            return;
        }

        const formValue = this.taskForm.value;

        try {
            if (this.isEditMode && this.currentTaskId) {
                // âœ… INCLUDE REASSIGNMENT in edit
                await this.taskService.updateTask(this.currentTaskId, {
                    title: formValue.title,
                    description: formValue.description,
                    priority: formValue.priority,
                    dueDate: new Date(formValue.dueDate).getTime(),
                    estimatedHours: formValue.estimatedHours,
                    assignedTo: formValue.assignedTo, // âœ… ADD THIS
                    wardId: formValue.wardId, // âœ… ADD THIS
                    notes: formValue.notes
                });

                this.messageService.add({
                    severity: 'success',
                    summary: 'Success',
                    detail: 'Task updated successfully',
                    life: 3000
                });
            } else {
                // Create task (unchanged)
                const taskData: CreateTaskData = {
                    title: formValue.title,
                    description: formValue.description,
                    type: formValue.type,
                    priority: formValue.priority,
                    assignedTo: formValue.assignedTo,
                    dueDate: new Date(formValue.dueDate).getTime(),
                    estimatedHours: formValue.estimatedHours,
                    wardId: formValue.wardId,
                    notes: formValue.notes
                };

                await this.taskService.createTask(taskData);
                this.messageService.add({
                    severity: 'success',
                    summary: 'Success',
                    detail: 'Task created successfully',
                    life: 3000
                });
            }

            setTimeout(() => this.router.navigate(['/tasks/tasks-list']), 1000);
        } catch (error: any) {
            console.error('Failed to save task:', error);
            this.messageService.add({
                severity: 'error',
                summary: 'Error',
                detail: error?.message || 'Failed to save task',
                life: 3000
            });
        }
    }
}
</file>

<file path="src/app/features/training/interfaces/training.interface.ts">
import { Id } from 'convex/_generated/dataModel';

export interface Course {
    _id: Id<'training_courses'>;
    _creationTime: number;
    title: string;
    description: string;
    category: string;
    difficulty: 'beginner' | 'intermediate' | 'advanced';
    passingScore: number;
    estimatedHours: number;
    rootId: string;
    isActive: boolean;
    isDeleted: boolean;
    certificateTemplateId?: Id<'_storage'>;
    totalEnrollments: number;
    completionRate: number;
    averageScore: number;
    createdAt: number;
    updatedAt: number;
    modules?: Module[];
}

export interface TrainingProgress {
    _id: Id<'training_progress'>;
    _creationTime: number;
    executiveId: Id<'executives'>;
    courseId: Id<'training_courses'>;
    status: 'not_started' | 'in_progress' | 'completed' | 'failed';
    completedModules: number;
    totalModules: number;
    progressPercentage: number;
    finalScore?: number;
    startedAt: number;
    completedAt?: number;
    certificateId?: Id<'_storage'>;
    createdAt: number;
    updatedAt: number;
    executiveName?: string;
    courseTitle?: string;
}

export interface QuizQuestion {
    _id: string;
    module_id: string; // âœ… DB field (snake_case)
    question_text: string; // âœ… DB field (snake_case)
    question_type: QuizQuestionType;
    correct_answer: string; // âœ… DB field (snake_case)
    options?: string[]; // âœ… JSON field
    points: number; // âœ… DB field
    difficulty?: 'easy' | 'medium' | 'hard'; // âœ… DB field
    explanation?: string; // âœ… DB field
    createdAt?: number;
    updatedAt?: number;
}
export interface QuizImportCSV {
    moduleId: string;
    file: File;
}

export interface AddQuestionRequest {
    moduleId: string;
    questionText: string;
    questionType: QuizQuestionType;
    correctAnswer: string;
    options?: string[];
    explanation?: string;
    points: number;
    difficulty?: 'easy' | 'medium' | 'hard';
}

export interface QuizQuestionFrontend {
    _id: string;
    moduleId: string;
    questionText: string;
    questionType: QuizQuestionType;
    correctAnswer: string;
    options?: string[];
    points: number;
    difficulty?: 'easy' | 'medium' | 'hard';
    explanation?: string;
    createdAt?: number;
    updatedAt?: number;
}

export interface ContentTreeNode {
    label: string;
    key: string;
    data: Course | any; // Course for root, module for children
    expanded?: boolean;
    leaf?: boolean;
    children?: ContentTreeNode[];
    courseTitle?: string; // For modules
}

export interface Module {
    _id: Id<'training_modules'>;
    title: string;
    description: string;
    order: number;
    estimatedMinutes: number;
    contentType: 'video' | 'document' | 'quiz' | 'interactive';
    contentId?: Id<'_storage'>;
    isRequired: boolean;
    createdAt: number;
    updatedAt: number;
}

export type QuizQuestionType = 'multiplechoice' | 'truefalse' | 'shortanswer';

export interface TrainingProgress {
    _id: Id<'training_progress'>;
    _creationTime: number;
    rootId: Id<'hierarchies'>;
    hierarchyId: Id<'hierarchies'>;
    executiveId: Id<'executives'>;
    courseId: Id<'training_courses'>;
    completedModules: number;
    totalModules: number;
    progressPercentage: number;
    status: 'not_started' | 'in_progress' | 'completed' | 'failed';
    startedAt: number;
    lastAccessedAt: number;
    completedAt?: number;
    finalScore?: number;
    certificateId?: Id<'_storage'>;
    createdAt: number;
    updatedAt: number;
    // Enriched fields
    executiveName?: string;
    executiveEmployeeId?: string;
    courseTitle?: string;
}

export interface ModuleProgress {
    _id: Id<'training_module_progress'>;
    progressId: Id<'training_progress'>;
    moduleId: Id<'training_modules'>;
    executiveId: Id<'executives'>;
    status: 'not_started' | 'in_progress' | 'completed';
    timeSpentMinutes: number;
    score?: number;
    startedAt?: number;
    completedAt?: number;
    createdAt: number;
    updatedAt: number;
}

export interface PaginatedProgress {
    page: TrainingProgress[];
    continueCursor: string;
    isDone: boolean;
}
</file>

<file path="src/app/features/training/manage-content/manage-content.component.html">
<div class="content-management-wrapper">
    <p-toast position="top-right" />

    <!-- Header -->
    <div class="content-header surface-card shadow-2 border-round-lg mb-4">
        <div class="flex align-items-center justify-content-between px-5 py-4">
            <div class="flex align-items-center gap-4">
                <div
                    class="flex align-items-center justify-content-center bg-primary border-circle"
                    style="width: 3.5rem; height: 3.5rem"
                >
                    <i class="pi pi-book text-white text-2xl"></i>
                </div>
                <div>
                    <h1 class="text-3xl font-bold text-900 m-0 mb-2">
                        Content Management
                    </h1>
                    <p class="text-600 m-0">
                        Training &amp; Course Administration
                    </p>
                </div>
            </div>

            <div class="flex align-items-center gap-4">
                <div class="text-center px-4 border-right-1 surface-border">
                    <div class="text-2xl font-bold text-primary">
                        {{ courseTree().length }}
                    </div>
                    <div class="text-sm text-500 uppercase font-medium">
                        Courses
                    </div>
                </div>
                <div class="text-center px-4 border-right-1 surface-border">
                    <div class="text-2xl font-bold text-primary">
                        {{ getTotalModules() }}
                    </div>
                    <div class="text-sm text-500 uppercase font-medium">
                        Modules
                    </div>
                </div>
                <div class="flex gap-2">
                    <p-button
                        icon="pi pi-refresh"
                        [outlined]="true"
                        [loading]="loading()"
                        (click)="loadCourses()"
                        pTooltip="Refresh"
                        tooltipPosition="bottom"
                    />
                    <p-button
                        label="New Course"
                        icon="pi pi-plus"
                        (click)="showNewCourseDialog = true"
                    />
                </div>
            </div>
        </div>
    </div>

    <div class="grid">
        <!-- LEFT: Course Tree -->
        <div class="col-12 lg:col-3">
            <div class="surface-card shadow-2 border-round-lg h-full">
                <div
                    class="flex align-items-center justify-content-between p-4 border-bottom-1 surface-border"
                >
                    <div class="flex align-items-center gap-2">
                        <i class="pi pi-list text-primary"></i>
                        <span class="font-semibold text-900"
                            >Course Library</span
                        >
                    </div>
                    <p-tag [value]="courseTree().length.toString()" />
                </div>

                <div class="p-3 border-bottom-1 surface-border">
                    <span class="p-input-icon-left w-full">
                        <i class="pi pi-search"></i>
                        <input
                            pInputText
                            type="text"
                            placeholder="Search courses..."
                            class="w-full"
                        />
                    </span>
                </div>

                <div
                    class="p-3"
                    style="max-height: calc(100vh - 350px); overflow-y: auto"
                >
                    @if (loading()) {
                        <div
                            class="flex flex-column align-items-center justify-content-center py-8"
                        >
                            <p-progressSpinner
                                styleClass="w-4rem h-4rem"
                                strokeWidth="4"
                            />
                            <p class="text-sm text-600 mt-3">
                                Loading courses...
                            </p>
                        </div>
                    } @else if (courseTree().length === 0) {
                        <div
                            class="flex flex-column align-items-center justify-content-center py-8 text-center"
                        >
                            <i class="pi pi-inbox text-6xl text-300 mb-4"></i>
                            <h3 class="text-lg font-semibold text-900 mb-2">
                                No Courses
                            </h3>
                            <p class="text-sm text-600 mb-4">
                                Create your first course to get started.
                            </p>
                            <p-button
                                label="Create Course"
                                icon="pi pi-plus"
                                size="small"
                                (click)="showNewCourseDialog = true"
                            />
                        </div>
                    } @else {
                        <p-tree
                            [value]="courseTree()"
                            selectionMode="single"
                            [(selection)]="selectedNode"
                            (onNodeSelect)="onNodeSelect($event)"
                            [filter]="true"
                            filterPlaceholder="Filter..."
                            class="w-full"
                        />
                    }
                </div>
            </div>
        </div>

        <!-- CENTER: Editor -->
        <div class="col-12 lg:col-6">
            <div class="surface-card shadow-2 border-round-lg">
                @if (!selectedNode) {
                    <div
                        class="flex flex-column align-items-center justify-content-center p-8"
                        style="min-height: 500px"
                    >
                        <div class="text-center" style="max-width: 400px">
                            <div
                                class="bg-primary-50 inline-flex align-items-center justify-content-center border-circle mb-4"
                                style="width: 100px; height: 100px"
                            >
                                <i
                                    class="pi pi-file-edit text-5xl text-primary"
                                ></i>
                            </div>
                            <h2 class="text-2xl font-bold text-900 mb-3">
                                Select Content to Edit
                            </h2>
                            <p class="text-600 line-height-3 mb-4">
                                Choose a course or module from the library to
                                view and manage its details.
                            </p>
                            <div class="flex gap-2 justify-content-center">
                                <p-button
                                    label="Refresh"
                                    icon="pi pi-refresh"
                                    [outlined]="true"
                                    (click)="loadCourses()"
                                />
                                <p-button
                                    label="New Course"
                                    icon="pi pi-plus"
                                    (click)="showNewCourseDialog = true"
                                />
                            </div>
                        </div>
                    </div>
                } @else {
                    <div class="p-5">
                        <!-- Breadcrumb -->
                        <div class="flex align-items-center gap-2 mb-4 text-sm">
                            <i class="pi pi-home text-500"></i>
                            <i class="pi pi-angle-right text-400"></i>
                            <span class="text-600">Content Library</span>
                            <i class="pi pi-angle-right text-400"></i>
                            <span class="font-semibold text-900">
                                {{ selectedContentTitle || 'Untitled' }}
                            </span>
                        </div>

                        <!-- Title & Tags -->
                        <div class="flex align-items-center gap-2 mb-3">
                            <p-tag
                                [value]="
                                    selectedContentType || 'course' | titlecase
                                "
                                [severity]="
                                    getContentTypeColor(
                                        selectedContentType || 'course'
                                    )
                                "
                            />
                            @if (isCourse()) {
                                <p-tag value="Course" severity="success" />
                            } @else {
                                <p-tag value="Module" severity="secondary" />
                            }
                        </div>

                        <!-- Title -->
                        <div class="mb-4">
                            <label
                                class="block text-sm font-semibold text-700 mb-2"
                                >Title *</label
                            >
                            <input
                                pInputText
                                [(ngModel)]="selectedContentTitle"
                                placeholder="Enter title"
                                class="w-full text-xl font-bold"
                            />
                        </div>

                        <!-- Description -->
                        <div class="mb-4">
                            <label
                                class="block text-sm font-semibold text-700 mb-2"
                                >Description</label
                            >
                            <textarea
                                pInputTextarea
                                [(ngModel)]="selectedContentDescription"
                                rows="4"
                                placeholder="Enter description..."
                                class="w-full"
                            ></textarea>
                        </div>

                        <!-- Course fields -->
                        @if (isCourse()) {
                            <div class="grid mb-4">
                                <div class="col-12 md:col-6">
                                    <label
                                        class="block text-sm font-semibold text-700 mb-2"
                                        >Category *</label
                                    >
                                    <p-select
                                        [options]="categories"
                                        [(ngModel)]="selectedContentCategory"
                                        placeholder="Select category"
                                        class="w-full"
                                        [filter]="true"
                                    />
                                </div>
                                <div class="col-12 md:col-6">
                                    <label
                                        class="block text-sm font-semibold text-700 mb-2"
                                        >Passing Score (%)</label
                                    >
                                    <p-inputNumber
                                        [(ngModel)]="
                                            selectedNode!.data.passingScore
                                        "
                                        [min]="0"
                                        [max]="100"
                                        suffix="%"
                                        class="w-full"
                                    />
                                </div>
                            </div>
                        }

                        <!-- Module fields -->
                        @if (isModule()) {
                            <div class="grid mb-4">
                                <div class="col-12 md:col-6">
                                    <label
                                        class="block text-sm font-semibold text-700 mb-2"
                                        >Content Type</label
                                    >
                                    <p-select
                                        [options]="contentTypes"
                                        [(ngModel)]="selectedContentType"
                                        placeholder="Select type"
                                        class="w-full"
                                    />
                                </div>
                                <div class="col-12 md:col-6">
                                    <label
                                        class="block text-sm font-semibold text-700 mb-2"
                                        >Estimated Minutes</label
                                    >
                                    <p-inputNumber
                                        [(ngModel)]="
                                            selectedNode!.data.estimatedMinutes
                                        "
                                        [min]="0"
                                        suffix=" min"
                                        class="w-full"
                                    />
                                </div>
                            </div>

                            <!-- Module content upload -->
                            <div class="mb-4 surface-50 border-round p-3">
                                <div
                                    class="flex align-items-center justify-content-between mb-2"
                                >
                                    <span class="font-semibold text-900"
                                        >Module Content File</span
                                    >
                                    <span
                                        class="text-400 text-sm"
                                        *ngIf="selectedModuleContentUrl"
                                    >
                                        {{
                                            selectedContentType | titlecase
                                        }}
                                        attached
                                    </span>
                                </div>

                                <p-fileUpload
                                    name="moduleContent"
                                    mode="basic"
                                    chooseLabel="Upload file"
                                    [auto]="true"
                                    [maxFileSize]="524288000"
                                    (onSelect)="onModuleFileSelected($event)"
                                    [disabled]="uploading()"
                                ></p-fileUpload>

                                <small class="text-500 block mt-2">
                                    Video: MP4/WebM/OGG/MOV up to 500MB.
                                    Documents: PDF/DOC/DOCX up to 50MB.
                                </small>
                            </div>

                            

                            <!-- Module content preview -->
                            @if (selectedModuleContentUrl) {
                                <div class="mb-4 surface-card border-round p-3">
                                    <h3
                                        class="text-sm font-semibold text-700 mb-3"
                                    >
                                        Content Preview
                                    </h3>

                                    @if (selectedContentType === 'video') {
                                        <video
                                            controls
                                            [src]="selectedModuleContentUrl"
                                            class="w-full border-round"
                                            style="max-height: 360px"
                                        ></video>
                                    } @else if (
                                        selectedContentType === 'document'
                                    ) {
                                        <iframe
                                            [src]="
                                                selectedModuleContentUrl
                                                    | safeResource
                                            "
                                            class="w-full border-round"
                                            style="height: 480px; border: none"
                                        ></iframe>
                                    } @else {
                                        <p class="text-600 text-sm m-0">
                                            This content type does not have a
                                            preview. Use the dedicated editor
                                            instead.
                                        </p>
                                    }
                                </div>
                            } @else {
                                <div
                                    class="mb-4 surface-50 border-round p-3 text-sm text-600"
                                >
                                    No content file uploaded yet. Upload a video
                                    or document to attach it to this module.
                                </div>
                            }
                        }

                        <p-divider />

                        <!-- Modules list for courses -->
                        @if (isCourse()) {
                            <div class="mb-4">
                                <div
                                    class="flex align-items-center justify-content-between mb-3"
                                >
                                    <h3 class="text-lg font-bold text-900 m-0">
                                        Modules ({{
                                            selectedNode!.data.modules
                                                ?.length || 0
                                        }})
                                    </h3>
                                    <p-button
                                        label="Add Module"
                                        icon="pi pi-plus"
                                        size="small"
                                        [outlined]="true"
                                        (click)="openAddModuleDialog()"
                                    />
                                </div>

                                @if (
                                    selectedNode!.data.modules &&
                                    selectedNode!.data.modules.length > 0
                                ) {
                                    <div class="flex flex-column gap-2">
                                        @for (
                                            module of selectedNode!.data
                                                .modules;
                                            track module._id;
                                            let i = $index
                                        ) {
                                            <div
                                                class="surface-50 border-round p-3 flex align-items-center justify-content-between hover:surface-100 transition-duration-150 cursor-pointer"
                                            >
                                                <div
                                                    class="flex align-items-center gap-3"
                                                >
                                                    <div
                                                        class="bg-primary text-white w-2rem h-2rem border-circle flex align-items-center justify-content-center font-bold text-sm"
                                                    >
                                                        {{ i + 1 }}
                                                    </div>
                                                    <div>
                                                        <div
                                                            class="font-semibold text-900"
                                                        >
                                                            {{ module.title }}
                                                        </div>
                                                        <div
                                                            class="text-sm text-600"
                                                        >
                                                            {{
                                                                module.contentType ||
                                                                    'No type'
                                                            }}
                                                            <span
                                                                *ngIf="
                                                                    module.contentId
                                                                "
                                                                class="ml-2 text-xs text-primary"
                                                            >
                                                                â€¢ file attached
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="flex gap-2">
                                                    <p-button
                                                        icon="pi pi-pencil"
                                                        size="small"
                                                        [text]="true"
                                                        [rounded]="true"
                                                        label="Edit"
                                                        (click)="
                                                            selectModuleFromList(
                                                                module
                                                            )
                                                        "
                                                    />
                                                    <p-button
                                                        icon="pi pi-trash"
                                                        severity="danger"
                                                        size="small"
                                                        [text]="true"
                                                        [rounded]="true"
                                                        label="Delete"
                                                        (click)="
                                                            onDeleteModule(
                                                                module
                                                            )
                                                        "
                                                    />
                                                </div>
                                            </div>
                                        }
                                    </div>
                                } @else {
                                    <div
                                        class="surface-50 border-round p-4 text-center"
                                    >
                                        <i
                                            class="pi pi-folder-open text-4xl text-300 mb-3"
                                        ></i>
                                        <p class="text-600 m-0">
                                            No modules yet. Click "Add Module"
                                            to create one.
                                        </p>
                                    </div>
                                }
                            </div>
                        }

                        <!-- Actions -->
                        <div
                            class="flex gap-2 justify-content-end pt-4 border-top-1 surface-border"
                        >
                            <p-button
                                label="Discard"
                                icon="pi pi-times"
                                severity="secondary"
                                [outlined]="true"
                            />
                            <p-button
                                label="Save Changes"
                                icon="pi pi-check"
                                [loading]="saving()"
                                (click)="saveContent()"
                            />
                        </div>
                    </div>
                }
            </div>
        </div>

        <!-- RIGHT: Properties (simplified) -->
        <div class="col-12 lg:col-3">
            <div class="surface-card shadow-2 border-round-lg p-4 h-full">
                <h3
                    class="text-lg font-bold text-900 mb-4 flex align-items-center gap-2"
                >
                    <i class="pi pi-cog text-primary"></i>
                    Properties
                </h3>

                @if (selectedNode) {
                    <div class="flex flex-column gap-4">
                        <div>
                            <label
                                class="block text-sm font-semibold text-700 mb-2"
                                >Status</label
                            >
                            <p-tag
                                value="Published"
                                severity="success"
                                class="w-full"
                            />
                        </div>
                        <div>
                            <label
                                class="block text-sm font-semibold text-700 mb-2"
                                >Created</label
                            >
                            <p class="text-sm text-600 m-0">
                                <i class="pi pi-calendar mr-2"></i>
                                {{
                                    selectedNode.data?.createdAt
                                        | date: 'MMM d, y'
                                }}
                            </p>
                        </div>
                        <div>
                            <label
                                class="block text-sm font-semibold text-700 mb-2"
                                >Last Modified</label
                            >
                            <p class="text-sm text-600 m-0">
                                <i class="pi pi-clock mr-2"></i>
                                {{
                                    selectedNode.data?.updatedAt
                                        | date: 'MMM d, y, h:mm a'
                                }}
                            </p>
                        </div>
                    </div>
                } @else {
                    <div class="text-center py-6">
                        <i class="pi pi-info-circle text-4xl text-300 mb-3"></i>
                        <p class="text-sm text-500">
                            Select content to view properties.
                        </p>
                    </div>
                }
            </div>
        </div>
    </div>

    <!-- Add Module dialog -->
    <p-dialog
        header="Add Module"
        [(visible)]="showAddModuleDialog"
        [modal]="true"
        [style]="{ width: '500px' }"
        [draggable]="false"
    >
        <div class="flex flex-column gap-3">
            <div>
                <label class="block text-sm font-semibold text-700 mb-2"
                    >Title *</label
                >
                <input
                    pInputText
                    [(ngModel)]="newModule.title"
                    placeholder="Module title"
                    class="w-full"
                />
            </div>
            <div>
                <label class="block text-sm font-semibold text-700 mb-2"
                    >Description</label
                >
                <textarea
                    pInputTextarea
                    rows="3"
                    [(ngModel)]="newModule.description"
                    placeholder="Short description"
                    class="w-full"
                ></textarea>
            </div>
            <div class="grid">
                <div class="col-12 md:col-6">
                    <label class="block text-sm font-semibold text-700 mb-2"
                        >Estimated Minutes</label
                    >
                    <p-inputNumber
                        [(ngModel)]="newModule.estimatedMinutes"
                        [min]="0"
                        suffix=" min"
                        class="w-full"
                    ></p-inputNumber>
                </div>
                <div class="col-12 md:col-6">
                    <label class="block text-sm font-semibold text-700 mb-2"
                        >Content Type</label
                    >
                    <p-select
                        [options]="contentTypes"
                        [(ngModel)]="newModule.contentType"
                        class="w-full"
                        placeholder="Select type"
                    ></p-select>
                </div>
            </div>
            <div>
                <p-checkbox
                    binary="true"
                    [(ngModel)]="newModule.isRequired"
                    label="Required module"
                ></p-checkbox>
            </div>
        </div>

        <ng-template pTemplate="footer">
            <p-button
                label="Cancel"
                [outlined]="true"
                (click)="showAddModuleDialog = false"
            ></p-button>
            <p-button
                label="Create"
                icon="pi pi-check"
                [loading]="saving()"
                (click)="createModuleFromDialog()"
            ></p-button>
        </ng-template>
    </p-dialog>
</div>
</file>

<file path="src/app/features/training/manage-content/manage-content.component.scss">
// Simple, clean, Apollo-compatible styles
.content-management-wrapper {
  width: 100%;
  padding: 1.5rem;
  
  // Tree styling
  ::ng-deep {
    .p-tree {
      border: none;
      background: transparent;
      
      .p-tree-node-content {
        padding: 0.75rem;
        border-radius: 6px;
        transition: all 0.2s;
        
        &:hover {
          background: var(--primary-50);
        }
        
        &.p-tree-node-content-selected {
          background: var(--primary-100);
          font-weight: 600;
        }
      }
    }
  }
}
</file>

<file path="src/app/features/training/manage-content/manage-content.component.ts">
import { Component, OnInit, signal } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule, ReactiveFormsModule } from '@angular/forms';

import { TreeNode, MessageService, SharedModule } from 'primeng/api';
import { TreeModule } from 'primeng/tree';
import { ButtonModule } from 'primeng/button';
import { InputTextModule } from 'primeng/inputtext';
import { SplitterModule } from 'primeng/splitter';
import { DialogModule } from 'primeng/dialog';
import { TagModule } from 'primeng/tag';
import { ToastModule } from 'primeng/toast';
import { ProgressSpinnerModule } from 'primeng/progressspinner';
import { InputNumberModule } from 'primeng/inputnumber';
import { CardModule } from 'primeng/card';
import { SelectModule } from 'primeng/select';
import { CheckboxModule } from 'primeng/checkbox';
import { DividerModule } from 'primeng/divider';
import { EditorModule } from 'primeng/editor';
import { FileUploadModule } from 'primeng/fileupload';
import { MenuModule } from 'primeng/menu';
import { RadioButtonModule } from 'primeng/radiobutton';
import { ToolbarModule } from 'primeng/toolbar';
import { TooltipModule } from 'primeng/tooltip';

import { Id } from 'convex/_generated/dataModel';

import { TrainingService } from '../services/training.service';
import { ContentTreeNode, Course } from '../interfaces/training.interface';
import { SafeResourcePipe } from '../saferesourcespipe/safe-resource.pipe';

@Component({
    selector: 'app-manage-content',
    standalone: true,
    imports: [
        CommonModule,
        FormsModule,
        ReactiveFormsModule,
        TreeModule,
        SharedModule,
        ButtonModule,
        InputTextModule,
        EditorModule,
        SplitterModule,
        FileUploadModule,
        RadioButtonModule,
        DialogModule,
        MenuModule,
        ToolbarModule,
        SelectModule,
        ToastModule,
        TooltipModule,
        DividerModule,
        InputNumberModule,
        CheckboxModule,
        ProgressSpinnerModule,
        TagModule,
        CardModule,
        SafeResourcePipe
    ],
    templateUrl: './manage-content.component.html',
    styleUrls: ['./manage-content.component.scss'],
    providers: [MessageService]
})
export class ManageContentComponent implements OnInit {
    // Signals
    loading = signal(false);
    saving = signal(false);
    uploading = signal(false);

    // Tree data
    courseTree = signal<TreeNode[]>([]);
    selectedNode: TreeNode | null = null;

    // Content fields
    selectedContentTitle = '';
    selectedContentDescription = '';
    selectedContentCategory = '';
    selectedContentType:
        | 'course'
        | 'video'
        | 'document'
        | 'quiz'
        | 'interactive'
        | '' = '';

    // Module content file
    selectedModuleStorageId: Id<'_storage'> | null = null;
    selectedModuleContentUrl: string | null = null;

    // Dialogs
    showNewCourseDialog = false;
    showAddModuleDialog = false;

    // Add module model
    newModule = {
        title: '',
        description: '',
        estimatedMinutes: 60,
        contentType: 'video' as 'video' | 'document' | 'quiz' | 'interactive',
        isRequired: true
    };

    // Dropdown options
    contentTypes = [
        { label: 'Course', value: 'course' },
        { label: 'Video', value: 'video' },
        { label: 'Document', value: 'document' },
        { label: 'Quiz', value: 'quiz' },
        { label: 'Interactive', value: 'interactive' }
    ];

    categories = [
        { label: 'Leadership', value: 'leadership' },
        { label: 'Technical', value: 'technical' },
        { label: 'Compliance', value: 'compliance' },
        { label: 'Soft Skills', value: 'soft_skills' }
    ];

    constructor(
        private trainingService: TrainingService,
        private messageService: MessageService
    ) {}

    async ngOnInit() {
        await this.loadCourses();
    }

    // ---------------------------------------------------------------------------
    // LOAD COURSES & BUILD TREE
    // ---------------------------------------------------------------------------
    async loadCourses() {
        this.loading.set(true);
        try {
            await this.buildCourseTree();
            this.messageService.add({
                severity: 'success',
                summary: 'Loaded',
                detail: 'Courses loaded successfully'
            });
        } catch (error: any) {
            console.error('âŒ loadCourses failed', error);
            this.messageService.add({
                severity: 'error',
                summary: 'Error',
                detail: error.message || 'Failed to load courses'
            });
        } finally {
            this.loading.set(false);
        }
    }

    private async buildCourseTree() {
        const courses = (await this.trainingService.getCourses()) as Course[];

        const tree: ContentTreeNode[] = courses.map((course) => ({
            label: course.title,
            key: course._id as any,
            data: course,
            expanded: true,
            children: (course.modules || []).map(
                (module: any, index: number) => ({
                    label: module.title || `Module ${index + 1}`,
                    key: module._id as any,
                    data: {
                        ...module,
                        courseTitle: course.title,
                        isModule: true
                    },
                    leaf: true
                })
            )
        }));

        this.courseTree.set(tree as any as TreeNode[]);
        console.log('ðŸŒ³ courseTree:', this.courseTree());
    }

    getTotalModules(): number {
        return this.courseTree().reduce((total, course) => {
            return total + (course.children?.length || 0);
        }, 0);
    }

    // ---------------------------------------------------------------------------
    // SELECTION
    // ---------------------------------------------------------------------------
    async onNodeSelect(event: any) {
        console.log('ðŸ“Œ Node selected:', event.node);
        this.selectedNode = event.node;

        const data = event.node?.data || {};

        this.selectedContentTitle = data.title || '';
        this.selectedContentDescription = data.description || '';
        this.selectedContentCategory = data.category || '';
        this.selectedContentType =
            data.contentType || (event.node.parent ? 'video' : 'course');

        this.selectedModuleStorageId = null;
        this.selectedModuleContentUrl = null;

        if (data.contentId) {
            this.selectedModuleStorageId = data.contentId as Id<'_storage'>;
            await this.loadSelectedModuleContentUrl();
        }
    }

    isCourse(): boolean {
        return !!this.selectedNode && !this.selectedNode.parent;
    }

    isModule(): boolean {
        return !!this.selectedNode && !!this.selectedNode.parent;
    }

    // ---------------------------------------------------------------------------
    // MODULE CONTENT FILE
    // ---------------------------------------------------------------------------
    private async loadSelectedModuleContentUrl() {
        if (!this.selectedModuleStorageId) return;

        this.uploading.set(true);
        try {
            const url = await this.trainingService.getModuleContentUrl(
                this.selectedModuleStorageId
            );
            this.selectedModuleContentUrl = url;
        } catch (error) {
            console.error('âŒ Failed to load content URL', error);
            this.messageService.add({
                severity: 'error',
                summary: 'Content error',
                detail: 'Could not load module content'
            });
        } finally {
            this.uploading.set(false);
        }
    }

    async onModuleFileSelected(event: any) {
        if (!this.selectedNode || !this.isModule()) {
            this.messageService.add({
                severity: 'warn',
                summary: 'Select module',
                detail: 'Please select a module first.'
            });
            return;
        }

        const file: File | undefined =
            event?.files?.[0] || event?.target?.files?.[0];
        if (!file) return;

        const contentType = (this.selectedContentType ||
            this.selectedNode.data?.contentType) as
            | 'video'
            | 'document'
            | 'quiz'
            | 'interactive';

        if (contentType !== 'video' && contentType !== 'document') {
            this.messageService.add({
                severity: 'warn',
                summary: 'Unsupported type',
                detail: 'Only video or document modules can have files.'
            });
            return;
        }

        const validationError = this.trainingService.validateModuleFile(
            file,
            contentType
        );
        if (validationError) {
            this.messageService.add({
                severity: 'error',
                summary: 'Invalid file',
                detail: validationError
            });
            return;
        }

        this.uploading.set(true);

        try {
            const storageId = await this.trainingService.uploadModuleFile(file);
            const moduleId = this.selectedNode.data
                ._id as Id<'training_modules'>;

            await this.trainingService.updateModuleContent(moduleId, storageId);

            this.selectedModuleStorageId = storageId;
            const url =
                await this.trainingService.getModuleContentUrl(storageId);
            this.selectedModuleContentUrl = url;

            this.messageService.add({
                severity: 'success',
                summary: 'Content uploaded',
                detail: 'Module content linked successfully.'
            });
        } catch (error: any) {
            console.error('âŒ Upload/link failed', error);
            this.messageService.add({
                severity: 'error',
                summary: 'Upload failed',
                detail: error.message || 'Could not upload module content'
            });
        } finally {
            this.uploading.set(false);
        }
    }

    // ---------------------------------------------------------------------------
    // ADD MODULE
    // ---------------------------------------------------------------------------
    openAddModuleDialog() {
        if (!this.selectedNode || !this.isCourse()) {
            this.messageService.add({
                severity: 'warn',
                summary: 'Select course',
                detail: 'Select a course before adding a module.'
            });
            return;
        }
        this.newModule = {
            title: '',
            description: '',
            estimatedMinutes: 60,
            contentType: 'video',
            isRequired: true
        };
        this.showAddModuleDialog = true;
    }

    async createModuleFromDialog() {
        if (!this.selectedNode || !this.isCourse()) return;

        const courseId = this.selectedNode.data._id as Id<'training_courses'>;

        this.saving.set(true);
        try {
            await this.trainingService.addModule(courseId, this.newModule);
            this.messageService.add({
                severity: 'success',
                summary: 'Module created',
                detail: this.newModule.title || 'New module added.'
            });
            this.showAddModuleDialog = false;
            await this.loadCourses();
        } catch (error: any) {
            this.messageService.add({
                severity: 'error',
                summary: 'Create failed',
                detail: error.message || 'Failed to create module'
            });
        } finally {
            this.saving.set(false);
        }
    }

    // ---------------------------------------------------------------------------
    // EDIT / DELETE MODULE FROM LIST
    // ---------------------------------------------------------------------------
    selectModuleFromList(module: any) {
        const nodes = this.courseTree();
        let found: TreeNode | null = null;

        for (const courseNode of nodes) {
            const child = courseNode.children?.find(
                (m: any) => m.data && m.data._id === module._id
            );
            if (child) {
                found = child as TreeNode;
                break;
            }
        }

        if (found) {
            this.onNodeSelect({ node: found });
        } else {
            this.messageService.add({
                severity: 'warn',
                summary: 'Module not found',
                detail: 'Unable to locate module in tree.'
            });
        }
    }

    async onDeleteModule(module: any) {
        this.uploading.set(true);
        try {
            await this.trainingService.deleteModule(
                module._id as Id<'training_modules'>
            );
            this.messageService.add({
                severity: 'success',
                summary: 'Module deleted',
                detail: module.title
            });
            await this.loadCourses();
            this.selectedNode = null;
        } catch (error: any) {
            this.messageService.add({
                severity: 'error',
                summary: 'Delete failed',
                detail: error.message || 'Failed to delete module'
            });
        } finally {
            this.uploading.set(false);
        }
    }

    // ---------------------------------------------------------------------------
    // CONTENT TYPE TAG COLOR
    // ---------------------------------------------------------------------------
    getContentTypeColor(
        type: string
    ):
        | 'success'
        | 'secondary'
        | 'info'
        | 'warn'
        | 'danger'
        | 'contrast'
        | null {
        const colors: Record<string, any> = {
            course: 'info',
            video: 'info',
            document: 'secondary',
            quiz: 'warn',
            interactive: 'info'
        };
        return colors[type] || 'info';
    }

    // ---------------------------------------------------------------------------
    // SAVE CONTENT (placeholder)
    // ---------------------------------------------------------------------------
    async saveContent() {
        if (!this.selectedNode) return;
        this.saving.set(true);
        setTimeout(() => {
            this.saving.set(false);
            this.messageService.add({
                severity: 'success',
                summary: 'Saved',
                detail: 'Changes saved.'
            });
        }, 800);
    }
}
</file>

<file path="src/app/features/training/quiz-manager/quiz-manager.component.html">
<div class="quiz-manager-root">
    <!-- Header -->
    <div class="quiz-header">
        <div class="header-content">
            <div class="header-left">
                <div class="header-icon-wrapper">
                    <i class="pi pi-question-circle header-icon"></i>
                    <h1>Quiz Manager</h1>
                </div>
                <p>Create and manage quiz questions for training courses</p>
            </div>
        </div>
    </div>

    <!-- Filters -->
    <div class="filters-section">
        <div class="filters-grid">
            <div class="filter-group">
                <label><i class="pi pi-book"></i> Select Course</label>
                <p-select
                    [options]="coursesDropdown"
                    [(ngModel)]="selectedCourse"
                    (onChange)="onCourseChange($event)"
                    placeholder="Choose a course"
                    [disabled]="loading()"
                />
            </div>

            <div class="filter-group">
                <label><i class="pi pi-list"></i> Select Quiz Module</label>
                <p-select
                    [options]="modulesDropdown"
                    [(ngModel)]="selectedModule"
                    (onChange)="onModuleChange($event)"
                    placeholder="Choose a quiz module"
                    [disabled]="
                        !selectedCourse() || modulesDropdown.length === 0
                    "
                />
            </div>

            <div class="filter-actions">
                <p-button
                    label="Add Question"
                    icon="pi pi-plus"
                    (onClick)="showAddDialog()"
                    [disabled]="!selectedModule()"
                />

                <p-button
                    label="Import CSV"
                    icon="pi pi-upload"
                    severity="secondary"
                    (onClick)="fileUpload.choose()"
                    [disabled]="!selectedModule()"
                />

                <p-button
                    label="Download Template"
                    icon="pi pi-download"
                    severity="secondary"
                    [outlined]="true"
                    (onClick)="downloadTemplate()"
                />
            </div>
        </div>
    </div>

    <!-- CSV instructions - ALWAYS VISIBLE -->
    <div class="csv-instructions-panel">
        <h3>How to prepare the Excel / CSV file</h3>
        <p>
            Please follow these steps slowly. The file
            <strong>must</strong> match this format, otherwise questions will
            not import correctly.
        </p>

        <div class="csv-steps-grid">
            <div class="csv-step-card">
                <h4>Step 1 â€“ Open Excel / Sheets</h4>
                <p>
                    Open a new blank sheet in Excel, Google Sheets, or
                    LibreOffice Calc.
                </p>
            </div>

            <div class="csv-step-card">
                <h4>Step 2 â€“ Create headers (Row 1)</h4>
                <p>
                    In the first row (Row 1), create these columns, one per
                    cell:
                </p>
                <pre class="csv-code">
questionText | questionType | correctAnswer | optionA | optionB | optionC | optionD | points | explanation | difficulty
                </pre>
                <p>
                    Type them <strong>exactly</strong> like this (same spelling,
                    no extra spaces, no extra columns).
                </p>
            </div>

            <div class="csv-step-card">
                <h4>Step 3 â€“ Fill one question per row</h4>
                <p>Each next row (Row 2, Row 3, â€¦) is one question.</p>
                <ul>
                    <li><strong>questionText</strong>: the full question.</li>
                    <li>
                        <strong>questionType</strong>: must be exactly one of:
                        multiple_choice, true_false, short_answer (all
                        lowercase, with underscore).
                    </li>
                    <li>
                        <strong>correctAnswer</strong>: <br />- for multiple
                        choice: A, B, C, or D <br />- for true/false: true or
                        false <br />- for short answer: the expected text
                        answer.
                    </li>
                    <li>
                        <strong>optionA â€“ optionD</strong>: for multiple_choice,
                        fill at least A and B. C and D are optional. For
                        true_false and short_answer you can leave them empty.
                    </li>
                    <li><strong>points</strong>: a number like 5, 10, etc.</li>
                    <li>
                        <strong>explanation</strong>: short explanation (can be
                        empty).
                    </li>
                    <li>
                        <strong>difficulty</strong>: must be exactly easy,
                        medium, or hard.
                    </li>
                </ul>
            </div>

            <div class="csv-step-card">
                <h4>Step 4 â€“ Example row</h4>
                <p>
                    This is how a correct multiple choice question looks in
                    Excel:
                </p>
                <table class="csv-example-table">
                    <thead>
                        <tr>
                            <th>questionText</th>
                            <th>questionType</th>
                            <th>correctAnswer</th>
                            <th>optionA</th>
                            <th>optionB</th>
                            <th>optionC</th>
                            <th>optionD</th>
                            <th>points</th>
                            <th>explanation</th>
                            <th>difficulty</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>What is 2 + 2?</td>
                            <td>multiple_choice</td>
                            <td>A</td>
                            <td>4</td>
                            <td>3</td>
                            <td>5</td>
                            <td>6</td>
                            <td>5</td>
                            <td>Basic math question.</td>
                            <td>easy</td>
                        </tr>
                    </tbody>
                </table>
                <p>
                    Every new question is just another row under this, with the
                    same column order.
                </p>
            </div>

            <div class="csv-step-card">
                <h4>Step 5 â€“ Save as CSV</h4>
                <p>When all questions are filled:</p>
                <ul>
                    <li>
                        Excel:
                        <strong>File â†’ Save As â†’ CSV (Comma delimited)</strong>.
                    </li>
                    <li>
                        Google Sheets:
                        <strong
                            >File â†’ Download â†’ Comma-separated values
                            (.csv)</strong
                        >.
                    </li>
                </ul>
                <p>
                    Save the file. This is the file you will upload with "Import
                    CSV".
                </p>
            </div>

            <div class="csv-step-card warning-card">
                <h4>Common mistakes to avoid</h4>
                <ul>
                    <li>
                        Do <strong>not</strong> rename or reorder the headers.
                    </li>
                    <li>Do <strong>not</strong> add extra columns.</li>
                    <li>
                        <strong>questionType</strong> must be exactly
                        multiple_choice, true_false, or short_answer.
                    </li>
                    <li>
                        <strong>difficulty</strong> must be exactly easy,
                        medium, or hard.
                    </li>
                    <li>File must be <strong>.csv</strong>, not .xlsx.</li>
                </ul>
            </div>
        </div>

        <div class="csv-upload-hint">
            <p>
                Tip: Start with 2â€“3 questions in one CSV, upload and check. If
                everything looks correct, then prepare a bigger file.
            </p>
        </div>
    </div>

    <!-- Questions Section - only when module selected -->
    @if (selectedModule()) {
        <div class="questions-section">
            <div class="questions-header">
                <div class="questions-title">
                    <i class="pi pi-list-check"></i>
                    <h2>Questions</h2>
                    @if (quizQuestions().length > 0) {
                        <span class="question-count">{{
                            quizQuestions().length
                        }}</span>
                    }
                </div>
            </div>

            <div class="questions-content">
                @if (loadingQuestions()) {
                    <div class="loading-container">
                        <p-progressSpinner />
                        <p>Loading questions...</p>
                    </div>
                } @else if (quizQuestions().length === 0) {
                    <div class="questions-empty">
                        <i class="pi pi-inbox"></i>
                        <h3>No Questions Yet</h3>
                        <p>Add questions manually or import from a CSV file</p>
                    </div>
                } @else {
                    <div class="questions-grid">
                        @for (
                            question of quizQuestions();
                            track question._id;
                            let i = $index
                        ) {
                            <div class="question-card">
                                <div class="question-header">
                                    <span class="question-number"
                                        >Q{{ i + 1 }}</span
                                    >
                                    <p class="question-text">
                                        {{ question.questionText }}
                                    </p>
                                    <div class="question-actions">
                                        <p-button
                                            icon="pi pi-pencil"
                                            [rounded]="true"
                                            [text]="true"
                                            severity="info"
                                            (onClick)="editQuestion(question)"
                                        />
                                        <p-button
                                            icon="pi pi-trash"
                                            [rounded]="true"
                                            [text]="true"
                                            severity="danger"
                                            (onClick)="deleteQuestion(question)"
                                        />
                                    </div>
                                </div>

                                <div class="question-meta">
                                    <p-tag
                                        [value]="question.questionType"
                                        [severity]="
                                            getTypeBadgeSeverity(
                                                question.questionType
                                            )
                                        "
                                        icon="pi pi-tag"
                                    />
                                    <p-tag
                                        [value]="question.difficulty"
                                        [severity]="
                                            getDifficultyBadgeSeverity(
                                                question.difficulty
                                            )
                                        "
                                        icon="pi pi-chart-line"
                                    />
                                    <p-tag
                                        [value]="question.points + ' pts'"
                                        severity="secondary"
                                        icon="pi pi-star"
                                    />
                                </div>

                                @if (
                                    question.options &&
                                    question.options.length > 0
                                ) {
                                    <div class="question-options">
                                        <div class="options-title">
                                            <i class="pi pi-list"></i>
                                            <span>Answer Options</span>
                                        </div>
                                        <div class="options-grid">
                                            @for (
                                                option of question.options;
                                                track $index;
                                                let idx = $index
                                            ) {
                                                <div
                                                    class="option-item"
                                                    [class.is-correct]="
                                                        String.fromCharCode(
                                                            65 + idx
                                                        ) ===
                                                        question.correctAnswer
                                                    "
                                                >
                                                    <span class="option-label">
                                                        {{
                                                            String.fromCharCode(
                                                                65 + idx
                                                            )
                                                        }}
                                                    </span>
                                                    <span class="option-text">{{
                                                        option
                                                    }}</span>
                                                    @if (
                                                        String.fromCharCode(
                                                            65 + idx
                                                        ) ===
                                                        question.correctAnswer
                                                    ) {
                                                        <i
                                                            class="pi pi-check-circle"
                                                        ></i>
                                                    }
                                                </div>
                                            }
                                        </div>
                                    </div>
                                }

                                @if (question.explanation) {
                                    <div class="question-explanation">
                                        <div class="explanation-title">
                                            <i class="pi pi-info-circle"></i>
                                            <span>Explanation</span>
                                        </div>
                                        <p class="explanation-text">
                                            {{ question.explanation }}
                                        </p>
                                    </div>
                                }
                            </div>
                        }
                    </div>
                }
            </div>
        </div>
    }
</div>

<!-- Add/Edit Dialog -->
<p-dialog
    [(visible)]="showQuestionDialog"
    [header]="editMode ? 'Edit Question' : 'Add Question'"
    [modal]="true"
    [style]="{ width: '600px' }"
    styleClass="quiz-question-dialog"
>
    <form [formGroup]="questionForm" (ngSubmit)="submitQuestion()">
        <div class="form-grid">
            <div class="form-group">
                <label class="required">Question Text</label>
                <textarea
                    pInputTextarea
                    formControlName="questionText"
                    rows="3"
                ></textarea>
            </div>

            <div class="form-group">
                <label class="required">Question Type</label>
                <p-select
                    formControlName="questionType"
                    [options]="questionTypes"
                />
            </div>

            @if (isMultipleChoice()) {
                <div class="options-grid">
                    <div class="form-group">
                        <label class="required">Option A</label>
                        <input pInputText formControlName="optionA" />
                    </div>
                    <div class="form-group">
                        <label class="required">Option B</label>
                        <input pInputText formControlName="optionB" />
                    </div>
                    <div class="form-group">
                        <label class="required">Option C</label>
                        <input pInputText formControlName="optionC" />
                    </div>
                    <div class="form-group">
                        <label class="required">Option D</label>
                        <input pInputText formControlName="optionD" />
                    </div>
                </div>
            }

            <div class="form-group">
                <label class="required">Correct Answer</label>
                <input pInputText formControlName="correctAnswer" />
                <small class="help-text">
                    For MCQ: A, B, C, or D. For True/False: true or false
                </small>
            </div>

            <div class="form-group">
                <label>Points</label>
                <p-inputNumber formControlName="points" [min]="1" />
            </div>

            <div class="form-group">
                <label>Difficulty</label>
                <p-select
                    formControlName="difficulty"
                    [options]="difficultyLevels"
                />
            </div>

            <div class="form-group">
                <label>Explanation (Optional)</label>
                <textarea
                    pInputTextarea
                    formControlName="explanation"
                    rows="2"
                ></textarea>
            </div>
        </div>
    </form>

    <ng-template pTemplate="footer">
        <p-button
            label="Cancel"
            icon="pi pi-times"
            [text]="true"
            (onClick)="showQuestionDialog = false"
        />
        <p-button
            label="{{ editMode ? 'Update' : 'Add' }}"
            icon="pi pi-check"
            (onClick)="submitQuestion()"
            [disabled]="questionForm.invalid"
        />
    </ng-template>
</p-dialog>

<!-- Hidden File Upload -->
<p-fileUpload
    #fileUpload
    mode="basic"
    [auto]="true"
    accept=".csv"
    (onSelect)="uploadCSV($event)"
    [style]="{ display: 'none' }"
/>

<!-- Toast & Confirm Dialog -->
<p-toast />
<p-confirmDialog />
</file>

<file path="src/app/features/training/quiz-manager/quiz-manager.component.scss">
// ============================================================================
// QUIZ MANAGER - APOLLO THEME STYLING
// ============================================================================

.quiz-manager-root {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    background: var(--surface-ground);
    padding: 1.5rem;
    gap: 1.5rem;
    max-width: 1400px; // Limit max width
    margin: 0 auto; // Center the layout
    overflow-y: auto; // Allow page scrolling
}

// ============================================================================
// HEADER SECTION
// ============================================================================
.quiz-header {
    background: var(--surface-card);
    border-radius: var(--border-radius-lg);
    padding: 1.25rem 1.5rem;
    box-shadow: var(--surface-shadow);

    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 1.5rem;
    }

    .header-left {
        flex: 1;

        .header-icon-wrapper {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0.5rem;

            .header-icon {
                font-size: 2rem;
                color: var(--primary-color);
            }

            h1 {
                margin: 0;
                font-size: 1.75rem;
                font-weight: 700;
                color: var(--text-color);
            }
        }

        p {
            margin: 0;
            color: var(--text-color-secondary);
            font-size: 0.95rem;
            line-height: 1.5;
        }
    }
}

// ============================================================================
// FILTERS SECTION
// ============================================================================
.filters-section {
    background: var(--surface-card);
    border-radius: var(--border-radius-lg);
    padding: 2rem 1.5rem;
    box-shadow: var(--surface-shadow);
    min-height: 200px;

    .filters-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
        align-items: end;
    }

    .filter-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;

        label {
            font-weight: 600;
            color: var(--text-color);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;

            i {
                color: var(--primary-color);
                font-size: 1rem;
            }
        }

        ::ng-deep .p-select,
        ::ng-deep .p-inputtext {
            width: 100%;
        }
    }

    .filter-actions {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
    }
}

// ============================================================================
// CSV INSTRUCTIONS PANEL (ALWAYS VISIBLE)
// ============================================================================
.csv-instructions-panel {
    background: var(--surface-card);
    border-radius: var(--border-radius-lg);
    padding: 1.75rem 2rem 2rem;
    box-shadow: var(--surface-shadow);
    border: 2px solid var(--primary-100);
    display: flex;
    flex-direction: column;
    gap: 1.25rem;

    h3 {
        margin: 0;
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--text-color);
        display: flex;
        align-items: center;
        gap: 0.5rem;

        &::before {
            content: 'ðŸ“‹';
            font-size: 1.5rem;
        }
    }

    > p {
        margin: 0;
        font-size: 1rem;
        color: var(--text-color-secondary);
        line-height: 1.6;
    }

    .csv-steps-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1rem;
    }

    .csv-step-card {
        background: var(--surface-ground);
        border-radius: var(--border-radius);
        padding: 1.25rem;
        border: 1px solid var(--surface-border);
        font-size: 0.95rem;
        transition: all 0.2s ease;

        &:hover {
            border-color: var(--primary-color);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        h4 {
            margin: 0 0 0.75rem;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;

            &::before {
                content: 'âœ“';
                background: var(--primary-color);
                color: white;
                width: 24px;
                height: 24px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 0.75rem;
                font-weight: 700;
            }
        }

        p {
            margin: 0 0 0.5rem;
            color: var(--text-color);
            line-height: 1.6;
        }

        ul {
            margin: 0.5rem 0 0;
            padding-left: 1.25rem;

            li {
                margin-bottom: 0.5rem;
                color: var(--text-color);
                line-height: 1.5;

                strong {
                    color: var(--primary-color);
                }
            }
        }
    }

    .warning-card {
        border-color: var(--orange-400);
        background: var(--orange-50);

        h4::before {
            content: 'âš ï¸';
            background: var(--orange-500);
        }
    }

    .csv-code {
        background: var(--surface-900);
        color: var(--surface-0);
        padding: 0.75rem 1rem;
        border-radius: var(--border-radius);
        font-family: 'Courier New', Courier, monospace;
        font-size: 0.85rem;
        white-space: pre-wrap;
        margin: 0.5rem 0;
        border: 1px solid var(--surface-700);
        overflow-x: auto;
    }

    .csv-example-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.85rem;
        margin-top: 0.75rem;
        border: 1px solid var(--surface-border);
        border-radius: var(--border-radius);
        display: block;           // ADD THIS
  overflow-x: auto; 

        th,
        td {
            border: 1px solid var(--surface-border);
            padding: 0.5rem 0.75rem;
            text-align: left;
            white-space: nowrap; 
        }

        th {
            background: var(--primary-50);
            font-weight: 600;
            color: var(--primary-700);
        }

        td {
            background: var(--surface-card);
            color: var(--text-color);
        }

        tbody tr:hover td {
            background: var(--surface-hover);
        }
    }

    .csv-upload-hint {
        margin-top: 0.5rem;
        padding: 1rem;
        background: var(--blue-50);
        border-left: 4px solid var(--blue-500);
        border-radius: var(--border-radius);

        p {
            margin: 0;
            font-size: 0.9rem;
            color: var(--blue-900);
            line-height: 1.5;

            &::before {
                content: 'ðŸ’¡ ';
                font-size: 1.1rem;
            }
        }
    }
}

// ============================================================================
// QUESTIONS SECTION
// ============================================================================
.questions-section {
    flex: 0 1 auto;
    background: var(--surface-card);
    border-radius: var(--border-radius-lg);
    box-shadow: var(--surface-shadow);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    margin-bottom: 2rem;

    .questions-header {
        padding: 1.5rem;
        border-bottom: 2px solid var(--surface-border);
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: linear-gradient(to right, var(--primary-50), transparent);

        .questions-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;

            i {
                font-size: 1.5rem;
                color: var(--primary-color);
            }

            h2 {
                margin: 0;
                font-size: 1.5rem;
                font-weight: 700;
                color: var(--text-color);
            }

            .question-count {
                background: var(--primary-color);
                color: white;
                padding: 0.25rem 0.75rem;
                border-radius: var(--border-radius);
                font-size: 0.875rem;
                font-weight: 600;
            }
        }
    }

    .questions-content {
        flex: 1;
        overflow-y: auto;
        padding: 1.5rem;
        max-height: 600px;

        &::-webkit-scrollbar {
            width: 8px;
        }

        &::-webkit-scrollbar-track {
            background: var(--surface-ground);
        }

        &::-webkit-scrollbar-thumb {
            background: var(--surface-border);
            border-radius: 4px;

            &:hover {
                background: var(--primary-color);
            }
        }
    }

    .questions-grid {
        display: grid;
        gap: 1rem;
    }

    .question-card {
        background: var(--surface-ground);
        border: 2px solid var(--surface-border);
        border-radius: var(--border-radius-lg);
        padding: 1.5rem;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;

        &:hover {
            border-color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        &::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary-color);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1rem;

            .question-number {
                background: var(--primary-color);
                color: white;
                padding: 0.35rem 0.75rem;
                border-radius: var(--border-radius);
                font-weight: 700;
                font-size: 0.875rem;
                flex-shrink: 0;
            }

            .question-text {
                flex: 1;
                font-size: 1.1rem;
                font-weight: 600;
                color: var(--text-color);
                line-height: 1.5;
                margin: 0;
            }

            .question-actions {
                display: flex;
                gap: 0.5rem;
                flex-shrink: 0;
            }
        }

        .question-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .question-options {
            background: var(--surface-card);
            border-radius: var(--border-radius);
            padding: 1rem;
            margin: 1rem 0;

            .options-title {
                font-size: 0.875rem;
                font-weight: 600;
                color: var(--text-color-secondary);
                margin-bottom: 0.75rem;
                display: flex;
                align-items: center;
                gap: 0.5rem;

                i {
                    color: var(--primary-color);
                }
            }

            .options-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 0.75rem;
            }

            .option-item {
                display: flex;
                align-items: center;
                gap: 0.75rem;
                padding: 0.75rem;
                background: var(--surface-ground);
                border: 1px solid var(--surface-border);
                border-radius: var(--border-radius);
                font-size: 0.95rem;

                &.is-correct {
                    background: var(--green-50);
                    border-color: var(--green-500);
                    font-weight: 600;

                    .option-label {
                        color: var(--green-700);
                    }

                    i {
                        color: var(--green-500);
                    }
                }

                .option-label {
                    background: var(--primary-100);
                    color: var(--primary-700);
                    padding: 0.25rem 0.5rem;
                    border-radius: var(--border-radius-sm);
                    font-weight: 700;
                    font-size: 0.75rem;
                    min-width: 24px;
                    text-align: center;
                }

                .option-text {
                    flex: 1;
                    color: var(--text-color);
                }
            }
        }

        .question-explanation {
            background: var(--blue-50);
            border-left: 4px solid var(--blue-500);
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-top: 1rem;

            .explanation-title {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                font-size: 0.875rem;
                font-weight: 600;
                color: var(--blue-700);
                margin-bottom: 0.5rem;

                i {
                    font-size: 1rem;
                }
            }

            .explanation-text {
                color: var(--text-color);
                font-size: 0.95rem;
                line-height: 1.6;
                margin: 0;
            }
        }
    }

    // Empty State
    .questions-empty {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 3rem;
        text-align: center;

        i {
            font-size: 5rem;
            color: var(--surface-border);
            margin-bottom: 1.5rem;
        }

        h3 {
            margin: 0 0 0.75rem 0;
            font-size: 1.5rem;
            color: var(--text-color);
        }

        p {
            margin: 0;
            color: var(--text-color-secondary);
            font-size: 1rem;
            max-width: 400px;
        }
    }
}

// ============================================================================
// LOADING STATE
// ============================================================================
.loading-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    padding: 3rem;

    p {
        color: var(--text-color-secondary);
        font-size: 1rem;
    }
}

// ============================================================================
// DIALOG STYLING (for Add Question form)
// ============================================================================
::ng-deep .quiz-question-dialog {
    .p-dialog-header {
        background: linear-gradient(
            135deg,
            var(--primary-color),
            var(--primary-600)
        );
        color: white;
        padding: 1.5rem;

        .p-dialog-title {
            font-weight: 700;
            font-size: 1.25rem;
        }
    }

    .p-dialog-content {
        padding: 2rem;
    }

    .form-grid {
        display: grid;
        gap: 1.5rem;
    }

    .form-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;

        label {
            font-weight: 600;
            color: var(--text-color);
            font-size: 0.9rem;

            &.required::after {
                content: ' *';
                color: var(--red-500);
            }
        }

        .help-text {
            font-size: 0.85rem;
            color: var(--text-color-secondary);
            font-style: italic;
        }
    }

    .options-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
    }
}

// ============================================================================
// RESPONSIVE DESIGN
// ============================================================================
@media (max-width: 1024px) {
    .quiz-manager-root {
        padding: 1rem;
        gap: 1rem;
    }

    .filters-section .filters-grid {
        grid-template-columns: 1fr;
    }

    .csv-instructions-panel .csv-steps-grid {
        grid-template-columns: 1fr;
    }

    .question-card .question-options .options-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .quiz-manager-root {
        padding: 0.75rem;
    }

    .quiz-header {
        padding: 1.25rem;

        .header-content {
            flex-direction: column;
        }

        .header-left .header-icon-wrapper {
            flex-direction: column;
            align-items: flex-start;

            h1 {
                font-size: 1.5rem;
            }
        }
    }

    .filters-section {
        padding: 1rem;

        .filter-actions {
            width: 100%;

            ::ng-deep .p-button {
                flex: 1;
            }
        }
    }

    .csv-instructions-panel {
        padding: 1.25rem;

        .csv-steps-grid {
            grid-template-columns: 1fr;
        }

        .csv-example-table {
            font-size: 0.75rem;

            th,
            td {
                padding: 0.35rem 0.5rem;
            }
        }
    }

    .questions-section .questions-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }

    .question-card .question-header {
        flex-direction: column;

        .question-actions {
            width: 100%;
            justify-content: flex-end;
        }
    }

    ::ng-deep .quiz-question-dialog .options-grid {
        grid-template-columns: 1fr;
    }
}
</file>

<file path="src/app/features/training/quiz-manager/quiz-manager.component.ts">
import { Component, OnInit, signal } from '@angular/core';
import { CommonModule } from '@angular/common';
import {
    FormBuilder,
    FormGroup,
    FormsModule,
    ReactiveFormsModule,
    Validators
} from '@angular/forms';
import { MessageService, ConfirmationService } from 'primeng/api';
import { ButtonModule } from 'primeng/button';
import { SelectModule } from 'primeng/select';
import { InputTextModule } from 'primeng/inputtext';
import { InputNumberModule } from 'primeng/inputnumber';
import { DialogModule } from 'primeng/dialog';
import { FileUploadModule } from 'primeng/fileupload';
import { ToastModule } from 'primeng/toast';
import { ProgressSpinnerModule } from 'primeng/progressspinner';
import { Tag } from 'primeng/tag';
import { ConfirmDialogModule } from 'primeng/confirmdialog';
import { TrainingService } from '../services/training.service';
import { QuizService } from '../services/quiz.service';
import { Id } from 'convex/_generated/dataModel';

@Component({
    selector: 'app-quiz-manager',
    standalone: true,
    imports: [
        CommonModule,
        FormsModule,
        ReactiveFormsModule,
        ButtonModule,
        SelectModule,
        InputTextModule,
        InputNumberModule,
        DialogModule,
        FileUploadModule,
        ToastModule,
        ProgressSpinnerModule,
        Tag,
        ConfirmDialogModule
    ],
    templateUrl: './quiz-manager.component.html',
    styleUrls: ['./quiz-manager.component.scss'],
    providers: [MessageService, ConfirmationService]
})
export class QuizManagerComponent implements OnInit {
    // State
    courses = signal<any[]>([]);
    quizModules = signal<any[]>([]);
    selectedCourse = signal<any>(null);
    selectedModule = signal<any>(null);
    quizQuestions = signal<any[]>([]);
    loading = signal(false);
    loadingQuestions = signal(false);

    // Dialog
    showQuestionDialog = false;
    editMode = false;
    selectedQuestion: any = null;
    questionForm!: FormGroup;

    // Dropdowns
    coursesDropdown: any[] = [];
    modulesDropdown: any[] = [];

    questionTypes = [
        { label: 'Multiple Choice', value: 'multiplechoice' },
        { label: 'True/False', value: 'truefalse' },
        { label: 'Short Answer', value: 'shortanswer' }
    ];

    difficultyLevels = [
        { label: 'Easy', value: 'easy' },
        { label: 'Medium', value: 'medium' },
        { label: 'Hard', value: 'hard' }
    ];

    // âœ… FIX: Expose String to template
    readonly String = String;

    constructor(
        private trainingService: TrainingService,
        private quizService: QuizService,
        private fb: FormBuilder,
        private messageService: MessageService,
        private confirmationService: ConfirmationService
    ) {}

    async ngOnInit() {
        this.initForm();
        await this.loadCourses();
    }

    private initForm() {
        this.questionForm = this.fb.group({
            questionText: ['', Validators.required],
            questionType: ['multiplechoice', Validators.required],
            optionA: [''],
            optionB: [''],
            optionC: [''],
            optionD: [''],
            correctAnswer: ['', Validators.required],
            points: [10, [Validators.required, Validators.min(1)]],
            difficulty: ['medium'],
            explanation: ['']
        });

        this.questionForm
            .get('questionType')
            ?.valueChanges.subscribe((type) => {
                const optionControls = [
                    'optionA',
                    'optionB',
                    'optionC',
                    'optionD'
                ];
                if (type === 'multiplechoice') {
                    optionControls.forEach((c) =>
                        this.questionForm
                            .get(c)
                            ?.setValidators(Validators.required)
                    );
                } else {
                    optionControls.forEach((c) =>
                        this.questionForm.get(c)?.clearValidators()
                    );
                }
                optionControls.forEach((c) =>
                    this.questionForm.get(c)?.updateValueAndValidity()
                );
            });
    }

    async loadCourses() {
        this.loading.set(true);
        try {
            const courses = await this.trainingService.getCourses();
            this.courses.set(courses);
            this.coursesDropdown = courses.map((c) => ({
                label: c.title,
                value: c._id
            }));
        } catch (error: any) {
            this.messageService.add({
                severity: 'error',
                summary: 'Error',
                detail: error.message
            });
        } finally {
            this.loading.set(false);
        }
    }

    // âœ… FIX: Type annotation for 'm'
    async onCourseChange(event: any) {
        const course = this.courses().find((c: any) => c._id === event.value);
        if (!course) return;

        this.selectedCourse.set(course);
        this.selectedModule.set(null);
        this.quizQuestions.set([]);

        const quizModules = (course.modules || [])
            .filter((m: any) => m.contentType === 'quiz')
            .map((m: any) => ({ _id: m._id, title: m.title }));

        this.quizModules.set(quizModules);
        // âœ… FIX: Explicit type annotation
        this.modulesDropdown = quizModules.map((m: any) => ({
            label: m.title,
            value: m._id
        }));
    }

    async onModuleChange(event: any) {
        const module = this.quizModules().find(
            (m: any) => m._id === event.value
        );
        if (!module) return;

        this.selectedModule.set(module);
        await this.loadQuestions(module._id);
    }

    async loadQuestions(moduleId: string) {
        this.loadingQuestions.set(true);
        try {
            const questions = await this.quizService.getQuestions(
                moduleId as Id<'training_modules'>
            );
            this.quizQuestions.set(questions);

            if (questions.length === 0) {
                this.messageService.add({
                    severity: 'info',
                    summary: 'No Questions',
                    detail: 'Add questions to get started!'
                });
            }
        } catch (error: any) {
            this.messageService.add({
                severity: 'error',
                summary: 'Error',
                detail: error.message
            });
        } finally {
            this.loadingQuestions.set(false);
        }
    }

    // ============================================================================
    // EDIT/DELETE
    // ============================================================================

    editQuestion(question: any) {
        this.editMode = true;
        this.selectedQuestion = question;

        this.questionForm.patchValue({
            questionText: question.questionText,
            questionType: question.questionType,
            correctAnswer: question.correctAnswer,
            points: question.points,
            difficulty: question.difficulty,
            explanation: question.explanation || ''
        });

        if (question.options && question.options.length > 0) {
            this.questionForm.patchValue({
                optionA: question.options[0] || '',
                optionB: question.options[1] || '',
                optionC: question.options[2] || '',
                optionD: question.options[3] || ''
            });
        }

        this.showQuestionDialog = true;
    }

    deleteQuestion(question: any) {
        this.confirmationService.confirm({
            message: `Are you sure you want to delete this question?`,
            header: 'Confirm Delete',
            icon: 'pi pi-exclamation-triangle',
            accept: async () => {
                try {
                    await this.quizService.deleteQuestion(question._id);
                    this.messageService.add({
                        severity: 'success',
                        summary: 'Deleted',
                        detail: 'Question deleted successfully'
                    });
                    await this.loadQuestions(this.selectedModule()!._id);
                } catch (error: any) {
                    this.messageService.add({
                        severity: 'error',
                        summary: 'Error',
                        detail: error.message
                    });
                }
            }
        });
    }

    // ============================================================================
    // ADD QUESTION
    // ============================================================================

    showAddDialog() {
        if (!this.selectedModule()) {
            this.messageService.add({
                severity: 'warn',
                summary: 'No Module',
                detail: 'Select a quiz module first'
            });
            return;
        }

        this.editMode = false;
        this.selectedQuestion = null;
        this.questionForm.reset({
            questionType: 'multiplechoice',
            points: 10,
            difficulty: 'medium'
        });
        this.showQuestionDialog = true;
    }

    async submitQuestion() {
        if (this.questionForm.invalid || !this.selectedModule()) return;

        const formValue = this.questionForm.value;
        const options =
            formValue.questionType === 'multiplechoice'
                ? [
                      formValue.optionA,
                      formValue.optionB,
                      formValue.optionC,
                      formValue.optionD
                  ].filter(Boolean)
                : undefined;

        try {
            if (this.editMode && this.selectedQuestion) {
                await this.quizService.updateQuestion(
                    this.selectedQuestion._id,
                    {
                        questionText: formValue.questionText,
                        questionType: formValue.questionType,
                        correctAnswer: formValue.correctAnswer,
                        options,
                        explanation: formValue.explanation,
                        points: formValue.points,
                        difficulty: formValue.difficulty
                    }
                );
                this.messageService.add({
                    severity: 'success',
                    summary: 'Updated',
                    detail: 'Question updated successfully!'
                });
            } else {
                await this.quizService.addQuestion({
                    moduleId: this.selectedModule()!._id,
                    questionText: formValue.questionText,
                    questionType: formValue.questionType,
                    correctAnswer: formValue.correctAnswer,
                    options,
                    explanation: formValue.explanation,
                    points: formValue.points,
                    difficulty: formValue.difficulty
                });
                this.messageService.add({
                    severity: 'success',
                    summary: 'Added',
                    detail: 'Question added successfully!'
                });
            }

            this.showQuestionDialog = false;
            await this.loadQuestions(this.selectedModule()!._id);
        } catch (error: any) {
            this.messageService.add({
                severity: 'error',
                summary: 'Error',
                detail: error.message
            });
        }
    }

    // ============================================================================
    // CSV
    // ============================================================================

    async uploadCSV(event: any) {
        const file = event.files[0];
        if (!file || !this.selectedModule()) return;

        try {
            const count = await this.quizService.importCSV({
                moduleId: this.selectedModule()!._id,
                file
            });

            this.messageService.add({
                severity: 'success',
                summary: 'Success',
                detail: `Imported ${count} questions!`
            });
            await this.loadQuestions(this.selectedModule()!._id);
        } catch (error: any) {
            this.messageService.add({
                severity: 'error',
                summary: 'Import Failed',
                detail: error.message
            });
        }
    }

    downloadTemplate() {
        const csv = `question_text,question_type,correct_answer,option_a,option_b,option_c,option_d,points,explanation,difficulty
"What is the capital of India?","multiple_choice","B","Mumbai","New Delhi","Kolkata","Chennai",10,"New Delhi is the capital","easy"`;
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'quiz-template.csv';
        a.click();
        window.URL.revokeObjectURL(url);
    }

    // ============================================================================
    // UI HELPERS
    // ============================================================================

    // âœ… FIX: Return type for p-tag severity
    getTypeBadgeSeverity(
        type: string
    ): 'success' | 'info' | 'warn' | 'danger' | 'secondary' | 'contrast' {
        const map: {
            [key: string]:
                | 'success'
                | 'info'
                | 'warn'
                | 'danger'
                | 'secondary'
                | 'contrast';
        } = {
            multiplechoice: 'info',
            truefalse: 'success',
            shortanswer: 'warn'
        };
        return map[type] || 'secondary';
    }

    // âœ… FIX: Return type for p-tag severity
    getDifficultyBadgeSeverity(
        difficulty: string
    ): 'success' | 'info' | 'warn' | 'danger' | 'secondary' | 'contrast' {
        const map: {
            [key: string]:
                | 'success'
                | 'info'
                | 'warn'
                | 'danger'
                | 'secondary'
                | 'contrast';
        } = {
            easy: 'success',
            medium: 'info',
            hard: 'danger'
        };
        return map[difficulty] || 'secondary';
    }

    isMultipleChoice(): boolean {
        return (
            this.questionForm.get('questionType')?.value === 'multiplechoice'
        );
    }
}
</file>

<file path="src/app/features/training/saferesourcespipe/safe-resource.pipe.ts">
import { Pipe, PipeTransform } from '@angular/core';
import { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';

@Pipe({
  name: 'safeResource',
  standalone: true,
})
export class SafeResourcePipe implements PipeTransform {
  constructor(private sanitizer: DomSanitizer) {}

  transform(url: string | null | undefined): SafeResourceUrl {
    if (!url) {
      // Fallback to about:blank to avoid errors
      return this.sanitizer.bypassSecurityTrustResourceUrl('about:blank');
    }
    return this.sanitizer.bypassSecurityTrustResourceUrl(url);
  }
}
</file>

<file path="src/app/features/training/services/progress.service.ts">
// src/app/services/progress.service.ts
import { ConvexService } from '@/core/services/convex.service';
import { Injectable, signal } from '@angular/core';
import { api } from 'convex/_generated/api';
import { Id } from 'convex/_generated/dataModel';
import {
    PaginatedProgress,
    TrainingProgress
} from '../interfaces/training.interface';

@Injectable({
    providedIn: 'root'
})
export class ProgressService {
    loading = signal(false);

    constructor(private convex: ConvexService) {}

    /**
     * List progress with pagination and filters
     */
    // src/app/services/progress.service.ts
    async listProgress(
        numItems: number = 50,
        cursor: string | null = null,
        courseId?: Id<'training_courses'>,
        executiveId?: Id<'executives'>,
        status?: 'not_started' | 'in_progress' | 'completed' | 'failed'
    ): Promise<PaginatedProgress> {
        this.loading.set(true);
        try {
            console.log('ðŸ” Calling listProgress with:', {
                numItems,
                cursor,
                courseId,
                executiveId,
                status
            });

            const result = await this.convex.client.query(
                api.training.progress.listProgress,
                {
                    paginationOpts: {
                        numItems,
                        cursor: cursor || null
                    },
                    courseId,
                    executiveId,
                    status
                }
            );

            console.log('âœ… Progress result:', result);
            return result as any;
        } catch (error) {
            console.error('âŒ Progress query error:', error);
            throw error;
        } finally {
            this.loading.set(false);
        }
    }

    /**
     * Get detailed progress by ID
     */
    async getProgress(progressId: Id<'training_progress'>): Promise<any> {
        return await this.convex.client.query(
            api.training.progress.getProgress,
            {
                progressId
            }
        );
    }

    /**
     * Get executive's training progress
     */
    async getExecutiveProgress(
        executiveId: Id<'executives'>
    ): Promise<TrainingProgress[]> {
        return (await this.convex.client.query(
            api.training.progress.getExecutiveProgress,
            {
                executiveId
            }
        )) as any;
    }

    /**
     * Get executive training stats
     */
    async getExecutiveStats(executiveId: Id<'executives'>): Promise<any> {
        return await this.convex.client.query(
            api.training.progress.getExecutiveTrainingStats,
            {
                executiveId
            }
        );
    }

    /**
     * Enroll executive in course
     */
    async enrollExecutive(
        executiveId: Id<'executives'>,
        courseId: Id<'training_courses'>
    ): Promise<{ progressId: Id<'training_progress'>; success: boolean }> {
        return (await this.convex.client.mutation(
            api.training.progress.enrollExecutive,
            {
                executiveId,
                courseId
            }
        )) as any;
    }

    /**
     * Update module progress
     */
    async updateModuleProgress(
        moduleProgressId: Id<'training_module_progress'>,
        status: 'in_progress' | 'completed',
        timeSpentMinutes: number,
        score?: number
    ): Promise<{ success: boolean }> {
        return (await this.convex.client.mutation(
            api.training.progress.updateModuleProgress,
            {
                moduleProgressId,
                status,
                timeSpentMinutes,
                score
            }
        )) as any;
    }

    /**
     * Generate certificate
     */
generateCertificate(progressId: Id<'training_progress'>) {
  return this.convex.client.action(
    api.training.certificates.generateCertificate,
    { progressId }
  );
}

    /**
     * Get certificate URL
     */
    async getCertificateUrl(certificateId: Id<'_storage'>): Promise<string> {
        return await this.convex.client.query(
            api.training.progress.getCertificateUrl,
            {
                certificateId
            }
        );
    }
}
</file>

<file path="src/app/features/training/services/quiz.service.ts">
// src/app/training/services/quiz.service.ts
import { Injectable } from '@angular/core';
import { api } from 'convex/_generated/api';
import { Id } from 'convex/_generated/dataModel';
import { ConvexService } from 'src/app/core/services/convex.service';
import { QuizQuestionFrontend, AddQuestionRequest, QuizImportCSV } from '../interfaces/training.interface';

@Injectable({ providedIn: 'root' })
export class QuizService {
  constructor(private convex: ConvexService) {}

  // ============================================================================
  // CRUD OPERATIONS
  // ============================================================================

  async getQuestions(moduleId: Id<'training_modules'>): Promise<QuizQuestionFrontend[]> {
    try {
      const result = await this.convex.client.query(api.training.quizzes.listByModule, { moduleId });
      return result as QuizQuestionFrontend[];
    } catch (error: any) {
      console.error('getQuestions failed:', error);
      throw new Error(`Failed to fetch questions: ${error.message}`);
    }
  }

  async addQuestion(payload: AddQuestionRequest): Promise<QuizQuestionFrontend> {
    try {
      const result = await this.convex.client.mutation(api.training.quizzes.create, {
        moduleId: payload.moduleId as Id<'training_modules'>,
        questionText: payload.questionText,
        questionType: payload.questionType as any,
        correctAnswer: payload.correctAnswer.toUpperCase(),
        options: payload.options,
        explanation: payload.explanation,
        points: payload.points,
        difficulty: payload.difficulty as any
      });

      return {
        _id: result.questionId,
        moduleId: payload.moduleId,
        questionText: payload.questionText,
        questionType: payload.questionType,
        correctAnswer: payload.correctAnswer.toUpperCase(),
        options: payload.options,
        points: payload.points,
        difficulty: payload.difficulty,
        explanation: payload.explanation
      } as QuizQuestionFrontend;
    } catch (error: any) {
      console.error('addQuestion failed:', error);
      throw new Error(`Failed to add question: ${error.message}`);
    }
  }

  async updateQuestion(questionId: Id<'quiz_questions'>, updates: Partial<QuizQuestionFrontend>): Promise<void> {
    try {
      const convexUpdates: any = {};
      
      if (updates.questionText) convexUpdates.questionText = updates.questionText;
      if (updates.questionType) convexUpdates.questionType = updates.questionType;
      if (updates.correctAnswer) convexUpdates.correctAnswer = updates.correctAnswer.toUpperCase();
      if (updates.options) convexUpdates.options = updates.options;
      if (updates.explanation !== undefined) convexUpdates.explanation = updates.explanation;
      if (updates.points) convexUpdates.points = updates.points;
      if (updates.difficulty) convexUpdates.difficulty = updates.difficulty;

      await this.convex.client.mutation(api.training.quizzes.update, { questionId, ...convexUpdates });
    } catch (error: any) {
      console.error('updateQuestion failed:', error);
      throw new Error(`Failed to update question: ${error.message}`);
    }
  }

  async deleteQuestion(questionId: Id<'quiz_questions'>): Promise<void> {
    try {
      await this.convex.client.mutation(api.training.quizzes.deleteQuestion, { questionId });
    } catch (error: any) {
      console.error('deleteQuestion failed:', error);
      throw new Error(`Failed to delete question: ${error.message}`);
    }
  }

  // ============================================================================
  // CSV IMPORT
  // ============================================================================

  async importCSV({ moduleId, file }: QuizImportCSV): Promise<number> {
    try {
      const csvContent = await this.readFileAsText(file);
      const questions = this.parseCSVQuestions(csvContent);
      
      const result = await this.convex.client.mutation(api.training.quizzes.importBulk, {
        moduleId: moduleId as Id<'training_modules'>,
        questions
      });

      return result.questionsImported || questions.length;
    } catch (error: any) {
      console.error('importCSV failed:', error);
      throw new Error(`Failed to import CSV: ${error.message}`);
    }
  }

  // ============================================================================
  // HELPERS
  // ============================================================================

  private readFileAsText(file: File): Promise<string> {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result as string);
      reader.onerror = () => reject(new Error('Failed to read file'));
      reader.readAsText(file);
    });
  }

  private parseCSVQuestions(csvContent: string): any[] {
    const lines = csvContent.trim().split('\n').slice(1);
    const questions: any[] = [];

    lines.forEach((line, index) => {
      try {
        const columns = this.parseCSVLine(line);
        if (columns.length < 2) return;

        const [questionText, questionTypeRaw, correctAnswer, optionA, optionB, optionC, optionD, pointsStr, explanation, difficultyRaw] = columns;
        const questionType = questionTypeRaw?.trim().toLowerCase();

        const typeMap: any = { 'multiple_choice': 'multiplechoice', 'true_false': 'truefalse', 'short_answer': 'shortanswer' };
        const mappedType = typeMap[questionType] || questionType;

        if (!['multiplechoice', 'truefalse', 'shortanswer'].includes(mappedType)) {
          console.warn(`âš ï¸ Invalid type: ${questionType}`);
          return;
        }

        const question: any = {
          questiontext: questionText?.trim() || '',
          questiontype: mappedType,
          correctanswer: correctAnswer?.trim() || '',
          points: Math.max(1, parseInt(pointsStr || '10') || 10),
          difficulty: (difficultyRaw?.trim().toLowerCase() || 'medium') as any
        };

        if (mappedType === 'multiplechoice') {
          const options = [optionA, optionB, optionC, optionD].map(s => s?.trim()).filter(Boolean);
          if (options.length >= 2) question.options = options;
        }

        if (explanation?.trim()) question.explanation = explanation.trim();
        questions.push(question);
      } catch (error) {
        console.warn(`âš ï¸ CSV parse error line ${index + 1}:`, error);
      }
    });

    return questions;
  }

  private parseCSVLine(line: string): string[] {
    const result: string[] = [];
    let current = '';
    let inQuotes = false;

    for (let i = 0; i < line.length; i++) {
      const char = line[i];
      if (char === '"') {
        inQuotes = !inQuotes;
      } else if (char === ',' && !inQuotes) {
        result.push(current);
        current = '';
      } else {
        current += char;
      }
    }
    result.push(current);
    return result;
  }
}
</file>

<file path="src/app/features/training/services/training.service.ts">
import { Injectable } from '@angular/core';
import { api } from 'convex/_generated/api';
import { Id } from 'convex/_generated/dataModel';
import { ConvexService } from 'src/app/core/services/convex.service';
import { Course } from '../interfaces/training.interface';

@Injectable({ providedIn: 'root' })
export class TrainingService {
  constructor(private convex: ConvexService) {}

  // ============================================================================
  // COURSE MANAGEMENT
  // ============================================================================

  async getCourses(): Promise<Course[]> {
    const result = await this.convex.client.query(api.training.courses.listCourses, {
      paginationOpts: { numItems: 100, cursor: null }
    });
    return result.page as any as Course[];
  }

  async getCourse(courseId: Id<'training_courses'>) {
    return this.convex.client.query(api.training.courses.getCourse, { courseId });
  }

  async createCourse(courseData: {
    title: string;
    description: string;
    category: string;
    difficulty: 'beginner' | 'intermediate' | 'advanced';
    passingScore: number;
    estimatedHours: number;
    modules: Array<{
      title: string;
      description: string;
      order: number;
      estimatedMinutes: number;
      contentType: 'video' | 'document' | 'quiz' | 'interactive';
      isRequired: boolean;
    }>;
  }) {
    return this.convex.client.mutation(api.training.courses.createCourse, courseData);
  }

  async updateCourse(
    courseId: Id<'training_courses'>,
    updates: Partial<{
      title: string;
      description: string;
      category: string;
      difficulty: 'beginner' | 'intermediate' | 'advanced';
      passingScore: number;
      estimatedHours: number;
      isActive: boolean;
      certificateTemplateId: Id<'_storage'>;
    }>
  ) {
    return this.convex.client.mutation(api.training.courses.updateCourse, {
      courseId,
      ...updates
    });
  }

  async deleteCourse(courseId: Id<'training_courses'>) {
    return this.updateCourse(courseId, { isActive: false });
  }

  async getCourseStats() {
    return this.convex.client.query(api.training.courses.getCourseStats, {});
  }

  // ============================================================================
  // MODULE MANAGEMENT
  // ============================================================================

  async addModule(
    courseId: Id<'training_courses'>,
    moduleData: {
      title: string;
      description: string;
      estimatedMinutes: number;
      contentType: 'video' | 'document' | 'quiz' | 'interactive';
      isRequired: boolean;
    }
  ): Promise<{ moduleId: Id<'training_modules'>; success: boolean }> {
    try {
      const result = await this.convex.client.mutation(api.training.courses.addModule, {
        courseId,
        ...moduleData
      });
      console.log('âœ… Module added:', result.moduleId);
      return result;
    } catch (error: any) {
      console.error('âŒ Add module failed:', error);
      throw new Error(`Failed to add module: ${error.message}`);
    }
  }

  async updateModule(
    moduleId: Id<'training_modules'>,
    updates: {
      title?: string;
      description?: string;
      estimatedMinutes?: number;
      contentType?: 'video' | 'document' | 'quiz' | 'interactive';
      isRequired?: boolean;
    }
  ): Promise<{ success: boolean }> {
    try {
      const result = await this.convex.client.mutation(
        api.training.courses.updateModule as any,
        { moduleId, ...updates }
      );
      return result;
    } catch (error: any) {
      console.error('âŒ Update module failed:', error);
      throw new Error(`Failed to update module: ${error.message}`);
    }
  }

  async deleteModule(moduleId: Id<'training_modules'>): Promise<{ success: boolean }> {
    try {
      const result = await this.convex.client.mutation(api.training.courses.deleteModule, { moduleId });
      return result;
    } catch (error: any) {
      console.error('âŒ Delete module failed:', error);
      throw new Error(`Failed to delete module: ${error.message}`);
    }
  }

  // ============================================================================
  // FILE/CONTENT MANAGEMENT
  // ============================================================================

  async uploadModuleFile(file: File): Promise<Id<'_storage'>> {
    try {
      console.log('ðŸ“¤ Uploading file:', file.name, file.type, `${(file.size / 1024 / 1024).toFixed(2)}MB`);

      const uploadUrl = await this.convex.client.mutation(api.files.generateUploadUrl, {});

      const response = await fetch(uploadUrl, {
        method: 'POST',
        headers: { 'Content-Type': file.type },
        body: file
      });

      if (!response.ok) throw new Error(`Upload failed: ${response.statusText}`);

      const { storageId } = await response.json();
      console.log('âœ… File uploaded successfully:', storageId);
      return storageId as Id<'_storage'>;
    } catch (error: any) {
      console.error('âŒ File upload failed:', error);
      throw new Error(`Failed to upload file: ${error.message}`);
    }
  }

  async getModuleContentUrl(storageId: Id<'_storage'>): Promise<string | null> {
    try {
      const url = await this.convex.client.query(api.files.getUrl as any, { storageId });
      if (!url) {
        console.warn('âš ï¸ No URL returned for storage ID:', storageId);
        return null;
      }
      return url;
    } catch (error: any) {
      console.error('âŒ Failed to get content URL:', error);
      return null;
    }
  }

  async updateModuleContent(
    moduleId: Id<'training_modules'>,
    contentId: Id<'_storage'>
  ): Promise<{ success: boolean }> {
    try {
      const result = await this.convex.client.mutation(api.training.courses.updateModuleContent, {
        moduleId,
        contentId
      });
      return result;
    } catch (error: any) {
      console.error('âŒ Update module content failed:', error);
      throw new Error(`Failed to update module content: ${error.message}`);
    }
  }

  async deleteModuleContent(moduleId: Id<'training_modules'>): Promise<{ success: boolean }> {
    try {
      const result = await this.convex.client.mutation(api.training.courses.updateModuleContent, {
        moduleId,
        contentId: undefined as any
      });
      return result;
    } catch (error: any) {
      console.error('âŒ Delete module content failed:', error);
      throw new Error(`Failed to delete module content: ${error.message}`);
    }
  }

  async uploadCertificateTemplate(storageId: Id<'_storage'>, courseId: Id<'training_courses'>) {
    return this.convex.client.mutation(api.training.courses.updateCourse, {
      courseId,
      certificateTemplateId: storageId
    });
  }

  // ============================================================================
  // VALIDATION HELPERS
  // ============================================================================

  validateModuleFile(file: File, contentType: 'video' | 'document'): string | null {
    const MAX_VIDEO_SIZE = 500 * 1024 * 1024; // 500MB
    const MAX_DOCUMENT_SIZE = 50 * 1024 * 1024; // 50MB

    const ALLOWED_VIDEO_TYPES = ['video/mp4', 'video/webm', 'video/ogg', 'video/quicktime'];
    const ALLOWED_DOCUMENT_TYPES = [
      'application/pdf',
      'application/msword',
      'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
    ];

    if (contentType === 'video') {
      if (!ALLOWED_VIDEO_TYPES.includes(file.type)) {
        return 'Invalid video format. Please upload MP4, WebM, OGG, or MOV files.';
      }
      if (file.size > MAX_VIDEO_SIZE) {
        return `Video file too large. Maximum size is ${MAX_VIDEO_SIZE / 1024 / 1024}MB.`;
      }
    } else if (contentType === 'document') {
      if (!ALLOWED_DOCUMENT_TYPES.includes(file.type)) {
        return 'Invalid document format. Please upload PDF, DOC, or DOCX files.';
      }
      if (file.size > MAX_DOCUMENT_SIZE) {
        return `Document too large. Maximum size is ${MAX_DOCUMENT_SIZE / 1024 / 1024}MB.`;
      }
    }

    return null;
  }

  formatFileSize(bytes: number): string {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return Math.round((bytes / Math.pow(k, i)) * 100) / 100 + ' ' + sizes[i];
  }

  // ============================================================================
  // PROGRESS/ENROLLMENT MANAGEMENT
  // ============================================================================

  async listProgress(
    numItems: number = 50,
    cursor: string | null = null,
    courseId?: Id<'training_courses'>,
    status?: 'not_started' | 'in_progress' | 'completed' | 'failed' | null
  ) {
    return this.convex.client.query(api.training.progress.listProgress, {
      paginationOpts: { numItems, cursor },
      courseId,
      status: status || undefined
    });
  }

  async getProgress(progressId: Id<'training_progress'>) {
    return this.convex.client.query(api.training.progress.getProgress, { progressId });
  }

  async enrollExecutive(executiveId: Id<'executives'>, courseId: Id<'training_courses'>) {
    return this.convex.client.mutation(api.training.progress.enrollExecutive, {
      executiveId,
      courseId
    });
  }

  async updateModuleProgress(
    moduleProgressId: Id<'training_module_progress'>,
    data: {
      status: 'in_progress' | 'completed';
      score?: number;
      timeSpentMinutes: number;
    }
  ) {
    return this.convex.client.mutation(api.training.progress.updateModuleProgress, {
      moduleProgressId,
      ...data
    });
  }

async generateCertificate(progressId: Id<'training_progress'>) {
  return this.convex.client.action(
    api.training.certificates.generateCertificate, 
    { progressId }
  );
}

  async getCertificateUrl(certificateId: Id<'_storage'>): Promise<string | null> {
    try {
      const url = await this.convex.client.query(api.training.progress.getCertificateUrl, {
        certificateId
      });
      return url;
    } catch {
      return null;
    }
  }

  async getExecutiveStats(executiveId: Id<'executives'>) {
    return this.convex.client.query(api.training.progress.getExecutiveTrainingStats, {
      executiveId
    });
  }

  async getExecutiveProgress(executiveId: Id<'executives'>) {
    return this.convex.client.query(api.training.progress.getExecutiveProgress, {
      executiveId
    });
  }
}
</file>

<file path="src/app/features/training/training.routes.ts">
import { Routes } from '@angular/router';
import { ViewProgressComponent } from './view-progress/view-progress.component';
import { ManageContentComponent } from './manage-content/manage-content.component';
import { QuizManagerComponent } from './quiz-manager/quiz-manager.component';

export const TRAINING_ROUTES: Routes = [
    {
        path: 'progress',
        component: ViewProgressComponent,
        title: 'View Progress'
    },
    {
        path: 'content',
        component: ManageContentComponent,
        title: 'Manage Content'
    },
      {
    path: 'quiz', // âœ… NEW ROUTE
    component: QuizManagerComponent,
    title: 'Quiz Manager'
  }
];
</file>

<file path="src/app/features/training/view-progress/view-progress.component.html">
<div class="progress-root">
  <p-toast />

  <!-- Header -->
  <div class="progress-header">
    <div class="header-content">
      <div>
        <h2>
          <i class="pi pi-chart-line"></i>
          Training Progress
        </h2>
        <p>Track employee training completion and performance</p>
      </div>

      <div class="header-actions">
        <p-button
          icon="pi pi-refresh"
          label="Refresh"
          [outlined]="true"
          (click)="refresh()"
          [loading]="loading()"
        />
        <p-button
          icon="pi pi-download"
          label="Export"
          severity="success"
          [outlined]="true"
          (click)="exportProgress()"
        />
      </div>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-grid">
    <!-- Total Enrollments -->
    <div class="stat-card">
      <div class="stat-content">
        <div class="stat-icon">
          <i class="pi pi-users"></i>
        </div>
        <div class="stat-details">
          <span class="stat-label">Total Enrollments</span>
          <div class="stat-value">
            <span class="stat-number">{{ totalRecords() }}</span>
            <p-tag value="Active" severity="info" [rounded]="true" class="stat-badge" />
          </div>
        </div>
      </div>
    </div>

    <!-- Completed -->
    <div class="stat-card completed-card">
      <div class="stat-content">
        <div class="stat-icon">
          <i class="pi pi-check-circle"></i>
        </div>
        <div class="stat-details">
          <span class="stat-label">Completed</span>
          <div class="stat-value">
            <span class="stat-number">{{ completedCount() }}</span>
            <span class="stat-percentage text-green-600">
              {{ totalRecords() > 0 ? (completedCount() / totalRecords() * 100).toFixed(0) : 0 }}%
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- In Progress -->
    <div class="stat-card in-progress-card">
      <div class="stat-content">
        <div class="stat-icon">
          <i class="pi pi-spin pi-spinner"></i>
        </div>
        <div class="stat-details">
          <span class="stat-label">In Progress</span>
          <div class="stat-value">
            <span class="stat-number">{{ inProgressCount() }}</span>
            <span class="stat-percentage text-orange-600">
              {{ totalRecords() > 0 ? (inProgressCount() / totalRecords() * 100).toFixed(0) : 0 }}%
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Failed -->
    <div class="stat-card failed-card">
      <div class="stat-content">
        <div class="stat-icon">
          <i class="pi pi-times-circle"></i>
        </div>
        <div class="stat-details">
          <span class="stat-label">Failed</span>
          <div class="stat-value">
            <span class="stat-number">{{ failedCount() }}</span>
            @if (failedCount() > 0) {
              <p-tag value="Review" [rounded]="true" severity="danger" class="stat-badge" />
            }
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Secondary stats -->
  <div class="stats-grid stats-secondary">
    <div class="stat-secondary-card">
      <div class="stat-secondary-header">
        <h3>
          <i class="pi pi-chart-bar"></i>
          Average Completion Rate
        </h3>
        <span class="stat-secondary-value">{{ averageCompletion() }}%</span>
      </div>
      <p-progressBar [value]="averageCompletion()" [showValue]="false" />
    </div>

    <div class="stat-secondary-card">
      <div class="stat-secondary-header">
        <h3>
          <i class="pi pi-verified"></i>
          Success Rate
        </h3>
        <span class="stat-secondary-value success">{{ successRate() }}%</span>
      </div>
      <p-progressBar
        [value]="successRate()"
        [showValue]="false"
        
      />
    </div>
  </div>

  <!-- Chart card -->
  <div class="chart-card">
    <div class="chart-header">
      <div>
        <h3>
          <i class="pi pi-chart-pie"></i>
          Progress Distribution
        </h3>
        <p>Overview of training completion status</p>
      </div>
    </div>
    <div class="chart-container">
      <p-chart type="pie" [data]="chartData" [options]="chartOptions" />
    </div>
  </div>

  <!-- Table card -->
  <div class="table-card">
    <div class="table-header">
      <div class="table-header-main">
        <h3>
          <i class="pi pi-list"></i>
          Training Progress List
        </h3>
      </div>
      <div class="table-filters">
        <span class="p-input-icon-left search-input">
          <i class="pi pi-search"></i>
          <input
            pInputText
            type="text"
            (input)="onGlobalFilter($event)"
            placeholder="Search..."
          />
        </span>
        <p-select
          [options]="statusOptions"
          [(ngModel)]="selectedStatus"
          (onChange)="onStatusChange()"
          placeholder="Filter by Status"
          optionLabel="label"
          optionValue="value"
          [showClear]="true"
          styleClass="status-select"
        />
      </div>
    </div>

    <p-table
      #dt
      [value]="progressList()"
      [rows]="50"
      [paginator]="true"
      [globalFilterFields]="['executiveName', 'courseTitle']"
      [tableStyle]="{ 'min-width': '75rem' }"
      [loading]="loading()"
      styleClass="p-datatable-striped progress-table"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} records"
      [showCurrentPageReport]="true"
      [rowsPerPageOptions]="[10, 25, 50, 100]"
    >
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="executiveName">
            Executive
            <p-sortIcon field="executiveName" />
          </th>
          <th pSortableColumn="courseTitle">
            Course
            <p-sortIcon field="courseTitle" />
          </th>
          <th pSortableColumn="status">
            Status
            <p-sortIcon field="status" />
          </th>
          <th pSortableColumn="progressPercentage">
            Progress
            <p-sortIcon field="progressPercentage" />
          </th>
          <th pSortableColumn="completedModules">
            Modules
            <p-sortIcon field="completedModules" />
          </th>
          <th *ngIf="selectedStatus === 'completed'">Score</th>
          <th class="actions-column">Actions</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-progress>
        <tr>
          <td>
            <div class="cell-executive">
              <div class="avatar">
                <i class="pi pi-user"></i>
              </div>
              <span class="name">{{ progress.executiveName || 'N/A' }}</span>
            </div>
          </td>
          <td>
            <div class="cell-course">
              <i class="pi pi-book"></i>
              <span>{{ progress.courseTitle || 'N/A' }}</span>
            </div>
          </td>
          <td>
            <p-tag
              [value]="progress.status | titlecase"
              [severity]="getStatusSeverity(progress.status)"
            />
          </td>
          <td>
            <div class="cell-progress">
              <p-progressBar
                [value]="progress.progressPercentage"
                [showValue]="false"
              ></p-progressBar>
              <span class="percent">{{ progress.progressPercentage }}%</span>
            </div>
          </td>
          <td>
            <span class="cell-modules">
              {{ progress.completedModules }} / {{ progress.totalModules }}
            </span>
          </td>
          <td *ngIf="selectedStatus === 'completed'">
            @if (progress.finalScore) {
              <div class="cell-score">
                <i class="pi pi-star-fill"></i>
                <span>{{ progress.finalScore }}%</span>
              </div>
            } @else {
              <span class="text-500">N/A</span>
            }
          </td>
          <td>
            <div class="cell-actions">
              <p-button
                icon="pi pi-eye"
                severity="info"
                [rounded]="true"
                [text]="true"
                (onClick)="viewDetails(progress)"
                pTooltip="View Details"
                tooltipPosition="top"
              />
              <p-button
                *ngIf="progress.status === 'completed' && !progress.certificateId"
                icon="pi pi-file"
                severity="success"
                [rounded]="true"
                [text]="true"
                [loading]="loading()"
                (onClick)="generateCertificate(progress)"
                pTooltip="Generate Certificate"
                tooltipPosition="top"
              />
              <p-button
                *ngIf="progress.status === 'completed' && progress.certificateId"
                icon="pi pi-download"
                severity="success"
                [rounded]="true"
                [text]="true"
                (onClick)="downloadCertificate(progress)"
                pTooltip="Download Certificate"
                tooltipPosition="top"
              />
              <p-button
                *ngIf="progress.status !== 'completed'"
                icon="pi pi-send"
                [rounded]="true"
                [text]="true"
                (onClick)="sendReminder(progress)"
                pTooltip="Send Reminder"
                tooltipPosition="top"
              />
            </div>
          </td>
        </tr>
      </ng-template>

      <!-- Empty -->
      <ng-template pTemplate="emptymessage">
        <tr>
          <td [attr.colspan]="selectedStatus === 'completed' ? 7 : 6">
            <div class="empty-state">
              <div class="empty-icon">
                <i class="pi pi-inbox"></i>
              </div>
              <h3>No Training Progress Found</h3>
              <p>
                @if (selectedStatus) {
                  No progress records with status "{{ selectedStatus | titlecase }}" found.
                } @else {
                  Training progress will appear here once executives enroll in courses.
                }
              </p>
              @if (selectedStatus) {
                <p-button
                  label="Clear Filters"
                  icon="pi pi-filter-slash"
                  [outlined]="true"
                  (click)="clearFilters()"
                />
              }
            </div>
          </td>
        </tr>
      </ng-template>

      <!-- Loading -->
      <ng-template pTemplate="loadingbody">
        <tr>
          <td [attr.colspan]="selectedStatus === 'completed' ? 7 : 6">
            <div class="loading-state">
              <i class="pi pi-spin pi-spinner"></i>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>

<!-- Details Dialog -->
<p-dialog
  [(visible)]="detailsDialogVisible"
  [style]="{ width: '800px', maxHeight: '90vh' }"
  header="Training Progress Details"
  [modal]="true"
  [draggable]="false"
  [resizable]="false"
  (onHide)="closeDialog()"
>
  <ng-container *ngIf="selectedProgress">
    <div class="flex flex-column gap-4">
      <!-- Course Info Section -->
      <div class="surface-50 border-round p-3">
        <h5 class="mt-0 mb-3 text-primary">
          <i class="pi pi-book mr-2"></i>Course Information
        </h5>
        <div class="grid">
          <div class="col-12">
            <label class="font-semibold text-color-secondary text-sm">Course Title</label>
            <p class="m-0 mt-1 text-lg font-medium">{{ selectedProgress.courseTitle || 'N/A' }}</p>
          </div>
        </div>
      </div>

      <!-- Executive Info Section -->
      <div class="surface-50 border-round p-3">
        <h5 class="mt-0 mb-3 text-primary">
          <i class="pi pi-user mr-2"></i>Executive Information
        </h5>
        <div class="grid">
          <div class="col-12">
            <label class="font-semibold text-color-secondary text-sm">Name</label>
            <p class="m-0 mt-1 font-medium">{{ selectedProgress.executiveName || 'N/A' }}</p>
          </div>
        </div>
      </div>

      <!-- Progress Section -->
      <div class="surface-50 border-round p-3">
        <h5 class="mt-0 mb-3 text-primary">
          <i class="pi pi-chart-line mr-2"></i>Progress Details
        </h5>
        <div class="grid">
          <div class="col-12 md:col-6">
            <label class="font-semibold text-color-secondary text-sm">Status</label>
            <div class="mt-2">
              <p-tag
                [value]="selectedProgress.status | titlecase"
                [severity]="getStatusSeverity(selectedProgress.status)"
                styleClass="text-base"
              />
            </div>
          </div>
          <div class="col-12 md:col-6">
            <label class="font-semibold text-color-secondary text-sm">Overall Progress</label>
            <p class="m-0 mt-1 text-2xl font-bold text-primary">{{ selectedProgress.progressPercentage }}%</p>
          </div>
          <div class="col-12">
            <label class="font-semibold text-color-secondary text-sm mb-2 block">Progress Bar</label>
            <p-progressBar [value]="selectedProgress.progressPercentage" [style]="{ height: '1.5rem' }" />
          </div>
          <div class="col-12 md:col-6">
            <label class="font-semibold text-color-secondary text-sm">Modules Completed</label>
            <p class="m-0 mt-1 text-lg">
              <span class="font-bold text-primary">{{ selectedProgress.completedModules }}</span>
              <span class="text-500"> / {{ selectedProgress.totalModules }}</span>
            </p>
          </div>
          <div class="col-12 md:col-6" *ngIf="selectedProgress.finalScore">
            <label class="font-semibold text-color-secondary text-sm">Final Score</label>
            <div class="flex align-items-center gap-2 mt-1">
              <i class="pi pi-star-fill text-yellow-500 text-xl"></i>
              <p class="m-0 text-xl font-bold text-green-600">{{ selectedProgress.finalScore }}%</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Timeline Section -->
      <div class="surface-50 border-round p-3">
        <h5 class="mt-0 mb-3 text-primary">
          <i class="pi pi-clock mr-2"></i>Timeline
        </h5>
        <div class="grid">
          <div class="col-12 md:col-6">
            <label class="font-semibold text-color-secondary text-sm">Started Date</label>
            <p class="m-0 mt-1 font-medium">{{ selectedProgress.createdAt | date: 'MMMM dd, yyyy' }}</p>
            <p class="text-sm text-500 m-0">{{ selectedProgress.createdAt | date: 'HH:mm' }}</p>
          </div>
          <div class="col-12 md:col-6" *ngIf="selectedProgress.completedAt">
            <label class="font-semibold text-color-secondary text-sm">Completed Date</label>
            <p class="m-0 mt-1 font-medium">{{ selectedProgress.completedAt | date: 'MMMM dd, yyyy' }}</p>
            <p class="text-sm text-500 m-0">{{ selectedProgress.completedAt | date: 'HH:mm' }}</p>
          </div>
          <div class="col-12" *ngIf="selectedProgress.completedAt">
            <label class="font-semibold text-color-secondary text-sm">Time Spent</label>
            <p class="m-0 mt-1 font-medium">
              <i class="pi pi-stopwatch mr-2 text-primary"></i>
              {{ calculateTimeSpent(selectedProgress) }}
            </p>
          </div>
        </div>
      </div>

      <!-- Certificate Section -->
      <div class="surface-50 border-round p-3" *ngIf="selectedProgress.status === 'completed'">
        <h5 class="mt-0 mb-3 text-primary">
          <i class="pi pi-certificate mr-2"></i>Certificate
        </h5>
        
        <!-- Certificate Available -->
        <div *ngIf="selectedProgress.certificateId" class="flex align-items-center gap-3 p-3 border-round bg-green-50">
          <div class="flex align-items-center justify-content-center bg-green-100 border-round" style="width: 4rem; height: 4rem">
            <i class="pi pi-file-pdf text-green-600 text-3xl"></i>
          </div>
          <div class="flex-1">
            <p class="m-0 font-bold text-lg text-900">Certificate Available</p>
            <p class="text-sm text-600 m-0 mt-1">Click to download your completion certificate</p>
          </div>
          <p-button
            label="Download"
            icon="pi pi-download"
            severity="success"
            (onClick)="downloadCertificate(selectedProgress)"
          />
        </div>

        <!-- Certificate Not Generated -->
        <div *ngIf="!selectedProgress.certificateId" class="flex align-items-center gap-3 p-3 border-round bg-orange-50">
          <div class="flex align-items-center justify-content-center bg-orange-100 border-round" style="width: 4rem; height: 4rem">
            <i class="pi pi-file text-orange-600 text-3xl"></i>
          </div>
          <div class="flex-1">
            <p class="m-0 font-bold text-lg text-900">Certificate Not Generated</p>
            <p class="text-sm text-600 m-0 mt-1">Generate your completion certificate now</p>
          </div>
          <p-button
            label="Generate"
            icon="pi pi-file"
            severity="success"
            [loading]="loading()"
            (onClick)="generateCertificate(selectedProgress)"
          />
        </div>
      </div>

      <!-- Reminder Section (for incomplete training) -->
      <div class="surface-50 border-round p-3" *ngIf="selectedProgress.status !== 'completed'">
        <h5 class="mt-0 mb-3 text-primary">
          <i class="pi pi-bell mr-2"></i>Actions
        </h5>
        <div class="flex align-items-center gap-3 p-3 border-round bg-blue-50">
          <div class="flex align-items-center justify-content-center bg-blue-100 border-round" style="width: 4rem; height: 4rem">
            <i class="pi pi-send text-blue-600 text-2xl"></i>
          </div>
          <div class="flex-1">
            <p class="m-0 font-bold text-lg text-900">Send Reminder</p>
            <p class="text-sm text-600 m-0 mt-1">Send a notification to complete the training</p>
          </div>
          <p-button
            label="Send"
            icon="pi pi-send"
            severity="info"
            (onClick)="sendReminder(selectedProgress)"
          />
        </div>
      </div>
    </div>
  </ng-container>

  <ng-template pTemplate="footer">
    <div class="flex justify-content-between w-full">
      <p-button
        label="Close"
        icon="pi pi-times"
        [text]="true"
        (onClick)="closeDialog()"
      />
      <div class="flex gap-2">
        @if (selectedProgress?.status === 'completed' && selectedProgress?.certificateId) {
          <p-button
            label="Download Certificate"
            icon="pi pi-download"
            severity="success"
            (onClick)="downloadCertificate(selectedProgress!)"
          />
        }
        @if (selectedProgress?.status === 'completed' && !selectedProgress?.certificateId) {
          <p-button
            label="Generate Certificate"
            icon="pi pi-file"
            severity="success"
            [loading]="loading()"
            (onClick)="generateCertificate(selectedProgress!)"
          />
        }
      </div>
    </div>
  </ng-template>
</p-dialog>
</file>

<file path="src/app/features/training/view-progress/view-progress.component.scss">
// ROOT
.progress-root {
    min-height: 100vh;
    background: var(--surface-ground);
    padding: 1.5rem;
    max-width: 1600px;
    margin: 0 auto;
}

// HEADER
.progress-header {
    background: var(--surface-card);
    border-radius: var(--border-radius-lg);
    padding: 1.5rem 2rem;
    box-shadow: var(--surface-shadow);
    margin-bottom: 1.5rem;

    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
    }

    h2 {
        margin: 0;
        font-size: 2rem;
        font-weight: 700;
        color: var(--primary-color);

        i {
            margin-right: 0.75rem;
        }
    }

    p {
        margin: 0.5rem 0 0;
        color: var(--text-color-secondary);
        font-size: 0.95rem;
    }

    .header-actions {
        display: flex;
        gap: 0.75rem;
    }
}

// PRIMARY STATS
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 1.25rem;
    margin-bottom: 1.5rem;
}

.stat-card {
    background: var(--surface-card);
    border-radius: var(--border-radius-lg);
    padding: 1.25rem 1.5rem;
    box-shadow: var(--surface-shadow);
    border-left: 4px solid var(--primary-color);
    transition: all 0.3s ease;

    &:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(15, 23, 42, 0.12);
    }

    &.completed-card {
        border-left-color: var(--green-500);

        .stat-icon {
            background: var(--green-50);
            color: var(--green-600);
        }
    }

    &.in-progress-card {
        border-left-color: var(--orange-500);

        .stat-icon {
            background: var(--orange-50);
            color: var(--orange-600);
        }
    }

    &.failed-card {
        border-left-color: var(--red-500);

        .stat-icon {
            background: var(--red-50);
            color: var(--red-600);
        }
    }

    .stat-content {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .stat-icon {
        width: 3.25rem;
        height: 3.25rem;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        background: var(--primary-50);
        color: var(--primary-600);
        font-size: 1.6rem;
        flex-shrink: 0;
    }

    .stat-details {
        flex: 1;
    }

    .stat-label {
        display: block;
        font-size: 0.8rem;
        font-weight: 600;
        color: var(--text-color-secondary);
        margin-bottom: 0.25rem;
    }

    .stat-value {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.5rem;
    }

    .stat-number {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--text-color);
        line-height: 1;
    }

    .stat-badge {
        font-size: 0.78rem;
        font-weight: 600;
    }

    .stat-percentage {
        font-size: 0.9rem;
        font-weight: 600;
    }
}

// SECONDARY STATS
.stats-secondary {
    margin-bottom: 1.5rem;
}

.stat-secondary-card {
    background: var(--surface-card);
    border-radius: var(--border-radius-lg);
    padding: 1.25rem 1.5rem 1.5rem;
    box-shadow: var(--surface-shadow);

    .stat-secondary-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 0.75rem;

        h3 {
            margin: 0;
            font-size: 1rem;
            font-weight: 600;

            i {
                margin-right: 0.5rem;
                color: var(--primary-color);
            }
        }

        .stat-secondary-value {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--primary-color);

            &.success {
                color: var(--green-600);
            }
        }
    }

    ::ng-deep .p-progressbar {
        height: 0.9rem;

        .p-progressbar-value {
            border-radius: 999px;
        }
    }

    ::ng-deep .success-progress .p-progressbar-value {
        background: var(--green-500);
    }
    ::ng-deep .stat-secondary-card .success-progress .p-progressbar-value {
  background: var(--green-500);
}
}

// CHART
.chart-card {
    background: var(--surface-card);
    border-radius: var(--border-radius-lg);
    padding: 1.5rem 1.75rem 1.75rem;
    box-shadow: var(--surface-shadow);
    margin-bottom: 1.5rem;

    .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        margin-bottom: 1rem;
    }

    h3 {
        margin: 0 0 0.25rem;
        font-size: 1.2rem;
        font-weight: 700;

        i {
            margin-right: 0.5rem;
            color: var(--primary-color);
        }
    }

    p {
        margin: 0;
        color: var(--text-color-secondary);
        font-size: 0.9rem;
    }

    .chart-container {
        height: 300px;
    }
}

// TABLE
.table-card {
    background: var(--surface-card);
    border-radius: var(--border-radius-lg);
    box-shadow: var(--surface-shadow);
    overflow: hidden;

    .table-header {
        padding: 1.25rem 1.75rem;
        border-bottom: 1px solid var(--surface-border);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
        background: linear-gradient(to right, var(--primary-50), transparent);
    }

    .table-header-main h3 {
        margin: 0;
        font-size: 1.15rem;
        font-weight: 700;

        i {
            margin-right: 0.5rem;
            color: var(--primary-color);
        }
    }

    .table-filters {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;

        .search-input input {
            min-width: 220px;
        }

        .status-select {
            min-width: 200px;
        }
    }

    ::ng-deep .progress-table {
        .p-datatable-thead > tr > th {
            background: var(--surface-50);
            color: var(--text-color);
            font-weight: 600;
            padding: 0.85rem 1.25rem;
            border-bottom: 2px solid var(--surface-border);
            font-size: 0.85rem;
            white-space: nowrap;
        }

        .p-datatable-tbody > tr {
            transition: background-color 0.2s ease;

            &:hover {
                background: var(--surface-hover) !important;
            }

            > td {
                padding: 0.85rem 1.25rem;
                border-bottom: 1px solid var(--surface-border);
                font-size: 0.9rem;
            }
        }

        .p-paginator {
            padding: 0.75rem 1.25rem;
        }
    }

    .actions-column {
        text-align: center;
    }

    .cell-executive {
        display: flex;
        align-items: center;
        gap: 0.6rem;

        .avatar {
            width: 2.2rem;
            height: 2.2rem;
            border-radius: 999px;
            background: var(--primary-50);
            color: var(--primary-600);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            flex-shrink: 0;
        }

        .name {
            font-weight: 600;
        }
    }

    .cell-course {
        display: flex;
        align-items: center;
        gap: 0.4rem;

        i {
            color: var(--primary-color);
            font-size: 0.9rem;
        }
    }

    .cell-progress {
        display: flex;
        align-items: center;
        gap: 0.5rem;

        ::ng-deep .p-progressbar {
            width: 150px;
            height: 0.9rem;
            border-radius: 999px;

            .p-progressbar-value {
                border-radius: 999px;
            }
        }

        .percent {
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
        }
    }

    .cell-modules {
        font-weight: 600;
        font-size: 0.9rem;
    }

    .cell-score {
        display: flex;
        align-items: center;
        gap: 0.35rem;
        color: var(--yellow-600);
        font-weight: 700;

        i {
            color: var(--yellow-500);
            font-size: 1rem;
        }
    }

    .cell-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 0.25rem;

        ::ng-deep .p-button {
            width: 2.25rem;
            height: 2.25rem;
        }
    }

    .empty-state {
        text-align: center;
        padding: 2.5rem 1.5rem;

        .empty-icon {
            width: 4rem;
            height: 4rem;
            margin: 0 auto 1rem;
            border-radius: 999px;
            background: var(--primary-50);
            display: flex;
            align-items: center;
            justify-content: center;

            i {
                font-size: 2rem;
                color: var(--primary-color);
            }
        }

        h3 {
            margin: 0 0 0.5rem;
            font-size: 1.1rem;
            font-weight: 700;
        }

        p {
            margin: 0 0 1.25rem;
            color: var(--text-color-secondary);
            max-width: 420px;
            margin-inline: auto;
            font-size: 0.9rem;
        }
    }

    .loading-state {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2rem;

        i {
            font-size: 2.5rem;
            color: var(--primary-color);
        }
    }
}

// DIALOG
::ng-deep .progress-details-dialog {
    .p-dialog-header {
        background: linear-gradient(
            135deg,
            var(--primary-color),
            var(--primary-600)
        );
        color: #fff;
        padding: 1.25rem 1.75rem;

        .p-dialog-title {
            font-weight: 700;
            font-size: 1.1rem;
        }
    }

    .p-dialog-content {
        padding: 1.75rem;
    }

    .surface-50 {
        background: var(--surface-50);
    }
}

// RESPONSIVE
@media (max-width: 1024px) {
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 768px) {
    .progress-root {
        padding: 1rem;
    }

    .progress-header {
        padding: 1.25rem;

        h2 {
            font-size: 1.6rem;
        }

        .header-actions {
            width: 100%;

            ::ng-deep .p-button {
                flex: 1;
            }
        }
    }

    .stats-grid {
        grid-template-columns: 1fr;
    }

    .chart-card {
        padding: 1.25rem;
    }

    .table-card .table-header {
        padding: 1.1rem;

        .table-filters {
            width: 100%;

            .search-input input {
                width: 100%;
                min-width: unset;
            }

            .status-select {
                width: 100%;
                min-width: unset;
            }
        }
    }
}
</file>

<file path="src/app/features/training/view-progress/view-progress.component.ts">
import { Component, OnInit, signal, ViewChild, computed } from '@angular/core';
import { CommonModule } from '@angular/common';
import { Table, TableLazyLoadEvent, TableModule } from 'primeng/table';
import { CardModule } from 'primeng/card';
import { ChartModule } from 'primeng/chart';
import { ProgressBarModule } from 'primeng/progressbar';
import { ButtonModule } from 'primeng/button';
import { TagModule } from 'primeng/tag';
import { InputTextModule } from 'primeng/inputtext';
import { IconFieldModule } from 'primeng/iconfield';
import { InputIconModule } from 'primeng/inputicon';
import { SelectModule } from 'primeng/select';
import { FormsModule } from '@angular/forms';
import { MessageService } from 'primeng/api';
import { ToastModule } from 'primeng/toast';
import { DialogModule } from 'primeng/dialog';
import { ProgressService } from '../services/progress.service';
import { TrainingProgress } from '../interfaces/training.interface';


@Component({
  selector: 'app-view-progress',
  standalone: true,
  imports: [
    CommonModule,
    FormsModule,
    CardModule,
    ChartModule,
    TableModule,
    ProgressBarModule,
    ButtonModule,
    TagModule,
    InputTextModule,
    IconFieldModule,
    InputIconModule,
    SelectModule,
    ToastModule,
    DialogModule,
  ],
  providers: [MessageService],
  templateUrl: './view-progress.component.html',
  styleUrls: ['view-progress.component.scss'],
})
export class ViewProgressComponent implements OnInit {
  @ViewChild('dt') dt!: Table;

  progressList = signal<TrainingProgress[]>([]);
  totalRecords = signal(0);
  loading = signal(false);
  selectedProgress: TrainingProgress | null = null;
  detailsDialogVisible = false;

  // Chart data
  chartData: any;
  chartOptions: any;

  // Computed statistics
  completedCount = computed(() =>
    this.progressList().filter((p) => p.status === 'completed').length
  );

  inProgressCount = computed(() =>
    this.progressList().filter((p) => p.status === 'in_progress').length
  );

  failedCount = computed(() =>
    this.progressList().filter((p) => p.status === 'failed').length
  );

  notStartedCount = computed(() =>
    this.progressList().filter((p) => p.status === 'not_started').length
  );

  averageCompletion = computed(() => {
    const list = this.progressList();
    if (list.length === 0) return 0;
    const total = list.reduce((sum, p) => sum + p.progressPercentage, 0);
    return Math.round(total / list.length);
  });

  successRate = computed(() => {
    const total = this.progressList().length;
    if (total === 0) return 0;
    return Math.round((this.completedCount() / total) * 100);
  });

  // Filter options
  selectedStatus: 'not_started' | 'in_progress' | 'completed' | 'failed' | null =
    null;

  statusOptions = [
    { label: 'All', value: null },
    { label: 'Not Started', value: 'not_started' as const },
    { label: 'In Progress', value: 'in_progress' as const },
    { label: 'Completed', value: 'completed' as const },
    { label: 'Failed', value: 'failed' as const },
  ];

  constructor(
    private progressService: ProgressService,
    private messageService: MessageService
  ) {}

  ngOnInit() {
    this.setupChart();
    this.loadProgressData(null);
  }

  setupChart() {
    this.chartData = {
      labels: ['Not Started', 'In Progress', 'Completed', 'Failed'],
      datasets: [
        {
          label: 'Training Progress Distribution',
          data: [0, 0, 0, 0],
          backgroundColor: [
            'rgba(255, 159, 64, 0.8)',
            'rgba(54, 162, 235, 0.8)',
            'rgba(75, 192, 75, 0.8)',
            'rgba(255, 99, 99, 0.8)',
          ],
          borderWidth: 0,
        },
      ],
    };

    this.chartOptions = {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          position: 'bottom',
          labels: {
            padding: 20,
            font: {
              size: 14,
            },
          },
        },
        tooltip: {
          callbacks: {
            label: (context: any) => {
              const label = context.label || '';
              const value = context.parsed || 0;
              const total = context.dataset.data.reduce(
                (a: number, b: number) => a + b,
                0
              );
              const percentage =
                total > 0 ? Math.round((value / total) * 100) : 0;
              return `${label}: ${value} (${percentage}%)`;
            },
          },
        },
      },
    };
  }

  async loadProgressData(event: TableLazyLoadEvent | null) {
    this.loading.set(true);
    try {
      const numItems = event?.rows || 50;
      const result = await this.progressService.listProgress(
        numItems,
        null,
        undefined,
        undefined,
        this.selectedStatus || undefined
      );

      this.progressList.set(result.page as TrainingProgress[]);
      this.totalRecords.set(
        result.continueCursor ? result.continueCursor.length : result.page.length
      );
      this.updateChart();
    } catch (error: any) {
      this.messageService.add({
        severity: 'error',
        summary: 'Error',
        detail: error.message || 'Failed to load progress data',
      });
    } finally {
      this.loading.set(false);
    }
  }

  private updateChart() {
    this.chartData = {
      ...this.chartData,
      datasets: [
        {
          ...this.chartData.datasets[0],
          data: [
            this.notStartedCount(),
            this.inProgressCount(),
            this.completedCount(),
            this.failedCount(),
          ],
        },
      ],
    };
  }

  async viewDetails(progress: TrainingProgress) {
    this.selectedProgress = progress;
    this.detailsDialogVisible = true;
  }

  getStatusSeverity(status: string): 'success' | 'secondary' | 'info' | 'warn' | 'danger' {
    const severityMap: Record<string, any> = {
      completed: 'success',
      in_progress: 'info',
      not_started: 'secondary',
      failed: 'danger',
    };
    return severityMap[status] || 'info';
  }

  getProgressColor(percentage: number): string {
    if (percentage === 100) return 'success';
    if (percentage >= 50) return 'info';
    if (percentage > 0) return 'warn';
    return 'danger';
  }

  onStatusChange() {
    this.loadProgressData(null);
  }

  onGlobalFilter(event: Event) {
    this.dt.filterGlobal((event.target as HTMLInputElement).value, 'contains');
  }

  clearFilters() {
    this.selectedStatus = null;
    this.dt.clear();
    this.loadProgressData(null);
  }

  async downloadCertificate(progress: TrainingProgress) {
    if (!progress.certificateId) {
      this.messageService.add({
        severity: 'warn',
        summary: 'No Certificate',
        detail: 'Certificate not yet generated',
      });
      return;
    }

    try {
      const url = await this.progressService.getCertificateUrl(
        progress.certificateId
      );
      if (url) {
        window.open(url, '_blank');
        this.messageService.add({
          severity: 'success',
          summary: 'Success',
          detail: 'Certificate opened in new tab',
        });
      } else {
        throw new Error('Certificate URL not found');
      }
    } catch (error: any) {
      this.messageService.add({
        severity: 'error',
        summary: 'Error',
        detail: error.message || 'Failed to download certificate',
      });
    }
  }

async generateCertificate(progress: TrainingProgress) {
  if (progress.status !== 'completed') {
    this.messageService.add({
      severity: 'warn',
      summary: 'Cannot Generate',
      detail: 'Certificate can only be generated for completed courses',
    });
    return;
  }

  if (progress.certificateId) {
    this.messageService.add({
      severity: 'info',
      summary: 'Already Generated',
      detail: 'Certificate already exists. Click download to view.',
    });
    return;
  }

  this.loading.set(true);
  try {
    await this.progressService.generateCertificate(progress._id);
    this.messageService.add({
      severity: 'success',
      summary: 'Success',
      detail: 'Certificate generated successfully',
    });
    await this.loadProgressData(null);
  } catch (error: any) {
    const msg: string =
      error?.message ||
      error?.data?.message || // convex client sometimes puts it here
      '';

    if (msg === 'NO_CERTIFICATE_TEMPLATE') {
      this.messageService.add({
        severity: 'warn',
        summary: 'No Template',
        detail: 'Please upload a certificate template for this course first.',
      });
    } else {
      this.messageService.add({
        severity: 'error',
        summary: 'Error',
        detail: msg || 'Failed to generate certificate',
      });
    }
  } finally {
    this.loading.set(false);
  }
}

  exportProgress() {
    const headers = [
      'Executive Name',
      'Course Title',
      'Status',
      'Progress %',
      'Completed Modules',
      'Total Modules',
      'Final Score',
      'Started Date',
      'Completed Date',
    ];

    const data = this.progressList().map((progress) => [
      progress.executiveName || 'N/A',
      progress.courseTitle || 'N/A',
      progress.status,
      progress.progressPercentage,
      progress.completedModules,
      progress.totalModules,
      progress.finalScore || 'N/A',
      new Date(progress.startedAt).toLocaleDateString(),
      progress.completedAt
        ? new Date(progress.completedAt).toLocaleDateString()
        : 'N/A',
    ]);

    const csv = [headers, ...data.map((row) => row.join(','))].join('\n');
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `training-progress-${new Date().toISOString().split('T')[0]}.csv`;
    link.click();
    window.URL.revokeObjectURL(url);

    this.messageService.add({
      severity: 'success',
      summary: 'Success',
      detail: 'Progress data exported successfully',
    });
  }

  async sendReminder(progress: TrainingProgress) {
    if (progress.status === 'completed') {
      this.messageService.add({
        severity: 'info',
        summary: 'No Action Needed',
        detail: 'Training already completed',
      });
      return;
    }

    try {
      // TODO: Call backend to send email/notification
      this.messageService.add({
        severity: 'success',
        summary: 'Reminder Sent',
        detail: `Reminder sent to ${progress.executiveName}`,
      });
    } catch (error: any) {
      this.messageService.add({
        severity: 'error',
        summary: 'Error',
        detail: error.message || 'Failed to send reminder',
      });
    }
  }

  closeDialog() {
    this.detailsDialogVisible = false;
    this.selectedProgress = null;
  }

  calculateTimeSpent(progress: TrainingProgress): string {
    if (!progress.completedAt) return 'N/A';

    const diffMs = progress.completedAt - progress.startedAt;
    const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
    const diffHours = Math.floor(
      (diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
    );

    if (diffDays > 0) {
      return `${diffDays} day${diffDays !== 1 ? 's' : ''} ${diffHours} hour${diffHours !== 1 ? 's' : ''}`;
    }
    return `${diffHours} hour${diffHours !== 1 ? 's' : ''}`;
  }

  refresh() {
    this.loadProgressData(null);
  }
}
</file>

<file path="src/app/features/user-management/components/admins/admin-form/admin-rbac-form.component.html">
<div class="admin-form-container">
    <p-card>
        <ng-template pTemplate="header">
            <div class="card-header">
                <h2>
                    {{ isEditMode ? 'Edit Admin User' : 'Create Admin User' }}
                </h2>
            </div>
        </ng-template>

        <form [formGroup]="adminForm" (ngSubmit)="onSubmit()">
             @if (formError()) {
      <div class="mb-4 p-4 border-l-4 border-red-500 bg-red-50 rounded">
        <div class="flex items-center">
          <i class="pi pi-exclamation-triangle text-red-600 text-xl mr-3"></i>
          <div>
            <p class="text-red-800 font-semibold">Error</p>
            <p class="text-red-700">{{ formError() }}</p>
          </div>
        </div>
      </div>
    }
            <!-- Basic Information Section -->
            <div class="form-section">
                <h3 class="section-title">Basic Information</h3>

                <div class="p-fluid p-formgrid p-grid">
                    <div class="p-field p-col-12 p-md-6">
                        <label for="name">Full Name *</label>
                        <input
                            id="name"
                            type="text"
                            pInputText
                            formControlName="name"
                            [class.ng-invalid]="isFieldInvalid('name')"
                            placeholder="Enter full name"
                        />
                        <small class="p-error" *ngIf="isFieldInvalid('name')">
                            Name is required
                        </small>
                    </div>

                    <div class="p-field p-col-12 p-md-6">
                        <label for="email">Email *</label>
                        <input
                            id="email"
                            type="email"
                            pInputText
                            formControlName="email"
                            [class.ng-invalid]="isFieldInvalid('email')"
                            placeholder="admin@example.com"
                        />
                        <small class="p-error" *ngIf="isFieldInvalid('email')">
                            Valid email is required
                        </small>
                    </div>

                    <div class="p-field p-col-12 p-md-6">
                        <label for="phone">Phone Number</label>
                        <input
                            id="phone"
                            type="tel"
                            pInputText
                            formControlName="phone"
                            placeholder="+91 1234567890"
                        />
                    </div>

                    <div class="p-field p-col-12 p-md-6">
                        <label for="roleLevel">Role Level (2-12) *</label>
                        <p-select
                            id="roleLevel"
                            formControlName="roleLevel"
                            [options]="roleLevelOptions"
                            optionLabel="label"
                            optionValue="value"
                            placeholder="Select Role Level"
                            [class.ng-invalid]="isFieldInvalid('roleLevel')"
                            (onChange)="onRoleLevelChange($event)"
                        ></p-select>

                        <small class="p-error" *ngIf="isFieldInvalid('roleLevel')">
                            Role level is required
                        </small>
                        
                        <!-- âœ… Dynamic hint based on role requirements -->
                        <small class="p-help" *ngIf="currentRoleLevel() && getRequiredFieldsHint()">
                            â„¹ï¸ {{ getRequiredFieldsHint() }}
                        </small>
                    </div>
                </div>
            </div>

            <!-- Hierarchy Selection (Cascading Dropdowns) -->
            <div class="form-section">
                <h3 class="section-title">Hierarchy Assignment</h3>

                <div class="p-fluid p-formgrid p-grid">
                    <!-- Zone Dropdown -->
                    <div class="p-field p-col-12 p-md-6" *ngIf="showZoneDropdown()">
                        <label for="zone">
                            Zone 
                            <span class="required-indicator" *ngIf="isFieldRequired('zone')">*</span>
                        </label>
                        <p-select
                            id="zone"
                            [ngModel]="selectedZone()"
                            [ngModelOptions]="{ standalone: true }"
                            (onChange)="onZoneChange($event.value)"
                            [options]="zones()"
                            optionLabel="label"
                            optionValue="value"
                            placeholder="Select Zone"
                            [filter]="true"
                            [showClear]="true"
                        ></p-select>
                    </div>

                    <!-- District Dropdown -->
                    <div class="p-field p-col-12 p-md-6" *ngIf="showDistrictDropdown()">
                        <label for="district">
                            District 
                            <span class="required-indicator" *ngIf="isFieldRequired('district')">*</span>
                        </label>
                        <p-select
                            id="district"
                            [ngModel]="selectedDistrict()"
                            [ngModelOptions]="{ standalone: true }"
                            (onChange)="onDistrictChange($event.value)"
                            [options]="districts()"
                            optionLabel="label"
                            optionValue="value"
                            placeholder="Select District"
                            [filter]="true"
                            [disabled]="showZoneDropdown() && !selectedZone()"
                            [showClear]="true"
                        ></p-select>
                    </div>

                    <!-- Subdistrict Dropdown -->
                    <div class="p-field p-col-12 p-md-6" *ngIf="showSubdistrictDropdown()">
                        <label for="subdistrict">
                            Subdistrict 
                            <span class="required-indicator" *ngIf="isFieldRequired('subdistrict')">*</span>
                        </label>
                        <p-select
                            id="subdistrict"
                            [ngModel]="selectedSubdistrict()"
                            [ngModelOptions]="{ standalone: true }"
                            (onChange)="onSubdistrictChange($event.value)"
                            [options]="subdistricts()"
                            optionLabel="label"
                            optionValue="value"
                            placeholder="Select Subdistrict"
                            [filter]="true"
                            [disabled]="showDistrictDropdown() && !selectedDistrict()"
                            [showClear]="true"
                        ></p-select>
                    </div>

                    <!-- Local Body Dropdown -->
                    <div class="p-field p-col-12 p-md-6" *ngIf="showLocalBodyDropdown()">
                        <label for="localBody">
                            Local Body 
                            <span class="required-indicator" *ngIf="isFieldRequired('localBody')">*</span>
                        </label>
                        <p-select
                            id="localBody"
                            [ngModel]="selectedLocalBody()"
                            [ngModelOptions]="{ standalone: true }"
                            (onChange)="onLocalBodyChange($event.value)"
                            [options]="localBodies()"
                            optionLabel="label"
                            optionValue="value"
                            placeholder="Select Local Body"
                            [filter]="true"
                            [disabled]="!selectedSubdistrict()"
                            [showClear]="true"
                        ></p-select>
                    </div>

                    <!-- Ward Dropdown -->
                    <div class="p-field p-col-12 p-md-6" *ngIf="showWardDropdown()">
                        <label for="ward">
                            Ward 
                            <span class="required-indicator" *ngIf="isFieldRequired('ward')">*</span>
                        </label>
                        <p-select
                            id="ward"
                            [ngModel]="selectedWard()"
                            [ngModelOptions]="{ standalone: true }"
                            (onChange)="onWardChange($event.value)"
                            [options]="wards()"
                            optionLabel="label"
                            optionValue="value"
                            placeholder="Select Ward"
                            [filter]="true"
                            [disabled]="!selectedLocalBody()"
                            [showClear]="true"
                        ></p-select>
                    </div>
                </div>

                <!-- Selected Hierarchy Display -->
                <div class="hierarchy-display" *ngIf="selectedHierarchyPath()">
                    <p-tag
                        severity="info"
                        [value]="'Hierarchy: ' + selectedHierarchyPath()"
                    ></p-tag>
                </div>
            </div>

            <!-- Manager Assignment -->
            <div class="form-section" *ngIf="managers().length > 0">
                <h3 class="section-title">Manager Assignment</h3>

                <div class="p-fluid p-formgrid p-grid">
                    <div class="p-field p-col-12 p-md-6">
                        <label for="managerId">Reporting Manager</label>
                        <p-select
                            id="managerId"
                            formControlName="managerId"
                            [options]="managers()"
                            optionLabel="name"
                            optionValue="_id"
                            placeholder="Select Manager (Optional)"
                            [filter]="true"
                            [showClear]="true"
                        ></p-select>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="form-actions">
                <p-button
                    label="Cancel"
                    icon="pi pi-times"
                    severity="secondary"
                    (onClick)="onCancel()"
                    [outlined]="true"
                ></p-button>

                <p-button
                    label="{{ isEditMode ? 'Update Admin' : 'Create Admin' }}"
                    icon="pi pi-check"
                    [loading]="isSubmitting"
                    [disabled]="adminForm.invalid || isSubmitting"
                    type="submit"
                ></p-button>
            </div>
        </form>

        <!-- âœ… Setup Link Section - Production Ready with Dev Toggle -->
        <div class="setup-link-section" *ngIf="setupLink">
            <p-message severity="success" text="Admin created successfully!"></p-message>

            <!-- âœ… DEV ONLY - Remove this div in production -->
            <div class="setup-link-card dev-only">
                <div class="dev-badge">
                    <i class="pi pi-code"></i> Development Only
                </div>
                <h4>Setup Link (DEV)</h4>
                <p class="info-text">
                    Share this link with the new admin to set their password:
                </p>

                <div class="link-display">
                    <input
                        type="text"
                        pInputText
                        [value]="setupLink"
                        readonly
                        #setupLinkInput
                        class="setup-link-input"
                    />
                    <p-button
                        icon="pi pi-copy"
                        label="Copy"
                        (onClick)="copySetupLink(setupLinkInput)"
                        [outlined]="true"
                    ></p-button>
                </div>

                <small class="warning-text">
                    âš ï¸ This link expires in 24 hours. In production, this will be sent via email.
                </small>
            </div>
            <!-- âœ… END DEV ONLY -->

            <div class="production-message">
                <i class="pi pi-check-circle"></i>
                <p>Setup email has been sent to <strong>{{ adminForm.value.email }}</strong></p>
                <small>The new admin will receive instructions to set their password.</small>
            </div>
        </div>
    </p-card>
</div>
</file>

<file path="src/app/features/user-management/components/admins/admin-form/admin-rbac-form.component.scss">
.admin-rbac-container {
  max-width: 600px;
  margin: 0 auto;
  padding: 2rem;
  background: var(--surface-card);
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);

  .header {
    text-align: center;
    margin-bottom: 2rem;
    
    h2 {
      margin: 0 0 0.5rem 0;
      color: var(--text-title);
      font-size: 1.75rem;
    }
    
    p {
      margin: 0;
      color: var(--text-secondary);
      font-size: 0.95rem;
    }
  }

  .form-group {
    margin-bottom: 1.5rem;

    label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: var(--text-title);
      font-size: 0.9rem;
    }

    .required {
      color: var(--danger);
    }

    .form-control {
      width: 100%;
      padding: 0.875rem 1rem;
      border: 1px solid var(--surface-border);
      border-radius: 8px;
      font-size: 0.95rem;
      transition: all 0.2s;
      background: var(--surface-ground);

      &:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(74, 85, 104, 0.1);
      }

      &.error {
        border-color: var(--danger);
        background: rgba(255, 82, 82, 0.05);
      }
    }

    select.form-control {
      cursor: pointer;
    }
  }

  .role-selector {
    display: flex;
    gap: 1rem;
    margin-top: 0.5rem;

    .role-option {
      flex: 1;
      padding: 1rem;
      border: 2px solid var(--surface-border);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
      background: var(--surface-ground);
      display: flex;
      align-items: center;
      gap: 0.75rem;

      &:hover {
        border-color: var(--primary);
        background: rgba(74, 85, 104, 0.05);
      }

      &.selected {
        border-color: var(--primary);
        background: var(--primary);
        color: white;

        .role-icon {
          background: rgba(255,255,255,0.2);
        }
      }

      .role-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        font-weight: bold;
        background: var(--surface-section);
      }

      strong {
        display: block;
        font-size: 0.95rem;
      }

      small {
        opacity: 0.8;
        font-size: 0.8rem;
      }
    }
  }

  .form-actions {
    display: flex;
    gap: 1rem;
    margin-top: 2rem;

    button {
      flex: 1;
      padding: 1rem 2rem;
      border-radius: 8px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .btn-primary {
      background: var(--primary);
      color: white;

      &:hover:not(:disabled) {
        background: var(--primary-dark);
        transform: translateY(-1px);
      }

      &:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }
    }

    .btn-secondary {
      background: var(--surface-section);
      color: var(--text-secondary);

      &:hover:not(:disabled) {
        background: var(--surface-hover);
      }

      &:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
    }
  }

  .status-messages {
    margin-top: 1.5rem;

    .alert {
      padding: 1rem;
      border-radius: 8px;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1rem;

      &.alert-success {
        background: rgba(34, 197, 94, 0.1);
        border: 1px solid rgba(34, 197, 94, 0.3);
        color: var(--success);
      }

      &.alert-error {
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.3);
        color: var(--danger);
      }

      .close-btn {
        margin-left: auto;
        background: none;
        border: none;
        font-size: 1.25rem;
        cursor: pointer;
        color: inherit;
        opacity: 0.7;

        &:hover {
          opacity: 1;
        }
      }
    }
  }

  .debug-console {
    margin-top: 2rem;
    padding: 1.5rem;
    background: rgba(0,0,0,0.03);
    border-radius: 10px;
    border: 1px solid var(--surface-border);

    h4 {
      margin: 0 0 1rem 0;
      color: var(--text-title);
    }

    .debug-actions {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;

      .debug-btn {
        padding: 0.75rem 1.5rem;
        background: var(--surface-section);
        border: 1px solid var(--surface-border);
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s;

        &:hover {
          background: var(--surface-hover);
        }
      }
    }

    .debug-info {
      background: var(--surface-ground);
      padding: 1rem;
      border-radius: 6px;
      font-family: monospace;
      font-size: 0.85rem;
      max-height: 200px;
      overflow-y: auto;
    }
  }

  .spinner {
    width: 18px;
    height: 18px;
    border: 2px solid rgba(255,255,255,0.3);
    border-top: 2px solid white;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  @media (max-width: 768px) {
    padding: 1.5rem;
    
    .role-selector {
      flex-direction: column;
    }
    
    .form-actions {
      flex-direction: column;
    }
  }
}

.error-message {
  color: var(--danger);
  font-size: 0.8rem;
  margin-top: 0.25rem;
  min-height: 1rem;
}
.admin-form-container {
  max-width: 1200px;
  margin: 2rem auto;
  padding: 0 1rem;
}

.card-header {
  padding: 1.5rem;
  border-bottom: 1px solid var(--surface-border);

  h2 {
    margin: 0;
    color: var(--text-color);
    font-size: 1.5rem;
    font-weight: 600;
  }
}

.form-section {
  margin-bottom: 2rem;
  padding: 1.5rem;
  background: var(--surface-ground);
  border-radius: 8px;

  .section-title {
    margin: 0 0 1.5rem 0;
    color: var(--primary-color);
    font-size: 1.1rem;
    font-weight: 600;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--primary-color);
  }
}

.p-field {
  label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: var(--text-color);
  }

  .p-info {
    display: block;
    margin-top: 0.25rem;
    color: var(--primary-color);
    font-size: 0.875rem;
  }
}

.hierarchy-display {
  margin-top: 1rem;
  padding: 1rem;
  background: var(--surface-card);
  border-radius: 6px;
}

.form-actions {
  display: flex;
  justify-content: flex-end;
  gap: 1rem;
  margin-top: 2rem;
  padding-top: 1.5rem;
  border-top: 1px solid var(--surface-border);
}

.setup-link-section {
  margin-top: 2rem;
  padding: 1.5rem;
  background: var(--green-50);
  border-radius: 8px;

  .setup-link-card {
    margin-top: 1rem;
    padding: 1rem;
    background: white;
    border-radius: 6px;
    border: 1px solid var(--green-200);

    h4 {
      margin: 0 0 0.5rem 0;
      color: var(--green-700);
    }

    .info-text {
      margin: 0.5rem 0;
      color: var(--text-color-secondary);
    }

    .link-display {
      display: flex;
      gap: 0.5rem;
      margin: 1rem 0;

      .setup-link-input {
        flex: 1;
        font-family: monospace;
        font-size: 0.875rem;
        background: var(--surface-ground);
      }
    }

    .warning-text {
      display: block;
      margin-top: 0.5rem;
      color: var(--orange-600);
      font-weight: 500;
    }
  }
}

@media (max-width: 768px) {
  .form-actions {
    flex-direction: column;
    
    p-button {
      width: 100%;
    }
  }

  .link-display {
    flex-direction: column !important;
    
    p-button {
      width: 100%;
    }
  }
}
// âœ… Add to existing SCSS

.p-help {
  display: block;
  margin-top: 0.25rem;
  color: #6c757d;
  font-size: 0.875rem;
  
  i {
    margin-right: 0.25rem;
  }
}

// Dev-only section styling
.dev-only {
  position: relative;
  border: 2px dashed #ff9800;
  background: #fff3e0;
  
  .dev-badge {
    position: absolute;
    top: -12px;
    right: 20px;
    background: #ff9800;
    color: white;
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 4px;
  }
}

.production-message {
  background: #f0f9ff;
  border: 1px solid #3b82f6;
  border-radius: 8px;
  padding: 1.5rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  margin-top: 1rem;
  
  i {
    font-size: 3rem;
    color: #10b981;
    margin-bottom: 1rem;
  }
  
  p {
    margin: 0.5rem 0;
    font-size: 1rem;
    color: #1e293b;
  }
  
  small {
    color: #64748b;
    font-size: 0.875rem;
  }
}

// Enhanced validation error styling
.p-error {
  animation: shake 0.3s ease-in-out;
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  75% { transform: translateX(5px); }
}
</file>

<file path="src/app/features/user-management/components/admins/admin-form/admin-rbac-form.component.ts">
import { Component, OnInit, signal } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormBuilder, FormGroup, Validators, ReactiveFormsModule, FormsModule } from '@angular/forms';
import { ActivatedRoute, Router } from '@angular/router';
import { MessageService } from 'primeng/api';
import { ButtonModule } from 'primeng/button';
import { CardModule } from 'primeng/card';
import { InputTextModule } from 'primeng/inputtext';
import { SelectModule } from 'primeng/select';
import { MessageModule } from 'primeng/message';
import { TagModule } from 'primeng/tag';
import { ToastModule } from 'primeng/toast';
import { CreateAdminArgs } from '../../interfaces/userinterface';
import { Id } from 'convex/_generated/dataModel';
import { UserService } from '@/features/user-management/user.service';

@Component({
  selector: 'app-admin-rbac-form',
  standalone: true,
  imports: [
    CommonModule,
    ReactiveFormsModule,
    FormsModule,
    ButtonModule,
    CardModule,
    InputTextModule,
    SelectModule,
    MessageModule,
    TagModule,
    ToastModule,
  ],
  providers: [MessageService],
  templateUrl: './admin-rbac-form.component.html',
  styleUrls: ['./admin-rbac-form.component.scss'],
})
export class AdminRbacFormComponent implements OnInit {
  adminForm!: FormGroup;
  isEditMode = false;
  isSubmitting = false;
  setupLink = '';
  adminId: Id<'admin_users'> | null = null;
  formError = signal<string | null>(null);

  // Configuration
  private readonly ROLE_HIERARCHY_REQUIREMENTS = {
    12: { zone: true, district: false, subdistrict: false, localBody: false, ward: false },
    11: { zone: true, district: false, subdistrict: false, localBody: false, ward: false },
    10: { zone: true, district: false, subdistrict: false, localBody: false, ward: false },
    8:  { zone: true, district: false, subdistrict: false, localBody: false, ward: false },
    6:  { zone: true, district: true, subdistrict: false, localBody: false, ward: false },
    4:  { zone: true, district: true, subdistrict: true, localBody: false, ward: false },
    2:  { zone: true, district: true, subdistrict: true, localBody: true, ward: true },
  } as const;

  private readonly ROLE_NAMES = {
    12: 'Super Admin',
    11: 'National Head',
    10: 'State Head',
    8: 'Zonal Manager',
    6: 'District Manager',
    4: 'Subdistrict Coordinator',
    2: 'Ward Coordinator',
  } as const;

  roleLevelOptions = [
    { label: '12 - Super Admin', value: 12 },
    { label: '11 - National Head', value: 11 },
    { label: '10 - State Head', value: 10 },
    { label: '8 - Zonal Manager', value: 8 },
    { label: '6 - District Manager', value: 6 },
    { label: '4 - Subdistrict Coordinator', value: 4 },
    { label: '2 - Ward Coordinator', value: 2 },
  ];

  // Signals
  currentRoleLevel = signal<number | null>(null);
  showZoneDropdown = signal(false);
  showDistrictDropdown = signal(false);
  showSubdistrictDropdown = signal(false);
  showLocalBodyDropdown = signal(false);
  showWardDropdown = signal(false);

  zones = signal<Array<{ value: string; label: string }>>([]);
  districts = signal<Array<{ value: string; label: string }>>([]);
  subdistricts = signal<Array<{ value: string; label: string }>>([]);
  localBodies = signal<Array<{ value: string; label: string }>>([]);
  wards = signal<Array<{ value: string; label: string }>>([]);
  managers = signal<Array<any>>([]);

  selectedZone = signal<string | null>(null);
  selectedDistrict = signal<string | null>(null);
  selectedSubdistrict = signal<string | null>(null);
  selectedLocalBody = signal<string | null>(null);
  selectedWard = signal<string | null>(null);
  selectedHierarchyPath = signal<string>('');

  constructor(
    private fb: FormBuilder,
    private userService: UserService,
    private messageService: MessageService,
    private route: ActivatedRoute,
    private router: Router
  ) {}

  async ngOnInit(): Promise<void> {
    this.initializeForm();
    await this.loadHierarchyData();
    
    // Check if edit mode
    this.route.params.subscribe(async params => {
      if (params['id']) {
        this.isEditMode = true;
        this.adminId = params['id'] as Id<'admin_users'>;
        await this.loadAdminData(this.adminId);
      }
    });
  }

  private initializeForm(): void {
    this.adminForm = this.fb.group({
      name: ['', [Validators.required, Validators.minLength(3)]],
      email: ['', [Validators.required, Validators.email]],
      phone: [''],
      roleLevel: [null, Validators.required],
      managerId: [null],
    });

    // âœ… Disable email in edit mode (will be set after loading data)
    if (this.isEditMode) {
      this.adminForm.get('email')?.disable();
    }
  }

  private async loadHierarchyData(): Promise<void> {
    try {
      const zonesData = await this.userService.getZones();
      this.zones.set(zonesData);
    } catch (error) {
      console.error('Failed to load hierarchy data:', error);
      this.showError('Error', 'Failed to load hierarchy data');
    }
  }

  // âœ… Load admin data for editing
  private async loadAdminData(adminId: Id<'admin_users'>): Promise<void> {
    try {
      const admin = await this.userService.getAdminUserForEdit(adminId);
      
      // Populate form
      this.adminForm.patchValue({
        name: admin.name,
        email: admin.email,
        phone: admin.phone || '',
        roleLevel: admin.roleLevel,
        managerId: admin.managerId || null,
      });

      // Set role level and update dropdowns
      this.currentRoleLevel.set(admin.roleLevel);
      this.updateDropdownVisibility(admin.roleLevel);

      // âœ… Load geographic data if present
      if (admin.zone) {
        this.selectedZone.set(admin.zone);
        await this.loadDistrictsForZone(admin.zone);
      }

      if (admin.district) {
        this.selectedDistrict.set(admin.district);
        await this.loadSubdistrictsForDistrict(admin.zone!, admin.district);
      }

      if (admin.subdistrict) {
        this.selectedSubdistrict.set(admin.subdistrict);
        await this.loadLocalBodiesForSubdistrict(admin.zone!, admin.district!, admin.subdistrict);
      }

      if (admin.localBody) {
        this.selectedLocalBody.set(admin.localBody);
        await this.loadWardsForLocalBody(admin.zone!, admin.district!, admin.subdistrict!, admin.localBody);
      }

      if (admin.ward) {
        this.selectedWard.set(admin.ward);
      }

      this.updateHierarchyPath();

      console.log('âœ… Admin data loaded for editing:', admin);
    } catch (error: any) {
      console.error('âŒ Failed to load admin data:', error);
      this.showError('Error', error.message || 'Failed to load admin data');
      this.router.navigate(['/user-management/admins']);
    }
  }

  // âœ… Helper methods to load cascading data
  private async loadDistrictsForZone(zone: string): Promise<void> {
    const data = await this.userService.getDistricts(zone);
    this.districts.set(data);
  }

  private async loadSubdistrictsForDistrict(zone: string, district: string): Promise<void> {
    const data = await this.userService.getSubdistricts(zone, district);
    this.subdistricts.set(data);
  }

private async loadLocalBodiesForSubdistrict(zone: string, district: string, subdistrict: string): Promise<void> {
  const data = await this.userService.getLocalBodies({
    zone,
    district,
    subdistrict
  });
  this.localBodies.set(data);
}
private async loadWardsForLocalBody(zone: string, district: string, subdistrict: string, localBody: string): Promise<void> {
  const data = await this.userService.getWards({
    zone,
    district,
    subdistrict,
    localBodyName: localBody
  });
  this.wards.set(data);
}


  onRoleLevelChange(event: any): void {
    const roleLevel = event.value;
    this.currentRoleLevel.set(roleLevel);
    
    // âœ… Only reset hierarchy in create mode
    if (!this.isEditMode) {
      this.resetHierarchyFields();
    }
    
    this.updateDropdownVisibility(roleLevel);
  }

  private updateDropdownVisibility(roleLevel: number): void {
    const requirements = this.ROLE_HIERARCHY_REQUIREMENTS[roleLevel as keyof typeof this.ROLE_HIERARCHY_REQUIREMENTS] || {
      zone: false, district: false, subdistrict: false, localBody: false, ward: false
    };

    this.showZoneDropdown.set(requirements.zone);
    this.showDistrictDropdown.set(requirements.district);
    this.showSubdistrictDropdown.set(requirements.subdistrict);
    this.showLocalBodyDropdown.set(requirements.localBody);
    this.showWardDropdown.set(requirements.ward);
  }

  async onZoneChange(zone: string): Promise<void> {
    this.selectedZone.set(zone);
    this.selectedDistrict.set(null);
    this.selectedSubdistrict.set(null);
    this.selectedLocalBody.set(null);
    this.selectedWard.set(null);
    
    if (zone) {
      const data = await this.userService.getDistricts(zone);
      this.districts.set(data);
    }
    
    this.updateHierarchyPath();
  }

  async onDistrictChange(district: string): Promise<void> {
    this.selectedDistrict.set(district);
    this.selectedSubdistrict.set(null);
    this.selectedLocalBody.set(null);
    this.selectedWard.set(null);
    
    if (district && this.selectedZone()) {
      const data = await this.userService.getSubdistricts(this.selectedZone()!, district);
      this.subdistricts.set(data);
    }
    
    this.updateHierarchyPath();
  }

async onSubdistrictChange(subdistrict: string): Promise<void> {
  this.selectedSubdistrict.set(subdistrict);
  this.selectedLocalBody.set(null);
  this.selectedWard.set(null);
  
  if (subdistrict && this.selectedZone() && this.selectedDistrict()) {
    const data = await this.userService.getLocalBodies({
      zone: this.selectedZone()!,
      district: this.selectedDistrict()!,
      subdistrict: subdistrict
    });
    this.localBodies.set(data);
  }
  
  this.updateHierarchyPath();
}
async onLocalBodyChange(localBody: string): Promise<void> {
  this.selectedLocalBody.set(localBody);
  this.selectedWard.set(null);
  
  if (localBody && this.selectedZone() && this.selectedDistrict() && this.selectedSubdistrict()) {
    const data = await this.userService.getWards({
      zone: this.selectedZone()!,
      district: this.selectedDistrict()!,
      subdistrict: this.selectedSubdistrict()!,
      localBodyName: localBody
    });
    this.wards.set(data);
  }
  
  this.updateHierarchyPath();
}
  onWardChange(ward: string): void {
    this.selectedWard.set(ward);
    this.updateHierarchyPath();
  }

  private updateHierarchyPath(): void {
    const parts = [
      this.selectedZone(),
      this.selectedDistrict(),
      this.selectedSubdistrict(),
      this.selectedLocalBody(),
      this.selectedWard(),
    ].filter(Boolean);
    
    this.selectedHierarchyPath.set(parts.join(' > '));
  }

  private resetHierarchyFields(): void {
    this.selectedZone.set(null);
    this.selectedDistrict.set(null);
    this.selectedSubdistrict.set(null);
    this.selectedLocalBody.set(null);
    this.selectedWard.set(null);
    this.selectedHierarchyPath.set('');
    this.districts.set([]);
    this.subdistricts.set([]);
    this.localBodies.set([]);
    this.wards.set([]);
  }

  private validateHierarchySelection(): { valid: boolean; message: string } {
    const roleLevel = this.adminForm.value.roleLevel;
    const requirements = this.ROLE_HIERARCHY_REQUIREMENTS[roleLevel as keyof typeof this.ROLE_HIERARCHY_REQUIREMENTS];
    
    if (!requirements) {
      return { valid: true, message: '' };
    }

    const selections = {
      zone: this.selectedZone(),
      district: this.selectedDistrict(),
      subdistrict: this.selectedSubdistrict(),
      localBody: this.selectedLocalBody(),
      ward: this.selectedWard(),
    };

    const missingFields = Object.entries(requirements)
      .filter(([field, required]) => required && !selections[field as keyof typeof selections])
      .map(([field]) => field.charAt(0).toUpperCase() + field.slice(1));

    if (missingFields.length > 0) {
      const roleName = this.ROLE_NAMES[roleLevel as keyof typeof this.ROLE_NAMES] || 'this role';
      const fieldList = missingFields.join(', ');
      return { 
        valid: false, 
        message: `${roleName} requires: ${fieldList}` 
      };
    }

    return { valid: true, message: '' };
  }

  async onSubmit(): Promise<void> {
    console.log('submit called');
    
    if (this.adminForm.invalid) {
      this.markFormGroupTouched(this.adminForm);
      this.showError('Form Invalid', 'Please fill all required fields');
      return;
    }

    const hierarchyValidation = this.validateHierarchySelection();
    if (!hierarchyValidation.valid) {
      this.showWarning('Hierarchy Required', hierarchyValidation.message);
      return;
    }

    this.isSubmitting = true;
    this.setupLink = '';
    this.formError.set(null);

    try {
      if (this.isEditMode && this.adminId) {
        // âœ… UPDATE MODE
        await this.updateAdmin();
      } else {
        // âœ… CREATE MODE
        await this.createAdmin();
      }
    } catch (error: any) {
      console.error('âŒ Error:', error);
      this.handleSubmitError(error);
    } finally {
      this.isSubmitting = false;
    }
  }

  private async createAdmin(): Promise<void> {
    const formData: CreateAdminArgs = {
      name: this.adminForm.value.name,
      email: this.adminForm.value.email,
      phone: this.adminForm.value.phone || undefined,
      roleLevel: this.adminForm.value.roleLevel,
      managerId: this.adminForm.value.managerId || undefined,
      zone: this.selectedZone() || undefined,
      district: this.selectedDistrict() || undefined,
      subdistrict: this.selectedSubdistrict() || undefined,
      localBody: this.selectedLocalBody() || undefined,
      ward: this.selectedWard() || undefined,
    };

    console.log('ðŸš€ Creating admin:', formData);

    const result = await this.userService.createAdminUser(formData);

    if (result.success && result.setupLink) {
      this.setupLink = result.setupLink;
      this.showSuccess('Success', 'Admin account created successfully!');
      this.adminForm.reset();
      this.resetHierarchyFields();
    }
  }

  private async updateAdmin(): Promise<void> {
    const updateData: any = {
      userId: this.adminId!,
      name: this.adminForm.value.name,
      phone: this.adminForm.value.phone || undefined,
      roleLevel: this.adminForm.value.roleLevel,
      zone: this.selectedZone() || undefined,
      district: this.selectedDistrict() || undefined,
      subdistrict: this.selectedSubdistrict() || undefined,
      localBody: this.selectedLocalBody() || undefined,
      ward: this.selectedWard() || undefined,
    };

    console.log('ðŸš€ Updating admin:', updateData);

    const result = await this.userService.updateAdminUser(updateData);

    if (result.success) {
      this.showSuccess('Success', 'Admin account updated successfully!');
      this.router.navigate(['/user-management/admins']);
    }
  }

  private handleSubmitError(error: any): void {
    const errorPatterns = {
      email: { summary: 'Duplicate Email', detail: 'An admin with this email address already exists' },
      phone: { summary: 'Duplicate Phone', detail: 'An admin with this phone number already exists' },
    };

    const errorMessage = error.message?.toLowerCase() || '';
    const matchedError = Object.entries(errorPatterns).find(([key]) => 
      errorMessage.includes(key)
    );

    if (matchedError) {
      const [, { summary, detail }] = matchedError;
      this.showError(summary, detail);
    } else {
      this.showError('Error', error.message || 'Failed to process request');
    }
  }

  private showError(summary: string, detail: string, life = 6000): void {
    this.messageService.add({ severity: 'error', summary, detail, life });
    this.formError.set(detail);
  }

  private showWarning(summary: string, detail: string, life = 5000): void {
    this.messageService.add({ severity: 'warn', summary, detail, life });
  }

  private showSuccess(summary: string, detail: string, life = 5000): void {
    this.messageService.add({ severity: 'success', summary, detail, life });
  }

  getRequiredFieldsHint(): string {
    const roleLevel = this.currentRoleLevel();
    if (!roleLevel) return '';
    
    const requirements = this.ROLE_HIERARCHY_REQUIREMENTS[roleLevel as keyof typeof this.ROLE_HIERARCHY_REQUIREMENTS];
    if (!requirements) return '';
    
    const requiredFields = Object.entries(requirements)
      .filter(([_, required]) => required)
      .map(([field]) => field.charAt(0).toUpperCase() + field.slice(1));
    
    if (requiredFields.length === 0) return '';
    
    return `Required: ${requiredFields.join(', ')}`;
  }

  isFieldRequired(field: 'zone' | 'district' | 'subdistrict' | 'localBody' | 'ward'): boolean {
    const roleLevel = this.currentRoleLevel();
    if (!roleLevel) return false;
    
    const requirements = this.ROLE_HIERARCHY_REQUIREMENTS[roleLevel as keyof typeof this.ROLE_HIERARCHY_REQUIREMENTS];
    return requirements?.[field] || false;
  }

  isFieldInvalid(fieldName: string): boolean {
    const field = this.adminForm.get(fieldName);
    return !!(field && field.invalid && (field.dirty || field.touched));
  }

  private markFormGroupTouched(formGroup: FormGroup): void {
    Object.keys(formGroup.controls).forEach((key) => {
      const control = formGroup.get(key);
      control?.markAsTouched();
      if (control instanceof FormGroup) {
        this.markFormGroupTouched(control);
      }
    });
  }

  copySetupLink(input: HTMLInputElement): void {
    input.select();
    document.execCommand('copy');
    this.messageService.add({
      severity: 'success',
      summary: 'Copied',
      detail: 'Setup link copied to clipboard',
      life: 3000,
    });
  }

  onCancel(): void {
    if (this.isEditMode) {
      this.router.navigate(['/user-management/admins']);
    } else {
      this.adminForm.reset();
      this.resetHierarchyFields();
      this.setupLink = '';
    }
  }
}
</file>

<file path="src/app/features/user-management/components/admins/admin-list/admin-list.component.html">
<div class="admin-list-container">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <div class="title-section">
        <h1 class="page-title">
          <i class="pi pi-users"></i>
          Admin Management
        </h1>
        <p class="page-subtitle">
          Manage and monitor {{ totalRecords() }} administrators across your organization
        </p>
      </div>
      <button
        pButton
        type="button"
        label="Add New Admin"
        icon="pi pi-user-plus"
        class="create-btn"
        (click)="navigateToCreateAdmin()"
      ></button>
    </div>
  </div>

  <!-- Filters Section -->
  <div class="filters-card">
    <div class="filters-header">
      <h3 class="filters-title">
        <i class="pi pi-filter"></i>
        Filters
      </h3>
      <button
        pButton
        type="button"
        label="Clear All"
        icon="pi pi-times"
        class="p-button-text p-button-sm clear-btn"
        (click)="clearFilters()"
        [disabled]="!searchQuery() && selectedRoleLevel() === null && selectedStatus() === null"
      ></button>
    </div>

    <div class="filters-grid">
      <!-- Search by Name -->
      <div class="filter-item">
        <label class="filter-label">Search by Name</label>
        <p-iconfield iconPosition="left">
          <p-inputicon styleClass="pi pi-search" />
          <input
            pInputText
            type="text"
            placeholder="Search by admin name..."
            class="search-input"
            [value]="searchQuery()"
            (input)="onSearch($event)"
          />
        </p-iconfield>
      </div>

      <!-- Role Level Filter -->
      <div class="filter-item">
        <label class="filter-label">Role Level</label>
        <p-select
          [options]="roleOptions"
          [(ngModel)]="selectedRoleLevel"
          (onChange)="onRoleFilter($event.value)"
          placeholder="All Roles"
          [showClear]="true"
          optionLabel="label"
          optionValue="value"
          class="filter-dropdown"
        />
      </div>

      <!-- Status Filter -->
      <div class="filter-item">
        <label class="filter-label">Status</label>
        <p-select
          [options]="statusOptions"
          [(ngModel)]="selectedStatus"
          (onChange)="onStatusFilter($event.value)"
          placeholder="All Status"
          optionLabel="label"
          optionValue="value"
          class="filter-dropdown"
        />
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading() && admins().length === 0" class="loading-state">
    <div class="loading-card">
      <i class="pi pi-spin pi-spinner loading-icon"></i>
      <p class="loading-text">Loading administrators...</p>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="errorMessage() && !isLoading()" class="error-state">
    <div class="error-card">
      <i class="pi pi-exclamation-circle error-icon"></i>
      <h3 class="error-title">Failed to Load Data</h3>
      <p class="error-message">{{ errorMessage() }}</p>
      <button
        pButton
        type="button"
        label="Retry"
        icon="pi pi-refresh"
        class="p-button-outlined"
        (click)="loadAdmins()"
      ></button>
    </div>
  </div>

  <!-- Data Table -->
  <div *ngIf="!isLoading() || admins().length > 0" class="table-card">
    <p-table
      [value]="displayedAdmins()"
      [paginator]="true"
      [rows]="10"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} admins"
      [rowsPerPageOptions]="[10, 25, 50]"
      [globalFilterFields]="['name', 'email', 'roleName']"
      styleClass="p-datatable-gridlines p-datatable-striped"
      responsiveLayout="scroll"
    >
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="name">
            Name
            <p-sortIcon field="name" />
          </th>
          <th pSortableColumn="email">
            Email
            <p-sortIcon field="email" />
          </th>
          <th>Phone</th>
          <th pSortableColumn="roleLevel">
            Role
            <p-sortIcon field="roleLevel" />
          </th>
          <th pSortableColumn="hierarchyPath">
            Hierarchy
            <p-sortIcon field="hierarchyPath" />
          </th>
          <th pSortableColumn="isActive">
            Status
            <p-sortIcon field="isActive" />
          </th>
          <th pSortableColumn="lastLogin">
            Last Login
            <p-sortIcon field="lastLogin" />
          </th>
          <th class="actions-column">Actions</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-admin>
        <tr>
          <!-- Name -->
          <td>
            <div class="admin-name-cell">
              <i class="pi pi-user user-icon"></i>
              <span class="admin-name">{{ admin.name }}</span>
            </div>
          </td>

          <!-- Email -->
          <td>
            <a [href]="'mailto:' + admin.email" class="email-link">
              {{ admin.email }}
            </a>
          </td>

          <!-- Phone -->
          <td>
            <span *ngIf="admin.phone" class="phone-number">
              {{ admin.phone }}
            </span>
            <span *ngIf="!admin.phone" class="text-muted">-</span>
          </td>

          <!-- Role -->
          <td>
            <span
              class="role-badge"
              [ngClass]="getRoleBadgeClass(admin.roleLevel)"
              [pTooltip]="'Level ' + admin.roleLevel"
            >
              {{ admin.roleName }}
            </span>
          </td>

          <!-- Hierarchy -->
          <td>
            <div class="hierarchy-cell">
              <i class="pi pi-sitemap hierarchy-icon"></i>
              <span class="hierarchy-path">{{ admin.hierarchyPath }}</span>
            </div>
          </td>

          <!-- Status -->
          <td>
            <p-tag
              [value]="admin.isActive ? 'Active' : 'Inactive'"
              [severity]="getStatusSeverity(admin.isActive)"
            />
          </td>

          <!-- Last Login -->
          <td>
            <span class="last-login">{{ formatLastLogin(admin.lastLogin) }}</span>
          </td>

          <!-- Actions -->
          <td class="actions-cell">
            <div class="action-buttons">
              <button
                pButton
                type="button"
                icon="pi pi-eye"
                class="p-button-rounded p-button-text p-button-sm action-btn view-btn"
                pTooltip="View Details"
                tooltipPosition="top"
                (click)="viewAdmin(admin)"
              ></button>
              <button
                pButton
                type="button"
                icon="pi pi-pencil"
                class="p-button-rounded p-button-text p-button-sm action-btn edit-btn"
                pTooltip="Edit Admin"
                tooltipPosition="top"
                (click)="editAdmin(admin)"
              ></button>
              <button
                pButton
                type="button"
                icon="pi pi-trash"
                class="p-button-rounded p-button-text p-button-sm action-btn delete-btn"
                pTooltip="Delete Admin"
                tooltipPosition="top"
                (click)="deleteAdmin(admin)"
              ></button>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="8">
            <div class="empty-state">
              <i class="pi pi-users empty-icon"></i>
              <h3 class="empty-title">No Administrators Found</h3>
              <p class="empty-message">
                <span *ngIf="searchQuery() || selectedRoleLevel() !== null || selectedStatus() !== null">
                  No results match your filters. Try adjusting your search criteria.
                </span>
                <span *ngIf="!searchQuery() && selectedRoleLevel() === null && selectedStatus() === null">
                  Get started by creating your first administrator.
                </span>
              </p>
              <button
                *ngIf="!searchQuery() && selectedRoleLevel() === null && selectedStatus() === null"
                pButton
                type="button"
                label="Create Admin"
                icon="pi pi-plus"
                class="p-button-outlined"
                (click)="navigateToCreateAdmin()"
              ></button>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
<app-view-user-drawer 
  [userId]="selectedAdminId()"
  [userType]="selectedUserType()"
  [visible]="drawerVisible()"
  (onClose)="closeDrawer()"
></app-view-user-drawer>

    <!-- Load More Button -->
    <div *ngIf="hasMore() && displayedAdmins().length > 0" class="load-more-section">
      <button
        pButton
        type="button"
        label="Load More"
        icon="pi pi-angle-down"
        class="p-button-outlined load-more-btn"
        [loading]="isLoading()"
        (click)="loadMore()"
      ></button>
    </div>
  </div>

  <!-- Toast Messages -->
  <p-toast />
</div>
</file>

<file path="src/app/features/user-management/components/admins/admin-list/admin-list.component.scss">
// ============================================================================
// ENTERPRISE BLUE COLOR PALETTE
// ============================================================================
$primary-blue: #1e40af; // Enterprise blue
$primary-blue-light: #3b82f6;
$primary-blue-dark: #1e3a8a;
$success-green: #10b981;
$danger-red: #ef4444;
$warning-orange: #f59e0b;
$neutral-50: #f9fafb;
$neutral-100: #f3f4f6;
$neutral-200: #e5e7eb;
$neutral-300: #d1d5db;
$neutral-500: #6b7280;
$neutral-700: #374151;
$neutral-900: #111827;

// ============================================================================
// CONTAINER
// ============================================================================
.admin-list-container {
  padding: 2rem;
  background: $neutral-50;
  min-height: 100vh;
  
  @media (max-width: 768px) {
    padding: 1rem;
  }
}

// ============================================================================
// PAGE HEADER
// ============================================================================
.page-header {
  margin-bottom: 2rem;

  .header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: white;
    padding: 1.5rem 2rem;
    border-radius: 12px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    border-left: 4px solid $primary-blue;

    @media (max-width: 768px) {
      flex-direction: column;
      gap: 1rem;
      align-items: flex-start;
    }
  }

  .title-section {
    .page-title {
      margin: 0 0 0.5rem 0;
      font-size: 1.75rem;
      font-weight: 700;
      color: $neutral-900;
      display: flex;
      align-items: center;
      gap: 0.75rem;

      i {
        color: $primary-blue;
        font-size: 1.5rem;
      }
    }

    .page-subtitle {
      margin: 0;
      font-size: 0.95rem;
      color: $neutral-500;
      font-weight: 400;
    }
  }

  .create-btn {
    background: $primary-blue;
    border-color: $primary-blue;
    font-weight: 600;
    padding: 0.75rem 1.5rem;
    transition: all 0.3s ease;

    &:hover {
      background: $primary-blue-dark;
      border-color: $primary-blue-dark;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(30, 64, 175, 0.3);
    }

    @media (max-width: 768px) {
      width: 100%;
    }
  }
}

// ============================================================================
// FILTERS CARD
// ============================================================================
.filters-card {
  background: white;
  padding: 1.5rem;
  border-radius: 12px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  margin-bottom: 1.5rem;

  .filters-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.25rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid $neutral-100;

    .filters-title {
      margin: 0;
      font-size: 1.1rem;
      font-weight: 600;
      color: $neutral-900;
      display: flex;
      align-items: center;
      gap: 0.5rem;

      i {
        color: $primary-blue;
      }
    }

    .clear-btn {
      color: $danger-red;
      font-weight: 500;

      &:hover:enabled {
        background: rgba(239, 68, 68, 0.1);
      }

      &:disabled {
        opacity: 0.4;
      }
    }
  }

  .filters-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;

    @media (max-width: 768px) {
      grid-template-columns: 1fr;
    }
  }

  .filter-item {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;

    .filter-label {
      font-size: 0.9rem;
      font-weight: 600;
      color: $neutral-700;
      margin-bottom: 0.25rem;
    }

    ::ng-deep {
      .search-input,
      .filter-dropdown {
        width: 100%;
        border: 1px solid $neutral-300;
        border-radius: 8px;
        transition: all 0.2s ease;

        &:hover {
          border-color: $primary-blue-light;
        }

        &:focus {
          border-color: $primary-blue;
          box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
        }
      }

      .p-iconfield {
        width: 100%;

        .p-inputicon {
          color: $neutral-500;
        }
      }
    }
  }
}

// ============================================================================
// LOADING STATE
// ============================================================================
.loading-state {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 400px;

  .loading-card {
    text-align: center;
    background: white;
    padding: 3rem 4rem;
    border-radius: 12px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);

    .loading-icon {
      font-size: 3rem;
      color: $primary-blue;
      margin-bottom: 1rem;
    }

    .loading-text {
      margin: 0;
      font-size: 1.1rem;
      color: $neutral-500;
      font-weight: 500;
    }
  }
}

// ============================================================================
// ERROR STATE
// ============================================================================
.error-state {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 400px;

  .error-card {
    text-align: center;
    background: white;
    padding: 3rem 4rem;
    border-radius: 12px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    border: 2px solid rgba(239, 68, 68, 0.2);

    .error-icon {
      font-size: 3rem;
      color: $danger-red;
      margin-bottom: 1rem;
    }

    .error-title {
      margin: 0 0 0.5rem 0;
      font-size: 1.5rem;
      font-weight: 700;
      color: $neutral-900;
    }

    .error-message {
      margin: 0 0 1.5rem 0;
      font-size: 1rem;
      color: $neutral-500;
    }
  }
}

// ============================================================================
// TABLE CARD
// ============================================================================
.table-card {
  background: white;
  border-radius: 12px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  overflow: hidden;

  ::ng-deep {
    // Table header styling
    .p-datatable .p-datatable-thead > tr > th {
      background: linear-gradient(135deg, $primary-blue-dark 0%, $primary-blue 100%);
      color: white;
      font-weight: 600;
      padding: 1rem;
      border: none;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;

      .p-sortable-column-icon {
        color: white;
      }
    }

    // Table body styling
    .p-datatable .p-datatable-tbody > tr {
      transition: all 0.2s ease;

      &:hover {
        background: rgba(30, 64, 175, 0.05);
      }

      > td {
        padding: 1rem;
        color: $neutral-700;
        font-size: 0.95rem;
        border-bottom: 1px solid $neutral-100;
      }
    }

    // Pagination styling
    .p-paginator {
      background: $neutral-50;
      border-top: 2px solid $neutral-100;
      padding: 1rem;

      .p-paginator-current {
        color: $neutral-700;
        font-weight: 500;
      }

      .p-paginator-pages .p-paginator-page {
        min-width: 2.5rem;
        height: 2.5rem;
        color: $neutral-700;
        border-radius: 8px;

        &.p-highlight {
          background: $primary-blue;
          color: white;
        }

        &:not(.p-highlight):hover {
          background: rgba(30, 64, 175, 0.1);
        }
      }
    }
  }

  // Custom cell styles
  .admin-name-cell {
    display: flex;
    align-items: center;
    gap: 0.75rem;

    .user-icon {
      color: $primary-blue;
      font-size: 1.1rem;
    }

    .admin-name {
      font-weight: 600;
      color: $neutral-900;
    }
  }

  .email-link {
    color: $primary-blue;
    text-decoration: none;
    transition: color 0.2s ease;

    &:hover {
      color: $primary-blue-dark;
      text-decoration: underline;
    }
  }

  .phone-number {
    color: $neutral-700;
    font-family: 'Courier New', monospace;
  }

  .text-muted {
    color: $neutral-300;
  }

  .role-badge {
    display: inline-block;
    padding: 0.4rem 0.9rem;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.3px;

    &.badge-super-admin {
      background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(220, 38, 38, 0.3);
    }

    &.badge-state {
      background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(124, 58, 237, 0.3);
    }

    &.badge-zonal {
      background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(37, 99, 235, 0.3);
    }

    &.badge-district {
      background: linear-gradient(135deg, #0891b2 0%, #0e7490 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(8, 145, 178, 0.3);
    }

    &.badge-coordinator {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
    }
  }

  .hierarchy-cell {
    display: flex;
    align-items: center;
    gap: 0.5rem;

    .hierarchy-icon {
      
      font-size: 0.9rem;
    }

    .hierarchy-path {
      font-size: 0.9rem;
    }
  }

  .last-login {
    font-size: 0.9rem;
  }

  // Actions column
  .actions-column {
    width: 150px;
    text-align: center;
  }

  .actions-cell {
    .action-buttons {
      display: flex;
      justify-content: center;
      gap: 0.25rem;

      .action-btn {
        transition: all 0.2s ease;

        &.view-btn {
          color: $primary-blue;

          &:hover {
            background: rgba(30, 64, 175, 0.1);
          }
        }

        &.edit-btn {
          color: $warning-orange;

          &:hover {
            background: rgba(245, 158, 11, 0.1);
          }
        }

        &.delete-btn {
          color: $danger-red;

          &:hover {
            background: rgba(239, 68, 68, 0.1);
          }
        }
      }
    }
  }

  // Empty state
  .empty-state {
    text-align: center;
    padding: 4rem 2rem;

    .empty-icon {
      font-size: 4rem;
      color: $neutral-300;
      margin-bottom: 1rem;
    }

    .empty-title {
      margin: 0 0 0.5rem 0;
      font-size: 1.5rem;
      font-weight: 700;
      color: $neutral-900;
    }

    .empty-message {
      margin: 0 0 1.5rem 0;
      font-size: 1rem;
      color: $neutral-500;
    }
  }
}

// ============================================================================
// LOAD MORE SECTION
// ============================================================================
.load-more-section {
  display: flex;
  justify-content: center;
  padding: 1.5rem;
  background: $neutral-50;

  .load-more-btn {
    min-width: 200px;
    border-color: $primary-blue;
    color: $primary-blue;
    font-weight: 600;

    &:hover:enabled {
      background: rgba(30, 64, 175, 0.1);
      border-color: $primary-blue-dark;
      color: $primary-blue-dark;
    }
  }
}

// ============================================================================
// RESPONSIVE DESIGN
// ============================================================================
@media (max-width: 1024px) {
  .table-card ::ng-deep {
    .p-datatable-thead > tr > th {
      padding: 0.75rem 0.5rem;
      font-size: 0.85rem;
    }

    .p-datatable-tbody > tr > td {
      padding: 0.75rem 0.5rem;
      font-size: 0.9rem;
    }
  }
}

@media (max-width: 768px) {
  .admin-list-container {
    padding: 1rem;
  }

  .page-header .header-content {
    padding: 1rem;
  }

  .filters-card {
    padding: 1rem;
  }

  .table-card ::ng-deep {
    .p-datatable {
      font-size: 0.85rem;
    }

    .p-paginator {
      padding: 0.75rem;
      font-size: 0.85rem;
    }
  }

  .actions-cell .action-buttons {
    flex-direction: column;
    gap: 0.5rem;
  }
}

// ============================================================================
// PRIMENG OVERRIDES (COMPLEMENT, NOT OVERRIDE)
// ============================================================================
::ng-deep {
  // Button focus states
  .p-button:focus {
    box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.2);
  }

  // Tag styling
  .p-tag {
    padding: 0.4rem 0.75rem;
    border-radius: 20px;
    font-weight: 600;
    font-size: 0.85rem;
  }

  // Tooltip styling
  .p-tooltip {
    background: $neutral-900;
    color: white;
    font-size: 0.85rem;
    padding: 0.5rem 0.75rem;
    border-radius: 6px;

    .p-tooltip-arrow {
      border-top-color: $neutral-900;
    }
  }
}
</file>

<file path="src/app/features/user-management/components/admins/admin-list/admin-list.component.ts">
import { Component, OnInit, signal, computed, effect } from '@angular/core';
import { Router } from '@angular/router';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

// PrimeNG Modules
import { TableModule } from 'primeng/table';
import { ButtonModule } from 'primeng/button';
import { InputTextModule } from 'primeng/inputtext';
import { SelectModule } from 'primeng/select';
import { TagModule } from 'primeng/tag';
import { ToastModule } from 'primeng/toast';
import { IconFieldModule } from 'primeng/iconfield';
import { InputIconModule } from 'primeng/inputicon';
import { SkeletonModule } from 'primeng/skeleton';
import { TooltipModule } from 'primeng/tooltip';
import { MessageService } from 'primeng/api';

// Services & Shared Interfaces
import { UserService } from '../../../user.service';
import { Id } from 'convex/_generated/dataModel';
import { AdminUser, RoleOption, StatusOption } from '../../interfaces/userinterface';
import { ViewUserDrawerComponent } from '../../slideindrawer/view-user-drawer.component';

@Component({
  selector: 'app-admin-list',
  standalone: true,
  imports: [
    CommonModule,
    FormsModule,
    TableModule,
    ButtonModule,
    InputTextModule,
    SelectModule,
    TagModule,
    ToastModule,
    IconFieldModule,
    InputIconModule,
    SkeletonModule,
    TooltipModule,
    ViewUserDrawerComponent
  ],
  providers: [MessageService],
  templateUrl: './admin-list.component.html',
  styleUrls: ['./admin-list.component.scss'],
})
export class AdminListComponent implements OnInit {
  // Data signals - FULLY TYPED from shared interface
  admins = signal<AdminUser[]>([]);
  isLoading = signal(true);
  errorMessage = signal<string | null>(null);

  // Filter signals
  searchQuery = signal('');
  selectedRoleLevel = signal<number | null>(null);
  selectedStatus = signal<boolean | null>(null);

  // Pagination signals
  totalRecords = signal(0);
  hasMore = signal(true);
  continueCursor = signal<string | null>(null);

  // Drawer signals
  selectedAdminId = signal<Id<'admin_users'> | null>(null);
  drawerVisible = signal(false);
  selectedUserType = signal<'admin' | 'executive'>('admin');

  // âœ… FIXED: Role options matching backend definitions
  roleOptions: RoleOption[] = [
    { value: null, label: 'All Roles' }, // âœ… Added "All" option
    { value: 12, label: 'Super Admin' },
    { value: 11, label: 'State Head' },
    { value: 10, label: 'State Manager' },
    { value: 9, label: 'Zonal Head' },
    { value: 8, label: 'Zonal Manager' },
    { value: 7, label: 'District Head' },
    { value: 6, label: 'District Manager' },
    { value: 5, label: 'Ward Coordinator' },
    { value: 4, label: 'Block Coordinator' },
    { value: 1, label: 'Field Executive' },
  ];

  statusOptions: StatusOption[] = [
    { value: null, label: 'All Status' },
    { value: true, label: 'Active' },
    { value: false, label: 'Inactive' },
  ];

  // âœ… Computed property for filtered admins
  displayedAdmins = computed(() => {
    let filtered = this.admins();

    // Search filter
    const query = this.searchQuery().toLowerCase().trim();
    if (query) {
      filtered = filtered.filter(admin => 
        admin.name.toLowerCase().includes(query) ||
        admin.email.toLowerCase().includes(query)
      );
    }

    // Role filter
    const roleLevel = this.selectedRoleLevel();
    if (roleLevel !== null) {
      filtered = filtered.filter(admin => admin.roleLevel === roleLevel);
    }

    // Status filter
    const status = this.selectedStatus();
    if (status !== null) {
      filtered = filtered.filter(admin => admin.isActive === status);
    }

    return filtered;
  });

  constructor(
    private userService: UserService,
    private router: Router,
    private messageService: MessageService
  ) {
    // âœ… Update total records when filtered admins change
    effect(() => {
      this.totalRecords.set(this.displayedAdmins().length);
    });
  }

  async ngOnInit() {
    await this.loadAdmins();
    await this.loadRoles();
  }
async loadRoles() {
  const roles = await this.userService.getAvailableRoles();
  this.roleOptions = [
    { value: null, label: 'All Roles' },
    ...roles
  ];
}
  async loadAdmins(loadMore = false) {
    this.isLoading.set(true);
    this.errorMessage.set(null);

    try {
      const cursor = loadMore ? this.continueCursor() ?? null : null;
      const result = await this.userService.getAdmins({ numItems: 50, cursor });

      if (loadMore) {
        this.admins.update(current => [...current, ...result.page]);
      } else {
        this.admins.set(result.page);
      }

      this.hasMore.set(!result.isDone);
      this.continueCursor.set(result.continueCursor ?? null);
    } catch (error: any) {
      console.error('âŒ Failed to load admins:', error);
      this.errorMessage.set(error?.message || 'Failed to load admins');
      this.messageService.add({
        severity: 'error',
        summary: 'Error',
        detail: this.errorMessage() ?? undefined,
        life: 3000,
      });
    } finally {
      this.isLoading.set(false);
    }
  }

  async loadMore() {
    if (!this.hasMore() || this.isLoading()) return;
    await this.loadAdmins(true);
  }

  onSearch(event: Event) {
    const value = (event.target as HTMLInputElement).value;
    this.searchQuery.set(value);
  }

  onRoleFilter(roleLevel: number | null) {
    this.selectedRoleLevel.set(roleLevel);
  }

  onStatusFilter(status: boolean | null) {
    this.selectedStatus.set(status);
  }

  clearFilters() {
    this.searchQuery.set('');
    this.selectedRoleLevel.set(null);
    this.selectedStatus.set(null);
  }

  navigateToCreateAdmin() {
    this.router.navigate(['/user-management/admins/create']);
  }

  editAdmin(admin: AdminUser) {
    this.router.navigate(['/user-management/admins/edit', admin._id]);
  }

  viewAdmin(admin: AdminUser) {
    this.selectedAdminId.set(admin._id as Id<'admin_users'>);
    this.selectedUserType.set('admin');
    this.drawerVisible.set(true);
  }

  closeDrawer() {
    this.drawerVisible.set(false);
    this.selectedAdminId.set(null);
  }

  async deleteAdmin(admin: AdminUser) {
    if (!confirm(`Are you sure you want to delete ${admin.name}?`)) return;

    try {
      await this.userService.deleteAdmin(admin._id as Id<'admin_users'>);
      this.messageService.add({
        severity: 'success',
        summary: 'Success',
        detail: 'Admin deleted successfully',
        life: 3000,
      });
      await this.loadAdmins();
    } catch (error: any) {
      console.error('âŒ Failed to delete admin:', error);
      this.messageService.add({
        severity: 'error',
        summary: 'Error',
        detail: error?.message || 'Failed to delete admin',
        life: 3000,
      });
    }
  }

  // ============================================================================
  // UI HELPERS
  // ============================================================================

  getStatusSeverity(isActive: boolean): 'success' | 'danger' {
    return isActive ? 'success' : 'danger';
  }

  /**
   * âœ… UPDATED: Badge classes matching backend role levels
   */
  getRoleBadgeClass(roleLevel: number): string {
    if (roleLevel === 12) return 'badge-super-admin';  // Super Admin
    if (roleLevel >= 10) return 'badge-state';         // State level (10-11)
    if (roleLevel >= 8) return 'badge-zonal';          // Zonal level (8-9)
    if (roleLevel >= 6) return 'badge-district';       // District level (6-7)
    if (roleLevel >= 4) return 'badge-block';          // Block level (4-5)
    return 'badge-field';                              // Field level (1)
  }

  /**
   * âœ… Get role display name
   */
  getRoleDisplayName(roleLevel: number, roleName?: string): string {
    if (roleName) return roleName;
    
    const role = this.roleOptions.find(r => r.value === roleLevel);
    return role?.label || `Level ${roleLevel}`;
  }

  formatLastLogin(timestamp?: number): string {
    if (!timestamp) return 'Never';
    
    const date = new Date(timestamp);
    const now = new Date();
    const diffMs = now.getTime() - date.getTime();
    const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
    
    if (diffDays === 0) return 'Today';
    if (diffDays === 1) return 'Yesterday';
    if (diffDays < 7) return `${diffDays} days ago`;
    if (diffDays < 30) return `${Math.floor(diffDays / 7)} weeks ago`;
    
    return date.toLocaleDateString('en-IN', { 
      day: 'numeric', 
      month: 'short', 
      year: 'numeric' 
    });
  }

  formatDate(timestamp: number): string {
    return new Date(timestamp).toLocaleDateString('en-IN', {
      day: 'numeric',
      month: 'short',
      year: 'numeric',
    });
  }

  /**
   * âœ… Format hierarchy path for display
   */
  formatHierarchyPath(path?: string): string {
    if (!path) return 'N/A';
    
    // Convert path like "ORG_1/STATE_KERALA/ZONE_SOUTH/" to "Kerala â†’ South"
    const segments = path.split('/').filter(s => s.length > 0);
    return segments
      .map(s => {
        // Remove prefixes like "STATE_", "ZONE_", etc.
        return s.replace(/^(ORG|STATE|ZONE|DISTRICT|BLOCK|WARD)_/i, '')
          .split('_')
          .map(word => word.charAt(0) + word.slice(1).toLowerCase())
          .join(' ');
      })
      .join(' â†’ ');
  }
}
</file>

<file path="src/app/features/user-management/components/executives/executive-form/executive-form.component.html">
<div class="executive-form-container">
    <p-card>
        <ng-template pTemplate="header">
            <div class="card-header">
                <h2>Create Executive</h2>
            </div>
        </ng-template>

        <form [formGroup]="executiveForm" (ngSubmit)="onSubmit()">
            <!-- Profile Preview -->
            <div class="profile-preview">
                <div class="avatar-section">
                    <p-avatar
                        [label]="avatarInitials"
                        size="xlarge"
                        shape="circle"
                    ></p-avatar>
                </div>
                <div class="info-section">
                    <h3>{{ fullName }}</h3>
                    <p>{{ jobTitle }}</p>
                    <div class="meta-info">
                        <span class="badge">{{
                            executiveForm.get('employeeId')?.value
                        }}</span>
                        <span class="badge"
                            >Joining:
                            {{
                                executiveForm.get('dateOfJoining')?.value
                                    | date: 'mediumDate'
                            }}</span
                        >
                    </div>
                </div>
            </div>

            <!-- Personal Details Section (No Tabs - Direct Display) -->
            <div class="form-content">
                <div class="form-section" formGroupName="personalDetails">
                    <h3 class="section-title">
                        <i class="pi pi-user"></i>
                        Personal Details
                    </h3>

                    <div class="form-grid">
                        <div class="form-field">
                            <label for="firstName"
                                >First Name
                                <span class="required">*</span></label
                            >
                            <input
                                id="firstName"
                                type="text"
                                pInputText
                                formControlName="firstName"
                                placeholder="Enter first name"
                                [class.ng-invalid]="
                                    isFieldInvalid('personalDetails.firstName')
                                "
                            />
                            <small
                                class="p-error"
                                *ngIf="
                                    isFieldInvalid('personalDetails.firstName')
                                "
                            >
                                First name is required
                            </small>
                        </div>

                        <div class="form-field">
                            <label for="lastName"
                                >Last Name
                                <span class="required">*</span></label
                            >
                            <input
                                id="lastName"
                                type="text"
                                pInputText
                                formControlName="lastName"
                                placeholder="Enter last name"
                                [class.ng-invalid]="
                                    isFieldInvalid('personalDetails.lastName')
                                "
                            />
                            <small
                                class="p-error"
                                *ngIf="
                                    isFieldInvalid('personalDetails.lastName')
                                "
                            >
                                Last name is required
                            </small>
                        </div>

                        <div class="form-field">
                            <label for="workEmail"
                                >Work Email
                                <span class="required">*</span></label
                            >
                            <input
                                id="workEmail"
                                type="email"
                                pInputText
                                formControlName="workEmail"
                                placeholder="executive@example.com"
                                [class.ng-invalid]="
                                    isFieldInvalid('personalDetails.workEmail')
                                "
                            />
                            <small
                                class="p-error"
                                *ngIf="
                                    isFieldInvalid('personalDetails.workEmail')
                                "
                            >
                                Valid email is required
                            </small>
                        </div>

                        <div class="form-field">
                            <label for="primaryPhone"
                                >Phone Number
                                <span class="required">*</span></label
                            >
                            <input
                                id="primaryPhone"
                                type="tel"
                                pInputText
                                formControlName="primaryPhone"
                                placeholder="9876543210"
                                [class.ng-invalid]="
                                    isFieldInvalid(
                                        'personalDetails.primaryPhone'
                                    )
                                "
                            />
                            <small
                                class="p-error"
                                *ngIf="
                                    isFieldInvalid(
                                        'personalDetails.primaryPhone'
                                    )
                                "
                            >
                                Valid 10-digit phone number is required
                            </small>
                        </div>

                        <div class="form-field">
                            <label for="dateOfBirth">Date of Birth</label>
                            <p-datepicker
                                id="dateOfBirth"
                                formControlName="dateOfBirth"
                                [showIcon]="true"
                                placeholder="Select date"
                            ></p-datepicker>
                        </div>

                        <div class="form-field">
                            <label for="governmentId"
                                >Government ID (Aadhaar/PAN)</label
                            >
                            <input
                                id="governmentId"
                                type="text"
                                pInputText
                                formControlName="governmentId"
                                placeholder="Enter ID number"
                            />
                        </div>

                        <div class="form-field full-width">
                            <label for="currentAddress">Current Address</label>
                            <textarea
                                id="currentAddress"
                                pInputTextarea
                                formControlName="currentAddress"
                                rows="3"
                                placeholder="Enter current address"
                            ></textarea>
                        </div>
                    </div>
                </div>

                <!-- Employment & Hierarchy Section -->
                <div class="form-section" formGroupName="employmentHierarchy">
                    <h3 class="section-title">
                        <i class="pi pi-briefcase"></i>
                        Employment Details
                    </h3>

                    <div class="form-grid">
                        <div class="form-field">
                            <label for="jobTitle">Job Title</label>
                            <input
                                id="jobTitle"
                                type="text"
                                pInputText
                                formControlName="jobTitle"
                                placeholder="Field Executive"
                            />
                        </div>

                        <div class="form-field">
                            <label for="department">Department</label>
                            <p-select
                                id="department"
                                formControlName="department"
                                [options]="departments"
                                optionLabel="label"
                                optionValue="value"
                                placeholder="Select Department"
                                [showClear]="true"
                            ></p-select>
                        </div>

                        <!-- âœ… CONTRACT TYPE FIELD -->
                        <div class="form-field">
                            <label for="contractType">Contract Type</label>
                            <p-select
                                id="contractType"
                                formControlName="contractType"
                                [options]="contractTypes"
                                optionLabel="label"
                                optionValue="value"
                                placeholder="Select Contract Type"
                                [showClear]="true"
                            ></p-select>
                        </div>

                        <div class="form-field">
                            <label for="hierarchyId">Hierarchy</label>
                            <p-select
                                id="hierarchyId"
                                formControlName="hierarchyId"
                                [options]="hierarchies"
                                optionLabel="name"
                                optionValue="_id"
                                placeholder="Select Hierarchy (Optional)"
                                [showClear]="true"
                                (onChange)="onHierarchyChange($event)"
                            ></p-select>
                        </div>

                        <div class="form-field">
                            <label for="reportingManagerId"
                                >Reporting Manager
                                <span class="required">*</span></label
                            >
                            <p-select
                                id="reportingManagerId"
                                formControlName="reportingManagerId"
                                [options]="managers"
                                optionLabel="label"
                                optionValue="value"
                                placeholder="Select Manager"
                                [filter]="true"
                                [class.ng-invalid]="
                                    isFieldInvalid(
                                        'employmentHierarchy.reportingManagerId'
                                    )
                                "
                            ></p-select>
                            <small
                                class="p-error"
                                *ngIf="
                                    isFieldInvalid(
                                        'employmentHierarchy.reportingManagerId'
                                    )
                                "
                            >
                                Manager is required
                            </small>
                        </div>
                    </div>

                    <!-- Ward Assignment Section -->
                    <h3 class="section-title">
                        <i class="pi pi-map-marker"></i>
                        Ward Assignment
                    </h3>

                    <div formGroupName="wardFilters">
                        <div class="form-grid">
                            <div class="form-field">
                                <label for="zone"
                                    >Zone <span class="required">*</span></label
                                >
                                <p-select
                                    id="zone"
                                    formControlName="zone"
                                    [options]="zones()"
                                    optionLabel="label"
                                    optionValue="value"
                                    placeholder="Select Zone"
                                    [filter]="true"
                                    [showClear]="true"
                                    (onChange)="onZoneChange($event)"
                                ></p-select>
                            </div>

                            <div class="form-field">
                                <label for="district"
                                    >District
                                    <span class="required">*</span></label
                                >
                                <p-select
                                    id="district"
                                    formControlName="district"
                                    [options]="districts()"
                                    optionLabel="label"
                                    optionValue="value"
                                    placeholder="Select District"
                                    [filter]="true"
                                    [showClear]="true"
                                    [disabled]="
                                        !wardFiltersGroup.get('zone')?.value
                                    "
                                    [loading]="loadingDistricts()"
                                    (onChange)="onDistrictChange($event)"
                                ></p-select>
                            </div>

                            <div class="form-field">
                                <label for="subdistrict"
                                    >Subdistrict
                                    <span class="required">*</span></label
                                >
                                <p-select
                                    id="subdistrict"
                                    formControlName="subdistrict"
                                    [options]="subdistricts()"
                                    optionLabel="label"
                                    optionValue="value"
                                    placeholder="Select Subdistrict"
                                    [filter]="true"
                                    [showClear]="true"
                                    [disabled]="
                                        !wardFiltersGroup.get('district')?.value
                                    "
                                    [loading]="loadingSubdistricts()"
                                    (onChange)="onSubdistrictChange($event)"
                                ></p-select>
                            </div>

                            <div class="form-field">
                                <label for="localBody"
                                    >Local Body
                                    <span class="required">*</span></label
                                >
                                <p-select
                                    id="localBody"
                                    formControlName="localBody"
                                    [options]="localBodies()"
                                    optionLabel="label"
                                    optionValue="value"
                                    placeholder="Select Local Body"
                                    [filter]="true"
                                    [showClear]="true"
                                    [disabled]="
                                        !wardFiltersGroup.get('subdistrict')
                                            ?.value
                                    "
                                    [loading]="loadingLocalBodies()"
                                    (onChange)="onLocalBodyChange($event)"
                                ></p-select>
                            </div>
                        </div>
                    </div>

                    <!-- Ward Selection -->
                    <div class="form-field full-width">
                        <label for="wardIds"
                            >Assigned Wards
                            <span class="required">*</span></label
                        >
                        <p-multiselect
                            id="wardIds"
                            formControlName="wardIds"
                            [options]="availableWards()"
                            optionLabel="label"
                            optionValue="value"
                            placeholder="Select Wards"
                            [filter]="true"
                            [disabled]="availableWards().length === 0"
                            [loading]="loadingWards()"
                            display="chip"
                            [class.ng-invalid]="
                                isFieldInvalid('employmentHierarchy.wardIds')
                            "
                        ></p-multiselect>
                        <small
                            class="p-error"
                            *ngIf="
                                isFieldInvalid('employmentHierarchy.wardIds')
                            "
                        >
                            At least one ward is required
                        </small>
                        <small
                            class="p-help"
                            *ngIf="
                                availableWards().length === 0 && !loadingWards()
                            "
                        >
                            Please select a local body to load wards
                        </small>
                    </div>
                </div>

                <!-- Area of Operation Section -->
                <div class="form-section" formGroupName="areaOfOperation">
                    <h3 class="section-title">
                        <i class="pi pi-globe"></i>
                        Area of Operation
                    </h3>

                    <div class="form-grid">
                        <div class="form-field">
                            <label for="region">Region</label>
                            <p-select
                                id="region"
                                formControlName="region"
                                [options]="regions"
                                optionLabel="label"
                                optionValue="value"
                                placeholder="Select Region"
                                [showClear]="true"
                            ></p-select>
                        </div>

                        <div class="form-field">
                            <label for="primaryTerritory"
                                >Primary Territory</label
                            >
                            <input
                                id="primaryTerritory"
                                type="text"
                                pInputText
                                formControlName="primaryTerritory"
                                placeholder="Enter primary territory"
                            />
                        </div>

                        <div class="form-field full-width">
                            <label for="assignedZones">Assigned Zones</label>
                            <p-multiselect
                                id="assignedZones"
                                formControlName="assignedZones"
                                [options]="zones()"
                                optionLabel="label"
                                optionValue="value"
                                placeholder="Select Zones"
                                [filter]="true"
                                display="chip"
                            ></p-multiselect>
                        </div>
                    </div>
                </div>

                <!-- Debug Section -->
                <div class="debug-section">
                    <h4>Form Debug Info:</h4>
                    <p>Form Valid: {{ executiveForm.valid }}</p>
                    <p>Form Invalid: {{ executiveForm.invalid }}</p>

                    <div *ngIf="executiveForm.invalid">
                        <h5>Invalid Controls:</h5>
                        <ul>
                            <li
                                *ngIf="
                                    executiveForm.get('employmentHierarchy')
                                        ?.invalid
                                "
                            >
                                Employment & Hierarchy Invalid
                                <ul>
                                    <li
                                        *ngIf="
                                            executiveForm.get(
                                                'employmentHierarchy.reportingManagerId'
                                            )?.invalid
                                        "
                                    >
                                        Manager: Required
                                    </li>
                                    <li
                                        *ngIf="
                                            executiveForm.get(
                                                'employmentHierarchy.wardIds'
                                            )?.invalid
                                        "
                                    >
                                        Ward IDs:
                                        {{
                                            executiveForm.get(
                                                'employmentHierarchy.wardIds'
                                            )?.value?.length || 0
                                        }}
                                        selected
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
                <p-button
                    label="Cancel"
                    icon="pi pi-times"
                    severity="secondary"
                    [outlined]="true"
                    (onClick)="onCancel()"
                    type="button"
                ></p-button>

                <p-button
                    label="Create Executive"
                    icon="pi pi-check"
                    type="submit"
                    [loading]="submitting"
                    [disabled]="executiveForm.invalid || submitting"
                ></p-button>
            </div>
        </form>
    </p-card>
</div>
</file>

<file path="src/app/features/user-management/components/executives/executive-form/executive-form.component.scss">
.executive-form-container {
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;

    ::ng-deep .p-card {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        border-radius: 12px;

        .p-card-body {
            padding: 0;
        }
    }

    .card-header {
        padding: 2rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 12px 12px 0 0;

        h2 {
            margin: 0;
            font-size: 1.75rem;
            font-weight: 700;
            color: white;
        }
    }

    // Profile Preview
    .profile-preview {
        display: flex;
        align-items: center;
        gap: 1.5rem;
        padding: 2rem;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        border-bottom: 1px solid #e5e7eb;

        .avatar-section {
            ::ng-deep .p-avatar {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                font-weight: 600;
                font-size: 1.5rem;
                width: 80px;
                height: 80px;
            }
        }

        .info-section {
            h3 {
                margin: 0 0 0.5rem 0;
                font-size: 1.5rem;
                font-weight: 700;
                color: #1e293b;
            }

            p {
                margin: 0 0 0.75rem 0;
                color: #64748b;
                font-size: 1rem;
            }

            .meta-info {
                display: flex;
                gap: 0.75rem;
                flex-wrap: wrap;

                .badge {
                    padding: 0.5rem 0.75rem;
                    background: white;
                    border-radius: 6px;
                    font-size: 0.875rem;
                    font-weight: 500;
                    color: #475569;
                    border: 1px solid #e2e8f0;
                }
            }
        }
    }

    // Form Content
    .form-content {
        padding: 2rem;
    }

    .form-section {
        margin-bottom: 3rem;

        .section-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.25rem;
            font-weight: 600;
            color: #334155;
            margin: 0 0 1.5rem 0;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid #e2e8f0;

            i {
                color: #667eea;
                font-size: 1.5rem;
            }
        }
    }

    // Form Grid - 2 columns with proper spacing
    .form-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1.5rem;

        .form-field {
            &.full-width {
                grid-column: 1 / -1;
            }
        }
    }

    // Form Fields
    .form-field {
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #475569;
            font-size: 0.875rem;

            .required {
                color: #ef4444;
                font-weight: 700;
                margin-left: 2px;
            }
        }

        .p-error {
            display: block;
            margin-top: 0.5rem;
            color: #ef4444;
            font-size: 0.8125rem;
            font-weight: 500;
        }

        .p-help {
            display: block;
            margin-top: 0.5rem;
            color: #6366f1;
            font-size: 0.8125rem;
            font-weight: 500;
        }
    }

    // Debug Section
    .debug-section {
        background: #fef3c7;
        padding: 1.5rem;
        border-radius: 8px;
        margin: 2rem 0;

        h4 {
            margin: 0 0 1rem 0;
            color: #92400e;
        }

        p {
            margin: 0.5rem 0;
            color: #78350f;
        }

        ul {
            margin: 0.5rem 0;
            padding-left: 1.5rem;
            color: #78350f;
        }
    }

    // Form Actions
    .form-actions {
        display: flex;
        justify-content: flex-end;
        gap: 1rem;
        padding: 2rem;
        border-top: 1px solid #e2e8f0;
        background: #f8fafc;
        border-radius: 0 0 12px 12px;
    }

    // PrimeNG Overrides
    ::ng-deep {
        .p-inputtext,
        .p-textarea {
            width: 100%;
            padding: 0.75rem;
            border-radius: 8px;
            border: 1px solid #cbd5e1;
            transition: all 0.2s;
            font-size: 0.9375rem;

            &:focus {
                border-color: #667eea;
                box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            }

            &.ng-invalid.ng-touched {
                border-color: #ef4444;

                &:focus {
                    box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
                }
            }
        }

        .p-select,
        .p-multiselect {
            width: 100%;

            .p-select-label,
            .p-multiselect-label {
                padding: 0.75rem;
                font-size: 0.9375rem;
            }

            &.p-focus {
                border-color: #667eea;
                box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            }

            &.ng-invalid.ng-touched {
                border-color: #ef4444;
            }
        }

        .p-datepicker {
            width: 100%;

            .p-inputtext {
                width: 100%;
            }
        }

        .p-button {
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            border-radius: 8px;
            transition: all 0.2s;

            &:not(:disabled):hover {
                transform: translateY(-1px);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
            }
        }
    }

    // Responsive
    @media (max-width: 768px) {
        padding: 1rem;

        .form-content {
            padding: 1rem;
        }

        .form-grid {
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        .profile-preview {
            flex-direction: column;
            text-align: center;
            padding: 1.5rem;
        }

        .form-actions {
            flex-direction: column-reverse;

            .p-button {
                width: 100%;
            }
        }
    }
}
</file>

<file path="src/app/features/user-management/components/executives/executive-form/executive-form.component.ts">
import { Component, OnInit, signal } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormBuilder, FormGroup, Validators, ReactiveFormsModule, FormArray } from '@angular/forms';
import { ActivatedRoute, Router } from '@angular/router';

// PrimeNG Imports
import { DatePickerModule } from 'primeng/datepicker';
import { ButtonModule } from 'primeng/button';
import { InputTextModule } from 'primeng/inputtext';
import { TextareaModule } from 'primeng/textarea';
import { SelectModule } from 'primeng/select';
import { AvatarModule } from 'primeng/avatar';
import { FileUploadModule } from 'primeng/fileupload';
import { MultiSelectModule } from 'primeng/multiselect';
import { TabsModule } from 'primeng/tabs';
import { CardModule } from 'primeng/card';

// Services
import { Id } from 'convex/_generated/dataModel';
import { UserService } from '@/features/user-management/user.service';
import { WardsService } from '@/features/hr-recruitment/services/wards.service';
import { MessageService } from 'primeng/api';

@Component({
    selector: 'app-executive-form',
    standalone: true,
    imports: [
        CommonModule,
        ReactiveFormsModule,
        MultiSelectModule,
        ButtonModule,
        InputTextModule,
        TextareaModule,
        SelectModule,
        AvatarModule,
        FileUploadModule,
        DatePickerModule,
        TabsModule,
        CardModule,
    ],
    providers: [MessageService], 
    templateUrl: './executive-form.component.html',
    styleUrls: ['./executive-form.component.scss']
})
export class ExecutiveFormComponent implements OnInit {
    executiveForm!: FormGroup;
    loading = false;
    submitting = false;
    isEditMode = false;
    executiveId: Id<'executives'> | null = null;

    // âœ… Dropdown options
    departments: Array<{ label: string; value: string }> = [
        { label: 'Sales', value: 'sales' },
        { label: 'Operations', value: 'operations' },
        { label: 'Field Services', value: 'field-services' },
        { label: 'Customer Support', value: 'customer-support' },
    ];
    
    contractTypes: Array<{ label: string; value: string }> = [
        { label: 'Full-Time', value: 'full-time' },
        { label: 'Part-Time', value: 'part-time' },
        { label: 'Contract', value: 'contract' },
        { label: 'Temporary', value: 'temporary' },
        { label: 'Internship', value: 'internship' },
    ];
    
    managers: Array<{ label: string; value: string }> = [];
    
    regions: Array<{ label: string; value: string }> = [
        { label: 'North', value: 'north' },
        { label: 'South', value: 'south' },
        { label: 'East', value: 'east' },
        { label: 'West', value: 'west' },
    ];
    
    assetTypes: Array<{ label: string; value: string }> = [
        { label: 'Laptop', value: 'laptop' },
        { label: 'Mobile Phone', value: 'mobile' },
        { label: 'Vehicle', value: 'vehicle' },
        { label: 'Tablet', value: 'tablet' },
    ];
    
    hierarchies: Array<{ _id: string; name: string }> = [];

    // âœ… Ward selection signals
    zones = signal<Array<{ value: string; label: string }>>([]);
    districts = signal<Array<{ value: string; label: string }>>([]);
    subdistricts = signal<Array<{ value: string; label: string }>>([]);
    localBodies = signal<Array<{ value: string; label: string }>>([]);
    availableWards = signal<Array<{ value: string; label: string; fullPath?: string }>>([]);
    
    // âœ… Loading states
    loadingDistricts = signal(false);
    loadingSubdistricts = signal(false);
    loadingLocalBodies = signal(false);
    loadingWards = signal(false);

    constructor(
        private fb: FormBuilder,
        private userService: UserService,
        private wardsService: WardsService,
        private messageService: MessageService,
        private route: ActivatedRoute,
        private router: Router
    ) {}

    async ngOnInit(): Promise<void> {
        this.initializeForm();
        await this.loadFormData();
        
        // Check if edit mode
        this.route.params.subscribe(async params => {
            if (params['id']) {
                this.isEditMode = true;
                this.executiveId = params['id'] as Id<'executives'>;
                await this.loadExecutiveData(this.executiveId);
            }
        });
    }
      private initializeForm() {
        this.executiveForm = this.fb.group({
            employeeId: [{ value: this.generateEmployeeId(), disabled: true }],
            dateOfJoining: [{ value: new Date(), disabled: true }],
            
            personalDetails: this.fb.group({
                firstName: ['', Validators.required],
                lastName: ['', Validators.required],
                dateOfBirth: [null],
                primaryPhone: ['', [Validators.required, Validators.pattern(/^[0-9]{10}$/)]],
                workEmail: ['', [Validators.required, Validators.email]],
                governmentId: [''],
                currentAddress: ['']
            }),
            
            employmentHierarchy: this.fb.group({
                jobTitle: ['Field Executive'],
                department: [null],
                contractType: [null],
                reportingManagerId: [null, Validators.required],
                hierarchyId: [null],
                wardIds: [[], Validators.required],
                
                wardFilters: this.fb.group({
                    zone: [null],
                    district: [null],
                    subdistrict: [null],
                    localBody: [null],
                }),
            }),
            
            areaOfOperation: this.fb.group({
                region: [null],
                primaryTerritory: [''],
                assignedZones: [[]]
            }),
            
            assignedAssets: this.fb.array([])
        });

        // âœ… Disable email in edit mode
        if (this.isEditMode) {
            this.executiveForm.get('personalDetails.workEmail')?.disable();
        }
    }

    get wardFiltersGroup(): FormGroup {
        return this.executiveForm.get('employmentHierarchy.wardFilters') as FormGroup;
    }

    private async loadFormData() {
        try {
            this.loading = true;
            
            this.hierarchies = await this.userService.getHierarchies();
            const zonesData = await this.wardsService.getZones();
            this.zones.set(zonesData);
            
            console.log('âœ… Form data loaded');
        } catch (error) {
            console.error('âŒ Error loading form data:', error);
            this.messageService.add({
                severity: 'error',
                summary: 'Error',
                detail: 'Failed to load form data. Please try again.'
            });
        } finally {
            this.loading = false;
        }
    }
 private async loadExecutiveData(executiveId: Id<'executives'>): Promise<void> {
        try {
            const executive = await this.userService.getExecutiveForEdit(executiveId);
            
            // Set employee ID and join date
            this.executiveForm.patchValue({
                employeeId: executive.employeeId,
                dateOfJoining: new Date(executive.joinDate),
            });

            // Populate personal details
            this.executiveForm.get('personalDetails')?.patchValue({
                firstName: executive.firstName || '',
                lastName: executive.lastName || '',
                dateOfBirth: executive.dateOfBirth ? new Date(executive.dateOfBirth) : null,
                primaryPhone: executive.phone,
                workEmail: executive.email,
                governmentId: executive.governmentId || '',
                currentAddress: executive.currentAddress || ''
            });

            // Populate employment details
            this.executiveForm.get('employmentHierarchy')?.patchValue({
                jobTitle: executive.jobTitle || 'Field Executive',
                department: executive.department,
                contractType: executive.contractType,
                reportingManagerId: executive.managerId,
                hierarchyId: executive.hierarchyId,
            });

            // Load managers for the hierarchy
            if (executive.hierarchyId) {
                await this.onHierarchyChange({ value: executive.hierarchyId });
            }

            // Populate area of operation
            this.executiveForm.get('areaOfOperation')?.patchValue({
                region: executive.region,
                primaryTerritory: executive.primaryTerritory || '',
                assignedZones: executive.assignedZones || []
            });

            // âœ… Load geographic data and wards
            if (executive.zone) {
                await this.loadDistrictsForZone(executive.zone);
                this.wardFiltersGroup.patchValue({ zone: executive.zone });
            }

            if (executive.district) {
                await this.loadSubdistrictsForDistrict(executive.zone!, executive.district);
                this.wardFiltersGroup.patchValue({ district: executive.district });
            }

            if (executive.subdistrict) {
                await this.loadLocalBodiesForSubdistrict(executive.zone!, executive.district!, executive.subdistrict);
                this.wardFiltersGroup.patchValue({ subdistrict: executive.subdistrict });
            }

            // Load wards from assignedWards
            if (executive.assignedWards && executive.assignedWards.length > 0) {
                // You'll need to determine localBody from the ward data
                // For now, set the wardIds directly
                this.executiveForm.get('employmentHierarchy.wardIds')?.setValue(executive.assignedWards);
            }

            console.log('âœ… Executive data loaded for editing:', executive);
        } catch (error: any) {
            console.error('âŒ Failed to load executive data:', error);
            this.messageService.add({
                severity: 'error',
                summary: 'Error',
                detail: error.message || 'Failed to load executive data'
            });
            this.router.navigate(['/user-management/executives']);
        }
    }
    // ============================================================================
    // CASCADING LOCATION HANDLERS
    // ============================================================================

    private async loadDistrictsForZone(zone: string): Promise<void> {
        const data = await this.wardsService.getDistricts(zone);
        this.districts.set(data);
    }
private async loadSubdistrictsForDistrict(zone: string, district: string): Promise<void> {
        const data = await this.wardsService.getSubdistricts(zone, district);
        this.subdistricts.set(data);
    }
 private async loadLocalBodiesForSubdistrict(zone: string, district: string, subdistrict: string): Promise<void> {
        const data = await this.wardsService.getLocalBodies(zone, district, subdistrict);
        this.localBodies.set(data);
    }
checkFormValidity() {
    console.log('=== FORM VALIDATION DEBUG ===');
    console.log('Form Valid:', this.executiveForm.valid);
    console.log('Form Invalid:', this.executiveForm.invalid);
    console.log('Form Value:', this.executiveForm.value);
    
    Object.keys(this.executiveForm.controls).forEach(key => {
        const control = this.executiveForm.get(key);
        if (control && control.invalid) {
            console.log(`âŒ ${key} is INVALID:`, control.errors);
            
            // Check nested form groups
            if (control instanceof FormGroup) {
                Object.keys((control as FormGroup).controls).forEach(nestedKey => {
                    const nestedControl = control.get(nestedKey);
                    if (nestedControl && nestedControl.invalid) {
                        console.log(`  âŒ ${key}.${nestedKey} is INVALID:`, nestedControl.errors);
                    }
                });
            }
        }
    });
}
private markFormGroupTouched(formGroup: FormGroup) {
    Object.keys(formGroup.controls).forEach(key => {
        const control = formGroup.get(key);
        control?.markAsTouched();
        
        if (control instanceof FormGroup) {
            this.markFormGroupTouched(control);
        }
    });
}
    async onZoneChange(event: any) {
        const zone = event.value;
        console.log('ðŸŽ¯ Zone changed:', zone);
        
        this.wardFiltersGroup.patchValue({
            district: null,
            subdistrict: null,
            localBody: null,
        });
        this.executiveForm.get('employmentHierarchy.wardIds')?.setValue([]);
        
        this.districts.set([]);
        this.subdistricts.set([]);
        this.localBodies.set([]);
        this.availableWards.set([]);

        if (!zone) return;

        this.loadingDistricts.set(true);
        try {
            const data = await this.wardsService.getDistricts(zone);
            this.districts.set(data);
            console.log('âœ… Districts loaded:', data.length);
        } catch (error) {
            console.error('âŒ Failed to load districts:', error);
        } finally {
            this.loadingDistricts.set(false);
        }
    }

    async onDistrictChange(event: any) {
        const district = event.value;
        const zone = this.wardFiltersGroup.get('zone')?.value;
        
        this.wardFiltersGroup.patchValue({
            subdistrict: null,
            localBody: null,
        });
        this.executiveForm.get('employmentHierarchy.wardIds')?.setValue([]);
        
        this.subdistricts.set([]);
        this.localBodies.set([]);
        this.availableWards.set([]);

        if (!zone || !district) return;

        this.loadingSubdistricts.set(true);
        try {
            const data = await this.wardsService.getSubdistricts(zone, district);
            this.subdistricts.set(data);
            console.log('âœ… Subdistricts loaded:', data.length);
        } catch (error) {
            console.error('âŒ Failed to load subdistricts:', error);
        } finally {
            this.loadingSubdistricts.set(false);
        }
    }

    async onSubdistrictChange(event: any) {
        const subdistrict = event.value;
        const zone = this.wardFiltersGroup.get('zone')?.value;
        const district = this.wardFiltersGroup.get('district')?.value;
        
        this.wardFiltersGroup.patchValue({ localBody: null });
        this.executiveForm.get('employmentHierarchy.wardIds')?.setValue([]);
        
        this.localBodies.set([]);
        this.availableWards.set([]);

        if (!zone || !district || !subdistrict) return;

        this.loadingLocalBodies.set(true);
        try {
            const data = await this.wardsService.getLocalBodies(zone, district, subdistrict);
            this.localBodies.set(data);
            console.log('âœ… Local bodies loaded:', data.length);
        } catch (error) {
            console.error('âŒ Failed to load local bodies:', error);
        } finally {
            this.loadingLocalBodies.set(false);
        }
    }

    async onLocalBodyChange(event: any) {
        const localBody = event.value;
        const zone = this.wardFiltersGroup.get('zone')?.value;
        const district = this.wardFiltersGroup.get('district')?.value;
        const subdistrict = this.wardFiltersGroup.get('subdistrict')?.value;
        
        this.executiveForm.get('employmentHierarchy.wardIds')?.setValue([]);
        this.availableWards.set([]);

        if (!zone || !district || !subdistrict || !localBody) return;

        this.loadingWards.set(true);
        try {
            const data = await this.wardsService.getWards(zone, district, subdistrict, localBody, 200);
            this.availableWards.set(data);
            console.log('âœ… Wards loaded:', data.length);
        } catch (error) {
            console.error('âŒ Failed to load wards:', error);
        } finally {
            this.loadingWards.set(false);
        }
    }

    async onHierarchyChange(event: any) {
        const hierarchyId = event.value;
        if (!hierarchyId) return;
        
        try {
            const managersData = await this.userService.getManagersByHierarchy(hierarchyId);
            this.managers = managersData.map(m => ({
                label: `${m.name} (${m.email})`,
                value: m._id
            }));
        } catch (error) {
            console.error('âŒ Error loading managers:', error);
        }
    }
    

    private generateEmployeeId(): string {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const seq = String(Math.floor(Math.random() * 1000)).padStart(3, '0');
        return `EXE-${year}${month}${day}-${seq}`;
    }

get fullName(): string {
    const firstName = this.executiveForm.get('personalDetails.firstName')?.value || '';
    const lastName = this.executiveForm.get('personalDetails.lastName')?.value || '';
    return `${firstName} ${lastName}`.trim() || 'New Executive';
}

get jobTitle(): string {
    return this.executiveForm.get('employmentHierarchy.jobTitle')?.value || 'Field Executive';
}
get avatarInitials(): string {
    const firstName = this.executiveForm.get('personalDetails.firstName')?.value || '';
    const lastName = this.executiveForm.get('personalDetails.lastName')?.value || '';
    
    const firstInitial = firstName.charAt(0).toUpperCase();
    const lastInitial = lastName.charAt(0).toUpperCase();
    
    return firstInitial + lastInitial || 'NE';
}
    get assignedAssets(): FormArray {
        return this.executiveForm.get('assignedAssets') as FormArray;
    }

    newAsset(): FormGroup {
        return this.fb.group({
            assetType: ['', Validators.required],
            assetId: ['', Validators.required],
            dateOfAssignment: [new Date(), Validators.required]
        });
    }

    addAsset() {
        this.assignedAssets.push(this.newAsset());
    }

    removeAsset(index: number) {
        this.assignedAssets.removeAt(index);
    }

    // âœ… Helper to remove null/undefined values
    private removeNulls(obj: any): any {
        return Object.entries(obj).reduce((acc, [key, value]) => {
            if (value !== null && value !== undefined && value !== '') {
                acc[key] = value;
            }
            return acc;
        }, {} as any);
    }

    async onSubmit() {
        if (this.executiveForm.invalid) {
            this.messageService.add({
                severity: 'error',
                summary: 'Form Invalid',
                detail: 'Please fill all required fields'
            });
            this.markFormGroupTouched(this.executiveForm);
            return;
        }

        try {
            this.submitting = true;
            
            if (this.isEditMode && this.executiveId) {
                await this.updateExecutive();
            } else {
                await this.createExecutive();
            }
        } catch (error: any) {
            console.error('âŒ Error:', error);
            this.messageService.add({
                severity: 'error',
                summary: 'Error',
                detail: error.message || 'Failed to process request'
            });
        } finally {
            this.submitting = false;
        }
    }
    private async createExecutive(): Promise<void> {
        const formValue = this.executiveForm.getRawValue();
        const personalDetails = formValue.personalDetails;
        const employment = formValue.employmentHierarchy;
        const areaOfOperation = formValue.areaOfOperation;

        const wardIds = employment.wardIds;
        if (!wardIds || wardIds.length === 0) {
            this.messageService.add({
                severity: 'warn',
                summary: 'Validation',
                detail: 'Please select at least one ward'
            });
            return;
        }

        const executiveData = this.removeNulls({
            email: personalDetails.workEmail,
            firstName: personalDetails.firstName,
            lastName: personalDetails.lastName,
            phone: personalDetails.primaryPhone,
            employeeId: formValue.employeeId,
            dateOfBirth: personalDetails.dateOfBirth?.getTime(),
            governmentId: personalDetails.governmentId,
            currentAddress: personalDetails.currentAddress,
            jobTitle: employment.jobTitle,
            department: employment.department,
            contractType: employment.contractType,
            managerId: employment.reportingManagerId as Id<"admin_users">,
            hierarchyId: employment.hierarchyId as Id<"hierarchies">,
            wardIds: wardIds,
            region: areaOfOperation.region,
            primaryTerritory: areaOfOperation.primaryTerritory,
            assignedZones: areaOfOperation.assignedZones,
        });

        await this.userService.createExecutive(executiveData);
        
        this.messageService.add({
            severity: 'success',
            summary: 'Success',
            detail: 'Executive created successfully!'
        });
        this.router.navigate(['/user-management/executives']);
    }

     private async updateExecutive(): Promise<void> {
        const formValue = this.executiveForm.getRawValue();
        const personalDetails = formValue.personalDetails;
        const employment = formValue.employmentHierarchy;
        const areaOfOperation = formValue.areaOfOperation;

        const wardIds = employment.wardIds;
        if (!wardIds || wardIds.length === 0) {
            this.messageService.add({
                severity: 'warn',
                summary: 'Validation',
                detail: 'Please select at least one ward'
            });
            return;
        }

        const updateData = this.removeNulls({
            executiveId: this.executiveId!,
            firstName: personalDetails.firstName,
            lastName: personalDetails.lastName,
            phone: personalDetails.primaryPhone,
            dateOfBirth: personalDetails.dateOfBirth?.getTime(),
            governmentId: personalDetails.governmentId,
            currentAddress: personalDetails.currentAddress,
            jobTitle: employment.jobTitle,
            department: employment.department,
            contractType: employment.contractType,
            managerId: employment.reportingManagerId as Id<"admin_users">,
            wardIds: wardIds,
            region: areaOfOperation.region,
            primaryTerritory: areaOfOperation.primaryTerritory,
            assignedZones: areaOfOperation.assignedZones,
        });

        await this.userService.updateExecutive(updateData);
        
        this.messageService.add({
            severity: 'success',
            summary: 'Success',
            detail: 'Executive updated successfully!'
        });
        this.router.navigate(['/user-management/executives']);
    }

    isFieldInvalid(fieldPath: string): boolean {
        const field = this.executiveForm.get(fieldPath);
        return !!(field && field.invalid && (field.dirty || field.touched));
    }

    onCancel() {
        this.router.navigate(['/user-management/executives']);
    }
}
</file>

<file path="src/app/features/user-management/components/executives/executive-list/executive-list.component.html">
<div class="executive-list-container">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <div class="title-section">
        <h1 class="page-title">
          <i class="pi pi-briefcase"></i>
          Executive Management
        </h1>
        <p class="page-subtitle">
          Manage and monitor {{ totalRecords() }} field executives across your organization
        </p>
      </div>
      <button
        pButton
        type="button"
        label="Add New Executive"
        icon="pi pi-user-plus"
        class="create-btn"
        (click)="navigateToCreateExecutive()"
      ></button>
    </div>
  </div>

  <!-- Filters Section -->
  <div class="filters-card">
    <div class="filters-header">
      <h3 class="filters-title">
        <i class="pi pi-filter"></i>
        Filters
      </h3>
      <button
        pButton
        type="button"
        label="Clear All"
        icon="pi pi-times"
        class="p-button-text p-button-sm clear-btn"
        (click)="clearFilters()"
        [disabled]="!searchQuery() && selectedStatus() === null"
      ></button>
    </div>

    <div class="filters-grid">
      <!-- Search by Name/ID -->
      <div class="filter-item">
        <label class="filter-label">Search by Name/ID</label>
        <p-iconfield iconPosition="left">
          <p-inputicon styleClass="pi pi-search" />
          <input
            pInputText
            type="text"
            placeholder="Search executives by name or employee ID..."
            class="search-input"
            [value]="searchQuery()"
            (input)="onSearch($event)"
          />
        </p-iconfield>
      </div>

      <!-- Status Filter -->
      <div class="filter-item">
        <label class="filter-label">Status</label>
        <p-select
          [options]="statusOptions"
          [(ngModel)]="selectedStatus"
          (onChange)="onStatusFilter($event.value)"
          placeholder="All Status"
          optionLabel="label"
          optionValue="value"
          class="filter-dropdown"
        />
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading() && executives().length === 0" class="loading-state">
    <div class="loading-card">
      <i class="pi pi-spin pi-spinner loading-icon"></i>
      <p class="loading-text">Loading executives...</p>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="errorMessage() && !isLoading()" class="error-state">
    <div class="error-card">
      <i class="pi pi-exclamation-circle error-icon"></i>
      <h3 class="error-title">Failed to Load Data</h3>
      <p class="error-message">{{ errorMessage() }}</p>
      <button
        pButton
        type="button"
        label="Retry"
        icon="pi pi-refresh"
        class="p-button-outlined"
        (click)="loadExecutives()"
      ></button>
    </div>
  </div>

  <!-- Data Table -->
  <div *ngIf="!isLoading() || executives().length > 0" class="table-card">
    <p-table
      [value]="displayedExecutives()"
      [paginator]="true"
      [rows]="10"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} executives"
      [rowsPerPageOptions]="[10, 25, 50]"
      styleClass="p-datatable-gridlines p-datatable-striped"
      responsiveLayout="scroll"
    >
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="name">Name <p-sortIcon field="name" /></th>
          <th pSortableColumn="employeeId">Employee ID <p-sortIcon field="employeeId" /></th>
          <th pSortableColumn="email">Email <p-sortIcon field="email" /></th>
          <th>Phone</th>
          <th>Manager</th>
          <th pSortableColumn="hierarchyPath">Hierarchy <p-sortIcon field="hierarchyPath" /></th>
          <th pSortableColumn="isActive">Status <p-sortIcon field="isActive" /></th>
          <th class="actions-column">Actions</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-executive>
        <tr>
          <!-- Name -->
          <td>
            <div class="executive-name-cell">
              <i class="pi pi-briefcase user-icon"></i>
              <span class="executive-name">{{ executive.name }}</span>
            </div>
          </td>

          <!-- Employee ID -->
          <td>
            <span class="employee-id">{{ executive.employeeId }}</span>
          </td>

          <!-- Email -->
          <td>
            <a [href]="'mailto:' + executive.email" class="email-link">
              {{ executive.email }}
            </a>
          </td>

          <!-- Phone -->
          <td>
            <span class="phone-number">{{ executive.phone }}</span>
          </td>

          <!-- Manager -->
          <td>
            <span class="manager-name">{{ executive.managerName || 'Unassigned' }}</span>
          </td>

          <!-- Hierarchy -->
          <td>
            <div class="hierarchy-cell">
              <i class="pi pi-sitemap hierarchy-icon"></i>
              <span class="hierarchy-path">{{ executive.hierarchyPath }}</span>
            </div>
          </td>

          <!-- Status -->
          <td>
            <p-tag
              [value]="executive.isActive ? 'Active' : 'Inactive'"
              [severity]="getStatusSeverity(executive.isActive)"
            />
          </td>

          <!-- Actions -->
          <td class="actions-cell">
            <div class="action-buttons">
              <button
                pButton
                type="button"
                icon="pi pi-eye"
                class="p-button-rounded p-button-text p-button-sm action-btn view-btn"
                pTooltip="View Details"
                tooltipPosition="top"
                (click)="viewExecutive(executive)"
              ></button>
              <button
                pButton
                type="button"
                icon="pi pi-pencil"
                class="p-button-rounded p-button-text p-button-sm action-btn edit-btn"
                pTooltip="Edit Executive"
                tooltipPosition="top"
                (click)="editExecutive(executive)"
              ></button>
              <button
                pButton
                type="button"
                icon="pi pi-trash"
                class="p-button-rounded p-button-text p-button-sm action-btn delete-btn"
                pTooltip="Delete Executive"
                tooltipPosition="top"
                (click)="deleteExecutive(executive)"
              ></button>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="8">
            <div class="empty-state">
              <i class="pi pi-briefcase empty-icon"></i>
              <h3 class="empty-title">No Executives Found</h3>
              <p class="empty-message">
                <span *ngIf="searchQuery() || selectedStatus() !== null">
                  No results match your filters. Try adjusting your search criteria.
                </span>
                <span *ngIf="!searchQuery() && selectedStatus() === null">
                  Get started by creating your first field executive.
                </span>
              </p>
              <button
                *ngIf="!searchQuery() && selectedStatus() === null"
                pButton
                type="button"
                label="Create Executive"
                icon="pi pi-plus"
                class="p-button-outlined"
                (click)="navigateToCreateExecutive()"
              ></button>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>

    <!-- âœ… REUSABLE DRAWER -->
    <app-view-user-drawer 
      [userId]="selectedExecutiveId()"
      [userType]="selectedUserType()"
      [visible]="drawerVisible()"
      (onClose)="closeDrawer()"
    ></app-view-user-drawer>

    <!-- Load More Button -->
    <div *ngIf="hasMore() && displayedExecutives().length > 0" class="load-more-section">
      <button
        pButton
        type="button"
        label="Load More"
        icon="pi pi-angle-down"
        class="p-button-outlined load-more-btn"
        [loading]="isLoading()"
        (click)="loadMore()"
      ></button>
    </div>
  </div>

  <!-- Toast Messages -->
  <p-toast />
</div>
</file>

<file path="src/app/features/user-management/components/executives/executive-list/executive-list.component.scss">
@use '../../admins//admin-list/admin-list.component.scss' as adminStyles; // âœ… Reuse admin styles


// âœ… SAME ENTERPRISE BLUE THEME as Admin List
.executive-list-container {
  padding: 2rem;
  background: #f9fafb;
  min-height: 100vh;
}


// Override specific selectors
.page-title i {
  color: #10b981; // Green for executives
}

.employee-id {
  font-family: 'Courier New', monospace;
  font-weight: 600;
  color: #1e40af;
  background: rgba(30, 64, 175, 0.1);
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  font-size: 0.85rem;
}

.manager-name {
  color: #374151;
  font-weight: 500;
}

.executive-name-cell {
  display: flex;
  align-items: center;
  gap: 0.75rem;

  .user-icon {
    color: #10b981; // Green theme
    font-size: 1.1rem;
  }

  .executive-name {
    font-weight: 600;
    color: #111827;
  }
}
</file>

<file path="src/app/features/user-management/components/executives/executive-list/executive-list.component.ts">
import { Component, OnInit, signal, computed, effect } from '@angular/core';
import { Router } from '@angular/router';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';

// PrimeNG Modules
import { TableModule } from 'primeng/table';
import { ButtonModule } from 'primeng/button';
import { InputTextModule } from 'primeng/inputtext';
import { SelectModule } from 'primeng/select';
import { TagModule } from 'primeng/tag';
import { ToastModule } from 'primeng/toast';
import { IconFieldModule } from 'primeng/iconfield';
import { InputIconModule } from 'primeng/inputicon';
import { SkeletonModule } from 'primeng/skeleton';
import { TooltipModule } from 'primeng/tooltip';
import { MessageService } from 'primeng/api';

// Services & Shared Interfaces
import { UserService } from '../../../user.service';
import { Id } from 'convex/_generated/dataModel';
import { ExecutiveUser } from '../../interfaces/userinterface'; // âœ… SHARED INTERFACE
import { ViewUserDrawerComponent } from '../../slideindrawer/view-user-drawer.component'; // âœ… REUSABLE DRAWER

// âœ… SHARED DROPDOWN INTERFACES
interface StatusOption {
  value: boolean | null;
  label: string;
}

@Component({
  selector: 'app-executive-list',
  standalone: true,
  imports: [
    CommonModule,
    FormsModule,
    TableModule,
    ButtonModule,
    InputTextModule,
    SelectModule,
    TagModule,
    ToastModule,
    IconFieldModule,
    InputIconModule,
    SkeletonModule,
    TooltipModule,
    ViewUserDrawerComponent, // âœ… REUSABLE DRAWER
  ],
  providers: [MessageService],
  templateUrl: './executive-list.component.html',
  styleUrls: ['./executive-list.component.scss'],
})
export class ExecutiveListComponent implements OnInit {
  // Data signals - FULLY TYPED from shared interface
  executives = signal<ExecutiveUser[]>([]);
  isLoading = signal(true);
  errorMessage = signal<string | null>(null);

  // Filter signals
  searchQuery = signal('');
  selectedStatus = signal<boolean | null>(null);

  // Pagination signals
  totalRecords = signal(0);
  hasMore = signal(true);
  continueCursor = signal<string | null>(null);

  // Drawer signals
  selectedExecutiveId = signal<Id<'executives'> | null>(null);
  drawerVisible = signal(false);
  selectedUserType = signal<'admin' | 'executive'>('executive');

  // Dropdown options
  statusOptions: StatusOption[] = [
    { value: null, label: 'All Status' },
    { value: true, label: 'Active' },
    { value: false, label: 'Inactive' },
  ];

  displayedExecutives = computed(() => {
    let filtered = this.executives();

    const query = this.searchQuery().toLowerCase().trim();
    if (query) {
      filtered = filtered.filter(exec =>
        exec.name.toLowerCase().includes(query) ||
        exec.employeeId.toLowerCase().includes(query)
      );
    }

    const status = this.selectedStatus();
    if (status !== null) {
      filtered = filtered.filter(exec => exec.isActive === status);
    }

    return filtered;
  });

  constructor(
    private userService: UserService,
    private router: Router,
    private messageService: MessageService
  ) {
    effect(() => {
      this.totalRecords.set(this.displayedExecutives().length);
    });
  }

  async ngOnInit() {
    await this.loadExecutives();
  }

  async loadExecutives(loadMore = false) {
    this.isLoading.set(true);
    this.errorMessage.set(null);

    try {
      const cursor = loadMore ? this.continueCursor() ?? null : null;
      const result = await this.userService.getExecutives(
        { numItems: 50, cursor },
        {}
      );

      if (loadMore) {
        this.executives.update(current => [...current, ...result.page]);
      } else {
        this.executives.set(result.page);
      }

      this.hasMore.set(!result.isDone);
      this.continueCursor.set(result.continueCursor ?? null);
    } catch (error: any) {
      console.error('Failed to load executives:', error);
      this.errorMessage.set(error?.message || 'Failed to load executives');
      this.messageService.add({
        severity: 'error',
        summary: 'Error',
        detail: this.errorMessage() ?? undefined,
        life: 3000,
      });
    } finally {
      this.isLoading.set(false);
    }
  }

  async loadMore() {
    if (!this.hasMore() || this.isLoading()) return;
    await this.loadExecutives(true);
  }

  onSearch(event: Event) {
    const value = (event.target as HTMLInputElement).value;
    this.searchQuery.set(value);
  }

  onStatusFilter(status: boolean | null) {
    this.selectedStatus.set(status);
  }

  clearFilters() {
    this.searchQuery.set('');
    this.selectedStatus.set(null);
  }

  navigateToCreateExecutive() {
    this.router.navigate(['/user-management/executives/create']);
  }

  editExecutive(executive: ExecutiveUser) {
    this.router.navigate(['/user-management/executives/edit', executive._id]);
  }

  // âœ… PERFECT DRAWER INTEGRATION
  viewExecutive(executive: ExecutiveUser) {
    this.selectedExecutiveId.set(executive._id as Id<'executives'>);
    this.selectedUserType.set('executive');
    this.drawerVisible.set(true);
  }

  closeDrawer() {
    this.drawerVisible.set(false);
    this.selectedExecutiveId.set(null);
  }

  async deleteExecutive(executive: ExecutiveUser) {
    if (!confirm(`Are you sure you want to delete ${executive.name}?`)) return;

    try {
      await this.userService.deleteExecutive(executive._id as Id<'executives'>);
      this.messageService.add({
        severity: 'success',
        summary: 'Success',
        detail: 'Executive deleted successfully',
        life: 3000,
      });
      await this.loadExecutives();
    } catch (error: any) {
      console.error('Failed to delete executive:', error);
      this.messageService.add({
        severity: 'error',
        summary: 'Error',
        detail: error?.message || 'Failed to delete executive',
        life: 3000,
      });
    }
  }

  getStatusSeverity(isActive: boolean): 'success' | 'danger' {
    return isActive ? 'success' : 'danger';
  }

  formatDate(timestamp: number): string {
    return new Date(timestamp).toLocaleDateString('en-IN', {
      day: 'numeric',
      month: 'short',
      year: 'numeric',
    });
  }
}
</file>

<file path="src/app/features/user-management/components/interfaces/userinterface.ts">
import { Id } from "convex/_generated/dataModel";

export interface BaseUser {
  _id: string;
  name: string;
  email: string;
  phone?: string;
  isActive: boolean;
  hierarchyName?: string;
  hierarchyPath?: string;
  createdAt: number;
}

export interface AdminUser extends BaseUser {
  roleLevel: number;
  roleName: string;
  lastLogin?: number;
  managerName?: string | null;
}

export interface ExecutiveUser extends BaseUser {
  employeeId: string;
  wardId: string;
  managerName?: string | null;
  managerEmail?: string;
  jobTitle?: string;
  department?: string;
}

export interface StatusOption {
  value: boolean | null;
  label: string;
}

export type UserDetail = AdminUser | ExecutiveUser;

export type TopPerformer = {
  _id: Id<"executives">;
  name: string;
  employeeId: string;
  email: string;
  totalTasks: number;
  completedTasks: number;
  completionRate: number;
};

export type DashboardSummary = {
  taskStats: {
    total: number;
    pending: number;
    inProgress: number;
    completed: number;
    overdue: number;
    completionRate: number;
  };
  topPerformers: TopPerformer[];
  recentActivity: Array<{
    _id: Id<"tasks">;
    title: string;
    status: string;
    priority: string;
    dueDate: number;
    createdAt: number;
  }>;
  totalExecutives: number;
  activeExecutives: number;
};

// âœ… UPDATED: Now uses hierarchyId instead of geographic fields
export interface CreateAdminArgs {
  name: string;
  email: string;
  phone?: string;
  roleLevel: number;
  managerId?: Id<'admin_users'>;
  
  // âœ… Geographic fields instead of hierarchyId
  zone?: string;
  district?: string;
  subdistrict?: string;
  localBody?: string;
  ward?: string;
}
export interface UpdateAdminArgs {
  userId: Id<'admin_users'>;
  name?: string;
  phone?: string;
  roleLevel?: number;
  isActive?: boolean;
  hierarchyId?: Id<'hierarchies'>; // âœ… Optional for updates
  managerId?: Id<'admin_users'>;
}

export type CreateExecutiveArgs = {
  // Basic Info
  email: string;
  firstName: string;
  lastName: string;
  phone: string;
  employeeId: string;
  
  // Personal Details (optional)
  dateOfBirth?: number;
  governmentId?: string;
  currentAddress?: string;
  
  // Employment
  jobTitle?: string;
  department?: string;
  contractType?: string;
  managerId: Id<"admin_users">;
  
  // Area of Operation
  region?: string;
  primaryTerritory?: string;
  assignedZones?: string[];
  
  // Standard
  wardIds: string[];
  hierarchyId: Id<"hierarchies">;
};

export type UpdateExecutiveArgs = {
  executiveId: Id<"executives">;
  name?: string;
  phone?: string;
  wardId?: string;
  managerId?: Id<"admin_users">;
  isActive?: boolean;
};

// ============================================================================
// DROPDOWN TYPES
// ============================================================================

export type DropdownOption = {
  value: string;
  label: string;
};

export type HierarchyOption = {
  _id: string;
  name: string;
  level: number;
  pathString: string;
  parentId: string | null;
};

export type ManagerOption = {
  _id: string;
  name: string;
  email: string;
  roleLevel: number;
  roleName: string;
  hierarchyName?: string;
  hierarchyPath?: string;
};

export interface RoleOption {
  value: number | null;
  label: string;
}

export type WardOption = {
  value: Id<"wards"> | string;
  label: string;
  wardCode?: string;
  fullPath: string;
};

export type ValidationResult = {
  valid: boolean;
  reason: string | null;
};

export type BackendRoleOption = {
  level: number;
  name: string;
};
</file>

<file path="src/app/features/user-management/components/slideindrawer/view-user-drawer.component.html">
<p-drawer 
  [(visible)]="visible" 
  position="right" 
  [style]="{ width: '500px' }" 
  [modal]="true" 
  [closeOnEscape]="true" 
  (onHide)="closeDrawer()"
>
  <ng-template pTemplate="header">
    <div class="drawer-header">
      <h2>
        <i class="pi" [class]="'pi-' + (userType === 'admin' ? 'user' : 'briefcase')"></i>
        {{ userType === 'admin' ? 'Admin' : 'Executive' }} Details
      </h2>
      <button 
        pButton 
        icon="pi pi-times" 
        class="p-button-text p-button-rounded p-button-plain" 
        (click)="closeDrawer()"
        pTooltip="Close"
        tooltipPosition="top"
      ></button>
    </div>
  </ng-template>

  <!-- Loading -->
  <div *ngIf="isLoading" class="drawer-loading">
    <p-progressSpinner style="width: 40px; height: 40px;"></p-progressSpinner>
    <p class="loading-text">Loading user details...</p>
  </div>

  <!-- No Data -->
  <div *ngIf="!isLoading && !userDetail" class="drawer-no-data">
    <i class="pi pi-user-minus" style="font-size: 3rem; color: #6b7280;"></i>
    <h3>No details available</h3>
    <p>User data not found or access denied.</p>
  </div>

  <!-- User Details -->
  <div *ngIf="!isLoading && userDetail" class="drawer-content">
    <!-- Profile Header -->
    <div class="profile-header">
      <div class="profile-avatar">
        <i class="pi pi-user" [class]="userType === 'admin' ? 'admin-avatar' : 'executive-avatar'"></i>
      </div>
      <div class="profile-info">
        <h1>{{ userDetail.name }}</h1>
        <p class="profile-email">{{ userDetail.email }}</p>
        <p-tag 
          [value]="userDetail.isActive ? 'Active' : 'Inactive'" 
          [severity]="userDetail.isActive ? 'success' : 'danger'"
          class="status-tag"
        ></p-tag>
      </div>
    </div>

    <!-- Admin Specific Fields -->
    <div *ngIf="isAdmin()">
      <div class="detail-section">
        <h3>Role Information</h3>
        <div class="detail-row">
          <span class="label">Role</span>
          <span class="value role-badge" [ngClass]="getRoleBadgeClass()">
            {{ getAdminRoleName() }}
          </span>
        </div>
        <div class="detail-row">
          <span class="label">Last Login</span>
          <span class="value">{{ getAdminLastLogin() }}</span>
        </div>
      </div>
    </div>

    <!-- Executive Specific Fields -->
    <div *ngIf="isExecutive()">
      <div class="detail-section">
        <h3>Employment Details</h3>
        <div class="detail-row">
          <span class="label">Employee ID</span>
          <span class="value">{{ getEmployeeId() }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Job Title</span>
          <span class="value">{{ getJobTitle() }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Ward</span>
          <span class="value">{{ getWardId() }}</span>
        </div>
      </div>
    </div>

    <!-- Common Fields -->
    <div class="detail-section">
      <h3>Organization Details</h3>
      <div class="detail-row">
        <span class="label">Phone</span>
        <span class="value">{{ userDetail.phone || 'N/A' }}</span>
      </div>
      <ng-container *ngIf="userDetail.hierarchyName">
        <div class="detail-row">
          <span class="label">Hierarchy</span>
          <span class="value">{{ userDetail.hierarchyName }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Path</span>
          <span class="value text-muted">{{ userDetail.hierarchyPath }}</span>
        </div>
      </ng-container>
      <div class="detail-row">
        <span class="label">Created</span>
        <span class="value">{{ formatDate(userDetail.createdAt) }}</span>
      </div>
    </div>
  </div>
</p-drawer>
</file>

<file path="src/app/features/user-management/components/slideindrawer/view-user-drawer.component.scss">
.drawer-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;

  h2 {
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 1.25rem;
    font-weight: 600;

    i {
      font-size: 1.5rem;
    }
  }
}

.drawer-loading {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  min-height: 300px;
  gap: 1rem;

  .loading-text {
    color: #6b7280;
  }
}

.drawer-no-data {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  min-height: 300px;
  color: #6b7280;
  text-align: center;

  h3 {
    margin: 0.5rem 0;
    color: #374151;
  }

  p {
    margin: 0;
  }
}

.drawer-content {
  padding: 1.5rem;
  max-height: calc(100vh - 120px);
  overflow-y: auto;

  .profile-header {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.5rem;
    padding-bottom: 1.5rem;
    border-bottom: 2px solid #e5e7eb;

    .profile-avatar {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;

      &.admin-avatar {
        background: linear-gradient(135deg, #3b82f6, #1e40af);
        i {
          font-size: 2rem;
          color: white;
        }
      }

      &.executive-avatar {
        background: linear-gradient(135deg, #10b981, #059669);
        i {
          font-size: 2rem;
          color: white;
        }
      }
    }

    .profile-info {
      flex: 1;

      h1 {
        margin: 0 0 0.25rem 0;
        font-size: 1.5rem;
        font-weight: 700;
        color: #111827;
      }

      .profile-email {
        margin: 0 0 0.75rem 0;
        color: #1e40af;
        font-weight: 500;
        font-size: 1rem;
      }

      .status-tag {
        font-size: 0.85rem;
      }
    }
  }

  .detail-section {
    margin-bottom: 2rem;

    h3 {
      margin: 0 0 1rem 0;
      font-size: 1.1rem;
      font-weight: 600;
      color: #111827;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid #e5e7eb;
    }

    .detail-row {
      display: flex;
      margin-bottom: 0.75rem;
      gap: 1rem;

      .label {
        font-weight: 600;
        color: #6b7280;
        min-width: 100px;
        font-size: 0.9rem;
      }

      .value {
        flex: 1;
        color: #374151;
        font-weight: 500;
      }

      .text-muted {
        color: #9ca3af;
        font-size: 0.85rem;
      }

      .role-badge {
        padding: 0.4rem 0.8rem;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        text-transform: uppercase;

        &.badge-super-admin { background: linear-gradient(135deg, #dc2626, #991b1b); color: white; }
        &.badge-state { background: linear-gradient(135deg, #7c3aed, #5b21b6); color: white; }
        &.badge-zonal { background: linear-gradient(135deg, #2563eb, #1e40af); color: white; }
        &.badge-district { background: linear-gradient(135deg, #0891b2, #0e7490); color: white; }
        &.badge-coordinator { background: linear-gradient(135deg, #10b981, #059669); color: white; }
      }
    }
  }
}
</file>

<file path="src/app/features/user-management/components/slideindrawer/view-user-drawer.component.ts">
import { Component, Input, Output, EventEmitter, OnChanges, SimpleChanges, inject } from '@angular/core';
import { CommonModule } from '@angular/common';
import { DrawerModule } from 'primeng/drawer';
import { ButtonModule } from 'primeng/button';
import { TagModule } from 'primeng/tag';
import { TooltipModule } from 'primeng/tooltip';
import { ProgressSpinnerModule } from 'primeng/progressspinner';

import { Id } from 'convex/_generated/dataModel';
import { UserService } from '../../user.service';
import { AdminUser, ExecutiveUser, UserDetail } from '../interfaces/userinterface';

interface AdminUserDetail {
  _id: Id<'admin_users'>;
  name: string;
  email: string;
  phone?: string;
  roleLevel: number;
  roleName: string;
  hierarchyName: string;
  hierarchyPath: string;
  isActive: boolean;
  lastLogin?: number;
  createdAt: number;
  // Add more detailed fields as needed
}

@Component({
  selector: 'app-view-user-drawer',
  standalone: true,
  imports: [
    CommonModule,
    DrawerModule,
    ButtonModule,
    TagModule,
    TooltipModule,
    ProgressSpinnerModule,
  ],
  templateUrl: './view-user-drawer.component.html',
  styleUrls: ['./view-user-drawer.component.scss'],
})
export class ViewUserDrawerComponent implements OnChanges {
  @Input() userId: Id<'admin_users'> | Id<'executives'> | null = null;
  @Input() userType: 'admin' | 'executive' = 'admin';
  @Input() visible = false;
  @Output() onClose = new EventEmitter<void>();

  private userService = inject(UserService);
  
  userDetail: UserDetail | null = null;
  isLoading = false;

  ngOnChanges(changes: SimpleChanges) {
    if (changes['visible']?.currentValue && this.userId && this.visible) {
      this.loadUserDetail();
    }
    if (changes['visible']?.currentValue === false) {
      this.userDetail = null;
    }
  }

  async loadUserDetail() {
    if (!this.userId) return;
    
    try {
      this.isLoading = true;
      this.userDetail = null;

      if (this.userType === 'admin') {
        this.userDetail = await this.userService.getAdminById(this.userId as Id<'admin_users'>);
      } else {
        this.userDetail = await this.userService.getExecutiveById(this.userId as Id<'executives'>);
      }
    } catch (error) {
      console.error(`Failed to load ${this.userType} detail:`, error);
    } finally {
      this.isLoading = false;
    }
  }

  closeDrawer() {
    this.onClose.emit();
  }

  formatDate(timestamp: number | undefined): string {
    if (!timestamp) return 'N/A';
    return new Date(timestamp).toLocaleDateString('en-IN', {
      day: 'numeric',
      month: 'short',
      year: 'numeric',
      hour: '2-digit',
      minute: '2-digit',
    });
  }

  isAdmin(): boolean {
    return this.userType === 'admin' && !!this.userDetail;
  }

  isExecutive(): boolean {
    return this.userType === 'executive' && !!this.userDetail;
  }

  getStatusClass(): string {
    return this.userDetail?.isActive ? 'status-active' : 'status-inactive';
  }

  getRoleBadgeClass(): string {
    if (!this.isAdmin() || !this.userDetail) return '';
    const roleLevel = (this.userDetail as AdminUser).roleLevel;
    if (roleLevel >= 12) return 'badge-super-admin';
    if (roleLevel >= 10) return 'badge-state';
    if (roleLevel >= 8) return 'badge-zonal';
    if (roleLevel >= 6) return 'badge-district';
    return 'badge-coordinator';
  }

  // âœ… SAFE HELPER METHODS - No more type casting errors!
getAdminRoleName(): string {
  return this.isAdmin() && this.userDetail ? (this.userDetail as AdminUser).roleName : 'N/A';
}

getAdminLastLogin(): string {
  return this.isAdmin() && this.userDetail 
    ? this.formatDate((this.userDetail as AdminUser).lastLogin) 
    : 'N/A';
}

getEmployeeId(): string {
  return this.isExecutive() && this.userDetail 
    ? (this.userDetail as ExecutiveUser).employeeId 
    : 'N/A';
}

getJobTitle(): string {
  return this.isExecutive() && this.userDetail 
    ? (this.userDetail as ExecutiveUser).jobTitle || 'N/A' 
    : 'N/A';
}

getWardId(): string {
  return this.isExecutive() && this.userDetail 
    ? (this.userDetail as ExecutiveUser).wardId 
    : 'N/A';
}

}
</file>

<file path="src/app/features/user-management/user.management.route.ts">
import { Routes } from '@angular/router';
import { AdminListComponent } from './components/admins/admin-list/admin-list.component';
import { ExecutiveFormComponent } from './components/executives/executive-form/executive-form.component';
import { ExecutiveListComponent } from './components/executives/executive-list/executive-list.component';
import { AdminRbacFormComponent } from './components/admins/admin-form/admin-rbac-form.component';

export const USER_MANAGEMENT_ROUTES: Routes = [
  { path: 'admins', component: AdminListComponent },
  { path: 'admins/create', component: AdminRbacFormComponent },
  { path: 'admins/edit/:id', component: AdminRbacFormComponent },
  { path: 'executives', component: ExecutiveListComponent },
  { path: 'executives/create', component: ExecutiveFormComponent },
  { path: 'executives/edit/:id', component: ExecutiveFormComponent },
  { path: '', redirectTo: 'admins', pathMatch: 'full' }
];
</file>

<file path="src/app/features/user-management/user.service.ts">
// src/app/features/user-management/user.service.ts

import { Injectable } from '@angular/core';
import { ConvexService } from '../../core/services/convex.service';
import { DashboardSummary, TopPerformer } from '../task-management/models';
import {
    CreateAdminArgs,
    UpdateAdminArgs,
    CreateExecutiveArgs,
    UpdateExecutiveArgs,
    ManagerOption,
    RoleOption,
    ValidationResult,
    WardOption,
    DropdownOption,
    HierarchyOption,
    BackendRoleOption
} from './components/interfaces/userinterface';
import { api } from 'convex/_generated/api';
import { Id } from 'convex/_generated/dataModel';

// Type definitions

@Injectable({ providedIn: 'root' })
export class UserService {
    private get convex() {
        return this.convexService.client;
    }

    constructor(private convexService: ConvexService) {}


  getAdmins(
        paginationOpts: any, 
        filters?: { search?: string; roleLevel?: number; isActive?: boolean }
    ): Promise<any> {
        return this.convex.query(api.users.admin.queries.listAdmins, {
            paginationOpts,
            ...filters,
        });
    }

    getAdminById(id: Id<"admin_users">): Promise<any> {
        return this.convex.query(api.users.admin.queries.getAdminUser, { userId: id });
    }

    createAdmin(userData: CreateAdminArgs): Promise<any> {
      console.log('ðŸ“¤ Sending to backend:', userData);
        return this.convex.action(api.users.admin.mutations.createAdminAccount, userData);
    }

    updateAdmin(userData: UpdateAdminArgs): Promise<any> {
        return this.convex.action(api.users.admin.mutations.updateAdminUser, userData);
    }

    deleteAdmin(userId: Id<"admin_users">): Promise<any> {
        return this.convex.action(api.users.admin.mutations.deleteAdminUser, { userId });
    }

    // --- Executive Functions ---

   getExecutives(
        paginationOpts: any, 
        filters?: { search?: string; wardId?: string; managerId?: Id<"admin_users">; isActive?: boolean }
    ): Promise<any> {
        return this.convex.query(api.users.admin.queries.listAllExecutives, {
            paginationOpts,
            ...filters,
        });
    }
async getAdminUserForEdit(userId: Id<'admin_users'>): Promise<any> {
  return this.convex.query(api.users.admin.queries.getAdminUserForEdit, { userId });
}

    getExecutiveById(id: Id<"executives">): Promise<any> {
        return this.convex.query(api.users.admin.queries.getExecutive, { executiveId: id });
    }

    createExecutive(userData: CreateExecutiveArgs): Promise<any> {
        return this.convex.action(api.users.admin.mutations.createExecutiveAccount, userData);
    }

  
    deleteExecutive(executiveId: Id<"executives">): Promise<any> {
        return this.convex.action(api.users.admin.mutations.deleteExecutive, { executiveId });
    }
async getExecutiveForEdit(executiveId: Id<'executives'>): Promise<any> {
  return this.convex.query(api.executives.queries.getExecutiveForEdit, { executiveId });
}

async updateExecutive(data: {
  executiveId: Id<'executives'>;
  firstName?: string;
  lastName?: string;
  phone?: string;
  dateOfBirth?: number;
  governmentId?: string;
  currentAddress?: string;
  jobTitle?: string;
  department?: string;
  contractType?: string;
  managerId?: Id<'admin_users'>;
  region?: string;
  primaryTerritory?: string;
  assignedZones?: string[];
  wardIds?: string[];
  isActive?: boolean;
}): Promise<{ success: boolean }> {
  return this.convex.action(api.users.admin.mutations.updateExecutiveAccount, data);
}

    // --- Bulk Operations ---

  bulkImportExecutives(csvData: Array<{
    name: string;
    email: string;
    phone: string;
    employeeId: string;
    wardIds: string;
    managerEmail: string;
  }>): Promise<any> {
    return this.convex.action(api.users.admin.actions.bulkImportExecutives, { csvData });
  }
  exportExecutivesToCSV(filters?: { hierarchyId?: Id<"hierarchies">; isActive?: boolean }): Promise<string> {
    return this.convex.action(api.users.admin.actions.exportExecutivesToCSV, filters || {});
  }

  generateExecutiveReport(
    executiveId: Id<"executives">, 
    startDate: number, 
    endDate: number
  ): Promise<any> {
    return this.convex.action(api.users.admin.actions.generateExecutiveReport, {
      executiveId,
      startDate,
      endDate,
    });
  }

    // --- Hierarchy ---
  getHierarchyStructure(): Promise<any> {
    return this.convex.query(api.users.admin.queries.getHierarchyStructure, {});
  }


    // âœ… FIXED: Correct path for dashboard
  getDashboardSummary(): Promise<DashboardSummary> {
    return this.convex.query(api.tasks.admin.queries.getDashboardSummary, {});
  }

    // âœ… Helper method for top performers
  async getTopPerformers(): Promise<TopPerformer[]> {
    const dashboard = await this.getDashboardSummary();
    return dashboard.topPerformers;
  }

async createAdminUser(formData: {
  name: string;
  email: string;
  phone?: string;
  roleLevel: number;
  managerId?: string;
  zone?: string;
  district?: string;
  subdistrict?: string;
  localBody?: string;
  ward?: string;
}): Promise<any> {
  const adminData: CreateAdminArgs = {
    email: formData.email,
    name: formData.name,
    phone: formData.phone,
    roleLevel: formData.roleLevel,
    managerId: formData.managerId ? (formData.managerId as Id<"admin_users">) : undefined,
    
    // âœ… Pass geographic fields
    zone: formData.zone,
    district: formData.district,
    subdistrict: formData.subdistrict,
    localBody: formData.localBody,
    ward: formData.ward,
  };

  console.log('ðŸ“¤ Sending to backend:', adminData);

  return this.createAdmin(adminData);
}
async updateAdminUser(data: {
  userId: Id<'admin_users'>;
  name?: string;
  phone?: string;
  roleLevel?: number;
  isActive?: boolean;
  zone?: string;
  district?: string;
  subdistrict?: string;
  localBody?: string;
  ward?: string;
}): Promise<{ success: boolean }> {
  return this.convex.action(api.users.admin.mutations.updateAdminUser, data);
}

    // âœ… NEW: Get hierarchies for dropdown
  getHierarchies(roleLevel?: number): Promise<HierarchyOption[]> {
    return this.convex.query(api.users.admin.lookups.listHierarchiesForDropdown, {
      roleLevel: roleLevel,
    });
  }
  getManagersForAdmin(hierarchyId: string, roleLevel: number): Promise<ManagerOption[]> {
    return this.convex.query(api.users.admin.lookups.listManagersForAdmin, {
      hierarchyId: hierarchyId as Id<"hierarchies">,
      roleLevel: roleLevel,
    });
  }


    // âœ… NEW: Get managers by hierarchy for dropdown
  getManagersByHierarchy(hierarchyId: string): Promise<ManagerOption[]> {
    return this.convex.query(api.users.admin.lookups.getManagersForExecutives, {
      hierarchyId: hierarchyId as Id<"hierarchies">,
    });
  }

async getAvailableRoles(): Promise<RoleOption[]> {
  const backendRoles: BackendRoleOption[] = await this.convex.query(
    api.users.admin.lookups.getAvailableRoleLevels, 
    {}
  );
  
  // Transform to frontend format
  return backendRoles.map(role => ({
    value: role.level,
    label: role.name
  }));
}
  validateHierarchyForRole(hierarchyId: string, roleLevel: number): Promise<ValidationResult> {
    return this.convex.query(api.users.admin.lookups.validateHierarchyForRole, {
      hierarchyId: hierarchyId as Id<"hierarchies">,
      roleLevel: roleLevel,
    });
  }

    getZones(): Promise<DropdownOption[]> {
    return this.convex.query(api.users.admin.lookups.getZonesForExecutives, {});
  }

   getDistricts(zone?: string): Promise<DropdownOption[]> {
    return this.convex.query(api.users.admin.lookups.getDistrictsForExecutives, { zone });
  }

  /**
   * Get subdistricts
   */
  getSubdistricts(zone?: string, district?: string): Promise<DropdownOption[]> {
    return this.convex.query(api.users.admin.lookups.getSubdistrictsForExecutives, {
      zone,
      district,
    });
  }

  /**
   * Get local body types (Panchayath, Municipality, Corporation)
   */
  getLocalBodyTypes(): Promise<DropdownOption[]> {
    return this.convex.query(api.users.admin.lookups.getLocalBodyTypesForExecutives, {});
  }

  /**
   * Get local bodies (filtered by zone/district/subdistrict/type)
   */
getLocalBodies(filters: {
  zone?: string;
  district?: string;
  subdistrict?: string;
  localBodyType?: string;
}): Promise<DropdownOption[]> {
  return this.convex.query(api.users.admin.lookups.getLocalBodiesForExecutives, filters);
}

  /**
   * Get wards (optional - for specific ward assignment)
   */
  getWards(filters: {
    zone?: string;
    district?: string;
    subdistrict?: string;
    localBodyName?: string;
    limit?: number;
  }): Promise<WardOption[]> {
    return this.convex.query(api.users.admin.lookups.getWardsForExecutives, filters);
  }

  // ============================================================================
  // LOOKUPS - EMPLOYMENT
  // ============================================================================

  /**
   * Get contract types (Full-Time, Part-Time, Contract)
   */
  getContractTypes(): Promise<DropdownOption[]> {
    return this.convex.query(api.users.admin.lookups.getContractTypes, {});
  }

  /**
   * Get departments (future use)
   */
  getDepartments(): Promise<DropdownOption[]> {
    return this.convex.query(api.users.admin.lookups.getDepartments, {});
  }

    // âœ… Helper: Flatten hierarchy for dropdown
    private flattenHierarchy(structure: any): Array<{ _id: string; name: string; level: number }> {
    const flattened: Array<{ _id: string; name: string; level: number }> = [];
    
    const flatten = (node: any, level: number = 0) => {
      if (node._id) {
        flattened.push({
          _id: node._id,
          name: node.name || 'Unknown',
          level,
        });
      }
      
      if (node.children) {
        node.children.forEach((child: any) => flatten(child, level + 1));
      }
    };

    if (Array.isArray(structure)) {
      structure.forEach(node => flatten(node));
    } else {
      flatten(structure);
    }

    return flattened;
  }

  async generatePasswordResetToken(email: string): Promise<{ token: string; expiresAt: number }> {
  return this.convex.action(api.users.admin.actions.generatePasswordResetToken, { 
    email 
  });
}
}
</file>

<file path="src/app/layout/components/app-menu/app.menu.component.html">
<ul class="layout-menu">
    @for (item of model(); track $index) {
        <li app-menuitem [item]="item" [index]="$index" [root]="true"></li>
    }
</ul>
</file>

<file path="src/app/layout/components/app-menu/app.menu.ts">
import { Component, computed } from '@angular/core';
import { AuthService } from '@/core/services/auth.service';
import { CommonModule } from '@angular/common';
import { RouterModule } from '@angular/router';
import { AppMenuitem } from '../app.menuitem';
import { MessageService } from 'primeng/api';

@Component({
    selector: 'app-menu',
    standalone: true,
    imports: [CommonModule, RouterModule, AppMenuitem],
    providers: [MessageService],
    templateUrl: './app.menu.component.html'
})
export class AppMenuComponent {
    constructor(
        private authService: AuthService,
        private messageService: MessageService
    ) {}

    model = computed(() => {
        const user = this.authService.currentUser();
        const roleLevel = user?.roleLevel || 0;

        // âœ… Base menu - Available to ALL admin roles
        const dashboardMenu = {
            label: 'Home',
            i18n: '@@menuHome',
            items: [
                {
                    label: 'Dashboard',
                    icon: 'pi pi-home',
                    routerLink: ['/dashboard'],
                    i18n: '@@menuDashboard'
                }
            ]
        };

        // âœ… Executive Management - Available to ALL admin roles (Level 2+)
        const executiveManagement = {
            label: 'Executive Management',
            i18n: '@@menuTeamManagement',
            items: [
                {
                    label: 'View My Executives',
                    icon: 'pi pi-users',
                    routerLink: ['/user-management/executives'],
                    i18n: '@@menuViewMyTeam'
                },
                {
                    label: 'Approval Queue',
                    icon: 'pi pi-check-square',
                    routerLink: ['/tasks/tasks-approve'],
                    i18n: '@@menuApprovalQueue'
                }
            ]
        };

        // âœ… Task Settings - Available to ALL admin roles
        const taskSettings = {
            label: 'Task Settings',
            i18n: '@@menuTaskSettings',
            items: [
                {
                    label: 'Tasks List',
                    icon: 'pi pi-sitemap',
                    routerLink: ['/tasks/tasks-list'],
                    i18n: '@@menuTaskList'
                },
                {
                    label: 'Add Tasks',
                    icon: 'pi pi-sitemap',
                    routerLink: ['/tasks/tasks-add'],
                    i18n: '@@menuTaskList'
                }
            ]
        };

        // âœ… Base menu for ALL roles
        const baseMenu = [dashboardMenu, executiveManagement, taskSettings];

        // ðŸŽ¯ LOCAL BODY MANAGER+ (Level 4+): Can view admins
        const adminManagementMenu =
            roleLevel >= 4
                ? [
                      {
                          label: 'Admin Management',
                          i18n: '@@menuAdminManagement',
                          items: [
                              {
                                  label: 'View Admins',
                                  icon: 'pi pi-sitemap',
                                  routerLink: ['/user-management/admins'],
                                  i18n: '@@menuManageAdmins'
                              }
                          ]
                      }
                  ]
                : [];

        // ðŸŽ¯ DISTRICT MANAGER+ (Level 6+): Training Module
        const trainingMenu =
            roleLevel >= 6
                ? [
                      {
                          label: 'Training Module',
                          i18n: '@@menuTrainingModule',
                          items: [
                              {
                                  label: 'Manage Content',
                                  icon: 'pi pi-video',
                                  routerLink: ['/training/content'],
                                  i18n: '@@menuManageContent'
                              },
                              {
                                  label: 'Quiz Manager',
                                  icon: 'pi pi-question-circle',
                                  routerLink: ['/training/quiz'],
                                  i18n: '@@menuQuizManager'
                              },
                              {
                                  label: 'View Progress',
                                  icon: 'pi pi-chart-bar',
                                  routerLink: ['/training/progress'],
                                  i18n: '@@menuViewProgress'
                              },
                              {
                                  label: 'PDF Template',
                                  icon: 'pi pi-dollar',
                                  routerLink: [
                                      '/settings/certificate-templates'
                                  ],
                                  i18n: '@@menuPdfTemplates'
                              }
                          ]
                      }
                  ]
                : [];

        // ðŸŽ¯ STATE HEAD+ (Level 10+): HR & Recruitment
        const hrMenu =
            roleLevel >= 10
                ? [
                      {
                          label: 'HR & Recruitment',
                          i18n: '@@menuHrRecruitment',
                          items: [
                              {
                                  label: 'Candidate Pipeline',
                                  icon: 'pi pi-users',
                                  routerLink: ['/recruitment/pipeline'],
                                  i18n: '@@menuCandidatePipeline'
                              },
                              {
                                  label: 'Manage Jobs',
                                  icon: 'pi pi-book',
                                  routerLink: ['/recruitment/jobs'],
                                  i18n: '@@menuManageJobs'
                              }
                          ]
                      }
                  ]
                : [];

        // ðŸŽ¯ SUPER ADMIN ONLY (Level 12): Store Management
        const storeMenu =
            roleLevel === 12
                ? [
                      {
                          label: 'Store Management',
                          i18n: '@@menuStoreManagement',
                          items: [
                              {
                                  label: 'Manage Products',
                                  icon: 'pi pi-tags',
                                  routerLink: ['/store/products'],
                                  i18n: '@@menuManageProducts'
                              },
                              {
                                  label: 'View Orders',
                                  icon: 'pi pi-inbox',
                                  routerLink: ['/store/orders'],
                                  i18n: '@@menuViewOrders'
                              }
                          ]
                      }
                  ]
                : [];

        // âœ… Build final menu based on role level
        return [
            ...baseMenu, // ALL roles (Level 2+)
            ...adminManagementMenu, // Level 4+ (Local Body Manager+)
            ...trainingMenu, // Level 6+ (District Manager+) âœ… NEW
            ...hrMenu, // Level 10+ (State Head+)
            ...storeMenu // Level 12 only (Super Admin)
        ];
    });
}
</file>

<file path="src/app/layout/components/app-profile-sidebar/app.profilesidebar.component.html">
<p-drawer
    [visible]="visible()"
    (onHide)="onDrawerHide()"
    position="right"
    styleClass="layout-profile-sidebar w-full sm:w-25rem"
>
    <div class="flex flex-col mx-auto md:mx-0">
        <span class="mb-2 font-semibold">Welcome</span>
        <span class="text-surface-500 dark:text-surface-400 font-medium mb-8">
            {{ userName }}
        </span>

        <ul class="list-none m-0 p-0">
            <li>
                <a (click)="signOut()" class="cursor-pointer flex p-4 items-center border border-surface-200 dark:border-surface-700 rounded hover:bg-surface-100 dark:hover:bg-surface-800 transition-colors duration-150">
                    <span>
                        <i class="pi pi-power-off text-xl text-primary"></i>
                    </span>
                    <div class="ml-4">
                        <span class="mb-2 font-semibold">Sign Out</span>
                    </div>
                </a>
            </li>
        </ul>
    </div>
</p-drawer>
</file>

<file path="src/app/layout/components/app-profile-sidebar/app.profilesidebar.ts">
import { Component, computed, inject } from '@angular/core';
import { CommonModule } from '@angular/common';
import { ButtonModule } from 'primeng/button';
import { DrawerModule } from 'primeng/drawer';
import { LayoutService } from '@/layout/service/layout.service';
import { AuthService } from '@/core/services/auth.service'; 

@Component({
    selector: '[app-profilesidebar]',
    standalone: true,
    imports: [
        CommonModule,
        ButtonModule,
        DrawerModule,
    ],
    templateUrl: 'app.profilesidebar.component.html',
})
export class AppProfileSidebar {
    // TODO: Fetch and display the real user's name from the AuthService
    userName = "Isabella Andolini"; // Placeholder name

    layoutService = inject(LayoutService);
    authService = inject(AuthService);

    visible = computed(
        () => this.layoutService.layoutState().profileSidebarVisible,
    );

    onDrawerHide() {
        this.layoutService.hideProfileSidebar();
    }

    signOut() {
        this.authService.logout();
    }
}
</file>

<file path="src/app/layout/components/app-side-bar/app.sidebar.component.html">
<div
        class="layout-sidebar"
        (mouseenter)="onMouseEnter()"
        (mouseleave)="onMouseLeave()"
    >
        <div class="sidebar-header">
            <a [routerLink]="['/']" class="app-logo">
            <svg viewBox="0 0 124 22" fill="none" xmlns="http://www.w3.org/2000/svg" class="app-logo-normal">
                    <path d="M10.4851 0L0 20.9465H3.53702L10.4856 6.07843L17.2944 20.9465H20.9715L10.4851 0Z" fill="var(--logo-color)" />
                    <path d="M13.84 15.7927L16.2077 21.0016H11.7682L13.84 15.7927Z" fill="var(--logo-color)" />
                    <path d="M9.04645 21.0016L6.67875 15.7927L4.60701 21.0016H9.04645Z" fill="var(--logo-color)" />
                    <path d="M40.9033 14.5217H34.771L33.1753 18.0007H30.8467L37.9346 2.77661L44.772 18.0007H42.4062L40.9033 14.5217ZM40.022 12.49L37.8975 7.61938L35.6709 12.49H40.022Z" fill="var(--logo-color)" />
                    <path
                        d="M52.4927 12.1838V18.0007H50.3311V3.67651H52.7803C53.9802 3.67651 54.8862 3.76001 55.4985 3.927C56.117 4.09399 56.6613 4.40942 57.1314 4.87329C57.954 5.67733 58.3652 6.69165 58.3652 7.91626C58.3652 9.22746 57.9261 10.2665 57.0479 11.0334C56.1696 11.8004 54.9852 12.1838 53.4946 12.1838H52.4927ZM52.4927 10.1799H53.2998C55.2852 10.1799 56.2778 9.4161 56.2778 7.88843C56.2778 6.41024 55.2542 5.67114 53.207 5.67114H52.4927V10.1799Z"
                        fill="var(--logo-color)"
                    />
                    <path
                        d="M63.6367 10.7737C63.6367 8.75741 64.3758 7.02563 65.854 5.57837C67.326 4.1311 69.0949 3.40747 71.1607 3.40747C73.2017 3.40747 74.952 4.13729 76.4116 5.59692C77.8775 7.05656 78.6104 8.80998 78.6104 10.8572C78.6104 12.9167 77.8744 14.664 76.4024 16.0989C74.9242 17.54 73.1398 18.2605 71.0493 18.2605C69.2001 18.2605 67.5394 17.6204 66.0674 16.3401C64.447 14.9237 63.6367 13.0683 63.6367 10.7737ZM65.8169 10.8015C65.8169 12.3848 66.3488 13.6868 67.4126 14.7073C68.4702 15.7278 69.6918 16.238 71.0772 16.238C72.5801 16.238 73.848 15.7185 74.8809 14.6794C75.9138 13.628 76.4302 12.3477 76.4302 10.8386C76.4302 9.31095 75.9199 8.03068 74.8994 6.9978C73.8851 5.95874 72.6296 5.43921 71.1328 5.43921C69.6423 5.43921 68.3836 5.95874 67.357 6.9978C66.3303 8.0245 65.8169 9.2924 65.8169 10.8015Z"
                        fill="var(--logo-color)"
                    />
                    <path d="M87.2495 3.67651V15.969H91.4615V18.0007H85.0879V3.67651H87.2495Z" fill="var(--logo-color)" />
                    <path d="M99.4327 3.67651V15.969H103.645V18.0007H97.271V3.67651H99.4327Z" fill="var(--logo-color)" />
                    <path
                        d="M108.146 10.7737C108.146 8.75741 108.885 7.02563 110.363 5.57837C111.835 4.1311 113.604 3.40747 115.67 3.40747C117.711 3.40747 119.461 4.13729 120.921 5.59692C122.387 7.05656 123.12 8.80998 123.12 10.8572C123.12 12.9167 122.384 14.664 120.912 16.0989C119.433 17.54 117.649 18.2605 115.559 18.2605C113.709 18.2605 112.049 17.6204 110.577 16.3401C108.956 14.9237 108.146 13.0683 108.146 10.7737ZM110.326 10.8015C110.326 12.3848 110.858 13.6868 111.922 14.7073C112.98 15.7278 114.201 16.238 115.586 16.238C117.089 16.238 118.357 15.7185 119.39 14.6794C120.423 13.628 120.94 12.3477 120.94 10.8386C120.94 9.31095 120.429 8.03068 119.409 6.9978C118.394 5.95874 117.139 5.43921 115.642 5.43921C114.152 5.43921 112.893 5.95874 111.866 6.9978C110.84 8.0245 110.326 9.2924 110.326 10.8015Z"
                        fill="var(--logo-color)"
                    />
                </svg>
                <svg width="21" height="22" viewBox="0 0 21 22" fill="none" xmlns="http://www.w3.org/2000/svg" class="app-logo-small">
                    <path d="M10.4851 0L0 20.9465H3.53702L10.4856 6.07843L17.2944 20.9465H20.9715L10.4851 0Z" fill="var(--logo-color)" />
                    <path d="M13.8399 15.793L16.2076 21.0019H11.7681L13.8399 15.793Z" fill="var(--logo-color)" />
                    <path d="M9.04637 21.0019L6.67867 15.793L4.60693 21.0019H9.04637Z" fill="var(--logo-color)" />
                </svg>
            </a>
            <button
                class="layout-sidebar-anchor p-link z-2 hover:cursor-pointer"
                type="button"
                (click)="anchor()"
            ></button>
        </div>

        <div #menuContainer class="layout-menu-container">
            <app-menu></app-menu>
        </div>
    </div>
</file>

<file path="src/app/layout/components/app-side-bar/app.sidebar.ts">
import { Component, computed, ElementRef, inject, ViewChild } from '@angular/core';
import { CommonModule } from '@angular/common';
import { RouterModule } from '@angular/router';
import { DrawerModule } from 'primeng/drawer';
import { LayoutService } from '@/layout/service/layout.service';
import { AppMenuComponent } from '../app-menu/app.menu';

@Component({
    selector: '[app-sidebar]',
    standalone: true,
    imports: [
        CommonModule,
        RouterModule,
        DrawerModule,
        AppMenuComponent
    ],
    templateUrl: './app.sidebar.component.html'
})
export class AppSidebar {
    timeout: any = null;

    @ViewChild('menuContainer') menuContainer!: ElementRef;
    constructor(
        public layoutService: LayoutService,
        public el: ElementRef,
    ) {}

    onMouseEnter() {
        if (!this.layoutService.layoutState().anchored) {
            if (this.timeout) {
                clearTimeout(this.timeout);
                this.timeout = null;
            }

            this.layoutService.layoutState.update((state) => {
                if (!state.sidebarActive) {
                    return {
                        ...state,
                        sidebarActive: true,
                    };
                }
                return state;
            });
        }
    }

    onMouseLeave() {
        if (!this.layoutService.layoutState().anchored) {
            if (!this.timeout) {
                this.timeout = setTimeout(() => {
                    this.layoutService.layoutState.update((state) => {
                        if (state.sidebarActive) {
                            return {
                                ...state,
                                sidebarActive: false,
                            };
                        }
                        return state;
                    });
                }, 300);
            }
        }
    }

    anchor() {
        this.layoutService.layoutState.update((state) => ({
            ...state,
            anchored: !state.anchored,
        }));
    }
}
</file>

<file path="src/app/layout/components/app-topbar/app.topbar.component.html">
<div class="layout-topbar">
    <div class="topbar-start">
        <button #menubutton type="button" class="topbar-menubutton p-link p-trigger" (click)="onMenuButtonClick()">
            <i class="pi pi-bars"></i>
        </button>
        <nav app-breadcrumb class="topbar-breadcrumb"></nav>
    </div>

    <div class="topbar-end">
        <ul class="topbar-menu">
            <li class="topbar-profile">
                <button type="button" class="p-link" (click)="onProfileButtonClick()">
                    <img src="assets/layout/images/avatar.png" alt="Profile" />
                </button>
            </li>
        </ul>
    </div>
</div>
</file>

<file path="src/app/layout/components/app-topbar/app.topbar.ts">
import { Component, ElementRef, ViewChild } from '@angular/core';
import { RouterModule } from '@angular/router';
import { CommonModule } from '@angular/common';
import { LayoutService } from '@/layout/service/layout.service';
import { AppBreadcrumb } from '../app.breadcrumb';

@Component({
    selector: '[app-topbar]',
    standalone: true,
    imports: [RouterModule, CommonModule, AppBreadcrumb],
    templateUrl: 'app.topbar.component.html'
})
export class AppTopbar {
    @ViewChild('menubutton') menuButton!: ElementRef;

    constructor(public layoutService: LayoutService) {}

    onMenuButtonClick() {
        this.layoutService.onMenuToggle();
    }

    onProfileButtonClick() {
        this.layoutService.showProfileSidebar();
    }
}
</file>

<file path="src/app/layout/components/app.breadcrumb.ts">
import { Component } from '@angular/core';
import { CommonModule } from '@angular/common';
import {
    ActivatedRouteSnapshot,
    NavigationEnd,
    Router,
    RouterModule,
} from '@angular/router';

import { BehaviorSubject, filter } from 'rxjs';

interface Breadcrumb {
    label: string;
    url?: string;
}

@Component({
    selector: '[app-breadcrumb]',
    standalone: true,
    imports: [CommonModule, RouterModule],
    template: `<nav class="layout-breadcrumb">
        <ol>
            <ng-template
                ngFor
                let-item
                let-last="last"
                [ngForOf]="breadcrumbs$ | async"
            >
                <li>{{ item.label }}</li>
                <li *ngIf="!last" class="layout-breadcrumb-chevron">/</li>
            </ng-template>
        </ol>
    </nav> `,
})
export class AppBreadcrumb {
    private readonly _breadcrumbs$ = new BehaviorSubject<Breadcrumb[]>([]);

    readonly breadcrumbs$ = this._breadcrumbs$.asObservable();

    constructor(private router: Router) {
        this.router.events
            .pipe(filter((event) => event instanceof NavigationEnd))
            .subscribe((event) => {
                const root = this.router.routerState.snapshot.root;
                const breadcrumbs: Breadcrumb[] = [];
                this.addBreadcrumb(root, [], breadcrumbs);

                this._breadcrumbs$.next(breadcrumbs);
            });
    }

    private addBreadcrumb(
        route: ActivatedRouteSnapshot,
        parentUrl: string[],
        breadcrumbs: Breadcrumb[],
    ) {
        const routeUrl = parentUrl.concat(route.url.map((url) => url.path));
        const breadcrumb = route.data['breadcrumb'];
        const parentBreadcrumb =
            route.parent && route.parent.data
                ? route.parent.data['breadcrumb']
                : null;

        if (breadcrumb && breadcrumb !== parentBreadcrumb) {
            breadcrumbs.push({
                label: route.data['breadcrumb'],
                url: '/' + routeUrl.join('/'),
            });
        }

        if (route.firstChild) {
            this.addBreadcrumb(route.firstChild, routeUrl, breadcrumbs);
        }
    }
}
</file>

<file path="src/app/layout/components/app.menuitem.ts">
import {Component, computed, ElementRef, HostBinding, Input, OnDestroy, OnInit, ViewChild} from '@angular/core';
import {NavigationEnd, Router, RouterModule} from '@angular/router';
import {animate, AnimationEvent, state, style, transition, trigger} from '@angular/animations';
import {Subscription} from 'rxjs';
import {filter} from 'rxjs/operators';
import {DomHandler} from 'primeng/dom';
import {TooltipModule} from 'primeng/tooltip';
import {CommonModule} from '@angular/common';
import {RippleModule} from 'primeng/ripple';
import {LayoutService} from '@/layout/service/layout.service';

@Component({
    // eslint-disable-next-line @angular-eslint/component-selector
    selector: '[app-menuitem]',
    imports: [CommonModule, RouterModule, RippleModule, TooltipModule],
    template: `
        <ng-container>
            <div *ngIf="root && item.visible !== false" class="layout-menuitem-root-text">
                {{ item.label }}
            </div>
            <a
                *ngIf="(!item.routerLink || item.items) && item.visible !== false"
                [attr.href]="item.url"
                (click)="itemClick($event)"
                (mouseenter)="onMouseEnter()"
                [ngClass]="item.class"
                [attr.target]="item.target"
                tabindex="0"
                pRipple
                [pTooltip]="item.label"
                [tooltipDisabled]="!(isSlim() && root && !active)"
            >
                <i [ngClass]="item.icon" class="layout-menuitem-icon"></i>
                <span class="layout-menuitem-text">{{ item.label }}</span>
                <i class="pi pi-fw pi-angle-down layout-submenu-toggler" *ngIf="item.items"></i>
            </a>
            <a
                *ngIf="item.routerLink && !item.items && item.visible !== false"
                (click)="itemClick($event)"
                (mouseenter)="onMouseEnter()"
                [ngClass]="item.class"
                [routerLink]="item.routerLink"
                routerLinkActive="active-route"
                [routerLinkActiveOptions]="
                    item.routerLinkActiveOptions || {
                        paths: 'exact',
                        queryParams: 'ignored',
                        matrixParams: 'ignored',
                        fragment: 'ignored'
                    }
                "
                [fragment]="item.fragment"
                [queryParamsHandling]="item.queryParamsHandling"
                [preserveFragment]="item.preserveFragment"
                [skipLocationChange]="item.skipLocationChange"
                [replaceUrl]="item.replaceUrl"
                [state]="item.state"
                [queryParams]="item.queryParams"
                [attr.target]="item.target"
                tabindex="0"
                pRipple
                [pTooltip]="item.label"
                [tooltipDisabled]="!(isSlim() && root)"
            >
                <i [ngClass]="item.icon" class="layout-menuitem-icon"></i>
                <span class="layout-menuitem-text">{{ item.label }}</span>
                <i class="pi pi-fw pi-angle-down layout-submenu-toggler" *ngIf="item.items"></i>
            </a>

            <ul #submenu *ngIf="item.items && item.visible !== false" [@children]="submenuAnimation" (@children.done)="onSubmenuAnimated($event)">
                <ng-template ngFor let-child let-i="index" [ngForOf]="item.items">
                    <li app-menuitem [item]="child" [index]="i" [parentKey]="key" [class]="child['badgeClass']"></li>
                </ng-template>
            </ul>
        </ng-container>
    `,
    animations: [
        trigger('children', [
            state(
                'collapsed',
                style({
                    height: '0'
                })
            ),
            state(
                'expanded',
                style({
                    height: '*'
                })
            ),
            state(
                'hidden',
                style({
                    display: 'none'
                })
            ),
            state(
                'visible',
                style({
                    display: 'block'
                })
            ),
            transition('collapsed <=> expanded', animate('400ms cubic-bezier(0.86, 0, 0.07, 1)'))
        ])
    ],

})
export class AppMenuitem implements OnInit, OnDestroy {
    @Input() item: any;

    @Input() index!: number;

    @Input() @HostBinding('class.layout-root-menuitem') root!: boolean;

    @Input() parentKey!: string;

    @ViewChild('submenu') submenu!: ElementRef;

    @HostBinding('class.active-menuitem')
    get activeClass() {
        return this.active;
    }

    active = false;

    menuSourceSubscription: Subscription;

    menuResetSubscription: Subscription;

    key: string = '';

    get submenuAnimation() {
        if (this.layoutService.isDesktop() && (this.layoutService.isHorizontal() || this.layoutService.isSlim() || this.layoutService.isSlimPlus())) {
            return this.active ? 'visible' : 'hidden';
        } else return this.root ? 'expanded' : this.active ? 'expanded' : 'collapsed';
    }

    isSlim = computed(() => this.layoutService.isSlim());

    isSlimPlus = computed(() => this.layoutService.isSlimPlus());

    isHorizontal = computed(() => this.layoutService.isHorizontal());

    get isDesktop() {
        return this.layoutService.isDesktop();
    }

    get isMobile() {
        return this.layoutService.isMobile();
    }


    constructor(
        public layoutService: LayoutService,
        public router: Router
    ) {
        this.menuSourceSubscription = this.layoutService.menuSource$.subscribe((value) => {
            Promise.resolve(null).then(() => {
                if (value.routeEvent) {
                    this.active = value.key === this.key || value.key.startsWith(this.key + '-') ? true : false;
                } else {
                    if (value.key !== this.key && !value.key.startsWith(this.key + '-')) {
                        this.active = false;
                    }
                }
            });
        });

        this.menuResetSubscription = this.layoutService.resetSource$.subscribe(() => {
            this.active = false;
        });

        this.router.events.pipe(filter((event) => event instanceof NavigationEnd)).subscribe((params) => {
            if (this.isSlimPlus() || this.isSlim() || this.isHorizontal()) {
                this.active = false;
            } else {
                if (this.item.routerLink) {
                    this.updateActiveStateFromRoute();
                }
            }
        });
    }

    ngOnInit() {
        this.key = this.parentKey ? this.parentKey + '-' + this.index : String(this.index);

        if (!(this.isSlimPlus() || this.isSlim() || this.isHorizontal()) && this.item.routerLink) {
            this.updateActiveStateFromRoute();
        }
    }

    ngAfterViewChecked() {
        if (this.root && this.active && this.isDesktop && (this.isHorizontal() || this.isSlim() || this.isSlimPlus())) {
            this.calculatePosition(this.submenu?.nativeElement, this.submenu?.nativeElement.parentElement);
        }
    }

    updateActiveStateFromRoute() {
        let activeRoute = this.router.isActive(this.item.routerLink[0], {
            paths: 'exact',
            queryParams: 'ignored',
            matrixParams: 'ignored',
            fragment: 'ignored'
        });

        if (activeRoute) {
            this.layoutService.onMenuStateChange({
                key: this.key,
                routeEvent: true
            });
        }
    }
    onSubmenuAnimated(event: AnimationEvent) {
        if (event.toState === 'visible' && this.isDesktop && (this.isHorizontal() || this.isSlim() || this.isSlimPlus())) {
            const el = <HTMLUListElement>event.element;
            const elParent = <HTMLUListElement>el.parentElement;
            this.calculatePosition(el, elParent);
        }
    }

    calculatePosition(overlay: HTMLElement, target: HTMLElement) {
        if (overlay) {
            const { left, top } = target.getBoundingClientRect();
            const [vWidth, vHeight] = [window.innerWidth, window.innerHeight];
            const [oWidth, oHeight] = [overlay.offsetWidth, overlay.offsetHeight];
            const scrollbarWidth = DomHandler.calculateScrollbarWidth();
            // reset
            overlay.style.top = '';
            overlay.style.left = '';

            if (this.layoutService.isHorizontal()) {
                const width = left + oWidth + scrollbarWidth;
                overlay.style.left = vWidth < width ? `${left - (width - vWidth)}px` : `${left}px`;
            } else if ( this.layoutService.isSlim() || this.layoutService.isSlimPlus()) {
                const height = top + oHeight;
                overlay.style.top = vHeight < height ? `${top - (height - vHeight)}px` : `${top}px`;
            }
        }
    }

    itemClick(event: Event) {
        // avoid processing disabled items
        if (this.item.disabled) {
            event.preventDefault();
            return;
        }

        // navigate with hover
        if ((this.root && this.isSlim()) || this.isHorizontal() || this.isSlimPlus()) {
            this.layoutService.layoutState.update((val) => ({
                ...val,
                menuHoverActive: !val.menuHoverActive
            }));
        }

        // execute command
        if (this.item.command) {
            this.item.command({ originalEvent: event, item: this.item });
        }

        // toggle active state
        if (this.item.items) {
            this.active = !this.active;

            if (this.root && this.active && (this.isSlim() || this.isHorizontal() || this.isSlimPlus())) {
                this.layoutService.onOverlaySubmenuOpen();
            }
        } else {
            if (this.layoutService.isMobile()) {
                this.layoutService.layoutState.update((val) => ({
                    ...val,
                    staticMenuMobileActive: false
                }));
            }

            if (this.isSlim() || this.isHorizontal() || this.isSlimPlus()) {
                this.layoutService.reset();
                this.layoutService.layoutState.update((val) => ({
                    ...val,
                    menuHoverActive: false
                }));
            }
        }

        this.layoutService.onMenuStateChange({ key: this.key });
    }

    onMouseEnter() {
        // activate item on hover
        if (this.root && (this.isSlim() || this.isHorizontal() || this.isSlimPlus()) && this.layoutService.isDesktop()) {
            if (this.layoutService.layoutState().menuHoverActive) {
                this.active = true;
                this.layoutService.onMenuStateChange({ key: this.key });
            }
        }
    }

    ngOnDestroy() {
        if (this.menuSourceSubscription) {
            this.menuSourceSubscription.unsubscribe();
        }

        if (this.menuResetSubscription) {
            this.menuResetSubscription.unsubscribe();
        }
    }
}
</file>

<file path="src/app/layout/components/layout/layout.component.html">
<div class="layout-container" [ngClass]="containerClass">
    <div app-sidebar></div>
    <div class="layout-content-wrapper">
        <div app-topbar></div>
        <div class="layout-content">
            <router-outlet></router-outlet>
        </div>
    </div>
    <div app-profilesidebar></div>
    <div class="layout-mask "></div>
</div>
</file>

<file path="src/app/layout/components/layout/layout.component.ts">
import { Component, Renderer2, ViewChild, OnDestroy } from '@angular/core';
import { CommonModule } from '@angular/common';
import { NavigationEnd, Router, RouterModule } from '@angular/router';
import { filter, Subscription } from 'rxjs';

import { AppTopbar } from '../app-topbar/app.topbar';
import { AppProfileSidebar } from '../app-profile-sidebar/app.profilesidebar';
import { LayoutService } from '@/layout/service/layout.service';
import { AppSidebar } from '../app-side-bar/app.sidebar';

@Component({
    selector: 'app-layout',
    standalone: true,
    imports: [
        CommonModule,
        RouterModule,
        AppSidebar,
        AppTopbar,
        AppProfileSidebar,
    ],
    templateUrl: './layout.component.html'
})
export class LayoutComponent implements OnDestroy {
    overlayMenuOpenSubscription: Subscription;
    menuOutsideClickListener: any;
    menuScrollListener: any;

    @ViewChild(AppSidebar) appSidebar!: AppSidebar;
    @ViewChild(AppTopbar) appTopBar!: AppTopbar;

    constructor(
        public layoutService: LayoutService,
        public renderer: Renderer2,
        public router: Router
    ) {
        this.overlayMenuOpenSubscription = this.layoutService.overlayOpen$.subscribe(() => {
            if (!this.menuOutsideClickListener) {
                this.menuOutsideClickListener = this.renderer.listen('document', 'click', (event) => {
                    const isOutsideClicked = this.isOutsideClicked(event);
                    if (isOutsideClicked) {
                        this.hideMenu();
                    }
                });
            }

            if ((this.layoutService.isHorizontal() || this.layoutService.isSlim() || this.layoutService.isSlimPlus()) && !this.menuScrollListener) {
                this.menuScrollListener = this.renderer.listen(
                    this.appSidebar.menuContainer.nativeElement,
                    'scroll',
                    (event) => {
                        if (this.layoutService.isDesktop()) {
                            this.hideMenu();
                        }
                    }
                );
            }

            if (this.layoutService.layoutState().staticMenuMobileActive) {
                this.blockBodyScroll();
            }
        });

        this.router.events.pipe(filter((event) => event instanceof NavigationEnd)).subscribe(() => {
            this.hideMenu();
        });
    }

    isOutsideClicked(event: any) {
        const sidebarEl = this.appSidebar?.el?.nativeElement;
        const topbarButtonEl = this.appTopBar?.menuButton?.nativeElement;

        return !(
            sidebarEl?.isSameNode(event.target) ||
            sidebarEl?.contains(event.target) ||
            topbarButtonEl?.isSameNode(event.target) ||
            topbarButtonEl?.contains(event.target)
        );
    }

    hideMenu() {
        this.layoutService.layoutState.update((prev) => ({
            ...prev,
            overlayMenuActive: false,
            staticMenuMobileActive: false,
            menuHoverActive: false,
        }));

        if (this.menuOutsideClickListener) {
            this.menuOutsideClickListener();
            this.menuOutsideClickListener = null;
        }

        if (this.menuScrollListener) {
            this.menuScrollListener();
            this.menuScrollListener = null;
        }

        this.unblockBodyScroll();
    }

    blockBodyScroll(): void {
        if (document.body.classList) {
            document.body.classList.add('blocked-scroll');
        } else {
            document.body.className += ' blocked-scroll';
        }
    }

    unblockBodyScroll(): void {
        if (document.body.classList) {
            document.body.classList.remove('blocked-scroll');
        } else {
            document.body.className = document.body.className.replace(
                new RegExp('(^|\\b)' + 'blocked-scroll'.split(' ').join('|') + '(\\b|$)', 'gi'),
                ' '
            );
        }
    }

    get containerClass() {
        const layoutConfig = this.layoutService.layoutConfig();
        const layoutState = this.layoutService.layoutState();

        return {
            'layout-light': !layoutConfig.darkTheme,
            'layout-dark': layoutConfig.darkTheme,
            'layout-colorscheme-menu': layoutConfig.menuTheme === 'colorScheme',
            'layout-primarycolor-menu': layoutConfig.menuTheme === 'primaryColor',
            'layout-transparent-menu': layoutConfig.menuTheme === 'transparent',
            'layout-overlay': layoutConfig.menuMode === 'overlay',
            'layout-static': layoutConfig.menuMode === 'static',
            'layout-slim': layoutConfig.menuMode === 'slim',
            'layout-slim-plus': layoutConfig.menuMode === 'slim-plus',
            'layout-horizontal': layoutConfig.menuMode === 'horizontal',
            'layout-reveal': layoutConfig.menuMode === 'reveal',
            'layout-drawer': layoutConfig.menuMode === 'drawer',
            'layout-static-inactive': layoutState.staticMenuDesktopInactive && layoutConfig.menuMode === 'static',
            'layout-overlay-active': layoutState.overlayMenuActive,
            'layout-mobile-active': layoutState.staticMenuMobileActive,
            'layout-sidebar-active': layoutState.sidebarActive,
            'layout-sidebar-anchored': layoutState.anchored,
        };
    }

    ngOnDestroy() {
        if (this.overlayMenuOpenSubscription) {
            this.overlayMenuOpenSubscription.unsubscribe();
        }

        if (this.menuOutsideClickListener) {
            this.menuOutsideClickListener();
        }
    }
}
</file>

<file path="src/app/layout/service/layout.service.ts">
import { Injectable, effect, signal, computed } from '@angular/core';
import { Subject } from 'rxjs';

export type ColorScheme = 'light' | 'dark' | 'dim';

export interface layoutConfig {
    inputStyle: string;
    preset?: string;
    primary?: string;
    surface?: string | undefined | null;
    ripple: boolean;
    darkTheme?: boolean;
    menuMode?: string;
    menuTheme?: string;
    colorScheme?: ColorScheme;
}

interface LayoutState {
    staticMenuDesktopInactive?: boolean;
    overlayMenuActive?: boolean;
    configSidebarVisible: boolean;
    staticMenuMobileActive?: boolean;
    menuHoverActive?: boolean;
    profileSidebarVisible: boolean;
    sidebarActive: boolean;
    anchored: boolean;
    overlaySubmenuActive: boolean;
    activeMenuItem: any;
}

interface MenuChangeEvent {
    key: string;
    routeEvent?: boolean;
}

@Injectable({
    providedIn: 'root',
})
export class LayoutService {
    _config: layoutConfig = {
        ripple: false,
        preset: 'Aura',
        primary: 'indigo',
        inputStyle: 'outlined',
        surface: null,
        darkTheme: false,
        menuMode: 'static',
        menuTheme: 'colorScheme',
    };

    _state: LayoutState = {
        staticMenuDesktopInactive: false,
        overlayMenuActive: false,
        sidebarActive: false,
        anchored: false,
        overlaySubmenuActive: false,
        profileSidebarVisible: false,
        configSidebarVisible: false,
        staticMenuMobileActive: false,
        menuHoverActive: false,
        activeMenuItem: null,
    };

    layoutConfig = signal<layoutConfig>(this._config);

    layoutState = signal<LayoutState>(this._state);

    private configUpdate = new Subject<layoutConfig>();

    private overlayOpen = new Subject<any>();

    private menuSource = new Subject<MenuChangeEvent>();

    private resetSource = new Subject();

    menuSource$ = this.menuSource.asObservable();

    resetSource$ = this.resetSource.asObservable();

    configUpdate$ = this.configUpdate.asObservable();

    overlayOpen$ = this.overlayOpen.asObservable();

    isDarkTheme = computed(() => this.layoutConfig().darkTheme);

    isSlim = computed(() => this.layoutConfig().menuMode === 'slim');

    isSlimPlus = computed(() => this.layoutConfig().menuMode === 'slim-plus');

    isHorizontal = computed(
        () => this.layoutConfig().menuMode === 'horizontal',
    );

    isOverlay = computed(() => this.layoutConfig().menuMode === 'overlay');

    transitionComplete = signal<boolean>(false);

    isSidebarStateChanged = computed(() => {
        const layoutConfig = this.layoutConfig();
        return layoutConfig.menuMode === 'horizontal' || layoutConfig.menuMode === 'slim' || layoutConfig.menuMode === 'slim-plus';
    });

 hideMenu() {
    this.layoutState.update((prev) => ({
        ...prev,
        overlayMenuActive: false,
        staticMenuMobileActive: false,
        profileSidebarVisible: false,
        menuHoverActive: false
    }));
}
 hideProfileSidebar() {
        this.layoutState.update((state) => ({
            ...state,
            profileSidebarVisible: false,
        }));
    }

    private initialized = false;

    constructor() {
        effect(() => {
            const config = this.layoutConfig();
            if (config) {
                this.onConfigUpdate();
            }
        });

        effect(() => {
            const config = this.layoutConfig();

            if (!this.initialized || !config) {
                this.initialized = true;
                return;
            }

            this.handleDarkModeTransition(config);
        });

        effect(() => {
            this.isSidebarStateChanged() && this.reset();
        });
    }

    private handleDarkModeTransition(config: layoutConfig): void {
        const supportsViewTransition = 'startViewTransition' in document;

        if (supportsViewTransition) {
            this.startViewTransition(config);
        } else {
            this.toggleDarkMode(config);
            this.onTransitionEnd();
        }
    }

    private startViewTransition(config: layoutConfig): void {
        const transition = (document as any).startViewTransition(() => {
            this.toggleDarkMode(config);
        });

        transition.ready
            .then(() => {
                this.onTransitionEnd();
            })
            .catch(() => {});
    }

    toggleDarkMode(config?: layoutConfig): void {
        const _config = config || this.layoutConfig();
        if (_config.darkTheme) {
            document.documentElement.classList.add('app-dark');
        } else {
            document.documentElement.classList.remove('app-dark');
        }
    }

    private onTransitionEnd() {
        this.transitionComplete.set(true);
        setTimeout(() => {
            this.transitionComplete.set(false);
        });
    }

    onMenuToggle() {
        if (this.isOverlay()) {
            this.layoutState.update((prev) => ({ ...prev, overlayMenuActive: !prev.overlayMenuActive }));
            if (this.layoutState().overlayMenuActive) {
                this.overlayOpen.next(null);
            }
        }

        if (this.isDesktop()) {
            this.layoutState.update((prev) => ({ ...prev, staticMenuDesktopInactive: !prev.staticMenuDesktopInactive }));
        } else {
            this.layoutState.update((prev) => ({ ...prev, staticMenuMobileActive: !prev.staticMenuMobileActive }));
            if (this.layoutState().staticMenuMobileActive) {
                this.overlayOpen.next(null);
            }
        }
    }
    onConfigUpdate() {
        this._config = { ...this.layoutConfig() };
        this.configUpdate.next(this.layoutConfig());
    }

    onMenuStateChange(event: MenuChangeEvent) {
        this.menuSource.next(event);
    }

    reset() {
        this.resetSource.next(true);
    }

    onOverlaySubmenuOpen() {
        this.overlayOpen.next(null);
    }

    showProfileSidebar() {
        this.layoutState.update((state) => ({
            ...state,
            profileSidebarVisible: true,
        }));
    }

    showConfigSidebar() {
        this.layoutState.update((state) => ({
            ...state,
            configSidebarVisible: true,
        }));
    }

    hideConfigSidebar() {
        this.layoutState.update((prev) => ({ ...prev, configSidebarVisible: false }));
    }

    isDesktop() {
        return window.innerWidth > 991;
    }

    isMobile() {
        return !this.isDesktop();
    }
}
</file>

<file path="src/app/shared/notfound/notfound.component.ts">
import { Component } from '@angular/core';
import { RouterModule } from '@angular/router';
import { CommonModule } from '@angular/common';

@Component({
  selector: 'app-notfound',
  standalone: true,
  imports: [CommonModule, RouterModule],
  template: `
    <div class="notfound-container">
      <div class="notfound-content">
        <h1 class="error-code">404</h1>
        <h2 class="error-title">Page Not Found</h2>
        <p class="error-message">
          Sorry, the page you're looking for doesn't exist or has been moved.
        </p>
        <a routerLink="/dashboard" class="back-button">
          Go Back to Dashboard
        </a>
      </div>
    </div>
  `,
  styles: [`
    .notfound-container {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .notfound-content {
      text-align: center;
      background: white;
      padding: 3rem;
      border-radius: 1rem;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      max-width: 500px;
    }

    .error-code {
      font-size: 5rem;
      font-weight: 900;
      color: #667eea;
      margin: 0;
      line-height: 1;
    }

    .error-title {
      font-size: 1.75rem;
      font-weight: 600;
      color: #1f2937;
      margin: 0.5rem 0 1rem;
    }

    .error-message {
      color: #6b7280;
      margin-bottom: 2rem;
      font-size: 1rem;
    }

    .back-button {
      display: inline-block;
      padding: 0.75rem 2rem;
      background: #667eea;
      color: white;
      text-decoration: none;
      border-radius: 0.5rem;
      font-weight: 600;
      transition: background 0.3s ease;
    }

    .back-button:hover {
      background: #5568d3;
    }
  `]
})
export class NotFoundComponent {}
</file>

<file path="src/assets/i18n/en.json">
{
  "Executive Management": "Executive Management",
  "View Executives": "View Executives",
  "Create Executives": "Create Executives",
  "Edit Executives": "Edit Executives",
  "Terminate Executives": "Terminate Executives",
  "Reporting": "Reporting",
  "Access Dashboard": "Access Dashboard",
  "Generate Reports": "Generate Reports",
  "Export Data": "Export Data",
  "System Settings": "System Settings",
  "Manage Roles": "Manage Roles",
  "Configure Preferences": "Configure Preferences"
}
</file>

<file path="src/assets/layout/_breadcrumb.scss">
.layout-breadcrumb {
    ol {
        display: flex;
        align-items: center;
        margin: 0;
        padding: 0;
        list-style: none;
        gap: 1rem;
        flex-wrap: wrap;
        color: var(--text-color-secondary);

        li {
            font-weight: 600;
        }
    }
}

.content-breadcrumb {
    margin-bottom: 2rem;
    padding: 0 0.5rem;
}
</file>

<file path="src/assets/layout/_config.scss">
.layout-config-sidebar {
    &.p-sidebar {
        .p-sidebar-content {
            padding-left: 2rem;
            padding-right: 2rem;
        }
    }
}
.layout-config-button {
    display: block;
    position: fixed;
    width: 3rem;
    height: 3rem;
    line-height: 3rem;
    background: var(--primary-color);
    color: var(--primary-color-text);
    text-align: center;
    top: 50%;
    right: 0;
    margin-top: -1.5rem;
    border-top-left-radius: var(--border-radius);
    border-bottom-left-radius: var(--border-radius);
    border-top-right-radius: 0;
    border-bottom-right-radius: 0;
    transition: background-color var(--transition-duration);
    overflow: hidden;
    cursor: pointer;
    z-index: 999;
    box-shadow: -0.25rem 0 1rem rgba(173, 70, 70, 0.15);

    &.config-link {
        font-size: 1rem;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';
        border: none;
    }
    .config-link:focus {
        outline: 0 none;
        outline-offset: 0;
        box-shadow: 0 0 0 1px var(--focus-ring--shadow);
    }

    i {
        font-size: 2rem;
        line-height: inherit;
        transform: rotate(0deg);
        transition: transform 1s;
    }

    &:hover {
        background: var(--p-primary-400);
    }
}

.app-config-mobile-button {
    display: none;
}

.app-config-button {
    border: 1px solid var(--border-color);
    background-color: var(--card-background);
    position: relative;
    z-index: 0;
    border-radius: 50%;
    width: 2.5rem;
    height: 2.5rem;
    line-height: 2.5rem;
    text-align: center;

    i {
        line-height: inherit;
        font-size: 1.125rem;
    }
    &::before,
    &::after {
        content: '';
        position: absolute;
        inset: 0;
        border: 1px solid var(--topbar-item-text-color);
        transition: all 0.5s;
        animation: clippath 10s infinite linear;
        border-radius: 50%;
        opacity: 1;
    }

    &::after {
        animation: clippath 10s infinite -5s linear;
    }
}

@keyframes clippath {
    0% {
        clip-path: inset(0 0 98% 0);
    }
    12.5% {
        clip-path: inset(0 0 60% 0);
    }
    25% {
        clip-path: inset(0 98% 0 0);
    }
    37.5% {
        clip-path: inset(0 60% 0 0);
    }
    50% {
        clip-path: inset(98% 0 0 0);
    }
    62.5% {
        clip-path: inset(60% 0 0 0);
    }
    75% {
        clip-path: inset(0 0 0 98%);
    }
    87.5% {
        clip-path: inset(0 0 0 60%);
    }
    100% {
        clip-path: inset(0 0 98% 0);
    }
}
</file>

<file path="src/assets/layout/_content.scss">
.layout-content-wrapper {
    padding: 2rem;
}
</file>

<file path="src/assets/layout/_fonts.scss">
/* poppins-regular - latin */
@font-face {
    font-family: 'Poppins';
    font-style: normal;
    font-weight: 400;
    src: local(''),
         url("./fonts/poppins-v20-latin-regular.woff2") format('woff2'), /* Chrome 26+, Opera 23+, Firefox 39+ */
         url("./fonts/poppins-v20-latin-regular.woff") format('woff'); /* Chrome 6+, Firefox 3.6+, IE 9+, Safari 5.1+ */
  }
  /* poppins-500 - latin */
  @font-face {
    font-family: 'Poppins';
    font-style: normal;
    font-weight: 500;
    src: local(''),
         url("./fonts/poppins-v20-latin-500.woff2") format('woff2'), /* Chrome 26+, Opera 23+, Firefox 39+ */
         url("./fonts/poppins-v20-latin-500.woff") format('woff'); /* Chrome 6+, Firefox 3.6+, IE 9+, Safari 5.1+ */
  }
  /* poppins-600 - latin */
  @font-face {
    font-family: 'Poppins';
    font-style: normal;
    font-weight: 600;
    src: local(''),
         url("./fonts/poppins-v20-latin-600.woff2") format('woff2'), /* Chrome 26+, Opera 23+, Firefox 39+ */
         url("./fonts/poppins-v20-latin-600.woff") format('woff'); /* Chrome 6+, Firefox 3.6+, IE 9+, Safari 5.1+ */
  }
  /* poppins-700 - latin */
  @font-face {
    font-family: 'Poppins';
    font-style: normal;
    font-weight: 700;
    src: local(''),
         url("./fonts/poppins-v20-latin-700.woff2") format('woff2'), /* Chrome 26+, Opera 23+, Firefox 39+ */
         url("./fonts/poppins-v20-latin-700.woff") format('woff'); /* Chrome 6+, Firefox 3.6+, IE 9+, Safari 5.1+ */
  }
</file>

<file path="src/assets/layout/_main.scss">
* {
    box-sizing: border-box;
}

html {
    height: 100%;
    font-size: 14px;
    line-height: 1.5;
}

body {
    font-weight: 400;
    padding: 0;
    margin: 0;
    min-height: 100%;
    background: var(--surface-ground);
    color: var(--text-color);
    font-family: 'Poppins', sans-serif;
    font-feature-settings: "cv02","cv03","cv04","cv11";
    font-variation-settings: normal;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

a {
    text-decoration: none;
}

.layout-container {
    min-height: 100vh;
}

img {
    max-width: none !important;
}
</file>

<file path="src/assets/layout/_overrides.scss">
p-select {
  display: inline-flex;
  width: 100%;
  
  .p-select {
    width: 100%;
  }
}

// Fix: p-inputnumber display
p-inputnumber {
  display: block;
  width: 100%;
  
  .p-inputnumber {
    width: 100%;
  }
}

// Fix: p-button inline display
p-button {
  display: inline-flex;
  
  .p-button {
    display: inline-flex;
    align-items: center;
  }
}

// Fix: p-tree border conflicts
p-tree {
  display: block;
  
  .p-tree {
    border: none;
  }
  
  .p-tree-node-checkbox {
    display: block;
  }
}

// Fix: p-chart canvas sizing
p-chart {
  display: block;
  
  canvas {
    max-width: 100%;
    height: auto !important;
  }
}

// Fix: p-tooltip positioning
.p-tooltip {
  z-index: 9999 !important;
}
</file>

<file path="src/assets/layout/_profile.scss">
.layout-profile-sidebar {
    &.p-sidebar {
        width: 25rem;

        .p-sidebar-content {
            padding-left: 2rem;
            padding-right: 2rem;
        }
    }
}
</file>

<file path="src/assets/layout/_responsive.scss">
@use './_sass_variables' as *;

@media screen and (min-width: $breakpoint) {
    .layout-container {
        &.layout-static {
            .layout-sidebar {
                transition: transform var(--layout-section-transition-duration);
            }

            .layout-content-wrapper {
                margin-left: 18rem;
                transition: margin-left var(--layout-section-transition-duration);
            }
        }

        &.layout-static-inactive {
            .layout-sidebar {
                transform: translateX(-100%);
            }

            .layout-content-wrapper {
                margin-left: 0;
            }
        }

        &.layout-overlay {
            .layout-content-wrapper {
                margin-left: 0;
            }

            .layout-sidebar {
                z-index: 999;
                transform: translateX(-100%);
                transition: transform var(--layout-section-transition-duration);
            }

            &.layout-overlay-active {
                .layout-sidebar {
                    transform: translateX(0);
                }
            }
        }

        .content-breadcrumb {
            display: none;
        }
    }
}

@media screen and (max-width: ($breakpoint - 1)) {
    .blocked-scroll {
        overflow: hidden;
    }

    .layout-container {
        .layout-content-wrapper {
            margin-left: 0;
            padding: 1rem;
        }

        .layout-sidebar {
            z-index: 999;
            transform: translateX(-100%);
            transition: transform var(--layout-section-transition-duration);
            box-shadow: none;
        }

        &.layout-mobile-active {
            .layout-sidebar {
                transform: translateX(0);
            }

            .layout-mask {
                display: block;
                animation: fadein var(--layout-section-transition-duration);
            }
        }

        .layout-mask {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 998;
            width: 100%;
            height: 100%;
            background-color: var(--maskbg);
        }

        .topbar-breadcrumb {
            display: none;
        }

        .content-breadcrumb {
            display: block;
        }
    }
}

@media screen and (min-width: 1960px) {
    .layout-content,
    .landing-wrapper {
        width: 1504px;
        margin-left: auto !important;
        margin-right: auto !important;
    }

    .layout-topbar {
        width: 1504px;
        margin-left: auto !important;
        margin-right: auto !important;
    }
}
</file>

<file path="src/assets/layout/_sass_variables.scss">
$breakpoint: 992px !default;
</file>

<file path="src/assets/layout/_sidebar_drawer.scss">
@use './_sass_variables' as *;

@media screen and (min-width: $breakpoint) {
    .layout-container {
        &.layout-drawer {
            .layout-topbar {
                .topbar-menubutton {
                    display: none;
                }
            }

            .layout-sidebar {
                height: 100%;
                top: 0;
                transition: width 0.3s cubic-bezier(0, 0, 0.2, 1);
                width: 5.25rem;
                z-index: 999;

                .layout-menu-container {
                    overflow: hidden;
                }

                .sidebar-header {
                    display: flex;
                    justify-content: center;
                    gap: 1rem;
                    padding: 1.5rem 0rem;

                    .app-logo {
                        .app-logo-small {
                            display: inline;
                            order: 1;
                        }

                        .app-logo-normal {
                            display: none;
                            width: 0;
                            transition: width 0.3s cubic-bezier(0, 0, 0.2, 1);
                            transition-delay: 300ms;
                        }
                    }

                    .layout-sidebar-anchor {
                        display: none;
                        width: 1.25rem;
                        height: 1.25rem;
                        border-radius: 50%;
                        border: 2px solid var(--logo-color);
                        background-color: transparent;
                        transition:
                            background-color var(--layout-section-transition-duration),
                            transform 0.3s;
                    }
                }

                .layout-menu-container {
                    overflow: hidden;
                }

                .layout-menu {
                    transition: all 0.4s;

                    .layout-root-menuitem {
                        > .layout-menuitem-root-text {
                            opacity: 0;
                            white-space: nowrap;
                            transition: all 0.1s;

                            > span {
                                margin-right: auto;
                            }

                            .layout-menuitem-icon {
                                font-size: 1.25rem;
                                width: 1.25rem;
                            }

                            > .layout-menuitem-root-icon {
                                display: block;
                                margin-right: 0.125rem;
                                font-size: 1.25rem;
                            }
                        }
                    }

                    ul {
                        margin: 0;
                        padding: 0;
                        list-style-type: none;

                        a {
                            padding: 0.75rem 2rem;
                            width: 1.25rem;
                            span {
                                opacity: 0;
                                white-space: nowrap;
                                transition: all 0.1s;
                            }

                            .layout-menuitem-icon {
                                font-size: 1.25rem;
                                width: 1.25rem;
                            }
                        }
                    }
                }
            }

            &.layout-drawer {
                .layout-content-wrapper {
                    margin-left: 5.25rem;
                    transition: margin-left 0.3s cubic-bezier(0, 0, 0.2, 1);
                    overflow-x: hidden;
                }
            }

            &.layout-sidebar-active {
                .layout-sidebar {
                    width: 18rem;

                    .layout-menu-container {
                        overflow: auto;
                    }

                    .sidebar-header {
                        padding: 1.5rem 2rem;
                        justify-content: space-between;

                        .app-logo {
                            .app-logo-normal {
                                display: inline;
                                width: 100%;
                                transition: width 0.3s cubic-bezier(0, 0, 0.2, 1);
                                transition-delay: 300ms;
                            }

                            .app-logo-small {
                                display: none;
                            }
                        }

                        .layout-sidebar-anchor {
                            display: block;
                            animation: px-fadein 0.15s linear;
                        }
                    }

                    .layout-menu {
                        .layout-root-menuitem {
                            > .layout-menuitem-root-text {
                                padding: 1rem 2rem;
                                padding-right: 1.25rem;
                                opacity: 1;
                                white-space: nowrap;
                                transition: all 0.3s;

                                > .layout-menuitem-root-icon {
                                    display: none;
                                }
                            }
                        }

                        ul {
                            a {
                                padding: 0.75rem 2rem;
                                padding-right: 1.25rem;
                                width: auto;
                                .layout-submenu-toggler {
                                    display: block;
                                }

                                span {
                                    opacity: 1;
                                    white-space: nowrap;
                                    transition: all 0.3s;
                                }
                            }
                            ul {
                                overflow: hidden;
                                border-radius: var(--border-radius);

                                li {
                                    a {
                                        padding-left: 2.5rem;
                                    }

                                    li {
                                        a {
                                            padding-left: 3rem;
                                        }

                                        li {
                                            a {
                                                padding-left: 3.5rem;
                                            }

                                            li {
                                                a {
                                                    padding-left: 4rem;
                                                }

                                                li {
                                                    a {
                                                        padding-left: 5.5rem;
                                                    }

                                                    li {
                                                        a {
                                                            padding-left: 5rem;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }

            &.layout-sidebar-anchored {
                .sidebar-header {
                    .layout-sidebar-anchor {
                        background-color: var(--logo-color);
                    }
                }

                .layout-content-wrapper {
                    margin-left: 18rem;
                }
            }
        }
    }
    
}
</file>

<file path="src/assets/layout/_sidebar_horizontal.scss">
@use './_sass_variables' as *;

@media screen and (min-width: $breakpoint) {
    .layout-container {
        &.layout-horizontal {
            .layout-topbar {
                .topbar-menubutton {
                    display: none;
                }
            }

            .sidebar-header {
                .app-logo {
                    .app-logo-normal {
                        display: none;
                    }

                    .app-logo-small {
                        display: inline;
                    }
                }
            }

            .layout-sidebar {
                width: auto;
                height: auto;
                top: 0;
                z-index: 999;
                overflow: visible;
                flex-direction: row;
                position: static;

                .layout-menu-container {
                    overflow: auto;
                    padding-bottom: 0;
                    &::-webkit-scrollbar {
                        display: none;
                    }
                }

                .sidebar-header {
                    padding: 0 2rem;
                }
            }

            .layout-menu {
                display: flex;
                flex-wrap: nowrap;
                flex-direction: row;
                align-items: center;
                height: 100%;

                .layout-root-menuitem {
                    border-radius: var(--border-radius);

                    > .layout-menuitem-root-text {
                        display: none;
                    }

                    > a {
                        display: flex;
                        align-items: center;
                        padding: 0.75rem;
                        border-radius: 0;
                        cursor: pointer;
                        outline: none;
                        color: var(--menuitem-text-color);
                        transition: background-color var(--layout-section-transition-duration);

                        .layout-submenu-toggler {
                            display: block;
                            margin-left: auto;
                            transition: transform 0.2s;
                        }

                        .layout-menuitem-icon {
                            font-size: 1.25rem;
                            color: var(--menuitem-icon-color);
                        }

                        .layout-menuitem-text {
                            font-size: 0.875rem;
                            display: block;
                            margin-left: 0.75rem;
                            margin-right: 0.75rem;
                            white-space: nowrap;
                        }

                        &:hover {
                            background-color: var(--menuitem-hover-bg-color);
                        }
                    }

                    > ul {
                        display: none;
                        position: absolute;
                        left: auto;
                        top: 3rem;
                        min-width: 15rem;
                        background-color: var(--surface-overlay);
                        box-shadow: var(--sidebar-shadow);
                        padding: 1rem;
                        border-radius: var(--border-radius);
                        max-height: 20rem;
                        overflow: auto;
                        z-index: 999;

                        a {
                            padding-right: 0.5rem;
                            color: var(--popup-submenu-item-text-color);
                            border-radius: var(--border-radius);

                            .layout-menuitem-icon {
                                color: var(--popup-submenu-item-icon-color);
                            }

                            &:hover {
                                background-color: var(--popup-submenu-item-hover-bg-color);
                            }
                        }

                        li {
                            a {
                                padding-left: 0.5rem;
                            }

                            li {
                                a {
                                    padding-left: 1rem;
                                }

                                li {
                                    a {
                                        padding-left: 1.5rem;
                                    }

                                    li {
                                        a {
                                            padding-left: 2rem;
                                        }

                                        li {
                                            a {
                                                padding-left: 2.5rem;
                                            }

                                            li {
                                                a {
                                                    padding-left: 3rem;
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }

                    &.active-menuitem {
                        > ul {
                            display: block;
                        }
                    }
                }
            }
        }
    }
}
</file>

<file path="src/assets/layout/_sidebar_reveal.scss">
@use './_sass_variables' as *;

@media screen and (min-width: $breakpoint) {
    .layout-container {
        &.layout-reveal {
            .layout-topbar {
                .topbar-menubutton {
                    display: none;
                }
            }

            .layout-sidebar {
                height: 100%;
                top: 0;
                transition: transform 0.3s cubic-bezier(0, 0, 0.2, 1);
                transform: translateX(-14.75rem);
                z-index: 999;

                .sidebar-header {
                    display: flex;
                    justify-content: flex-end;
                    align-items: center;
                    gap: 1rem;
                    padding: 1.5rem 1rem;

                    .app-logo {
                        .app-logo-small {
                            display: inline;
                            order: 1;
                        }

                        .app-logo-normal {
                            display: none;
                        }
                    }

                    .layout-sidebar-anchor {
                        display: none;
                        width: 1.25rem;
                        height: 1.25rem;
                        border-radius: 50%;
                        border: 2px solid var(--logo-color);
                        background-color: transparent;
                        transition:
                            background-color var(--layout-section-transition-duration),
                            transform 0.3s;
                    }
                }
                .layout-menu-container {
                    overflow: hidden;
                }

                .layout-menu {
                    .layout-root-menuitem {
                        > .layout-menuitem-root-text {
                            > span {
                                margin-right: auto;
                            }

                            > .layout-menuitem-root-icon {
                                display: block;
                                margin-right: 0.125rem;
                            }
                        }
                    }

                    ul {
                        margin: 0;
                        padding: 0;
                        list-style-type: none;

                        a {
                            padding: 0.75rem 1rem;

                            .layout-menuitem-text {
                                order: 1;
                                margin-right: auto;
                            }

                            .layout-submenu-toggler {
                                order: 2;
                                display: none;
                                margin-right: 0.5rem;
                            }

                            .layout-menuitem-icon {
                                order: 3;
                                margin-right: 0;
                                font-size: 1.25rem;
                                width: auto;
                            }
                        }
                    }
                }
            }

            &.layout-reveal {
                .layout-content-wrapper {
                    margin-left: 4.25rem;
                    transition: margin-left 0.3s cubic-bezier(0, 0, 0.2, 1);
                }
            }

            &.layout-sidebar-active {
                .layout-sidebar {
                    transform: translateX(0);
                    .layout-menu-container {
                        overflow: auto;
                    }
                    .sidebar-header {
                        padding: 1.5rem 2rem;
                        justify-content: space-between;
                        .app-logo {
                            .app-logo-normal {
                                display: inline;
                            }

                            .app-logo-small {
                                display: none;
                            }
                        }
                        .layout-sidebar-anchor {
                            display: block;
                            animation: px-fadein 0.15s linear;
                        }
                    }

                    .layout-menu {
                        .layout-root-menuitem {
                            > .layout-menuitem-root-text {
                                > .layout-menuitem-root-icon {
                                    display: none;
                                }
                            }
                        }

                        ul {
                            a {
                                padding: 0.75rem 2rem;

                                .layout-submenu-toggler {
                                    display: block;
                                }
                            }
                            ul {
                                overflow: hidden;
                                border-radius: var(--border-radius);

                                li {
                                    a {
                                        padding-left: 2.5rem;
                                    }

                                    li {
                                        a {
                                            padding-left: 3rem;
                                        }

                                        li {
                                            a {
                                                padding-left: 3.5rem;
                                            }

                                            li {
                                                a {
                                                    padding-left: 4rem;
                                                }

                                                li {
                                                    a {
                                                        padding-left: 5.5rem;
                                                    }

                                                    li {
                                                        a {
                                                            padding-left: 5rem;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }

            &.layout-sidebar-anchored {
                .sidebar-header {
                    .layout-sidebar-anchor {
                        background-color: var(--logo-color);
                    }
                }

                .layout-content-wrapper {
                    margin-left: 18rem;
                }
            }
        }
    }
}
</file>

<file path="src/assets/layout/_sidebar_slim_plus.scss">
@use './_sass_variables' as *;

@media screen and (min-width: $breakpoint) {
    .layout-container {
        &.layout-slim-plus {
            .layout-topbar {
                .topbar-menubutton {
                    display: none;
                }
            }

            .sidebar-header {
                justify-content: center;
                .app-logo {
                    .app-logo-normal {
                        display: none;
                    }

                    .app-logo-small {
                        display: inline;
                        align-items: center;
                    }
                }
            }

            .layout-sidebar {
                width: 7rem;
                overflow: visible;
                z-index: 999;

                .layout-menu-container {
                    overflow: auto;

                    &::-webkit-scrollbar {
                        display: none;
                    }
                }
            }

            .layout-content-wrapper {
                margin-left: 7rem;
            }

            .layout-menu {
                ul {
                    display: none;
                }

                li.active-menuitem {
                    > ul {
                        display: block;
                    }
                }

                .layout-root-menuitem {
                    > .layout-menuitem-root-text {
                        display: none;
                    }

                    > a {
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        justify-content: center;
                        border-radius: var(--border-radius);
                        text-align: center;
                        cursor: pointer;
                        outline: none;
                        transition: background-color var(--layout-section-transition-duration);
                        width: auto;
                        height: auto;
                        margin: 0 auto 1rem auto;
                        padding: 0.75rem 0;

                        .layout-submenu-toggler {
                            display: none;
                        }

                        .layout-menuitem-icon {
                            font-size: 1.5rem;
                            color: var(--menuitem-icon-color);
                        }

                        .layout-menuitem-text {
                            font-size: 0.875rem;
                            display: block;
                            margin-top: 0.25rem;
                            color: var(--menuitem-text-color);
                        }

                        &:hover {
                            background-color: var(--menuitem-hover-bg-color);
                        }
                    }

                    > ul {
                        display: none;
                        position: absolute;
                        left: 7rem;
                        top: 0;
                        min-width: 15rem;
                        background-color: var(--surface-overlay);
                        border-radius: var(--border-radius);
                        box-shadow: var(--sidebar-shadow);
                        border: var(--sidebar-border);
                        padding: 1rem;
                        max-height: 20rem;
                        overflow: auto;
                        z-index: 999;

                        a {
                            padding-right: 0.5rem;
                            color: var(--popup-submenu-item-text-color);
                            border-radius: var(--border-radius);

                            .layout-menuitem-icon {
                                color: var(--popup-submenu-item-icon-color);
                            }

                            &:hover {
                                background-color: var(--popup-submenu-item-hover-bg-color);
                            }
                        }

                        li {
                            a {
                                padding-left: 0.5rem;
                            }

                            li {
                                a {
                                    padding-left: 1rem;
                                }

                                li {
                                    a {
                                        padding-left: 1.5rem;
                                    }

                                    li {
                                        a {
                                            padding-left: 2rem;
                                        }

                                        li {
                                            a {
                                                padding-left: 2.5rem;
                                            }

                                            li {
                                                a {
                                                    padding-left: 3rem;
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                    &.active-menuitem {
                        > ul {
                            display: block;
                        }
                    }
                }
            }
        }
    }
}
</file>

<file path="src/assets/layout/_sidebar_slim.scss">
@use './_sass_variables' as *;

@media screen and (min-width: $breakpoint) {
    .layout-container {
        &.layout-slim {
            .layout-topbar {
                .topbar-menubutton {
                    display: none;
                }
            }

            .sidebar-header {
                .app-logo {
                    .app-logo-normal {
                        display: none;
                    }

                    .app-logo-small {
                        display: inline;
                    }
                }
            }

            .layout-sidebar {
                width: 5rem;
                overflow: visible;
                z-index: 999;

                .layout-menu-container {
                    overflow: auto;

                    &::-webkit-scrollbar {
                        display: none;
                    }
                }
            }

            .layout-content-wrapper {
                margin-left: 5rem;
            }

            .layout-menu {
                ul {
                    display: none;
                }

                li.active-menuitem {
                    > ul {
                        display: block;
                    }
                }
                .layout-root-menuitem {
                    > .layout-menuitem-root-text {
                        display: none;
                    }

                    > a {
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        border-radius: 50%;
                        cursor: pointer;
                        outline: none;
                        transition: background-color var(--layout-section-transition-duration);
                        width: 3rem;
                        height: 3rem;
                        margin: 0 auto 1rem auto;

                        .layout-submenu-toggler {
                            display: none;
                        }

                        .layout-menuitem-icon {
                            font-size: 1.5rem;
                            color: var(--menuitem-icon-color);
                        }

                        .layout-menuitem-text {
                            display: none;
                        }

                        &:hover {
                            background-color: var(--menuitem-hover-bg-color);
                        }
                    }

                    > ul {
                        display: none;
                        position: absolute;
                        left: 5rem;
                        top: 0;
                        min-width: 15rem;
                        background-color: var(--surface-overlay);
                        border-radius: var(--border-radius);
                        box-shadow: var(--sidebar-shadow);
                        border: var(--sidebar-border);
                        padding: 1rem;
                        max-height: 20rem;
                        overflow: auto;
                        z-index: 999;

                        a {
                            padding-right: 0.5rem;
                            color: var(--popup-submenu-item-text-color);
                            border-radius: var(--border-radius);

                            .layout-menuitem-icon {
                                color: var(--popup-submenu-item-icon-color);
                            }

                            &:hover {
                                background-color: var(--popup-submenu-item-hover-bg-color);
                            }
                        }

                        li {
                            a {
                                padding-left: 0.5rem;
                            }

                            li {
                                a {
                                    padding-left: 1rem;
                                }

                                li {
                                    a {
                                        padding-left: 1.5rem;
                                    }

                                    li {
                                        a {
                                            padding-left: 2rem;
                                        }

                                        li {
                                            a {
                                                padding-left: 2.5rem;
                                            }

                                            li {
                                                a {
                                                    padding-left: 3rem;
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }

                    &.active-menuitem {
                        > ul {
                            display: block;
                        }
                    }
                }
            }
        }
    }
}
</file>

<file path="src/assets/layout/_sidebar_vertical.scss">
.layout-sidebar {
    position: fixed;
    height: 100%;
    top: 0;
    left: 0;
    width: 18rem;
    background: var(--menu-bg);
    border-right: var(--sidebar-border);
    box-shadow: var(--sidebar-shadow);
    display: flex;
    flex-direction: column;


    .sidebar-header {
        padding: 2.5rem 0 2rem 0;
        display: flex;
        justify-content: center;
        align-items: center;
        .app-logo {
            .app-logo-normal {
                display: inline;
                width:124px;
                height:22px;
            }
    
            .app-logo-small {
                display: none;
            }
        }
    }
   

    .layout-menu-container {
        overflow: auto;
        flex: 1;
        padding-bottom: 2rem;
    }

    .layout-menu {
        margin: 0;
        padding: 0;
        list-style-type: none;

        .layout-root-menuitem {
            > .layout-menuitem-root-text {
                font-size: .857rem;
                text-transform: uppercase;
                font-weight: 700;
                color: var(--root-menuitem-text-color);
                padding: 1rem 2rem;
            }
    
            > a {
                display: none;
            }
        }

        a {
            user-select: none;
            
            &.active-menuitem {
                > .layout-submenu-toggler {
                    transform: rotate(-180deg);
                }
            }
        }

        li.active-menuitem {
            > a {
                .layout-submenu-toggler {
                    transform: rotate(-180deg);
                }
            }
        }

        ul {
            margin: 0;
            padding: 0;
            list-style-type: none;
    
            a {
                display: flex;
                align-items: center;
                position: relative;
                outline: 0 none;
                color: var(--menuitem-text-color);
                cursor: pointer;
                padding: .75rem 2rem;
                transition: background-color var(--transition-duration), box-shadow var(--transition-duration);

                .layout-menuitem-icon {
                    margin-right: .5rem;
                    color: var(--menuitem-icon-color);
                }
    
                .layout-submenu-toggler {
                    font-size: 75%;
                    margin-left: auto;
                    transition: transform var(--transition-duration);
                }
    
                &.active-route {
                    font-weight: 700;
                }

                &:hover {
                    background-color: var(--menuitem-hover-bg-color);
                }
            }
    
            ul {
                overflow: hidden;
                border-radius: var(--border-radius);
    
                li {
                    a {
                        padding-left: 2.5rem;
                    }
    
                    li {
                        a {
                            padding-left: 3rem;
                        }
    
                        li {
                            a {
                                padding-left: 3.5rem;
                            }
    
                            li {
                                a {
                                    padding-left: 4rem;
                                }
    
                                li {
                                    a {
                                        padding-left: 5.5rem;
                                    }
    
                                    li {
                                        a {
                                            padding-left: 5rem;
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}
</file>

<file path="src/assets/layout/_topbar.scss">
.layout-topbar {
    margin-bottom: 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;

    .topbar-start {
        display: flex;
        align-items: center;

        .topbar-menubutton {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 2rem;
            border-radius: 50%;
            width: 2.5rem;
            height: 2.5rem;
            flex-shrink: 0;
            background-color: transparent;
            border: transparent;
            transition: background-color var(--layout-section-transition-duration);

            i {
                font-size: 1.25rem;
                color: var(--text-color);
                transition: color var(--layout-section-transition-duration);
            }

            &:hover {
                background-color: var(--primary-color);

                i {
                    color: var(--primary-color-text);
                }
            }
        }
    }

    .topbar-menu {
        display: flex;
        align-items: center;
        margin: 0;
        padding: 0;
        list-style: none;
        gap: 1rem;

        li {
            &.topbar-profile {
                display: inline-flex;
                align-items: center;
                justify-content: center;

                img {
                    width: 100%;
                    height: 100%;
                }

                button {
                    background-color: transparent;
                    margin: 0;
                    padding: 0;
                    border: none;
                    border-radius: 50%;
                    width: 2.5rem;
                    height: 2.5rem;
                    transition: box-shadow var(--layout-section-transition-duration);

                    &:focus {
                        box-shadow: var(--focus-ring);
                    }
                }
            }

            &.topbar-search {
                .p-inputtext {
                    padding-top: 0.5rem;
                    padding-bottom: 0.5rem;
                    border-radius: 2rem;
                }
            }
        }
    }
}

.config-panel {
    .config-panel-label {
        font-size: 0.875rem;
        color: var(--text-secondary-color);
        font-weight: 600;
        line-height: 1;
    }

    .config-panel-colors {
        > div {
            padding-top: 0.5rem;
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            justify-content: space-between;

            button {
                border: none;
                width: 1.25rem;
                height: 1.25rem;
                border-radius: 50%;
                padding: 0;
                cursor: pointer;
                outline-color: transparent;
                outline-width: 2px;
                outline-style: solid;
                outline-offset: 1px;

                &.active-color {
                    outline-color: var(--primary-color);
                }
            }
        }
    }

    .config-panel-settings {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }
}
</file>

<file path="src/assets/layout/_utils.scss">
.card {
    background: var(--surface-card);
    border: 1px solid var(--surface-border);
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: var(--card-shadow);
    border-radius: 12px;

    &:last-child {
        margin-bottom: 0;
    }
}

.p-toast {
    &.p-toast-top-right,
    &.p-toast-top-left,
    &.p-toast-top-center {
        top: 70px;
    }
}
</file>

<file path="src/assets/layout/layout.scss">
@use './_sass_variables' as *;
@use './variables/_common';
@use './variables/_light';
@use './variables/_dark';
@use './_fonts';
@use './_main';
@use './_sidebar_vertical';
@use './_sidebar_slim';
@use './_sidebar_slim_plus';
@use './_sidebar_horizontal';
@use './_sidebar_reveal';
@use './_sidebar_drawer'; 
@use './menutheme/_menutheme';
@use './_responsive';
@use './_topbar';
@use './_breadcrumb';
@use './_profile';
@use './_config';
@use './_content';
@use './_utils';
@use './_overrides';
</file>

<file path="src/assets/layout/menutheme/_colorscheme.scss">
.layout-colorscheme-menu {
    --logo-color: var(--primary-color);
    --menu-bg: var(--surface-overlay);
    --root-menuitem-text-color: var(--primary-color);
    --menuitem-text-color: var(--text-color);
    --menuitem-icon-color: var(--primary-color);
    --menuitem-hover-bg-color: var(--surface-hover);
    --popup-submenu-item-text-color: var(--text-color);
    --popup-submenu-item-icon-color: var(--primary-color);
    --popup-submenu-item-hover-bg-color: var(--surface-hover);
}
</file>

<file path="src/assets/layout/menutheme/_menutheme.scss">
@use './_colorscheme';
@use './_primarycolor';
@use './_transparent';
</file>

<file path="src/assets/layout/menutheme/_primarycolor.scss">
.layout-primarycolor-menu {
    --logo-color: var(--primary-color-text);
    --menu-bg: linear-gradient(to left top, var(--p-primary-400), var(--p-primary-500), var(--p-primary-600));
    --root-menuitem-text-color: var(--primary-color-text);
    --menuitem-text-color: var(--primary-color-text);
    --menuitem-icon-color: var(--primary-color-text);
    --menuitem-hover-bg-color: rgba(255, 255, 255, 0.1);
    --popup-submenu-item-text-color: var(--text-color);
    --popup-submenu-item-icon-color: var(--primary-color);
    --popup-submenu-item-hover-bg-color: var(--surface-hover);
}

.layout-dark.layout-primarycolor-menu,
.layout-dim.layout-primarycolor-menu {
    --menu-bg: linear-gradient(to left top, var(--p-primary-300), var(--p-primary-400), var(--p-primary-500));
}
</file>

<file path="src/assets/layout/menutheme/_transparent.scss">
@use '../_sass_variables' as *;

.layout-transparent-menu {
    --logo-color: var(--primary-color);
    --menu-bg: var(--surface-overlay);
    --root-menuitem-text-color: var(--primary-color);
    --menuitem-text-color: var(--text-color);
    --menuitem-icon-color: var(--primary-color);
    --menuitem-hover-bg-color: var(--surface-hover);
    --popup-submenu-item-text-color: var(--text-color);
    --popup-submenu-item-icon-color: var(--primary-color);
    --popup-submenu-item-hover-bg-color: var(--surface-hover);
}

@media screen and (min-width: $breakpoint) {
    .layout-container.layout-transparent-menu {
        &.layout-static,
        &.layout-slim,
        &.layout-slim-plus,
        &.layout-horizontal {
            .layout-sidebar {
                background-color: transparent;
                border-right: 1px solid transparent;
                box-shadow: none;
            }
        }
    }
}
</file>

<file path="src/assets/layout/variables/_common.scss">
:root {
    --primary-color: var(--p-primary-color);
    --primary-color-text: var(--p-primary-contrast-color);
    --text-color: var(--p-text-color);
    --text-color-secondary: var(--p-text-muted-color);
    --surface-border: var(--p-content-border-color);
    --surface-card: var(--p-content-background);
    --surface-hover: var(--p-content-hover-background);
    --surface-overlay: var(--p-overlay-popover-background);
    --transition-duration: var(--p-transition-duration);
    --maskbg: var(--p-mask-background);
    --border-radius: var(--p-content-border-radius);
    --layout-section-transition-duration: 0.2s;
    --focus-ring-shadow: var(--p-focus-ring-shadow);
}
</file>

<file path="src/assets/layout/variables/_dark.scss">
:root[class*='app-dark'] {
    --surface-ground: var(--p-surface-950);
    --sidebar-shadow: none;
    --sidebar-border: 1px solid var(--surface-border);
    --card-shadow: none;
}
</file>

<file path="src/assets/layout/variables/_light.scss">
:root {
    --surface-ground: var(--p-surface-100);
    --sidebar-shadow: 0px 4px 50px #d9ddfc;
    --sidebar-border: 1px solid transparent;
    --card-shadow: 0px 4px 30px rgba(221, 224, 255, 0.54);
}
</file>

<file path="src/assets/styles.scss">
/* You can add global styles to this file, and also import other style files */
@use './tailwind.css';

// PrimeNG Icons
@use 'primeicons/primeicons.css';

// Apollo Layout Styles (CRITICAL - this loads all sidebar/layout CSS)
@use './layout/layout.scss';

// Demo styles (optional)



.layout-container.layout-drawer {
    .layout-sidebar {
        transform: translateX(-100%) !important;
        transition: transform 0.3s cubic-bezier(0, 0, 0.2, 1) !important;
        z-index: 999 !important;
        width: 18rem !important;
    }

    // Show when menu is active
    &.layout-mobile-active .layout-sidebar,
    &.layout-overlay-active .layout-sidebar,
    &.layout-sidebar-active .layout-sidebar {
        transform: translateX(0) !important;
    }

    // Keep content at left edge (no margin)
    .layout-content-wrapper {
        margin-left: 0 !important;
    }

    // Topbar on top
    .layout-topbar {
        z-index: 1001 !important;
        left: 0 !important; // âœ… Don't shift with sidebar
    }

    // Show mask when sidebar is open
    .layout-mask {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.4);
        z-index: 998;
    }

    &.layout-mobile-active .layout-mask,
    &.layout-overlay-active .layout-mask,
    &.layout-sidebar-active .layout-mask {
        display: block !important;
    }
}

// PrimeNG Drawer stays above
.p-drawer {
    z-index: 1100 !important;
}

.p-drawer-mask {
    z-index: 1099 !important;
}
</file>

<file path="src/assets/tailwind.css">
@import "tailwindcss";
@import "tailwindcss-primeui";
@custom-variant dark (&:where(.app-dark, .app-dark *));

@theme {
    --breakpoint-sm: 576px;
    --breakpoint-md: 768px;
    --breakpoint-lg: 992px;
    --breakpoint-xl: 1200px;
    --breakpoint-2xl: 1920px;
}
</file>

<file path="src/environment/environment.development.ts">
export const environment = {
  production: false,
  convexUrl: 'https://adventurous-toad-869.convex.cloud'
};
</file>

<file path="src/environment/prod.environment.ts">
export const environment = {
  production: false,
  convexUrl: 'https://adventurous-toad-869.convex.cloud'
};
</file>

<file path="src/index.html">
<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Apollo - PrimeNG</title>
        <base href="/" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="preconnect" href="https://primefaces.org" />
        <link rel="icon" type="image/x-icon" href="/favicon.ico" />
        <link href="https://fonts.cdnfonts.com/css/lato" rel="stylesheet" />
    </head>

    <body>
        <app-root>
            <div class="layout-preloader-container">
                <div class="layout-preloader">
                    <span></span>
                </div>
            </div>
        </app-root>
    </body>
</html>
</file>

<file path="src/main.ts">
/// <reference types="@angular/localize" />

import { bootstrapApplication } from '@angular/platform-browser';
import { appConfig } from './app.config';
import { AppComponent } from './app.component';

bootstrapApplication(AppComponent, appConfig).catch((err) => console.error(err));
</file>

<file path="tsconfig.app.json">
/* To learn more about Typescript configuration file: https://www.typescriptlang.org/docs/handbook/tsconfig-json.html. */
/* To learn more about Angular compiler options: https://angular.dev/reference/configs/angular-compiler-options. */
{
    "extends": "./tsconfig.json",
    "compilerOptions": {
        "outDir": "./out-tsc/app",
       "types": [
  "@angular/localize",
  "node"
]
    },
    "files": [
        "src/main.ts"
    ],
    "include": [
        "src/**/*.d.ts"
    ]
}
</file>

<file path="tsconfig.json">
{
    "compileOnSave": false,
    "compilerOptions": {
        "outDir": "./dist/out-tsc",
        "strict": true,
        "noImplicitOverride": true,
        "noPropertyAccessFromIndexSignature": false,
        "noImplicitReturns": true,
        "noFallthroughCasesInSwitch": true,
        "skipLibCheck": true,
        "isolatedModules": true,
        "esModuleInterop": true,
        "experimentalDecorators": true,
        "moduleResolution": "bundler",
        "importHelpers": true,
        "target": "ES2022",
        "module": "ES2022",
        "baseUrl": "./",
        "paths": {
            "@/*": ["src/app/*"],
            "convex/*": ["../admin-backend/convex/*"]
        },
        "types": ["node"]  // âœ… Add this back - allows Buffer and process types
    },
    "angularCompilerOptions": {
        "enableI18nLegacyMessageIdFormat": false,
        "strictInjectionParameters": true,
        "strictInputAccessModifiers": true,
        "strictTemplates": true
    }
}
</file>

<file path="tsconfig.spec.json">
/* To learn more about Typescript configuration file: https://www.typescriptlang.org/docs/handbook/tsconfig-json.html. */
/* To learn more about Angular compiler options: https://angular.dev/reference/configs/angular-compiler-options. */
{
    "extends": "./tsconfig.json",
    "compilerOptions": {
        "outDir": "./out-tsc/spec",
        "types": [
          "jasmine",
          "@angular/localize"
        ]
    },
    "include": [
        "src/**/*.spec.ts",
        "src/**/*.d.ts"
    ]
}
</file>

<file path="vercel.json">
{
    "rewrites": [
        {
            "source": "/:path*",
            "destination": "/index.html"
        }
    ],
    "trailingSlash": false
}
</file>

</files>
